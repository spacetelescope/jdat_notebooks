

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>MIRI PSF Photometry with Photutils &#8212; STScI JDAT Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-D46G4HKJY3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/MIRI/psf_photometry/miri_photutils';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="STScI JDAT Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="STScI JDAT Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">General</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebook_development_workflow.html">Notebook Development Workflow</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/submitting_notebooks.html">Submitting Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/requirements.html">Requirements file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebooks.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/data_files.html">Data Files</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">GitHub Guidelines</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_setup.html">GitHub Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_workflow.html">GitHub Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_pr.html">GitHub PR</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Cross-Instrument</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/asdf_example/asdf_example.html">ASDF Example</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/background_estimation_imaging/Imaging_Sky_Background_Estimation.html">Complex 2D Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/composite_model_fitting/specfit_demo_3.html">Composite Model Spectral Fitting</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">MAST Query</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/rgb_imviz/imviz_rgb_carina.html">RGB images with Imviz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">Specviz Simple Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/update_pure_parallel_wcs/NIRISS_correct_pure_parallel_WCS.html">Improving Accuracy of WCS of Pure Parallel Dataset</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MIRI</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">MRS Mstar - Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">IFU of YSOs in LMC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MIRI_LRS_spectral_extraction/miri_lrs_advanced_extraction_part1.html">LRS Optimal Spectral Extraction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRCam</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/aperture_photometry/NIRCam_Aperture_Photometry_Example.html">Point Source Aperture Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_photometry/NIRCam_multiband_photometry.html">Extended Aperture Photometry</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">Cross-Filter PSF Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/psf_photometry/NIRCam_PSF_Photometry_Example.html">PSF Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_wisp_subtraction/nircam_wisp_subtraction.html">NIRCam Wisp Removal</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRISS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/00_Optimal_extraction.html">WFSS Spectra - Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/01_Combine_and_normalize_1D_spectra.html">WFSS Spectra - Combine and Normalize 1D Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/02_Cross_correlation_template.html">WFSS Spectra - Cross-Correlation Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map.html">WFSS Spectra - Emission Line Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/00_niriss_mast_query_data_setup.html">NIRISS MAST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/01_niriss_wfss_image2_image3.html">Direct imaging for WFSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/02_niriss_wfss_spec2.html">Spec2 pipeline for WFSS</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRSpec</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html">IFU Cube Fitting</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/cube_fitting/cube_fitting.html">IFU Cube Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/ifu_optimal/ifu_optimal.html">IFU Optimal Spectral Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/optimal_extraction/Spectral_Extraction-static.html">MOS Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/mos_spectroscopy_advanced/MOSspec_advanced.html">MOS Spectroscopy of Extragalactic Field</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">BOTS Time Series Observations</a></li>








<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/galaxy_redshift/redshift_fitting.html">Redshift and Template Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/FS_NSClean_example.html">FS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/IFU_NSClean_example.html">IFU Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/MOS_NSClean_example.html">MOS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/BOTS_NSClean_example.html">BOTS Products with NSClean</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/MIRI/psf_photometry/miri_photutils.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/MIRI/psf_photometry/miri_photutils.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>MIRI PSF Photometry with Photutils</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">MIRI PSF Photometry with Photutils</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of contents</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-class-anchor-id-intro-a">1. Introduction <a class="anchor" id="intro"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-imports-a-class-anchor-id-imports-a">1.1 Python Imports <a class="anchor" id="imports"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-set-up-required-data-for-webbpsf-and-synphot-a-class-anchor-id-setup-a">1.2 Download and Set up Required Data for WebbPSF and Synphot <a class="anchor" id="setup"></a></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download-jwst-miri-data-a-class-anchor-id-data-a">2. Download JWST MIRI Data <a class="anchor" id="data"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#single-bright-star-a-class-anchor-id-bso-a">3. Single Bright Star <a class="anchor" id="bso"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#single-level-2-file-a-class-anchor-id-bso2-a">3.1 Single Level 2 File <a class="anchor" id="bso2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-empirical-psf-grid-for-miri-f770w-using-webbpsf-a-class-anchor-id-bso3-a">3.2 Generate empirical PSF grid for MIRI F770W using WebbPSF <a class="anchor" id="bso3"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-photometry-a-class-anchor-id-bso4-a">3.3 PSF Photometry <a class="anchor" id="bso4"></a></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#faint-upper-limit-single-object-a-class-anchor-id-fso-a">4. Faint/Upper Limit, Single Object <a class="anchor" id="fso"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#note-you-can-go-significantly-deeper-with-the-level-3-combined-data-product">Note: you can go significantly deeper with the Level 3 combined data product</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#stellar-field-lmc-a-class-anchor-id-lmc-a">5. Stellar Field (LMC) <a class="anchor" id="lmc"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-stars-single-level-2-file-a-class-anchor-id-lmc2-a">5.1 Multiple Stars, Single Level 2 File <a class="anchor" id="lmc2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-empirical-psf-grid-for-miri-f560w-using-webbpsf-a-class-anchor-id-grid2-a">5.2 Generate empirical PSF grid for MIRI F560W using WebbPSF <a class="anchor" id="grid2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-photometry-a-class-anchor-id-lmc3-a">5.3 PSF Photometry <a class="anchor" id="lmc3"></a></a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="miri-psf-photometry-with-photutils">
<h1>MIRI PSF Photometry with Photutils<a class="headerlink" href="#miri-psf-photometry-with-photutils" title="Permalink to this heading">#</a></h1>
<p><strong>Author</strong>: Ori Fox<br></p>
<p><strong>Submitted</strong>: November, 2023<br>
<strong>Updated</strong>: November, 2023<br></p>
<p><strong>Use case</strong>: PSF Photometry using <a class="reference external" href="https://photutils.readthedocs.io/en/stable/">Photutils</a>. The purpose here is to illustrate the workflow and runtime for using Photutils in a variety of use cases.</p>
<p>Generally, PSF photometry for data from a space telescope is most accurately performed on pre-mosaiced data. The mosaic process changes the inherent PSF, blurring it both due to resampling and mixing PSFs at different detector positions and rotations.  Additionally, accurate theoretical PSF models (e.g., from <a class="reference external" href="https://webbpsf.readthedocs.io/en/latest/">WebbPSF</a>) are not available for mosaiced data. While an empirical PSF could be constructed (e.g., using Photutils <a class="reference external" href="https://photutils.readthedocs.io/en/latest/epsf.html">ePSFBuilder</a>) for mosaiced data, the results will generally not be as accurate as performing PSF photometry on the pre-mosaiced data.</p>
<p><strong>NOTE:</strong> A companion notebook exists that illustrates how to use perform PSF photometry on both Level 2 and Level 3 data using a new software program called space_phot.<br>
<strong>Data</strong>: MIRI Data PID 1028 (Calibration Program; Single Star Visit 006 A5V dwarf 2MASSJ17430448+6655015) and MIRI Data PID 1171 (LMC; Multiple Stars).<br>
<strong>Tools</strong>: photutils, webbpsf, jwst <br>
<strong>Cross-Instrument</strong>: MIRI<br>
<strong>Documentation:</strong> This notebook is part of a STScIâ€™s larger <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-post-pipeline-data-analysis">post-pipeline Data Analysis Tools Ecosystem</a> and can be <a class="reference external" href="https://github.com/spacetelescope/dat_pyinthesky/tree/main/jdat_notebooks/MRS_Mstar_analysis">downloaded</a> directly from the <a class="reference external" href="https://github.com/spacetelescope/jdat_notebooks">JDAT Notebook Github directory</a>.<br></p>
<section id="table-of-contents">
<h2>Table of contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><span class="xref myst">Introduction</span><br>
1.1 <span class="xref myst">Python Imports</span><br>
1.2 <span class="xref myst">Set up WebbPSF and Synphot</span><br></p></li>
<li><p><span class="xref myst">Download JWST MIRI Data</span><br></p></li>
<li><p><span class="xref myst">Single Bright Object</span><br>
3.1 <span class="xref myst">Single Level 2 File</span><br>
3.2 <span class="xref myst">Generate empirical PSF grid for MIRI F770W using WebbPSF</span><br>
3.3 <span class="xref myst">PSF Photometry</span><br></p></li>
<li><p><span class="xref myst">Faint/Upper Limit, Single Object</span><br>
4.1 <span class="xref myst">Multiple, Level2 Files</span><br></p></li>
<li><p><span class="xref myst">Stellar Field (LMC)</span><br>
5.1 <span class="xref myst">Multiple Stars, Single Level 2 File</span><br>
5.2 <span class="xref myst">Generate empirical PSF grid for MIRI F560W using WebbPSF</span><br>
5.3 <span class="xref myst">PSF Photometry</span><br></p></li>
</ol>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction-a-class-anchor-id-intro-a">
<h1>1. Introduction <a class="anchor" id="intro"></a><a class="headerlink" href="#introduction-a-class-anchor-id-intro-a" title="Permalink to this heading">#</a></h1>
<p><strong>GOALS</strong>:<br></p>
<p>Perform PSF photometry on JWST MIRI images with the <a class="reference external" href="https://photutils.readthedocs.io/en/latest/psf.html">Photutils PSF Photometry tools</a> using a grid of empirical PSF models from WebbPSF.</p>
<p>The notebook shows how to:<br></p>
<ul class="simple">
<li><p>generate a <a class="reference external" href="https://webbpsf.readthedocs.io/en/latest/psf_grids.html">grid of empirical PSF models</a> from WebbPSF<br></p></li>
<li><p>perform PSF photometry on the image using the <a class="reference external" href="https://photutils.readthedocs.io/en/latest/api/photutils.psf.PSFPhotometry.html#photutils.psf.PSFPhotometry">PSFPhotometry class</a><br></p></li>
</ul>
<p><strong>Data</strong>:<br></p>
<p>MIRI Data PID 1028 (Calibration Program), F770W <br>
MIRI Data PID 1171 (LMC), F560W/F770W</p>
<section id="python-imports-a-class-anchor-id-imports-a">
<h2>1.1 Python Imports <a class="anchor" id="imports"></a><a class="headerlink" href="#python-imports-a-class-anchor-id-imports-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">tarfile</span>
<span class="kn">from</span> <span class="nn">pandas</span> <span class="kn">import</span> <span class="n">DataFrame</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">webbpsf</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">extract_array</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">simple_norm</span>
<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">from</span> <span class="nn">jwst.datamodels</span> <span class="kn">import</span> <span class="n">ImageModel</span>
<span class="kn">from</span> <span class="nn">photutils.aperture</span> <span class="kn">import</span> <span class="n">CircularAperture</span>
<span class="kn">from</span> <span class="nn">photutils.background</span> <span class="kn">import</span> <span class="n">LocalBackground</span><span class="p">,</span> <span class="n">MADStdBackgroundRMS</span><span class="p">,</span> <span class="n">MMMBackground</span>
<span class="kn">from</span> <span class="nn">photutils.detection</span> <span class="kn">import</span> <span class="n">DAOStarFinder</span>
<span class="kn">from</span> <span class="nn">photutils.psf</span> <span class="kn">import</span> <span class="n">GriddedPSFModel</span><span class="p">,</span> <span class="n">PSFPhotometry</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-and-set-up-required-data-for-webbpsf-and-synphot-a-class-anchor-id-setup-a">
<h2>1.2 Download and Set up Required Data for WebbPSF and Synphot <a class="anchor" id="setup"></a><a class="headerlink" href="#download-and-set-up-required-data-for-webbpsf-and-synphot-a-class-anchor-id-setup-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set environmental variables</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;WEBBPSF_PATH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;./webbpsf-data/webbpsf-data&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PYSYN_CDBS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;./grp/redcat/trds/&quot;</span>

<span class="c1"># required webbpsf data</span>
<span class="n">boxlink</span> <span class="o">=</span> <span class="s1">&#39;https://stsci.box.com/shared/static/qxpiaxsjwo15ml6m4pkhtk36c9jgj70k.gz&#39;</span>                                                          
<span class="n">boxfile</span> <span class="o">=</span> <span class="s1">&#39;./webbpsf-data/webbpsf-data-LATEST.tar.gz&#39;</span>
<span class="n">synphot_url</span> <span class="o">=</span> <span class="s1">&#39;http://ssb.stsci.edu/trds/tarfiles/synphot5.tar.gz&#39;</span>
<span class="n">synphot_file</span> <span class="o">=</span> <span class="s1">&#39;./synphot5.tar.gz&#39;</span>

<span class="n">webbpsf_folder</span> <span class="o">=</span> <span class="s1">&#39;./webbpsf-data&#39;</span>
<span class="n">synphot_folder</span> <span class="o">=</span> <span class="s1">&#39;./grp&#39;</span>


<span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported URL scheme: </span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dest_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>


<span class="c1"># Gather webbpsf files</span>
<span class="n">psfExist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">webbpsf_folder</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">psfExist</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">webbpsf_folder</span><span class="p">)</span>
    <span class="n">download_file</span><span class="p">(</span><span class="n">boxlink</span><span class="p">,</span> <span class="n">boxfile</span><span class="p">)</span>
    <span class="n">gzf</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">boxfile</span><span class="p">)</span>
    <span class="n">gzf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">webbpsf_folder</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="c1"># Gather synphot files</span>
<span class="n">synExist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">synphot_folder</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">synExist</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">synphot_folder</span><span class="p">)</span>
    <span class="n">download_file</span><span class="p">(</span><span class="n">synphot_url</span><span class="p">,</span> <span class="n">synphot_file</span><span class="p">)</span>
    <span class="n">gzf</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">synphot_file</span><span class="p">)</span>
    <span class="n">gzf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="download-jwst-miri-data-a-class-anchor-id-data-a">
<h1>2. Download JWST MIRI Data <a class="anchor" id="data"></a><a class="headerlink" href="#download-jwst-miri-data-a-class-anchor-id-data-a" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download Proposal ID 1028 F770W data</span>

<span class="c1"># Define source and destination directories</span>
<span class="n">source_dir</span> <span class="o">=</span> <span class="s1">&#39;mastDownload/JWST/&#39;</span>
<span class="n">destination_dir</span> <span class="o">=</span> <span class="s1">&#39;mast/01028/&#39;</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data already downloaded to </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Query the MAST (Mikulski Archive for Space Telescopes) database for observations</span>
    <span class="c1"># with proposal ID 1028 and the F770W filter</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">proposal_id</span><span class="o">=</span><span class="mi">1028</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F770W&#39;</span><span class="p">])</span>
    
    <span class="c1"># Get a list of products associated with the located observation</span>
    <span class="n">plist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    
    <span class="c1"># Filter the product list to include only specific product subgroups</span>
    <span class="n">fplist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span><span class="n">plist</span><span class="p">,</span> <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CAL&#39;</span><span class="p">,</span> <span class="s1">&#39;I2D&#39;</span><span class="p">,</span> <span class="s1">&#39;ASN&#39;</span><span class="p">])</span>
    
    <span class="c1"># Download the selected products from the MAST database</span>
    <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">fplist</span><span class="p">)</span>
    
    <span class="c1"># Create the destination directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span>
    
    <span class="c1"># Use glob to find all files matching the pattern</span>
    <span class="n">files_to_copy</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="s1">&#39;j*/jw01028*&#39;</span><span class="p">))</span>

    <span class="c1"># Copy the matching files to the destination directory</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files_to_copy</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241028t203024_image2_00013_asn.json to ./mastDownload/JWST/jw01028006001_02101_00004_mirimage/jw01028-o006_20241028t203024_image2_00013_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241028t203024_image2_00014_asn.json to ./mastDownload/JWST/jw01028006001_02101_00003_mirimage/jw01028-o006_20241028t203024_image2_00014_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241028t203024_image2_00015_asn.json to ./mastDownload/JWST/jw01028006001_02101_00002_mirimage/jw01028-o006_20241028t203024_image2_00015_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241028t203024_image2_00016_asn.json to ./mastDownload/JWST/jw01028006001_02101_00001_mirimage/jw01028-o006_20241028t203024_image2_00016_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241028t203024_image3_00004_asn.json to ./mastDownload/JWST/jw01028-o006_t001_miri_f770w/jw01028-o006_20241028t203024_image3_00004_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01028-o006_t001_miri_f770w/jw01028-o006_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00001_mirimage/jw01028006001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00001_mirimage/jw01028006001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00002_mirimage/jw01028006001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00002_mirimage/jw01028006001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00003_mirimage/jw01028006001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00003_mirimage/jw01028006001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00004_mirimage/jw01028006001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00004_mirimage/jw01028006001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download Proposal ID 1171 F550W and F770W data</span>

<span class="c1"># Define source and destination directories</span>
<span class="n">source_dir</span> <span class="o">=</span> <span class="s1">&#39;mastDownload/JWST/&#39;</span>
<span class="n">destination_dir</span> <span class="o">=</span> <span class="s1">&#39;mast/01171/&#39;</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data already downloaded to </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Query the MAST (Mikulski Archive for Space Telescopes) database for observations</span>
    <span class="c1"># with proposal ID 1171 and the F550W and F770W filters</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">proposal_id</span><span class="o">=</span><span class="mi">1171</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F560W&#39;</span><span class="p">,</span> <span class="s1">&#39;F770W&#39;</span><span class="p">])</span>
    
    <span class="c1"># Get a list of products associated with the located observation</span>
    <span class="n">plist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    
    <span class="c1"># Filter the product list to include only specific product subgroups</span>
    <span class="n">fplist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span><span class="n">plist</span><span class="p">,</span> <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CAL&#39;</span><span class="p">,</span> <span class="s1">&#39;I2D&#39;</span><span class="p">,</span> <span class="s1">&#39;ASN&#39;</span><span class="p">])</span>
    
    <span class="c1"># Download the selected products from the MAST database</span>
    <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">fplist</span><span class="p">)</span>
    
    <span class="c1"># Create the destination directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span>
    
    <span class="c1"># Use glob to find all files matching the pattern</span>
    <span class="n">files_to_copy</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="s1">&#39;j*/jw01171*&#39;</span><span class="p">))</span>
    
    <span class="c1"># Copy the matching files to the destination directory</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files_to_copy</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171001001_02101_00004_mirimage/jw01171-o001_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171001001_02101_00003_mirimage/jw01171-o001_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171001001_02101_00002_mirimage/jw01171-o001_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171001001_02101_00001_mirimage/jw01171-o001_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o001_t001_miri_f770w/jw01171-o001_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o001_t001_miri_f770w/jw01171-o001_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171002001_02101_00004_mirimage/jw01171-o002_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171002001_02101_00003_mirimage/jw01171-o002_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171002001_02101_00002_mirimage/jw01171-o002_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171002001_02101_00001_mirimage/jw01171-o002_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o002_t001_miri_f770w/jw01171-o002_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o002_t001_miri_f770w/jw01171-o002_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171003001_02101_00004_mirimage/jw01171-o003_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171003001_02101_00003_mirimage/jw01171-o003_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171003001_02101_00002_mirimage/jw01171-o003_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171003001_02101_00001_mirimage/jw01171-o003_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o003_t001_miri_f770w/jw01171-o003_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o003_t001_miri_f770w/jw01171-o003_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171004001_02101_00004_mirimage/jw01171-o004_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171004001_02101_00003_mirimage/jw01171-o004_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171004001_02101_00002_mirimage/jw01171-o004_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171004001_02101_00001_mirimage/jw01171-o004_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o004_t001_miri_f560w/jw01171-o004_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_t001_miri_f560w_i2d.fits to ./mastDownload/JWST/jw01171-o004_t001_miri_f560w/jw01171-o004_t001_miri_f560w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171005001_02101_00004_mirimage/jw01171-o005_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171005001_02101_00003_mirimage/jw01171-o005_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171005001_02101_00002_mirimage/jw01171-o005_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171005001_02101_00001_mirimage/jw01171-o005_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o005_t001_miri_f770w/jw01171-o005_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o005_t001_miri_f770w/jw01171-o005_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00001_mirimage/jw01171001001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00001_mirimage/jw01171001001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00002_mirimage/jw01171001001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00002_mirimage/jw01171001001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00003_mirimage/jw01171001001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00003_mirimage/jw01171001001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00004_mirimage/jw01171001001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00004_mirimage/jw01171001001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00001_mirimage/jw01171002001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00001_mirimage/jw01171002001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00002_mirimage/jw01171002001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00002_mirimage/jw01171002001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00003_mirimage/jw01171002001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00003_mirimage/jw01171002001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00004_mirimage/jw01171002001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00004_mirimage/jw01171002001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00001_mirimage/jw01171003001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00001_mirimage/jw01171003001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00002_mirimage/jw01171003001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00002_mirimage/jw01171003001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00003_mirimage/jw01171003001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00003_mirimage/jw01171003001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00004_mirimage/jw01171003001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00004_mirimage/jw01171003001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00001_mirimage/jw01171004001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00001_mirimage/jw01171004001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00002_mirimage/jw01171004001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00002_mirimage/jw01171004001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00003_mirimage/jw01171004001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00003_mirimage/jw01171004001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00004_mirimage/jw01171004001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00004_mirimage/jw01171004001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00001_mirimage/jw01171005001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00001_mirimage/jw01171005001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00002_mirimage/jw01171005001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00002_mirimage/jw01171005001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00003_mirimage/jw01171005001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00003_mirimage/jw01171005001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00004_mirimage/jw01171005001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00004_mirimage/jw01171005001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="single-bright-star-a-class-anchor-id-bso-a">
<h1>3. Single Bright Star <a class="anchor" id="bso"></a><a class="headerlink" href="#single-bright-star-a-class-anchor-id-bso-a" title="Permalink to this heading">#</a></h1>
<p>The purpose of this section is to illustrate how to perform PSF photometry on a single bright star. While aperture photometry is feasible in isolated cases, the user may find PSF photometry preferable in crowded fields or complicated backgrounds.</p>
<section id="single-level-2-file-a-class-anchor-id-bso2-a">
<h2>3.1 Single Level 2 File <a class="anchor" id="bso2"></a><a class="headerlink" href="#single-level-2-file-a-class-anchor-id-bso2-a" title="Permalink to this heading">#</a></h2>
<p>In this example, we fit a single, bright source in a single Level 2 images. For a collection of Level 2 images, we could fit each Level 2 image individually and then average the measured fluxes.</p>
<p>Useful references:<br>
HST Documentation on PSF Photometry: https://www.stsci.edu/hst/instrumentation/wfc3/data-analysis/psf<br>
WFPC2 Stellar Photometry with HSTPHOT: https://ui.adsabs.harvard.edu/abs/2000PASP..112.1383D/abstract<br>
Photutils PSF Fitting Photometry: https://photutils.readthedocs.io/en/stable/psf.html</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the level 2 filenames</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./mast/01028/&quot;</span>
<span class="n">level2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*cal.fits&#39;</span><span class="p">)))</span>
<span class="n">level2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits&#39;,
 &#39;./mast/01028/jw01028006001_02101_00002_mirimage_cal.fits&#39;,
 &#39;./mast/01028/jw01028006001_02101_00003_mirimage_cal.fits&#39;,
 &#39;./mast/01028/jw01028006001_02101_00004_mirimage_cal.fits&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the first level-2 image</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">level2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MJy/sr&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Pixels&#39;)
</pre></div>
</div>
<img alt="../../../_images/21a6474ea1dc424e8506119240ac778eb2d773a41a47e6f7d8505ee9fde0050c.png" src="../../../_images/21a6474ea1dc424e8506119240ac778eb2d773a41a47e6f7d8505ee9fde0050c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change all DQ flagged pixels to NaN.</span>
<span class="c1"># Here, we&#39;ll overwrite the original CAL file.</span>
<span class="c1"># Reference for JWST DQ Flag Definitions: https://jwst-pipeline.readthedocs.io/en/latest/jwst/references_general/references_general.html</span>
<span class="c1"># In this case, we choose all DQ &gt; 10, but users are encouraged to choose their own values accordingly.</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">level2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">dq</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Re-display the image</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">level2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MJy/sr&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Pixels&#39;)
</pre></div>
</div>
<img alt="../../../_images/8f3b7b77fa50b85fe385efaf9b1d7b791ace6c12985bcbc60e746bf306a5c24a.png" src="../../../_images/8f3b7b77fa50b85fe385efaf9b1d7b791ace6c12985bcbc60e746bf306a5c24a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zoom in to see the source. In this case, our source is from MIRI Program ID #1028, a Calibration Program.</span>
<span class="c1"># We are using Visit 006, which targets the A5V dwarf 2MASSJ17430448+6655015</span>
<span class="c1"># Reference Link: http://simbad.cds.unistra.fr/simbad/sim-basic?Ident=2MASSJ17430448%2B6655015&amp;submit=SIMBAD+search</span>
<span class="n">source_location</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="s1">&#39;17:43:04.4879&#39;</span><span class="p">,</span> <span class="s1">&#39;+66:55:01.837&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">source_location</span><span class="p">)</span>

<span class="n">cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">norm2</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">cutout</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MJy/sr&#39;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PID1028, Obs006&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Pixels&#39;)
</pre></div>
</div>
<img alt="../../../_images/71fd7b5600c5c9af0b4d3773250c4ebff47a04ebf3e02f6db2327b9ffe013a93.png" src="../../../_images/71fd7b5600c5c9af0b4d3773250c4ebff47a04ebf3e02f6db2327b9ffe013a93.png" />
</div>
</div>
</section>
<section id="generate-empirical-psf-grid-for-miri-f770w-using-webbpsf-a-class-anchor-id-bso3-a">
<h2>3.2 Generate empirical PSF grid for MIRI F770W using WebbPSF <a class="anchor" id="bso3"></a><a class="headerlink" href="#generate-empirical-psf-grid-for-miri-f770w-using-webbpsf-a-class-anchor-id-bso3-a" title="Permalink to this heading">#</a></h2>
<p>Letâ€™s now use WebbPSF to generate an empirical grid of ePSF models for MIRI F770W.
The output will be a Photutils <a class="reference external" href="https://photutils.readthedocs.io/en/latest/api/photutils.psf.GriddedPSFModel.html#photutils.psf.GriddedPSFModel">GriddedPSFModel</a> containing a 2x2 grid of detector-position-dependent empirical PSFs, each oversampled by a factor of 4. Note that we save the PSF grid to a FITS file (via <code class="docutils literal notranslate"><span class="pre">save=True</span></code>) called <code class="docutils literal notranslate"><span class="pre">miri_mirim_f770w_fovp101_samp4_npsf4.fits</span></code>.  To save time in future runs, we load this FITS file directly into a <code class="docutils literal notranslate"><span class="pre">GriddedPSFModel</span></code> object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psfgrid_filename</span> <span class="o">=</span> <span class="s1">&#39;miri_mirim_f770w_fovp101_samp4_npsf4.fits&#39;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">psfgrid_filename</span><span class="p">):</span>
    <span class="n">miri</span> <span class="o">=</span> <span class="n">webbpsf</span><span class="o">.</span><span class="n">MIRI</span><span class="p">()</span>
    <span class="n">miri</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="s1">&#39;F770W&#39;</span>
    <span class="n">psf_model</span> <span class="o">=</span> <span class="n">miri</span><span class="o">.</span><span class="n">psf_grid</span><span class="p">(</span><span class="n">num_psfs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">all_detectors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">psf_model</span> <span class="o">=</span> <span class="n">GriddedPSFModel</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">psfgrid_filename</span><span class="p">)</span>

<span class="n">psf_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/4: (0, 0) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:15:27,002 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/webbpsf/opds.py:1746: UserWarning: For (V2,V3) = [-6.36389848 -7.26853851] arcmin, Field point -6.3638984816102235 arcmin, -0.5632056 arcmin not within valid region for field dependence model of OTE WFE for MIRI: -8.254199999999999 arcmin--6.21738 arcmin, -2.557224 arcmin--0.5632056 arcmin. Clipping to closest available valid location, 0.031744109903437345 arcmin away from the requested coordinates.
  warnings.warn(f&#39;For (V2,V3) = {v2v3}, Field point {x_field_pt}, {y_field_pt} not within valid region for field dependence model of OTE WFE for {instrument}: {min_x_field}-{max_x_field}, {min_y_field}-{max_y_field}. Clipping to closest available valid location, {clip_dist} away from the requested coordinates.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/4 centroid: (201.4023624749013, 201.47046390597333)
    Position 2/4: (0, 1023) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:15:34,847 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/webbpsf/opds.py:1746: UserWarning: For (V2,V3) = [-6.21257653 -5.39972458] arcmin, Field point -6.21738 arcmin, -2.4002754231217454 arcmin not within valid region for field dependence model of OTE WFE for MIRI: -8.254199999999999 arcmin--6.21738 arcmin, -2.557224 arcmin--0.5632056 arcmin. Clipping to closest available valid location, 0.00480347054204433 arcmin away from the requested coordinates.
  warnings.warn(f&#39;For (V2,V3) = {v2v3}, Field point {x_field_pt}, {y_field_pt} not within valid region for field dependence model of OTE WFE for {instrument}: {min_x_field}-{max_x_field}, {min_y_field}-{max_y_field}. Clipping to closest available valid location, {clip_dist} away from the requested coordinates.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 2/4 centroid: (201.30690755776234, 201.33283949933355)
    Position 3/4: (1023, 0) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 3/4 centroid: (201.46001999611343, 201.57406698621335)
    Position 4/4: (1023, 1023) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:15:46,445 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/astropy/io/fits/card.py:1038: VerifyWarning: Card is too long, comment will be truncated.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 4/4 centroid: (201.71435554877664, 201.48197003471253)
  Saving file: miri_mirim_f770w_fovp101_samp4_npsf4.fits
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;GriddedPSFModel(flux=1., x_0=0., y_0=0.)&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the PSF grid</span>
<span class="n">psf_model</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/83d7dbca4bc26a51cdacf1c9fa734894d77d9f998892226b5445d795cce6a624.png" src="../../../_images/83d7dbca4bc26a51cdacf1c9fa734894d77d9f998892226b5445d795cce6a624.png" />
<img alt="../../../_images/83d7dbca4bc26a51cdacf1c9fa734894d77d9f998892226b5445d795cce6a624.png" src="../../../_images/83d7dbca4bc26a51cdacf1c9fa734894d77d9f998892226b5445d795cce6a624.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the PSF grid deltas from the mean ePSF</span>
<span class="n">psf_model</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">deltas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/c46cc4b49f6f070ee2c240fac888718655425202313b5b046aee44077b23fee3.png" src="../../../_images/c46cc4b49f6f070ee2c240fac888718655425202313b5b046aee44077b23fee3.png" />
<img alt="../../../_images/c46cc4b49f6f070ee2c240fac888718655425202313b5b046aee44077b23fee3.png" src="../../../_images/c46cc4b49f6f070ee2c240fac888718655425202313b5b046aee44077b23fee3.png" />
</div>
</div>
</section>
<section id="psf-photometry-a-class-anchor-id-bso4-a">
<h2>3.3 PSF Photometry <a class="anchor" id="bso4"></a><a class="headerlink" href="#psf-photometry-a-class-anchor-id-bso4-a" title="Permalink to this heading">#</a></h2>
<p>Now letâ€™s use our gridded PSF model to perform PSF photometry.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load data and convert units from MJy/sr to uJy</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">bunit_data</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">err</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>

    <span class="c1"># use pixel area map because of geometric distortion in level-2 data </span>
    <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">photometry</span><span class="o">.</span><span class="n">pixelarea_steradians</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span>
    <span class="n">data</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    <span class="n">error</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>

<span class="n">data</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">unit</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Unit(&quot;uJy&quot;), Unit(&quot;uJy&quot;))
</pre></div>
</div>
</div>
</div>
<p>To perform photometry on a single source we can input a Table containing its (x, y) position.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">init_params</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
<span class="n">init_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=1</i>
<table id="table140217790751824" class="table-striped table-bordered table-condensed">
<thead><tr><th>x</th><th>y</th></tr></thead>
<thead><tr><th>float64</th><th>float64</th></tr></thead>
<tr><td>691.0126389412841</td><td>512.5838903335235</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we turn off the finder because we input the source position</span>
<span class="n">fit_shape</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">localbkg_estimator</span> <span class="o">=</span> <span class="n">LocalBackground</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">bkg_estimator</span><span class="o">=</span><span class="n">MMMBackground</span><span class="p">())</span>
<span class="n">psfphot</span> <span class="o">=</span> <span class="n">PSFPhotometry</span><span class="p">(</span><span class="n">psf_model</span><span class="p">,</span> <span class="n">fit_shape</span><span class="p">,</span> <span class="n">finder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aperture_radius</span><span class="o">=</span><span class="n">fit_shape</span><span class="p">,</span> 
                        <span class="n">localbkg_estimator</span><span class="o">=</span><span class="n">localbkg_estimator</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">phot</span> <span class="o">=</span> <span class="n">psfphot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">init_params</span><span class="o">=</span><span class="n">init_params</span><span class="p">)</span>
<span class="n">phot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:15:47,461 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/photutils/psf/photometry.py:346: AstropyUserWarning: Input data contains unmasked non-finite values (NaN or inf), which were automatically ignored.
  warnings.warn(&#39;Input data contains unmasked non-finite values &#39;
</pre></div>
</div>
<div class="output text_html"><div><i>QTable length=1</i>
<table id="table140217790361168" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>group_id</th><th>local_bkg</th><th>x_init</th><th>y_init</th><th>flux_init</th><th>x_fit</th><th>y_fit</th><th>flux_fit</th><th>x_err</th><th>y_err</th><th>flux_err</th><th>npixfit</th><th>group_size</th><th>qfit</th><th>cfit</th><th>flags</th></tr></thead>
<thead><tr><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>int64</th></tr></thead>
<tr><td>1</td><td>1</td><td>1.4397037772319776</td><td>691.0126389412841</td><td>512.5838903335235</td><td>475.7886379871932</td><td>691.179636780988</td><td>512.9113038644382</td><td>452.42267160623965</td><td>0.0010104372890293197</td><td>0.0010233534547689721</td><td>0.49982426715183176</td><td>25</td><td>1</td><td>0.7077179013668748</td><td>-0.01809988847561868</td><td>0</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert fit flux from uJy to ABmag</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_fit&#39;</span><span class="p">]</span>
<span class="n">flux_err</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_err&#39;</span><span class="p">]</span>
<span class="n">mag</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_fit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ABmag</span><span class="p">)</span>
<span class="n">magerr</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">flux_err</span> <span class="o">/</span> <span class="n">flux</span><span class="p">))</span>
<span class="n">magerr</span> <span class="o">=</span> <span class="n">magerr</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">ABmag</span>
<span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Magnitude [17.2611391] mag(AB)&gt;, &lt;Magnitude [0.00119883] mag(AB)&gt;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">cutout1</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">cutout1</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">98</span><span class="p">)</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout1</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Data ($\mu$Jy)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">psfphot</span><span class="o">.</span><span class="n">make_model_image</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
<span class="n">cutout2</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout2</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fit PSF Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">resid</span> <span class="o">=</span> <span class="n">psfphot</span><span class="o">.</span><span class="n">make_residual_image</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
<span class="n">cutout3</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">resid</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">norm3</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">cutout3</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout3</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f86ff09add0&gt;
</pre></div>
</div>
<img alt="../../../_images/39508729849faa20bf3b0aa1cc7caa126e0fddf15ea7183d0e3d9f9259148c7c.png" src="../../../_images/39508729849faa20bf3b0aa1cc7caa126e0fddf15ea7183d0e3d9f9259148c7c.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="faint-upper-limit-single-object-a-class-anchor-id-fso-a">
<h1>4. Faint/Upper Limit, Single Object <a class="anchor" id="fso"></a><a class="headerlink" href="#faint-upper-limit-single-object-a-class-anchor-id-fso-a" title="Permalink to this heading">#</a></h1>
<p>The purpose of this section is to illustrate how to calculate an upper limit at a fixed (x, y) position using forced PSF photometry a blank part of the sky.</p>
<p>Weâ€™ll use the same data as Section 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load data and convert units from MJy/sr to uJy</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">bunit_data</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">err</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    
    <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">photometry</span><span class="o">.</span><span class="n">pixelarea_steradians</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span>
    <span class="n">data</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    <span class="n">error</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>

<span class="n">source_location</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="s1">&#39;17:43:00.0332&#39;</span><span class="p">,</span> <span class="s1">&#39;+66:54:42.677&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">source_location</span><span class="p">)</span>

<span class="n">cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">cutout</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mu$Jy&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PID1028, Obs006&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Pixels&#39;)
</pre></div>
</div>
<img alt="../../../_images/0bef0c96631711b8c1bb83bdcfc1db15857f1e6483cd98a9a8b459340500a394.png" src="../../../_images/0bef0c96631711b8c1bb83bdcfc1db15857f1e6483cd98a9a8b459340500a394.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to perform forced photometry, we set the (x, y) source position</span>
<span class="c1"># AND we fix the PSF model position so that it does not vary in the fit</span>
<span class="c1"># (only flux will be fit)</span>
<span class="n">init_params</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>

<span class="c1"># This requires photutils 1.11.0</span>
<span class="n">psf_model_forced</span> <span class="o">=</span> <span class="n">psf_model</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">psf_model_forced</span><span class="o">.</span><span class="n">x_0</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">psf_model_forced</span><span class="o">.</span><span class="n">y_0</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">psf_model_forced</span><span class="o">.</span><span class="n">fixed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;flux&#39;: False, &#39;x_0&#39;: True, &#39;y_0&#39;: True}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_shape</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">localbkg_estimator</span> <span class="o">=</span> <span class="n">LocalBackground</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">bkg_estimator</span><span class="o">=</span><span class="n">MMMBackground</span><span class="p">())</span>
<span class="n">psfphot</span> <span class="o">=</span> <span class="n">PSFPhotometry</span><span class="p">(</span><span class="n">psf_model_forced</span><span class="p">,</span> <span class="n">fit_shape</span><span class="p">,</span> <span class="n">finder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aperture_radius</span><span class="o">=</span><span class="n">fit_shape</span><span class="p">,</span> 
                        <span class="n">localbkg_estimator</span><span class="o">=</span><span class="n">localbkg_estimator</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">phot</span> <span class="o">=</span> <span class="n">psfphot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">init_params</span><span class="o">=</span><span class="n">init_params</span><span class="p">)</span>
<span class="n">phot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:15:48,774 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/photutils/psf/photometry.py:346: AstropyUserWarning: Input data contains unmasked non-finite values (NaN or inf), which were automatically ignored.
  warnings.warn(&#39;Input data contains unmasked non-finite values &#39;
</pre></div>
</div>
<div class="output text_html"><div><i>QTable length=1</i>
<table id="table140217777617744" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>group_id</th><th>local_bkg</th><th>x_init</th><th>y_init</th><th>flux_init</th><th>x_fit</th><th>y_fit</th><th>flux_fit</th><th>x_err</th><th>y_err</th><th>flux_err</th><th>npixfit</th><th>group_size</th><th>qfit</th><th>cfit</th><th>flags</th></tr></thead>
<thead><tr><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>int64</th></tr></thead>
<tr><td>1</td><td>1</td><td>1.2926637902219071</td><td>559.0832487866571</td><td>772.8615809732944</td><td>99.6914129363197</td><td>559.0832487866571</td><td>772.8615809732944</td><td>-0.3700018357369572</td><td>nan</td><td>nan</td><td>0.061692716759511525</td><td>25</td><td>1</td><td>-96.08235647948484</td><td>0.4232093213516833</td><td>4</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To calculate upper limit, multiply the flux_err by your desired sigma</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">limit</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_err&#39;</span><span class="p">]</span>
<span class="n">limit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ABmag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[[25.731612] \; \mathrm{mag}$$\mathrm{\left( \mathrm{AB} \right)}\]</div>
</div>
</div>
<section id="note-you-can-go-significantly-deeper-with-the-level-3-combined-data-product">
<h2>Note: you can go significantly deeper with the Level 3 combined data product<a class="headerlink" href="#note-you-can-go-significantly-deeper-with-the-level-3-combined-data-product" title="Permalink to this heading">#</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="stellar-field-lmc-a-class-anchor-id-lmc-a">
<h1>5. Stellar Field (LMC) <a class="anchor" id="lmc"></a><a class="headerlink" href="#stellar-field-lmc-a-class-anchor-id-lmc-a" title="Permalink to this heading">#</a></h1>
<p>In this case, we are going to do the same steps as in Section 3, but for multiple stars. The purpose is to illustrate the workflow and runtime for using Photutils on a large number of stars.</p>
<section id="multiple-stars-single-level-2-file-a-class-anchor-id-lmc2-a">
<h2>5.1 Multiple Stars, Single Level 2 File <a class="anchor" id="lmc2"></a><a class="headerlink" href="#multiple-stars-single-level-2-file-a-class-anchor-id-lmc2-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find stars in Level 3 File</span>
<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;./mast/01171/&#39;</span>
<span class="n">level3</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;jw01171-o004_t001_miri_f560w_i2d.fits&#39;</span><span class="p">)</span>
<span class="n">level3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;./mast/01171/jw01171-o004_t001_miri_f560w_i2d.fits&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get rough estimate of background (there are better ways to do background subtraction)</span>
<span class="n">bkgrms</span> <span class="o">=</span> <span class="n">MADStdBackgroundRMS</span><span class="p">()</span>
<span class="n">mmm_bkg</span> <span class="o">=</span> <span class="n">MMMBackground</span><span class="p">()</span>

<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">level3</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">wcs_l3</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">bkgrms</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">bkg</span> <span class="o">=</span> <span class="n">mmm_bkg</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">data_bkgsub</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data_bkgsub</span> <span class="o">-=</span> <span class="n">bkg</span> 

<span class="c1"># Find stars</span>
<span class="c1"># F560W FWHM = 1.882 pix</span>
<span class="n">fwhm_psf</span> <span class="o">=</span> <span class="mf">1.882</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">daofind</span> <span class="o">=</span> <span class="n">DAOStarFinder</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span> <span class="o">*</span> <span class="n">std</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="n">fwhm_psf</span><span class="p">,</span> <span class="n">exclude_border</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_separation</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">found_stars</span> <span class="o">=</span> <span class="n">daofind</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">found_stars</span><span class="o">.</span><span class="n">pprint_all</span><span class="p">(</span><span class="n">max_lines</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> id     xcentroid          ycentroid          sharpness       roundness1      roundness2      npix sky         peak               flux                mag         
--- ------------------ ------------------ ------------------ ----------- -------------------- ---- --- ------------------- ------------------ --------------------
  1  546.2615248590856   5.40090706700177 0.7041937380599614  0.46773428  0.04273256330788055   25 0.0 -0.8653272390365601 1.6463868618011475  -0.5413297293846483
  2  789.0983970730795  6.312157835017226 0.6691237944354219 -0.17942303  -0.8079555096758742   25 0.0 -0.5761210918426514 1.1000438928604126 -0.10352503572911273
  3  845.9799634503643 3.6757970986043205 0.6829976607805458 0.043498766 -0.42254093349077776   25 0.0  -1.171976923942566 1.1794757843017578 -0.17922257214246215
...                ...                ...                ...         ...                  ...  ... ...                 ...                ...                  ...
788 1005.1187213604594 1062.3368573824348 0.6862059219157299  -0.4493568  -0.8216906677208772   25 0.0 -0.6988779306411743 1.0355932712554932 -0.03797304988288973
789  399.3766175963356 1064.9409739772366 0.3060837128458461  -0.1559235 -0.21203561885367334   25 0.0 -0.7487165927886963 1.0224626064300537 -0.02411858480836388
790  566.9700693080139  1065.048267845045 0.5650444893283237  -0.3703813  -0.5505482861764637   25 0.0  0.5157880783081055  1.638227939605713  -0.5359358211339778
Length = 790 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the found stars</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

<span class="n">xypos</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">])</span>
<span class="n">aper</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">(</span><span class="n">xypos</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">aper</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.patches.Circle at 0x7f86fee5e790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fee60bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fefdc790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feec5250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86ff5a11d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feca3890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fedf7710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fedf7690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feca0190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fed6f050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fed89050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fed7f290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fef63bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fef62690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fef62150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fef61c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fee34e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feeceb50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feece410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feece810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feecdad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feecd010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feecc490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec4d610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec4e850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec4ebd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec4ee50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec4e190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86ff799090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fee73390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fee95750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec21310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feee29d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feee3090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec99290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec98610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec9b550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec9af90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec9be10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec9a390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec982d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec9b1d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec99910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb56ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb55fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb55090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb55c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb54790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb55250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb54990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb556d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb56a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb56cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb56890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb57cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb56510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6cad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6d310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6ed10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6ea10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6ce90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6dcd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6c450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6d350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6dd90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6d810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6f510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6f890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6cd10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6fb50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb6c5d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febde310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febddcd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febdd7d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febdf790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febdc690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febde050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febdff10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febe4b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febe6510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febe4d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febe4dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febe6490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febe6450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febe5bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febe4410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febe6dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febe6f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febe7dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86febe7d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae1690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae0250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae0550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae0850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae0b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae0e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae1150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae1450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae1850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae1cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae21d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae25d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae2a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae2ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae3350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae37d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feae3c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea96ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea96ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea971d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea974d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea977d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea97ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea97dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea94150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea94750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea94a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea94610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea94bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea95350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea95650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea95410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea95d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea95ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea96250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea96010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea96350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea96650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f8c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f8f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f9290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f9590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f9690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f9b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f9e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8fa190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8fa490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8fa710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8faa50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8fad50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8fb090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8fb310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8fb650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8fb8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8fbc50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8fbf50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f82d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f8750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9000d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9003d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9006d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe900a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe900d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe901010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9014d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe901750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe901a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe901d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe902010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9023d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe902690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe902990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe902cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe902f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe903290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe903590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe903890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe903b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe903e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaac1d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaac4d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaac7d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaacad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaacdd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaad0d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaad3d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaad7d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaada50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaadcd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaadfd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaae2d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaae5d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaae8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaaebd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaaeed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaaf1d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaaf4d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaaf7d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaafad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaafdd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4c110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4c410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4c710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4ca10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4cd10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4d010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4d310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4d610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4d910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4dc10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4df10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4e210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4e510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4e810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4eb10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4ee10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4f110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4f410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4f710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4fa10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4fd10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea50050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea50350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea50650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea50950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea50c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea50f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea51250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea51550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea51850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea51b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea51e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea52150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea52450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea52750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea52a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea52d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea53050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea53350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fed5ee90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fefde210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb45690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feecd9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea53b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea53d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea54090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea54390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea54690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea54990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea54c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea54f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea55290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea55590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea55890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea55b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea55e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea56190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea56490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea56790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea56a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea56d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea57090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea57390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea57690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea57990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea57c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea57f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab42d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab45d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab48d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab4bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab4ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab51d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab54d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab57d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab5ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab5dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab60d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab63d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab66d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab69d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab6cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab6fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab72d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab75d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab78d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab7bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab7ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea58210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea58510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea58810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea58b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea58e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea59110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea59410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea59710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea59b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea59d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5a010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5a310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5a610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5a910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5ac10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5af10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5b210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5b510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5b810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5bb10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5be10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab81d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab84d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab88d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab8ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab8dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab90d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab93d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab96d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab99d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab9cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feab9fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaba2d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaba5d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaba8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feababd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feabaed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feabb1d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feabb4d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feabb7d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feabbad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feabbdd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea60090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea60390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea60690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea60990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea60c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea60f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea61290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea61590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea61890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea61b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea61e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea62190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea62490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea62790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea62a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea62d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea63090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea63390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea63690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea63990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea63c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea64090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea64310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea645d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea648d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea64bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea64ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea651d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea654d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea657d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea65ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea65dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea660d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea663d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea666d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea669d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea66cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea66fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea672d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea675d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea678d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea67bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea67ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac8210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac8510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac8810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac8b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac8e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac9110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac9410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac9710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac9a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac9d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaca010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaca310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaca610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feaca910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feacac10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feacaf10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feacb210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feacb510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feacb810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feacbb10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feacbe10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6c150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6c450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6c750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6ca50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6cd50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6d050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6d350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6d650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6d950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6dc50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6df10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6e350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6e5d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6e850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6eb50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6ee50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6f150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6f450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6f750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6fa50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea6fd50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea74090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea74390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea74690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea74990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea74c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea74f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea75290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea75590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea75890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea75b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea75e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea76190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea76490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea76790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea76a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea76d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea77090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea77390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea77690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea77990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea77c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea77f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead02d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead05d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead08d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead0bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead0ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead11d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead14d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead17d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead1ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead1dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead20d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead23d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead26d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead29d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead2cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead2fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead32d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead35d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead38d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead3bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead3ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead4210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead4610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead4890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead4b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead4e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead5110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead5410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead5710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead5a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead5d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead6010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead6310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead6610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead6910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead6c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead6f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead7210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead7510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead7810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead7b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fead7e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea78410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea78390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea78b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea78bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea79110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea78e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea79710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea792d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea79850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7a010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea79b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7a510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7a390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7a450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7a9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7add0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7b110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7b410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7bb10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7be10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7bd50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7c090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7c390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7c690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7c990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7cc90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7cf90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7d290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7d590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7d890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7db90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7de90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7e190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7e490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7e6d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7eb50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7edd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7f090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7f390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7f690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7f990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7fc90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea7ff90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea802d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea805d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea808d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea80bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea80ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea811d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea814d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea817d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea81ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea81dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea820d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea823d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea826d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea829d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea82cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea82fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea832d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea835d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea838d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea83bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea83ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea882d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea88150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea886d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea88dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea891d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea89190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea89350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea89550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea89810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea89a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea89f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8a2d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8a690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8a890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8aad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8ae90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8b090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8b490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8bbd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8bed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8bc50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea90150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea90450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea90750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea90a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea90e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea910d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea91350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea91650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea91950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea91c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea91f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea92250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea92550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea92850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea92b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea92e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea93150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea93450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea93750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea93a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea93d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac0090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac0390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac0690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac0990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac0c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac0f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac1290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac1590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac1890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac1b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac1e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac2190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac2490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac2790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac2a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac2d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac3090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac3390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac3690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac3990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac3c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feac3f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8c2d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8c5d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8c8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8cbd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8ced0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8d1d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8d4d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8d7d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8dad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8ddd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8e0d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8e3d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8e6d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8e9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8ecd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8f110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8f390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8f610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8f8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8fbd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea8fed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5c210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5c510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5c810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5cb10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5ce10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5d110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5d410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5d710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5da10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5dd10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5e010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5e310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5e610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5e910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5ec10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5ef10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5f210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5f510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5f810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5fb10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea5fe10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea48150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea48450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea48750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea48a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea48d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea49050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea49350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea49650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea49950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea49c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea49f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4a250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4a550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4a850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4ab50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4ae50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4b150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4b450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4b750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4ba50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fea4bd50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f0090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f0390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f0690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f0990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f0c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f0f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f1250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f1690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f1910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f1b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f1e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f2190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f2490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f2790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f2a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f2d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f3090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f3390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f3690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f3990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f3c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe8f3f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9042d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9045d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9048d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe904bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe904ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9051d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9054d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9057d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe905ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe905dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9060d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9063d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9066d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9069d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe906cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe906fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9072d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9075d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9078d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe907bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe907ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe908210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe908510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe908810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe908b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe908e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe909110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe909410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe909710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe909a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe909d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90a010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90a310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90a610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90a910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90ac10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90af10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90b210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90b510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90b910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90bb90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90be10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90c150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90c450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90c750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90ca50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90cd50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90d050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90d350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90d650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90d950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90dc50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90df50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90e250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90e550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90e850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90eb50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90ee50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90f150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90f450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90f750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90fa50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe90fd50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe914090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe914390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe914690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe914990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe914c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe914f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe915290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe915590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe915890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe915b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe915e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe916190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe916490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe916790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe916a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe916d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe917090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe917390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe917690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe917990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe917c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe917f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9182d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9185d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9188d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe918bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe918ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9191d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9194d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe9197d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe919a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe919e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe91a110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe91a3d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe91a6d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe91a9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe91acd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe91afd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe91b2d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe91b5d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe91b8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe91bbd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe91bed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe920210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe920510&gt;]
</pre></div>
</div>
<img alt="../../../_images/6d3a3b9b4990e31f7254cfd16b0ed731357d21673d34428069c535dbc6520c1c.png" src="../../../_images/6d3a3b9b4990e31f7254cfd16b0ed731357d21673d34428069c535dbc6520c1c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">],</span> <span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;sharpness&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">],</span> <span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;roundness&#39;</span><span class="p">)</span>

<span class="n">mag0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.0</span>
<span class="n">mag1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span>
<span class="k">for</span> <span class="n">ax_</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mag0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mag1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>

<span class="n">sh0</span> <span class="o">=</span> <span class="mf">0.40</span>
<span class="n">sh1</span> <span class="o">=</span> <span class="mf">0.82</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">sh0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">sh1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>

<span class="n">rnd0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.40</span>
<span class="n">rnd1</span> <span class="o">=</span> <span class="mf">0.40</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">rnd0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">rnd1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.lines.Line2D at 0x7f86fe92fe50&gt;
</pre></div>
</div>
<img alt="../../../_images/d1798d3737c8bf8cfe36df4063aee234552352b1751f97739811dfbd81327836.png" src="../../../_images/d1798d3737c8bf8cfe36df4063aee234552352b1751f97739811dfbd81327836.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mag0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">mag1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rnd0</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rnd1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sh0</span><span class="p">)</span> 
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sh1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">700</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">700</span><span class="p">))</span>

<span class="n">found_stars_sel</span> <span class="o">=</span> <span class="n">found_stars</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of stars found originally:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_stars</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of stars in final selection:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_stars_sel</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of stars found originally: 790
Number of stars in final selection: 13
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the selected stars</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

<span class="n">xypos</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">])</span>
<span class="n">aper</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">(</span><span class="n">xypos</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">aper</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.patches.Circle at 0x7f86fefae850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe922110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86ffab7b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86ffae6ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fe526f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feee34d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feee21d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feee1c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feee1150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feee3a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feee15d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feee3d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feee0e50&gt;]
</pre></div>
</div>
<img alt="../../../_images/725865398721a13deec8352d2264d6a26fa1bb147f1d0edaa41653a69d5942c6.png" src="../../../_images/725865398721a13deec8352d2264d6a26fa1bb147f1d0edaa41653a69d5942c6.png" />
</div>
</div>
</section>
<section id="generate-empirical-psf-grid-for-miri-f560w-using-webbpsf-a-class-anchor-id-grid2-a">
<h2>5.2 Generate empirical PSF grid for MIRI F560W using WebbPSF <a class="anchor" id="grid2"></a><a class="headerlink" href="#generate-empirical-psf-grid-for-miri-f560w-using-webbpsf-a-class-anchor-id-grid2-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psfgrid_filename</span> <span class="o">=</span> <span class="s1">&#39;miri_mirim_f560w_fovp101_samp4_npsf4.fits&#39;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">psfgrid_filename</span><span class="p">):</span>
    <span class="n">miri</span> <span class="o">=</span> <span class="n">webbpsf</span><span class="o">.</span><span class="n">MIRI</span><span class="p">()</span>
    <span class="n">miri</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="s1">&#39;F560W&#39;</span>
    <span class="n">psf_model</span> <span class="o">=</span> <span class="n">miri</span><span class="o">.</span><span class="n">psf_grid</span><span class="p">(</span><span class="n">num_psfs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">all_detectors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">psf_model</span> <span class="o">=</span> <span class="n">GriddedPSFModel</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">psfgrid_filename</span><span class="p">)</span>

<span class="n">psf_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/4: (0, 0) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:15:53,977 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/webbpsf/opds.py:1746: UserWarning: For (V2,V3) = [-6.36389848 -7.26853851] arcmin, Field point -6.3638984816102235 arcmin, -0.5632056 arcmin not within valid region for field dependence model of OTE WFE for MIRI: -8.254199999999999 arcmin--6.21738 arcmin, -2.557224 arcmin--0.5632056 arcmin. Clipping to closest available valid location, 0.031744109903437345 arcmin away from the requested coordinates.
  warnings.warn(f&#39;For (V2,V3) = {v2v3}, Field point {x_field_pt}, {y_field_pt} not within valid region for field dependence model of OTE WFE for {instrument}: {min_x_field}-{max_x_field}, {min_y_field}-{max_y_field}. Clipping to closest available valid location, {clip_dist} away from the requested coordinates.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/4 centroid: (201.39504365744267, 201.46837962104274)
    Position 2/4: (0, 1023) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:15:58,040 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/webbpsf/opds.py:1746: UserWarning: For (V2,V3) = [-6.21257653 -5.39972458] arcmin, Field point -6.21738 arcmin, -2.4002754231217454 arcmin not within valid region for field dependence model of OTE WFE for MIRI: -8.254199999999999 arcmin--6.21738 arcmin, -2.557224 arcmin--0.5632056 arcmin. Clipping to closest available valid location, 0.00480347054204433 arcmin away from the requested coordinates.
  warnings.warn(f&#39;For (V2,V3) = {v2v3}, Field point {x_field_pt}, {y_field_pt} not within valid region for field dependence model of OTE WFE for {instrument}: {min_x_field}-{max_x_field}, {min_y_field}-{max_y_field}. Clipping to closest available valid location, {clip_dist} away from the requested coordinates.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 2/4 centroid: (201.3020934606855, 201.31984343070152)
    Position 3/4: (1023, 0) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 3/4 centroid: (201.42830769164877, 201.59926840411686)
    Position 4/4: (1023, 1023) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:16:09,679 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/astropy/io/fits/card.py:1038: VerifyWarning: Card is too long, comment will be truncated.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 4/4 centroid: (201.75498594600958, 201.4970454286807)
  Saving file: miri_mirim_f560w_fovp101_samp4_npsf4.fits
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;GriddedPSFModel(flux=1., x_0=0., y_0=0.)&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psf_model</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/3c34df4822b7838e7423801e69374a736e877e36a017ee416a94bf55042a3372.png" src="../../../_images/3c34df4822b7838e7423801e69374a736e877e36a017ee416a94bf55042a3372.png" />
<img alt="../../../_images/3c34df4822b7838e7423801e69374a736e877e36a017ee416a94bf55042a3372.png" src="../../../_images/3c34df4822b7838e7423801e69374a736e877e36a017ee416a94bf55042a3372.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the level 2 image</span>
<span class="c1"># here, we&#39;ll use the PID 1171 files</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./mast/01171/&quot;</span>
<span class="n">level2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;jw01171004*cal.fits&#39;</span><span class="p">)))</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">level2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c1"># load data and convert units from MJy/sr to uJy</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">bunit_data</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">dq</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">err</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    
    <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">photometry</span><span class="o">.</span><span class="n">pixelarea_steradians</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span>
    <span class="n">data</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    <span class="n">error</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>

    <span class="n">wcs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span>

<span class="n">data</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">unit</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./mast/01171/jw01171004001_02101_00001_mirimage_cal.fits
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Unit(&quot;uJy&quot;), Unit(&quot;uJy&quot;))
</pre></div>
</div>
</div>
</div>
</section>
<section id="psf-photometry-a-class-anchor-id-lmc3-a">
<h2>5.3 PSF Photometry <a class="anchor" id="lmc3"></a><a class="headerlink" href="#psf-photometry-a-class-anchor-id-lmc3-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># translate (x, y) positions from the level 3 image to the level 2 image</span>
<span class="n">xc</span> <span class="o">=</span> <span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]</span>
<span class="n">yc</span> <span class="o">=</span> <span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">wcs_l3</span><span class="o">.</span><span class="n">pixel_to_world</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">wcs</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="n">init_params</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>

<span class="c1"># we need to remove stars in the masked region of</span>
<span class="c1"># the level-2 data</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">400</span>
<span class="n">init_params</span> <span class="o">=</span> <span class="n">init_params</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([False,  True,  True,  True,  True, False,  True,  True,  True,
        True,  True,  True,  True])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the selected stars</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

<span class="n">xypos</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="n">aper</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">(</span><span class="n">xypos</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">aper</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.patches.Circle at 0x7f86fec5cfd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb5db10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86fec77390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb8b490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb8a4d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb8a250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb8aa90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb8a8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb8b750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb894d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f86feb8a390&gt;]
</pre></div>
</div>
<img alt="../../../_images/688ca2508baa3dea517881a7fce2f727909abdaf244aee95fd3693d2185a34d8.png" src="../../../_images/688ca2508baa3dea517881a7fce2f727909abdaf244aee95fd3693d2185a34d8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_shape</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">localbkg_estimator</span> <span class="o">=</span> <span class="n">LocalBackground</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">bkg_estimator</span><span class="o">=</span><span class="n">MMMBackground</span><span class="p">())</span>
<span class="n">psfphot</span> <span class="o">=</span> <span class="n">PSFPhotometry</span><span class="p">(</span><span class="n">psf_model</span><span class="p">,</span> <span class="n">fit_shape</span><span class="p">,</span> <span class="n">finder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aperture_radius</span><span class="o">=</span><span class="n">fit_shape</span><span class="p">,</span> 
                        <span class="n">localbkg_estimator</span><span class="o">=</span><span class="n">localbkg_estimator</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">phot</span> <span class="o">=</span> <span class="n">psfphot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">init_params</span><span class="o">=</span><span class="n">init_params</span><span class="p">)</span>
<span class="n">phot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:16:10,813 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/photutils/psf/photometry.py:346: AstropyUserWarning: Input data contains unmasked non-finite values (NaN or inf), which were automatically ignored.
  warnings.warn(&#39;Input data contains unmasked non-finite values &#39;
</pre></div>
</div>
<div class="output text_html"><div><i>QTable length=11</i>
<table id="table140217775311440" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>group_id</th><th>local_bkg</th><th>x_init</th><th>y_init</th><th>flux_init</th><th>x_fit</th><th>y_fit</th><th>flux_fit</th><th>x_err</th><th>y_err</th><th>flux_err</th><th>npixfit</th><th>group_size</th><th>qfit</th><th>cfit</th><th>flags</th></tr></thead>
<thead><tr><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>int64</th></tr></thead>
<tr><td>1</td><td>1</td><td>0.6448802831437852</td><td>660.8682340958862</td><td>73.30952825775023</td><td>99.22615357989018</td><td>660.9286846394467</td><td>73.20923844919115</td><td>60.868198060066106</td><td>0.00508560759583491</td><td>0.005213347960630993</td><td>0.35070448135682786</td><td>25</td><td>1</td><td>0.6875349675263613</td><td>0.0507190914432771</td><td>0</td></tr>
<tr><td>2</td><td>2</td><td>0.5874391903047975</td><td>464.1246542280646</td><td>137.46955055574392</td><td>146.60569021592204</td><td>464.1612736578599</td><td>137.47656054126384</td><td>118.86790586339693</td><td>0.0036127479969553576</td><td>0.00332654031132284</td><td>0.4934731425162559</td><td>25</td><td>1</td><td>0.7937337032069842</td><td>0.0458428871200886</td><td>0</td></tr>
<tr><td>3</td><td>3</td><td>0.6104557472178589</td><td>481.9300536591688</td><td>142.74569905705442</td><td>122.16382552364978</td><td>481.7942336547994</td><td>142.85534595605364</td><td>93.13605371445458</td><td>0.004066468627209195</td><td>0.0037182540675848004</td><td>0.4370216793482647</td><td>25</td><td>1</td><td>0.6532491049959812</td><td>0.05590328925087897</td><td>0</td></tr>
<tr><td>4</td><td>4</td><td>0.5496421364243962</td><td>553.43672949644</td><td>147.6140915866477</td><td>110.58509932779731</td><td>553.3332687437463</td><td>147.6279956521992</td><td>81.38350059142448</td><td>0.0040451298749260445</td><td>0.0040049668954863765</td><td>0.3840827233584572</td><td>25</td><td>1</td><td>0.7618745097066745</td><td>0.06556201317924007</td><td>0</td></tr>
<tr><td>5</td><td>5</td><td>0.5802685211656431</td><td>493.8538169846163</td><td>220.82325504415456</td><td>170.9292596067879</td><td>493.8793157655576</td><td>220.62652265893462</td><td>150.22386179966216</td><td>0.003358635097457586</td><td>0.0031756031119978185</td><td>0.604400981865906</td><td>25</td><td>1</td><td>0.5327777896677033</td><td>0.05003401088019915</td><td>0</td></tr>
<tr><td>6</td><td>6</td><td>0.5552616705110063</td><td>633.1485658474755</td><td>324.17790497032087</td><td>116.40546174421459</td><td>633.1391855542114</td><td>324.1804492328962</td><td>88.43072429485113</td><td>0.004024860983398037</td><td>0.004004495142547085</td><td>0.4125289249159527</td><td>25</td><td>1</td><td>0.9902255297083485</td><td>0.12838325600826472</td><td>0</td></tr>
<tr><td>7</td><td>7</td><td>0.5410288111266928</td><td>597.6581645996761</td><td>447.6985048034759</td><td>121.35040364262599</td><td>597.3590198542189</td><td>447.56140193618455</td><td>98.56227008651472</td><td>0.00411653953630617</td><td>0.003647216028470465</td><td>0.4631820087267053</td><td>24</td><td>1</td><td>1.0760066465813405</td><td>0.045988202193837834</td><td>1</td></tr>
<tr><td>8</td><td>8</td><td>0.5712058916028622</td><td>546.6143269821247</td><td>529.1914918633589</td><td>259.8907892997661</td><td>546.8404355606814</td><td>529.2634236784783</td><td>251.86227681431046</td><td>0.0024193218378376147</td><td>0.0023130923903441785</td><td>0.7294551139699648</td><td>25</td><td>1</td><td>0.6666010174304933</td><td>0.02801968559292353</td><td>0</td></tr>
<tr><td>9</td><td>9</td><td>0.5766501870561154</td><td>453.82949747513493</td><td>549.258081072752</td><td>238.8740045482744</td><td>453.64985222857916</td><td>549.1688932057833</td><td>230.6362230696203</td><td>0.0025260579257618395</td><td>0.0027603261287867066</td><td>0.7252348583173828</td><td>25</td><td>1</td><td>0.7916554339315172</td><td>0.05213277450198142</td><td>0</td></tr>
<tr><td>10</td><td>10</td><td>0.543873813275104</td><td>581.7237520077483</td><td>589.2362246196259</td><td>150.4488293995264</td><td>581.8579817852578</td><td>589.3358089492639</td><td>129.7767129600465</td><td>0.0034935348032658553</td><td>0.003275752444225367</td><td>0.5187529531837481</td><td>25</td><td>1</td><td>0.9165073112371286</td><td>0.040711935582376686</td><td>0</td></tr>
<tr><td>11</td><td>11</td><td>0.5791730733885281</td><td>626.719046718948</td><td>619.1527113454913</td><td>252.4189435162317</td><td>626.6242165721334</td><td>619.0989132934759</td><td>231.22037687602779</td><td>0.00247478201995571</td><td>0.0028746739738682086</td><td>0.7257771750537931</td><td>25</td><td>1</td><td>0.778471055791462</td><td>0.03879531357454251</td><td>0</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert fit flux from uJy to ABmag</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_fit&#39;</span><span class="p">]</span>
<span class="n">flux_err</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_err&#39;</span><span class="p">]</span>
<span class="n">mag</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_fit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ABmag</span><span class="p">)</span>
<span class="n">magerr</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">flux_err</span> <span class="o">/</span> <span class="n">flux</span><span class="p">))</span>
<span class="n">magerr</span> <span class="o">=</span> <span class="n">magerr</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">ABmag</span>
<span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Magnitude [19.43902389, 18.71233847, 18.97720542, 19.12365908,
             18.45815269, 19.03349204, 18.91572326, 17.89709219,
             17.99268121, 18.61700808, 17.98993474] mag(AB)&gt;,
 &lt;Magnitude [0.00623774, 0.00449804, 0.00508268, 0.00511199, 0.00435952,
             0.00505318, 0.00509034, 0.00314001, 0.00340874, 0.00433133,
             0.00340268] mag(AB)&gt;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Write to File</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;RA&quot;</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">ra</span><span class="o">.</span><span class="n">deg</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="s2">&quot;DEC&quot;</span><span class="p">:</span> <span class="n">sc</span><span class="o">.</span><span class="n">dec</span><span class="o">.</span><span class="n">deg</span><span class="p">[</span><span class="n">mask</span><span class="p">],</span> <span class="s2">&quot;Mag&quot;</span><span class="p">:</span> <span class="n">mag</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;Mag Err&quot;</span><span class="p">:</span> <span class="n">magerr</span><span class="o">.</span><span class="n">value</span><span class="p">})</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;miri_photometry_photutils.txt&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  
</pre></div>
</div>
</div>
</div>
<hr style="border:1px solid gray"> </hr><a class="reference internal image-reference" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></a>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/MIRI/psf_photometry"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">MIRI PSF Photometry with Photutils</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of contents</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-class-anchor-id-intro-a">1. Introduction <a class="anchor" id="intro"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-imports-a-class-anchor-id-imports-a">1.1 Python Imports <a class="anchor" id="imports"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-set-up-required-data-for-webbpsf-and-synphot-a-class-anchor-id-setup-a">1.2 Download and Set up Required Data for WebbPSF and Synphot <a class="anchor" id="setup"></a></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download-jwst-miri-data-a-class-anchor-id-data-a">2. Download JWST MIRI Data <a class="anchor" id="data"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#single-bright-star-a-class-anchor-id-bso-a">3. Single Bright Star <a class="anchor" id="bso"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#single-level-2-file-a-class-anchor-id-bso2-a">3.1 Single Level 2 File <a class="anchor" id="bso2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-empirical-psf-grid-for-miri-f770w-using-webbpsf-a-class-anchor-id-bso3-a">3.2 Generate empirical PSF grid for MIRI F770W using WebbPSF <a class="anchor" id="bso3"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-photometry-a-class-anchor-id-bso4-a">3.3 PSF Photometry <a class="anchor" id="bso4"></a></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#faint-upper-limit-single-object-a-class-anchor-id-fso-a">4. Faint/Upper Limit, Single Object <a class="anchor" id="fso"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#note-you-can-go-significantly-deeper-with-the-level-3-combined-data-product">Note: you can go significantly deeper with the Level 3 combined data product</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#stellar-field-lmc-a-class-anchor-id-lmc-a">5. Stellar Field (LMC) <a class="anchor" id="lmc"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-stars-single-level-2-file-a-class-anchor-id-lmc2-a">5.1 Multiple Stars, Single Level 2 File <a class="anchor" id="lmc2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-empirical-psf-grid-for-miri-f560w-using-webbpsf-a-class-anchor-id-grid2-a">5.2 Generate empirical PSF grid for MIRI F560W using WebbPSF <a class="anchor" id="grid2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-photometry-a-class-anchor-id-lmc3-a">5.3 PSF Photometry <a class="anchor" id="lmc3"></a></a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>