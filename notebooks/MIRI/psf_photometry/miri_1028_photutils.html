

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>MIRI PSF Photometry with Photutils &#8212; STScI JDAT Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-D46G4HKJY3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/MIRI/psf_photometry/miri_1028_photutils';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="STScI JDAT Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="STScI JDAT Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">General</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebook_development_workflow.html">Notebook Development Workflow</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/submitting_notebooks.html">Submitting Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/requirements.html">Requirements file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebooks.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/data_files.html">Data Files</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">GitHub Guidelines</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_setup.html">GitHub Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_workflow.html">GitHub Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_pr.html">GitHub PR</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Cross-Instrument</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/asdf_example/asdf_example.html">ASDF Example</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/background_estimation_imaging/Imaging_Sky_Background_Estimation.html">Complex 2D Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/composite_model_fitting/specfit_demo_3.html">Composite Model Spectral Fitting</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">MAST Query</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/rgb_imviz/imviz_rgb_carina.html">RGB images with Imviz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">Specviz Simple Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/update_pure_parallel_wcs/NIRISS_correct_pure_parallel_WCS.html">Improving Accuracy of WCS of Pure Parallel Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/stpsf_examples/stpsf_examples.html">STPSF Examples</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MIRI</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">MRS Mstar - Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">IFU of YSOs in LMC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MIRI_LRS_spectral_extraction/miri_lrs_advanced_extraction_part1.html">LRS Optimal Spectral Extraction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRCam</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/aperture_photometry/NIRCam_Aperture_Photometry_Example.html">Point Source Aperture Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_photometry/NIRCam_multiband_photometry.html">Extended Aperture Photometry</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">Cross-Filter PSF Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/psf_photometry/NIRCam_PSF_Photometry_Example.html">PSF Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_wisp_subtraction/nircam_wisp_subtraction.html">NIRCam Wisp Removal</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRISS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/00_Optimal_extraction.html">WFSS Spectra - Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/01_Combine_and_normalize_1D_spectra.html">WFSS Spectra - Combine and Normalize 1D Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/02_Cross_correlation_template.html">WFSS Spectra - Cross-Correlation Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map.html">WFSS Spectra - Emission Line Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/00_niriss_mast_query_data_setup.html">NIRISS MAST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/01_niriss_wfss_image2_image3.html">Direct imaging for WFSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/02_niriss_wfss_spec2.html">Spec2 pipeline for WFSS</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRSpec</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html">IFU Cube Fitting</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/cube_fitting/cube_fitting.html">IFU Cube Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/ifu_optimal/ifu_optimal.html">IFU Optimal Spectral Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/optimal_extraction/Spectral_Extraction-static.html">MOS Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/mos_spectroscopy_advanced/MOSspec_advanced.html">MOS Spectroscopy of Extragalactic Field</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">BOTS Time Series Observations</a></li>








<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/galaxy_redshift/redshift_fitting.html">Redshift and Template Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/FS_NSClean_example.html">FS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/IFU_NSClean_example.html">IFU Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/MOS_NSClean_example.html">MOS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/BOTS_NSClean_example.html">BOTS Products with NSClean</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/MIRI/psf_photometry/miri_1028_photutils.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/MIRI/psf_photometry/miri_1028_photutils.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>MIRI PSF Photometry with Photutils</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">MIRI PSF Photometry with Photutils</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of contents</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-class-anchor-id-intro-a">1. Introduction <a class="anchor" id="intro"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-imports-a-class-anchor-id-imports-a">1.1 Python Imports <a class="anchor" id="imports"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-set-up-required-data-for-webbpsf-and-synphot-a-class-anchor-id-setup-a">1.2 Download and Set up Required Data for WebbPSF and Synphot <a class="anchor" id="setup"></a></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download-jwst-miri-data-a-class-anchor-id-data-a">2. Download JWST MIRI Data <a class="anchor" id="data"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#single-bright-star-a-class-anchor-id-bso-a">3. Single Bright Star <a class="anchor" id="bso"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#single-level-2-file-a-class-anchor-id-bso2-a">3.1 Single Level 2 File <a class="anchor" id="bso2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-empirical-psf-grid-for-miri-f770w-using-webbpsf-a-class-anchor-id-bso3-a">3.2 Generate empirical PSF grid for MIRI F770W using WebbPSF <a class="anchor" id="bso3"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-photometry-a-class-anchor-id-bso4-a">3.3 PSF Photometry <a class="anchor" id="bso4"></a></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#faint-upper-limit-single-object-a-class-anchor-id-fso-a">4. Faint/Upper Limit, Single Object <a class="anchor" id="fso"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#note-you-can-go-significantly-deeper-with-the-level-3-combined-data-product">Note: you can go significantly deeper with the Level 3 combined data product</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#stellar-field-lmc-a-class-anchor-id-lmc-a">5. Stellar Field (LMC) <a class="anchor" id="lmc"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-stars-single-level-2-file-a-class-anchor-id-lmc2-a">5.1 Multiple Stars, Single Level 2 File <a class="anchor" id="lmc2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-empirical-psf-grid-for-miri-f560w-using-webbpsf-a-class-anchor-id-grid2-a">5.2 Generate empirical PSF grid for MIRI F560W using WebbPSF <a class="anchor" id="grid2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-photometry-a-class-anchor-id-lmc3-a">5.3 PSF Photometry <a class="anchor" id="lmc3"></a></a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="miri-psf-photometry-with-photutils">
<h1>MIRI PSF Photometry with Photutils<a class="headerlink" href="#miri-psf-photometry-with-photutils" title="Permalink to this heading">#</a></h1>
<p><strong>Author</strong>: Ori Fox<br></p>
<p><strong>Submitted</strong>: November, 2023<br>
<strong>Updated</strong>: November, 2023<br></p>
<p><strong>Use case</strong>: PSF Photometry using <a class="reference external" href="https://photutils.readthedocs.io/en/stable/">Photutils</a>. The purpose here is to illustrate the workflow and runtime for using Photutils in a variety of use cases.</p>
<p>Generally, PSF photometry for data from a space telescope is most accurately performed on pre-mosaiced data. The mosaic process changes the inherent PSF, blurring it both due to resampling and mixing PSFs at different detector positions and rotations.  Additionally, accurate theoretical PSF models (e.g., from <a class="reference external" href="https://webbpsf.readthedocs.io/en/latest/">WebbPSF</a>) are not available for mosaiced data. While an empirical PSF could be constructed (e.g., using Photutils <a class="reference external" href="https://photutils.readthedocs.io/en/latest/epsf.html">ePSFBuilder</a>) for mosaiced data, the results will generally not be as accurate as performing PSF photometry on the pre-mosaiced data.</p>
<p><strong>NOTE:</strong> A companion notebook exists that illustrates how to use perform PSF photometry on both Level 2 and Level 3 data using a new software program called space_phot.<br>
<strong>Data</strong>: MIRI Data PID 1028 (Calibration Program; Single Star Visit 006 A5V dwarf 2MASSJ17430448+6655015) and MIRI Data PID 1171 (LMC; Multiple Stars).<br>
<strong>Tools</strong>: photutils, webbpsf, jwst <br>
<strong>Cross-Instrument</strong>: MIRI<br>
<strong>Documentation:</strong> This notebook is part of a STScI’s larger <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-post-pipeline-data-analysis">post-pipeline Data Analysis Tools Ecosystem</a> and can be <a class="reference external" href="https://github.com/spacetelescope/dat_pyinthesky/tree/main/jdat_notebooks/MRS_Mstar_analysis">downloaded</a> directly from the <a class="reference external" href="https://github.com/spacetelescope/jdat_notebooks">JDAT Notebook Github directory</a>.<br></p>
<section id="table-of-contents">
<h2>Table of contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><span class="xref myst">Introduction</span><br>
1.1 <span class="xref myst">Python Imports</span><br>
1.2 <span class="xref myst">Set up WebbPSF and Synphot</span><br></p></li>
<li><p><span class="xref myst">Download JWST MIRI Data</span><br></p></li>
<li><p><span class="xref myst">Single Bright Object</span><br>
3.1 <span class="xref myst">Single Level 2 File</span><br>
3.2 <span class="xref myst">Generate empirical PSF grid for MIRI F770W using WebbPSF</span><br>
3.3 <span class="xref myst">PSF Photometry</span><br></p></li>
<li><p><span class="xref myst">Faint/Upper Limit, Single Object</span><br>
4.1 <span class="xref myst">Multiple, Level2 Files</span><br></p></li>
<li><p><span class="xref myst">Stellar Field (LMC)</span><br>
5.1 <span class="xref myst">Multiple Stars, Single Level 2 File</span><br>
5.2 <span class="xref myst">Generate empirical PSF grid for MIRI F560W using WebbPSF</span><br>
5.3 <span class="xref myst">PSF Photometry</span><br></p></li>
</ol>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction-a-class-anchor-id-intro-a">
<h1>1. Introduction <a class="anchor" id="intro"></a><a class="headerlink" href="#introduction-a-class-anchor-id-intro-a" title="Permalink to this heading">#</a></h1>
<p><strong>GOALS</strong>:<br></p>
<p>Perform PSF photometry on JWST MIRI images with the <a class="reference external" href="https://photutils.readthedocs.io/en/latest/psf.html">Photutils PSF Photometry tools</a> using a grid of empirical PSF models from WebbPSF.</p>
<p>The notebook shows how to:<br></p>
<ul class="simple">
<li><p>generate a <a class="reference external" href="https://webbpsf.readthedocs.io/en/latest/psf_grids.html">grid of empirical PSF models</a> from WebbPSF<br></p></li>
<li><p>perform PSF photometry on the image using the <a class="reference external" href="https://photutils.readthedocs.io/en/latest/api/photutils.psf.PSFPhotometry.html#photutils.psf.PSFPhotometry">PSFPhotometry class</a><br></p></li>
</ul>
<p><strong>Data</strong>:<br></p>
<p>MIRI Data PID 1028 (Calibration Program), F770W <br>
MIRI Data PID 1171 (LMC), F560W/F770W</p>
<section id="python-imports-a-class-anchor-id-imports-a">
<h2>1.1 Python Imports <a class="anchor" id="imports"></a><a class="headerlink" href="#python-imports-a-class-anchor-id-imports-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tarfile</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">u</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">webbpsf</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.coordinates</span><span class="w"> </span><span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.nddata</span><span class="w"> </span><span class="kn">import</span> <span class="n">extract_array</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.visualization</span><span class="w"> </span><span class="kn">import</span> <span class="n">simple_norm</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.mast</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jwst.datamodels</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImageModel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">photutils.aperture</span><span class="w"> </span><span class="kn">import</span> <span class="n">CircularAperture</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">photutils.background</span><span class="w"> </span><span class="kn">import</span> <span class="n">LocalBackground</span><span class="p">,</span> <span class="n">MADStdBackgroundRMS</span><span class="p">,</span> <span class="n">MMMBackground</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">photutils.detection</span><span class="w"> </span><span class="kn">import</span> <span class="n">DAOStarFinder</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">photutils.psf</span><span class="w"> </span><span class="kn">import</span> <span class="n">GriddedPSFModel</span><span class="p">,</span> <span class="n">PSFPhotometry</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-and-set-up-required-data-for-webbpsf-and-synphot-a-class-anchor-id-setup-a">
<h2>1.2 Download and Set up Required Data for WebbPSF and Synphot <a class="anchor" id="setup"></a><a class="headerlink" href="#download-and-set-up-required-data-for-webbpsf-and-synphot-a-class-anchor-id-setup-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set environmental variables</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;WEBBPSF_PATH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;./webbpsf-data/webbpsf-data&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PYSYN_CDBS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;./grp/redcat/trds/&quot;</span>

<span class="c1"># required webbpsf data</span>
<span class="n">boxlink</span> <span class="o">=</span> <span class="s1">&#39;https://stsci.box.com/shared/static/qxpiaxsjwo15ml6m4pkhtk36c9jgj70k.gz&#39;</span>                                                          
<span class="n">boxfile</span> <span class="o">=</span> <span class="s1">&#39;./webbpsf-data/webbpsf-data-LATEST.tar.gz&#39;</span>
<span class="n">synphot_url</span> <span class="o">=</span> <span class="s1">&#39;http://ssb.stsci.edu/trds/tarfiles/synphot5.tar.gz&#39;</span>
<span class="n">synphot_file</span> <span class="o">=</span> <span class="s1">&#39;./synphot5.tar.gz&#39;</span>

<span class="n">webbpsf_folder</span> <span class="o">=</span> <span class="s1">&#39;./webbpsf-data&#39;</span>
<span class="n">synphot_folder</span> <span class="o">=</span> <span class="s1">&#39;./grp&#39;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported URL scheme: </span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dest_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>


<span class="c1"># Gather webbpsf files</span>
<span class="n">psfExist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">webbpsf_folder</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">psfExist</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">webbpsf_folder</span><span class="p">)</span>
    <span class="n">download_file</span><span class="p">(</span><span class="n">boxlink</span><span class="p">,</span> <span class="n">boxfile</span><span class="p">)</span>
    <span class="n">gzf</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">boxfile</span><span class="p">)</span>
    <span class="n">gzf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">webbpsf_folder</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="c1"># Gather synphot files</span>
<span class="n">synExist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">synphot_folder</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">synExist</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">synphot_folder</span><span class="p">)</span>
    <span class="n">download_file</span><span class="p">(</span><span class="n">synphot_url</span><span class="p">,</span> <span class="n">synphot_file</span><span class="p">)</span>
    <span class="n">gzf</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">synphot_file</span><span class="p">)</span>
    <span class="n">gzf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="download-jwst-miri-data-a-class-anchor-id-data-a">
<h1>2. Download JWST MIRI Data <a class="anchor" id="data"></a><a class="headerlink" href="#download-jwst-miri-data-a-class-anchor-id-data-a" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download Proposal ID 1028 F770W data</span>

<span class="c1"># Define source and destination directories</span>
<span class="n">source_dir</span> <span class="o">=</span> <span class="s1">&#39;mastDownload/JWST/&#39;</span>
<span class="n">destination_dir</span> <span class="o">=</span> <span class="s1">&#39;mast/01028/&#39;</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data already downloaded to </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Query the MAST (Mikulski Archive for Space Telescopes) database for observations</span>
    <span class="c1"># with proposal ID 1028 and the F770W filter</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">proposal_id</span><span class="o">=</span><span class="mi">1028</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F770W&#39;</span><span class="p">])</span>
    
    <span class="c1"># Get a list of products associated with the located observation</span>
    <span class="n">plist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    
    <span class="c1"># Filter the product list to include only specific product subgroups</span>
    <span class="n">fplist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span><span class="n">plist</span><span class="p">,</span> <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CAL&#39;</span><span class="p">,</span> <span class="s1">&#39;I2D&#39;</span><span class="p">,</span> <span class="s1">&#39;ASN&#39;</span><span class="p">])</span>
    
    <span class="c1"># Download the selected products from the MAST database</span>
    <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">fplist</span><span class="p">)</span>
    
    <span class="c1"># Create the destination directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span>
    
    <span class="c1"># Use glob to find all files matching the pattern</span>
    <span class="n">files_to_copy</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="s1">&#39;j*/jw01028*&#39;</span><span class="p">))</span>

    <span class="c1"># Copy the matching files to the destination directory</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files_to_copy</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241218t003622_image2_00013_asn.json to ./mastDownload/JWST/jw01028006001_02101_00004_mirimage/jw01028-o006_20241218t003622_image2_00013_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241218t003622_image2_00014_asn.json to ./mastDownload/JWST/jw01028006001_02101_00003_mirimage/jw01028-o006_20241218t003622_image2_00014_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241218t003622_image2_00015_asn.json to ./mastDownload/JWST/jw01028006001_02101_00002_mirimage/jw01028-o006_20241218t003622_image2_00015_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241218t003622_image2_00016_asn.json to ./mastDownload/JWST/jw01028006001_02101_00001_mirimage/jw01028-o006_20241218t003622_image2_00016_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241218t003622_image3_00004_asn.json to ./mastDownload/JWST/jw01028-o006_t001_miri_f770w/jw01028-o006_20241218t003622_image3_00004_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01028-o006_t001_miri_f770w/jw01028-o006_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00001_mirimage/jw01028006001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00001_mirimage/jw01028006001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00002_mirimage/jw01028006001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00002_mirimage/jw01028006001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00003_mirimage/jw01028006001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00003_mirimage/jw01028006001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00004_mirimage/jw01028006001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00004_mirimage/jw01028006001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download Proposal ID 1171 F560W and F770W data</span>

<span class="c1"># Define source and destination directories</span>
<span class="n">source_dir</span> <span class="o">=</span> <span class="s1">&#39;mastDownload/JWST/&#39;</span>
<span class="n">destination_dir</span> <span class="o">=</span> <span class="s1">&#39;mast/01171/&#39;</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data already downloaded to </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Query the MAST (Mikulski Archive for Space Telescopes) database for observations</span>
    <span class="c1"># with proposal ID 1171 and the F550W and F770W filters</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">proposal_id</span><span class="o">=</span><span class="mi">1171</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F560W&#39;</span><span class="p">,</span> <span class="s1">&#39;F770W&#39;</span><span class="p">])</span>
    
    <span class="c1"># Get a list of products associated with the located observation</span>
    <span class="n">plist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    
    <span class="c1"># Filter the product list to include only specific product subgroups</span>
    <span class="n">fplist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span><span class="n">plist</span><span class="p">,</span> <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CAL&#39;</span><span class="p">,</span> <span class="s1">&#39;I2D&#39;</span><span class="p">,</span> <span class="s1">&#39;ASN&#39;</span><span class="p">])</span>
    
    <span class="c1"># Download the selected products from the MAST database</span>
    <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">fplist</span><span class="p">)</span>
    
    <span class="c1"># Create the destination directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span>
    
    <span class="c1"># Use glob to find all files matching the pattern</span>
    <span class="n">files_to_copy</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="s1">&#39;j*/jw01171*&#39;</span><span class="p">))</span>
    
    <span class="c1"># Copy the matching files to the destination directory</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files_to_copy</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171001001_02101_00004_mirimage/jw01171-o001_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171001001_02101_00003_mirimage/jw01171-o001_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171001001_02101_00002_mirimage/jw01171-o001_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171001001_02101_00001_mirimage/jw01171-o001_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o001_t001_miri_f770w/jw01171-o001_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o001_t001_miri_f770w/jw01171-o001_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171002001_02101_00004_mirimage/jw01171-o002_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171002001_02101_00003_mirimage/jw01171-o002_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171002001_02101_00002_mirimage/jw01171-o002_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171002001_02101_00001_mirimage/jw01171-o002_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o002_t001_miri_f770w/jw01171-o002_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o002_t001_miri_f770w/jw01171-o002_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171003001_02101_00004_mirimage/jw01171-o003_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171003001_02101_00003_mirimage/jw01171-o003_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171003001_02101_00002_mirimage/jw01171-o003_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171003001_02101_00001_mirimage/jw01171-o003_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o003_t001_miri_f770w/jw01171-o003_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o003_t001_miri_f770w/jw01171-o003_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171004001_02101_00004_mirimage/jw01171-o004_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171004001_02101_00003_mirimage/jw01171-o004_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171004001_02101_00002_mirimage/jw01171-o004_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171004001_02101_00001_mirimage/jw01171-o004_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o004_t001_miri_f560w/jw01171-o004_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_t001_miri_f560w_i2d.fits to ./mastDownload/JWST/jw01171-o004_t001_miri_f560w/jw01171-o004_t001_miri_f560w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171005001_02101_00004_mirimage/jw01171-o005_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171005001_02101_00003_mirimage/jw01171-o005_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171005001_02101_00002_mirimage/jw01171-o005_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171005001_02101_00001_mirimage/jw01171-o005_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o005_t001_miri_f770w/jw01171-o005_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o005_t001_miri_f770w/jw01171-o005_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00001_mirimage/jw01171001001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00001_mirimage/jw01171001001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00002_mirimage/jw01171001001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00002_mirimage/jw01171001001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00003_mirimage/jw01171001001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00003_mirimage/jw01171001001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00004_mirimage/jw01171001001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00004_mirimage/jw01171001001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00001_mirimage/jw01171002001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00001_mirimage/jw01171002001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00002_mirimage/jw01171002001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00002_mirimage/jw01171002001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00003_mirimage/jw01171002001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00003_mirimage/jw01171002001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00004_mirimage/jw01171002001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00004_mirimage/jw01171002001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00001_mirimage/jw01171003001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00001_mirimage/jw01171003001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00002_mirimage/jw01171003001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00002_mirimage/jw01171003001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00003_mirimage/jw01171003001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00003_mirimage/jw01171003001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00004_mirimage/jw01171003001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00004_mirimage/jw01171003001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00001_mirimage/jw01171004001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00001_mirimage/jw01171004001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00002_mirimage/jw01171004001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00002_mirimage/jw01171004001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00003_mirimage/jw01171004001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00003_mirimage/jw01171004001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00004_mirimage/jw01171004001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00004_mirimage/jw01171004001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00001_mirimage/jw01171005001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00001_mirimage/jw01171005001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00002_mirimage/jw01171005001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00002_mirimage/jw01171005001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00003_mirimage/jw01171005001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00003_mirimage/jw01171005001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00004_mirimage/jw01171005001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00004_mirimage/jw01171005001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="single-bright-star-a-class-anchor-id-bso-a">
<h1>3. Single Bright Star <a class="anchor" id="bso"></a><a class="headerlink" href="#single-bright-star-a-class-anchor-id-bso-a" title="Permalink to this heading">#</a></h1>
<p>The purpose of this section is to illustrate how to perform PSF photometry on a single bright star. While aperture photometry is feasible in isolated cases, the user may find PSF photometry preferable in crowded fields or complicated backgrounds.</p>
<section id="single-level-2-file-a-class-anchor-id-bso2-a">
<h2>3.1 Single Level 2 File <a class="anchor" id="bso2"></a><a class="headerlink" href="#single-level-2-file-a-class-anchor-id-bso2-a" title="Permalink to this heading">#</a></h2>
<p>In this example, we fit a single, bright source in a single Level 2 images. For a collection of Level 2 images, we could fit each Level 2 image individually and then average the measured fluxes.</p>
<p>Useful references:<br>
HST Documentation on PSF Photometry: https://www.stsci.edu/hst/instrumentation/wfc3/data-analysis/psf<br>
WFPC2 Stellar Photometry with HSTPHOT: https://ui.adsabs.harvard.edu/abs/2000PASP..112.1383D/abstract<br>
Photutils PSF Fitting Photometry: https://photutils.readthedocs.io/en/stable/psf.html</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the level 2 filenames</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./mast/01028/&quot;</span>
<span class="n">level2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*cal.fits&#39;</span><span class="p">)))</span>
<span class="n">level2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits&#39;,
 &#39;./mast/01028/jw01028006001_02101_00002_mirimage_cal.fits&#39;,
 &#39;./mast/01028/jw01028006001_02101_00003_mirimage_cal.fits&#39;,
 &#39;./mast/01028/jw01028006001_02101_00004_mirimage_cal.fits&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the first level-2 image</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">level2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MJy/sr&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Pixels&#39;)
</pre></div>
</div>
<img alt="../../../_images/25ba51b321bb0b934775e1755f63ba905208ac2893f3d8af8fa6349afad2779f.png" src="../../../_images/25ba51b321bb0b934775e1755f63ba905208ac2893f3d8af8fa6349afad2779f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change all DQ flagged pixels to NaN.</span>
<span class="c1"># Here, we&#39;ll overwrite the original CAL file.</span>
<span class="c1"># Reference for JWST DQ Flag Definitions: https://jwst-pipeline.readthedocs.io/en/latest/jwst/references_general/references_general.html</span>
<span class="c1"># In this case, we choose all DQ &gt; 10, but users are encouraged to choose their own values accordingly.</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">level2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">dq</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Re-display the image</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">level2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MJy/sr&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Pixels&#39;)
</pre></div>
</div>
<img alt="../../../_images/25ba51b321bb0b934775e1755f63ba905208ac2893f3d8af8fa6349afad2779f.png" src="../../../_images/25ba51b321bb0b934775e1755f63ba905208ac2893f3d8af8fa6349afad2779f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zoom in to see the source. In this case, our source is from MIRI Program ID #1028, a Calibration Program.</span>
<span class="c1"># We are using Visit 006, which targets the A5V dwarf 2MASSJ17430448+6655015</span>
<span class="c1"># Reference Link: http://simbad.cds.unistra.fr/simbad/sim-basic?Ident=2MASSJ17430448%2B6655015&amp;submit=SIMBAD+search</span>
<span class="n">source_location</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="s1">&#39;17:43:04.4879&#39;</span><span class="p">,</span> <span class="s1">&#39;+66:55:01.837&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">source_location</span><span class="p">)</span>

<span class="n">cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">norm2</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">cutout</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MJy/sr&#39;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PID1028, Obs006&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Pixels&#39;)
</pre></div>
</div>
<img alt="../../../_images/3a803cb7bb03f7f55f4b2a5809559b552592596b03bca9e7403a62c1e7cdd189.png" src="../../../_images/3a803cb7bb03f7f55f4b2a5809559b552592596b03bca9e7403a62c1e7cdd189.png" />
</div>
</div>
</section>
<section id="generate-empirical-psf-grid-for-miri-f770w-using-webbpsf-a-class-anchor-id-bso3-a">
<h2>3.2 Generate empirical PSF grid for MIRI F770W using WebbPSF <a class="anchor" id="bso3"></a><a class="headerlink" href="#generate-empirical-psf-grid-for-miri-f770w-using-webbpsf-a-class-anchor-id-bso3-a" title="Permalink to this heading">#</a></h2>
<p>Let’s now use WebbPSF to generate an empirical grid of ePSF models for MIRI F770W.
The output will be a Photutils <a class="reference external" href="https://photutils.readthedocs.io/en/latest/api/photutils.psf.GriddedPSFModel.html#photutils.psf.GriddedPSFModel">GriddedPSFModel</a> containing a 2x2 grid of detector-position-dependent empirical PSFs, each oversampled by a factor of 4. Note that we save the PSF grid to a FITS file (via <code class="docutils literal notranslate"><span class="pre">save=True</span></code>) called <code class="docutils literal notranslate"><span class="pre">miri_mirim_f770w_fovp101_samp4_npsf4.fits</span></code>.  To save time in future runs, we load this FITS file directly into a <code class="docutils literal notranslate"><span class="pre">GriddedPSFModel</span></code> object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psfgrid_filename</span> <span class="o">=</span> <span class="s1">&#39;miri_mirim_f770w_fovp101_samp4_npsf4.fits&#39;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">psfgrid_filename</span><span class="p">):</span>
    <span class="n">miri</span> <span class="o">=</span> <span class="n">webbpsf</span><span class="o">.</span><span class="n">MIRI</span><span class="p">()</span>
    <span class="n">miri</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="s1">&#39;F770W&#39;</span>
    <span class="n">psf_model</span> <span class="o">=</span> <span class="n">miri</span><span class="o">.</span><span class="n">psf_grid</span><span class="p">(</span><span class="n">num_psfs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">all_detectors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">psf_model</span> <span class="o">=</span> <span class="n">GriddedPSFModel</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">psfgrid_filename</span><span class="p">)</span>

<span class="n">psf_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/4: (0, 0) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:31:53,698 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.11/x64/lib/python3.11/site-packages/webbpsf/opds.py:1746: UserWarning: For (V2,V3) = [-6.36389848 -7.26853851] arcmin, Field point -6.3638984816102235 arcmin, -0.5632056 arcmin not within valid region for field dependence model of OTE WFE for MIRI: -8.254199999999999 arcmin--6.21738 arcmin, -2.557224 arcmin--0.5632056 arcmin. Clipping to closest available valid location, 0.031744109903437345 arcmin away from the requested coordinates.
  warnings.warn(f&#39;For (V2,V3) = {v2v3}, Field point {x_field_pt}, {y_field_pt} not within valid region for field dependence model of OTE WFE for {instrument}: {min_x_field}-{max_x_field}, {min_y_field}-{max_y_field}. Clipping to closest available valid location, {clip_dist} away from the requested coordinates.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/4 centroid: (201.4023624749013, 201.47046390597333)
    Position 2/4: (0, 1023) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:32:01,225 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.11/x64/lib/python3.11/site-packages/webbpsf/opds.py:1746: UserWarning: For (V2,V3) = [-6.21257653 -5.39972458] arcmin, Field point -6.21738 arcmin, -2.4002754231217454 arcmin not within valid region for field dependence model of OTE WFE for MIRI: -8.254199999999999 arcmin--6.21738 arcmin, -2.557224 arcmin--0.5632056 arcmin. Clipping to closest available valid location, 0.00480347054204433 arcmin away from the requested coordinates.
  warnings.warn(f&#39;For (V2,V3) = {v2v3}, Field point {x_field_pt}, {y_field_pt} not within valid region for field dependence model of OTE WFE for {instrument}: {min_x_field}-{max_x_field}, {min_y_field}-{max_y_field}. Clipping to closest available valid location, {clip_dist} away from the requested coordinates.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 2/4 centroid: (201.30690755776234, 201.33283949933355)
    Position 3/4: (1023, 0) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 3/4 centroid: (201.46001999611343, 201.57406698621335)
    Position 4/4: (1023, 1023) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:32:13,019 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.11/x64/lib/python3.11/site-packages/astropy/io/fits/card.py:1038: VerifyWarning: Card is too long, comment will be truncated.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 4/4 centroid: (201.71435554877664, 201.48197003471253)
  Saving file: miri_mirim_f770w_fovp101_samp4_npsf4.fits
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;GriddedPSFModel(flux=1., x_0=0., y_0=0.)&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the PSF grid</span>
<span class="n">psf_model</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/b52bd23cfa3ad50496c6c06ab126664f5fee636e32d54212a29b39b7ed481637.png" src="../../../_images/b52bd23cfa3ad50496c6c06ab126664f5fee636e32d54212a29b39b7ed481637.png" />
<img alt="../../../_images/b52bd23cfa3ad50496c6c06ab126664f5fee636e32d54212a29b39b7ed481637.png" src="../../../_images/b52bd23cfa3ad50496c6c06ab126664f5fee636e32d54212a29b39b7ed481637.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the PSF grid deltas from the mean ePSF</span>
<span class="n">psf_model</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">deltas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/659b4587db502407d38266ead9ebb4333c92f48eebb243cc6d89171de50d2627.png" src="../../../_images/659b4587db502407d38266ead9ebb4333c92f48eebb243cc6d89171de50d2627.png" />
<img alt="../../../_images/659b4587db502407d38266ead9ebb4333c92f48eebb243cc6d89171de50d2627.png" src="../../../_images/659b4587db502407d38266ead9ebb4333c92f48eebb243cc6d89171de50d2627.png" />
</div>
</div>
</section>
<section id="psf-photometry-a-class-anchor-id-bso4-a">
<h2>3.3 PSF Photometry <a class="anchor" id="bso4"></a><a class="headerlink" href="#psf-photometry-a-class-anchor-id-bso4-a" title="Permalink to this heading">#</a></h2>
<p>Now let’s use our gridded PSF model to perform PSF photometry.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load data and convert units from MJy/sr to uJy</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">bunit_data</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">err</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>

    <span class="c1"># use pixel area map because of geometric distortion in level-2 data </span>
    <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">photometry</span><span class="o">.</span><span class="n">pixelarea_steradians</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span>
    <span class="n">data</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    <span class="n">error</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>

<span class="n">data</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">unit</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Unit(&quot;uJy&quot;), Unit(&quot;uJy&quot;))
</pre></div>
</div>
</div>
</div>
<p>To perform photometry on a single source we can input a Table containing its (x, y) position.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">init_params</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
<span class="n">init_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=1</i>
<table id="table140166539969232" class="table-striped table-bordered table-condensed">
<thead><tr><th>x</th><th>y</th></tr></thead>
<thead><tr><th>float64</th><th>float64</th></tr></thead>
<tr><td>691.0126389412841</td><td>512.5838903335235</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we turn off the finder because we input the source position</span>
<span class="n">fit_shape</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">localbkg_estimator</span> <span class="o">=</span> <span class="n">LocalBackground</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">bkg_estimator</span><span class="o">=</span><span class="n">MMMBackground</span><span class="p">())</span>
<span class="n">psfphot</span> <span class="o">=</span> <span class="n">PSFPhotometry</span><span class="p">(</span><span class="n">psf_model</span><span class="p">,</span> <span class="n">fit_shape</span><span class="p">,</span> <span class="n">finder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aperture_radius</span><span class="o">=</span><span class="n">fit_shape</span><span class="p">,</span> 
                        <span class="n">localbkg_estimator</span><span class="o">=</span><span class="n">localbkg_estimator</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">phot</span> <span class="o">=</span> <span class="n">psfphot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">init_params</span><span class="o">=</span><span class="n">init_params</span><span class="p">)</span>
<span class="n">phot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:32:14,278 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.11/x64/lib/python3.11/site-packages/photutils/psf/photometry.py:346: AstropyUserWarning: Input data contains unmasked non-finite values (NaN or inf), which were automatically ignored.
  warnings.warn(&#39;Input data contains unmasked non-finite values &#39;
</pre></div>
</div>
<div class="output text_html"><div><i>QTable length=1</i>
<table id="table140166542740112" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>group_id</th><th>local_bkg</th><th>x_init</th><th>y_init</th><th>flux_init</th><th>x_fit</th><th>y_fit</th><th>flux_fit</th><th>x_err</th><th>y_err</th><th>flux_err</th><th>npixfit</th><th>group_size</th><th>qfit</th><th>cfit</th><th>flags</th></tr></thead>
<thead><tr><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>int64</th></tr></thead>
<tr><td>1</td><td>1</td><td>1.4397037772319776</td><td>691.0126389412841</td><td>512.5838903335235</td><td>475.7886379871932</td><td>691.179636780988</td><td>512.9113038644382</td><td>452.42267160623965</td><td>0.0010104372890293197</td><td>0.0010233534547689721</td><td>0.49982426715183176</td><td>25</td><td>1</td><td>0.7077179013668748</td><td>-0.01809988847561868</td><td>0</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert fit flux from uJy to ABmag</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_fit&#39;</span><span class="p">]</span>
<span class="n">flux_err</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_err&#39;</span><span class="p">]</span>
<span class="n">mag</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_fit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ABmag</span><span class="p">)</span>
<span class="n">magerr</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">flux_err</span> <span class="o">/</span> <span class="n">flux</span><span class="p">))</span>
<span class="n">magerr</span> <span class="o">=</span> <span class="n">magerr</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">ABmag</span>
<span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Magnitude [17.2611391] mag(AB)&gt;, &lt;Magnitude [0.00119883] mag(AB)&gt;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">cutout1</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">cutout1</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">98</span><span class="p">)</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout1</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Data ($\mu$Jy)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">psfphot</span><span class="o">.</span><span class="n">make_model_image</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
<span class="n">cutout2</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout2</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fit PSF Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">resid</span> <span class="o">=</span> <span class="n">psfphot</span><span class="o">.</span><span class="n">make_residual_image</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
<span class="n">cutout3</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">resid</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">norm3</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">cutout3</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout3</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7f7ace0d8610&gt;
</pre></div>
</div>
<img alt="../../../_images/68e039717bb1d3220ee6d503c48bad3182e3db4c7ddc3fd3b25f518f7853b1a3.png" src="../../../_images/68e039717bb1d3220ee6d503c48bad3182e3db4c7ddc3fd3b25f518f7853b1a3.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="faint-upper-limit-single-object-a-class-anchor-id-fso-a">
<h1>4. Faint/Upper Limit, Single Object <a class="anchor" id="fso"></a><a class="headerlink" href="#faint-upper-limit-single-object-a-class-anchor-id-fso-a" title="Permalink to this heading">#</a></h1>
<p>The purpose of this section is to illustrate how to calculate an upper limit at a fixed (x, y) position using forced PSF photometry a blank part of the sky.</p>
<p>We’ll use the same data as Section 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load data and convert units from MJy/sr to uJy</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">bunit_data</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">err</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    
    <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">photometry</span><span class="o">.</span><span class="n">pixelarea_steradians</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span>
    <span class="n">data</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    <span class="n">error</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>

<span class="n">source_location</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="s1">&#39;17:43:00.0332&#39;</span><span class="p">,</span> <span class="s1">&#39;+66:54:42.677&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">source_location</span><span class="p">)</span>

<span class="n">cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">cutout</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mu$Jy&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PID1028, Obs006&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Pixels&#39;)
</pre></div>
</div>
<img alt="../../../_images/00a44a9143db4a72dec13e17f282a929ea5ced4503a5cbc3702c6843d1cd6901.png" src="../../../_images/00a44a9143db4a72dec13e17f282a929ea5ced4503a5cbc3702c6843d1cd6901.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to perform forced photometry, we set the (x, y) source position</span>
<span class="c1"># AND we fix the PSF model position so that it does not vary in the fit</span>
<span class="c1"># (only flux will be fit)</span>
<span class="n">init_params</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>

<span class="c1"># This requires photutils 1.11.0</span>
<span class="n">psf_model_forced</span> <span class="o">=</span> <span class="n">psf_model</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">psf_model_forced</span><span class="o">.</span><span class="n">x_0</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">psf_model_forced</span><span class="o">.</span><span class="n">y_0</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">psf_model_forced</span><span class="o">.</span><span class="n">fixed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;flux&#39;: False, &#39;x_0&#39;: True, &#39;y_0&#39;: True}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_shape</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">localbkg_estimator</span> <span class="o">=</span> <span class="n">LocalBackground</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">bkg_estimator</span><span class="o">=</span><span class="n">MMMBackground</span><span class="p">())</span>
<span class="n">psfphot</span> <span class="o">=</span> <span class="n">PSFPhotometry</span><span class="p">(</span><span class="n">psf_model_forced</span><span class="p">,</span> <span class="n">fit_shape</span><span class="p">,</span> <span class="n">finder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aperture_radius</span><span class="o">=</span><span class="n">fit_shape</span><span class="p">,</span> 
                        <span class="n">localbkg_estimator</span><span class="o">=</span><span class="n">localbkg_estimator</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">phot</span> <span class="o">=</span> <span class="n">psfphot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">init_params</span><span class="o">=</span><span class="n">init_params</span><span class="p">)</span>
<span class="n">phot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:32:15,772 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.11/x64/lib/python3.11/site-packages/photutils/psf/photometry.py:346: AstropyUserWarning: Input data contains unmasked non-finite values (NaN or inf), which were automatically ignored.
  warnings.warn(&#39;Input data contains unmasked non-finite values &#39;
</pre></div>
</div>
<div class="output text_html"><div><i>QTable length=1</i>
<table id="table140166670874064" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>group_id</th><th>local_bkg</th><th>x_init</th><th>y_init</th><th>flux_init</th><th>x_fit</th><th>y_fit</th><th>flux_fit</th><th>x_err</th><th>y_err</th><th>flux_err</th><th>npixfit</th><th>group_size</th><th>qfit</th><th>cfit</th><th>flags</th></tr></thead>
<thead><tr><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>int64</th></tr></thead>
<tr><td>1</td><td>1</td><td>1.2926637902219071</td><td>559.0832487866571</td><td>772.8615809732944</td><td>99.6914129363197</td><td>559.0832487866571</td><td>772.8615809732944</td><td>-0.3700018357369572</td><td>nan</td><td>nan</td><td>0.061692716759511525</td><td>25</td><td>1</td><td>-96.08235647948484</td><td>0.4232093213516833</td><td>4</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To calculate upper limit, multiply the flux_err by your desired sigma</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">limit</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_err&#39;</span><span class="p">]</span>
<span class="n">limit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ABmag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[[25.731612] \; \mathrm{mag}$$\mathrm{\left( \mathrm{AB} \right)}\]</div>
</div>
</div>
<section id="note-you-can-go-significantly-deeper-with-the-level-3-combined-data-product">
<h2>Note: you can go significantly deeper with the Level 3 combined data product<a class="headerlink" href="#note-you-can-go-significantly-deeper-with-the-level-3-combined-data-product" title="Permalink to this heading">#</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="stellar-field-lmc-a-class-anchor-id-lmc-a">
<h1>5. Stellar Field (LMC) <a class="anchor" id="lmc"></a><a class="headerlink" href="#stellar-field-lmc-a-class-anchor-id-lmc-a" title="Permalink to this heading">#</a></h1>
<p>In this case, we are going to do the same steps as in Section 3, but for multiple stars. The purpose is to illustrate the workflow and runtime for using Photutils on a large number of stars.</p>
<section id="multiple-stars-single-level-2-file-a-class-anchor-id-lmc2-a">
<h2>5.1 Multiple Stars, Single Level 2 File <a class="anchor" id="lmc2"></a><a class="headerlink" href="#multiple-stars-single-level-2-file-a-class-anchor-id-lmc2-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find stars in Level 3 File</span>
<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;./mast/01171/&#39;</span>
<span class="n">level3</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;jw01171-o004_t001_miri_f560w_i2d.fits&#39;</span><span class="p">)</span>
<span class="n">level3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;./mast/01171/jw01171-o004_t001_miri_f560w_i2d.fits&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get rough estimate of background (there are better ways to do background subtraction)</span>
<span class="n">bkgrms</span> <span class="o">=</span> <span class="n">MADStdBackgroundRMS</span><span class="p">()</span>
<span class="n">mmm_bkg</span> <span class="o">=</span> <span class="n">MMMBackground</span><span class="p">()</span>

<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">level3</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">wcs_l3</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">bkgrms</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">bkg</span> <span class="o">=</span> <span class="n">mmm_bkg</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">data_bkgsub</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data_bkgsub</span> <span class="o">-=</span> <span class="n">bkg</span> 

<span class="c1"># Find stars</span>
<span class="c1"># F560W FWHM = 1.882 pix</span>
<span class="n">fwhm_psf</span> <span class="o">=</span> <span class="mf">1.882</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">daofind</span> <span class="o">=</span> <span class="n">DAOStarFinder</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span> <span class="o">*</span> <span class="n">std</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="n">fwhm_psf</span><span class="p">,</span> <span class="n">exclude_border</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_separation</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">found_stars</span> <span class="o">=</span> <span class="n">daofind</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">)</span>

<span class="c1"># print first 10 rows</span>
<span class="n">found_stars</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>QTable length=10</i>
<table id="table140166544104656" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>xcentroid</th><th>ycentroid</th><th>sharpness</th><th>roundness1</th><th>roundness2</th><th>npix</th><th>sky</th><th>peak</th><th>flux</th><th>mag</th></tr></thead>
<thead><tr><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float32</th><th>float64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>1</td><td>546.2615248590856</td><td>5.40090706700177</td><td>0.7041937380599614</td><td>0.46773428</td><td>0.04273256330788055</td><td>25</td><td>0.0</td><td>-0.8653272390365601</td><td>1.6463868618011475</td><td>-0.5413297293846483</td></tr>
<tr><td>2</td><td>789.0983970730795</td><td>6.312157835017226</td><td>0.6691237944354219</td><td>-0.17942303</td><td>-0.8079555096758742</td><td>25</td><td>0.0</td><td>-0.5761210918426514</td><td>1.1000438928604126</td><td>-0.10352503572911273</td></tr>
<tr><td>3</td><td>845.9799634503643</td><td>3.6757970986043205</td><td>0.6829976607805458</td><td>0.043498766</td><td>-0.42254093349077776</td><td>25</td><td>0.0</td><td>-1.171976923942566</td><td>1.1794757843017578</td><td>-0.17922257214246215</td></tr>
<tr><td>4</td><td>899.9897053947699</td><td>6.39779821296389</td><td>0.5563295885896342</td><td>-0.13047144</td><td>0.2603567958961923</td><td>25</td><td>0.0</td><td>-0.9210708141326904</td><td>1.282814621925354</td><td>-0.2704097537749816</td></tr>
<tr><td>5</td><td>933.9483297710668</td><td>6.082630968636201</td><td>0.5395764543423918</td><td>-0.30286184</td><td>0.31405623969522456</td><td>25</td><td>0.0</td><td>-0.8810544013977051</td><td>1.310049295425415</td><td>-0.2932190947280454</td></tr>
<tr><td>6</td><td>385.6695305861909</td><td>5.6695305861908665</td><td>0.7041937004909312</td><td>0.32498807</td><td>0.0</td><td>25</td><td>0.0</td><td>-0.24849343299865723</td><td>2.248995780944824</td><td>-0.8799716017792757</td></tr>
<tr><td>7</td><td>385.3304694138091</td><td>5.6695305861908665</td><td>0.7041937004909312</td><td>-0.75487006</td><td>-7.402970179157126e-16</td><td>25</td><td>0.0</td><td>-0.24849343299865723</td><td>2.248995780944824</td><td>-0.8799716017792757</td></tr>
<tr><td>8</td><td>444.15413979694966</td><td>6.5255939563821155</td><td>0.5542676488294513</td><td>0.54399556</td><td>-0.0043752550961698635</td><td>25</td><td>0.0</td><td>-0.6147366762161255</td><td>1.59718656539917</td><td>-0.508389121265139</td></tr>
<tr><td>9</td><td>457.96743096331807</td><td>6.572213266744114</td><td>0.5819540250110783</td><td>-0.37343192</td><td>0.32949080159621963</td><td>25</td><td>0.0</td><td>-0.6794391870498657</td><td>1.4479076862335205</td><td>-0.40185218393906974</td></tr>
<tr><td>10</td><td>504.80151790231764</td><td>6.318931006256025</td><td>0.7041936997157474</td><td>-0.40236253</td><td>0.013733775120274237</td><td>25</td><td>0.0</td><td>-0.3774709701538086</td><td>2.122992515563965</td><td>-0.817371157747781</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the found stars</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

<span class="n">xypos</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">])</span>
<span class="n">aper</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">(</span><span class="n">xypos</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">aper</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.patches.Circle at 0x7f7acdb79750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdac7850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b10e7a890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99a490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99a150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd999b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd999a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd999490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd998f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd999e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd998490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd998410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99a710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99aa10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99be90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99bbd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99b910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99b650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99b390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99b0d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99ad10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdc5cc10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdc5f450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdc5f510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdc5e910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdc5e190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdc5d3d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd9ab250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdb73450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdb73950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdb72510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdb724d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdb73d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99da90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99d490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99d110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99cd90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99ca10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99c4d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99c150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd99d890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdca6090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd9b5590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b63e150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acda542d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5f7690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5f5e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5f61d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdd34b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd9eb950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b645f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b6459d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b6470d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b647a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b645990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b644250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b644610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b644990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b69e790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b69d650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b69fe50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b69cd90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b69c410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b69dd90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b69c310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b69ecd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b69c050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acda4f090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acda4f390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdbcc750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdbcfd10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b53d6d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b53dd90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b53f450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b53ff90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b53cd10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b6d9450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b6da7d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b6d8950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b6d8d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b6d8250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b6d8510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b6da3d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b6d9b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b6d9f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b6da990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b55e350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b55cc50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b55f750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b55e650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b55c390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b55c810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b55e0d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b55ed90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b55ea10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b564050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b564390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b564710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b564d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b564cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b565590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5655d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b565dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b565cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b566050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b566190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5664d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b566b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b566dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5672d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b567690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b567990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b567ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b459f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b458410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b458790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b458990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b458e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b459210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b459410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b459910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b459c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45a090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45a5d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45ab90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45b050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45b590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45bad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45bed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40f610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40fad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40fe50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40c050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40c9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40c790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40cbd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40d050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40d350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40d6d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40da10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40de50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40e0d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40e550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40e790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40f050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40eed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40f750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4698d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b469c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b469fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b46a310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b46a6d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b46aa10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b46ad90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b46b0d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b46b450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b46b8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b46bb90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b46bf10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4684d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b468a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b468f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b469490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b470290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b470610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b470990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b470d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b471090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b471350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4717d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b471a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b471f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b472390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b472750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b472b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b472e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b473190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b473550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4738d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b473c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b473fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e0390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e0710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e0a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e0e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e1190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e1510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e1890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e1c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e1f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e2310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e2690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e2a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e2d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e3110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e3490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e3810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e3b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5e3f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d42d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d4650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d49d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d4d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d5190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d5450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d57d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d5b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d5ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d6250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d65d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d6950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d6cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d7050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d73d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d7750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d7ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b5d7e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b418210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b418590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b418910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b418c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b419010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b419390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b419710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b419a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b419e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41a190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41a510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41a890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41ac10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41af90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41b310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41b690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41ba10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41bd90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41c1d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41c550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41c8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41ccd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41cfd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41d350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41d6d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41da50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41ddd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41e150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41e4d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41e6d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41ebd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41ef50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41f290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41f710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41f9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b41fbd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b420090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b420410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b420790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b420b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b420e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b421210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b421590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b421910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b421c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b422010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b422390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b422710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b422a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b422e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b423190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b423510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b423890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b423c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b423f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b424350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4246d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b424a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b424dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b425150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4254d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b425850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b425bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b425f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4262d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b426650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4269d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b426d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4270d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b427450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4277d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b427b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b427ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b430310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b430510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b430a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b430d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b430f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdbc8150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0e997750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acd9b5310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b431710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b431cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b431e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b432390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b432710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b432910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b432e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b433190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b433390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b433890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b433c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b433e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4342d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b434650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4349d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b434d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4350d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b435450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4357d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b435b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b435ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b436250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4365d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b436950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b436cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b437050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4373d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b437750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b437ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b437e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b438210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b438590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b438910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b438c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b439010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b439390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b439710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b439a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b439e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b43a190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b43a510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b43a890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b43ac10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b43af90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b43b310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b43b690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b43b9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b43be50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b444150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4444d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b444850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b444bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b444f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4452d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b445650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4459d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b445d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4460d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b446450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4467d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b446b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b446ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b447250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4475d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b447950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b447cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ec090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ec410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ec790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ecb10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ece90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ed210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ed590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ed910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3edc90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ee010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ee390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ee710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3eea90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3eee10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ef190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ef510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ef890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3efc10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3eff90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f0350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f06d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f0a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f0dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f1150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f14d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f1850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f1bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f1f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f2390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f2650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f29d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f2d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f30d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f3450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f37d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f3b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f3ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44c290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44c610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44c990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44cd10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44d090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44d410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44d790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44db10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44de90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44e210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44e590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44e910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44ec90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44f010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44f390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44f710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44fa90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b44fe10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f41d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f4550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f48d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f4c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f4fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f5350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f56d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f5a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f5dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f6150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f64d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f6850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f6bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f6f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f72d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f7650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f79d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f7d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fc250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fc810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fc850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fcf50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fd2d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fd150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fd290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fd750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fdad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fde10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fe7d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fe590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fe8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ff150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fef90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ff410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ffcd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ff950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45c050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45c3d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45c750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45cad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45ce50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45d1d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45d550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45d8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45dc50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45dfd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45e350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45e6d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45ea50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45edd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45f150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45f4d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45f850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45fbd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b45ff50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b400310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b400690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b400a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b400d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b401110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b401490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b401810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b401b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b401f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b402290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b402610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b402950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b402dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b403090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b403410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b403790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b403b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b403e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b408250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4085d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b408950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b408cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b409050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4093d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b409750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b409ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b409e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40a1d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40a550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40a8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40ac50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40afd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40b350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40b6d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40ba50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b40bdd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b410190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b410510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b410890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b410c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b410f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b411310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b411690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b411a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b411d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b412110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b412490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b412810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b412b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b412f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b413290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b413610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b413990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b413d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4500d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b450450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4507d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b450b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b450e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b451310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4515d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b451950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b451cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b452050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4523d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b452750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b452ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b452e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4531d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b453550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4538d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b453c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b453fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f8390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f8710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f8a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f8e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f9190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f9510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f9890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f9c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3f9f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fa310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fa690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3faa10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fad90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fb110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fb490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fb810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fbb90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3fbf10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3e82d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3e8650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3e89d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3e8d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3e90d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3e9450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3e97d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3e9b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3e9ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ea250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ea5d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ea950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3eacd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3eb050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3eb390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3eb810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ebad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b3ebe50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b478210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b478590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b478910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b478c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b479010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b479390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b479710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b479a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b479e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47a190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47a510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47a890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47ac10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47af90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47b310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47b690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47ba10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47bd90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47c150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47c4d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47c850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47cbd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47cf50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47d2d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47d650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47d9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47dd50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47e0d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47e450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47e7d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47eb50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47eed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47f250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47f5d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47f950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b47fcd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b480090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b480410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b480790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b480b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b480e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b481210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b481590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4818d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b481d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b482010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b482390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b482710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b482a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b482e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b483190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b483510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b483890&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b483c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b483f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b484350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4846d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b484a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b484dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b485150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4854d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b485850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b485bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b485f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4862d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b486650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4869d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b486d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4870d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b487450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4877d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b487b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b487ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48c290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48c610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48c990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48cd10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48d090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48d410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48d790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48db10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48de90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48e210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48e590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48e910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48ec90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48f010&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48f390&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48f710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48fa90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b48fdd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b490290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b490550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4908d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b490c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b490fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b491350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4916d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b491a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b491dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b492150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4924d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b492850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b492bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b492f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4932d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b493650&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4939d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b493d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b498110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b498490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b498810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b498b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b498f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b499290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b499610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b499990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b499d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49a090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49a410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49a790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49ab10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49ae90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49b210&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49b590&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49b910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49bc90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49c050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49c3d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49c750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49cad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49ce50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49d1d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49d550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49d8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49dc50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49dfd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49e310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49e790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49ea50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49edd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49f150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49f4d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49f850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49fbd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b49ff50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a4310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a4690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a4a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a4d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a5110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a5490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a5810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a5b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a5f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a6290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a6610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a6990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a6d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a7090&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a7410&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a7790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a7b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4a7e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4ac250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4ac5d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4ac950&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4accd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4ad050&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4ad3d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4ad750&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4adad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4ade50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4ae1d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4ae550&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4ae8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4aec50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4aefd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4af350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4af6d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4afa50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4afdd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b0190&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b0510&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b0850&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b0cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b0f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b1310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b1690&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b1a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b1d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b2110&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b2490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b2810&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b2b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b2f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b3290&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b3610&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b3990&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b3d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b40d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b4450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b47d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b4b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b4ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b5250&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b4b55d0&gt;]
</pre></div>
</div>
<img alt="../../../_images/2f863c380baa27a39828ac5d10dc34f49cd0f7888176b2f4b369cb4afcb95fe2.png" src="../../../_images/2f863c380baa27a39828ac5d10dc34f49cd0f7888176b2f4b369cb4afcb95fe2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">],</span> <span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;sharpness&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">],</span> <span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;roundness&#39;</span><span class="p">)</span>

<span class="n">mag0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.0</span>
<span class="n">mag1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span>
<span class="k">for</span> <span class="n">ax_</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mag0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mag1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>

<span class="n">sh0</span> <span class="o">=</span> <span class="mf">0.40</span>
<span class="n">sh1</span> <span class="o">=</span> <span class="mf">0.82</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">sh0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">sh1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>

<span class="n">rnd0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.40</span>
<span class="n">rnd1</span> <span class="o">=</span> <span class="mf">0.40</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">rnd0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">rnd1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.lines.Line2D at 0x7f7b0b5fecd0&gt;
</pre></div>
</div>
<img alt="../../../_images/488c26c90e85dc9fffb7cf5f9c119154751e5eb61ca20517c63b559f756f5cf2.png" src="../../../_images/488c26c90e85dc9fffb7cf5f9c119154751e5eb61ca20517c63b559f756f5cf2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mag0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">mag1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rnd0</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rnd1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sh0</span><span class="p">)</span> 
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sh1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">700</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">700</span><span class="p">))</span>

<span class="n">found_stars_sel</span> <span class="o">=</span> <span class="n">found_stars</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of stars found originally:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_stars</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of stars in final selection:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_stars_sel</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of stars found originally: 790
Number of stars in final selection: 13
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the selected stars</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

<span class="n">xypos</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">])</span>
<span class="n">aper</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">(</span><span class="n">xypos</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">aper</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.patches.Circle at 0x7f7b0b683b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdb44bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b10f5e150&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b10d7ff90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdc17310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdba9710&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdba9ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdac5910&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdc0d790&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b10f5db90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0af9f310&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdae7450&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdb44c10&gt;]
</pre></div>
</div>
<img alt="../../../_images/b1e2985dbec807d607e6f368fb74dd214329dcf2a984e0bc7986c4f1e9dc0db9.png" src="../../../_images/b1e2985dbec807d607e6f368fb74dd214329dcf2a984e0bc7986c4f1e9dc0db9.png" />
</div>
</div>
</section>
<section id="generate-empirical-psf-grid-for-miri-f560w-using-webbpsf-a-class-anchor-id-grid2-a">
<h2>5.2 Generate empirical PSF grid for MIRI F560W using WebbPSF <a class="anchor" id="grid2"></a><a class="headerlink" href="#generate-empirical-psf-grid-for-miri-f560w-using-webbpsf-a-class-anchor-id-grid2-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psfgrid_filename</span> <span class="o">=</span> <span class="s1">&#39;miri_mirim_f560w_fovp101_samp4_npsf4.fits&#39;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">psfgrid_filename</span><span class="p">):</span>
    <span class="n">miri</span> <span class="o">=</span> <span class="n">webbpsf</span><span class="o">.</span><span class="n">MIRI</span><span class="p">()</span>
    <span class="n">miri</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="s1">&#39;F560W&#39;</span>
    <span class="n">psf_model</span> <span class="o">=</span> <span class="n">miri</span><span class="o">.</span><span class="n">psf_grid</span><span class="p">(</span><span class="n">num_psfs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">all_detectors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">psf_model</span> <span class="o">=</span> <span class="n">GriddedPSFModel</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">psfgrid_filename</span><span class="p">)</span>

<span class="n">psf_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/4: (0, 0) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:32:21,321 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.11/x64/lib/python3.11/site-packages/webbpsf/opds.py:1746: UserWarning: For (V2,V3) = [-6.36389848 -7.26853851] arcmin, Field point -6.3638984816102235 arcmin, -0.5632056 arcmin not within valid region for field dependence model of OTE WFE for MIRI: -8.254199999999999 arcmin--6.21738 arcmin, -2.557224 arcmin--0.5632056 arcmin. Clipping to closest available valid location, 0.031744109903437345 arcmin away from the requested coordinates.
  warnings.warn(f&#39;For (V2,V3) = {v2v3}, Field point {x_field_pt}, {y_field_pt} not within valid region for field dependence model of OTE WFE for {instrument}: {min_x_field}-{max_x_field}, {min_y_field}-{max_y_field}. Clipping to closest available valid location, {clip_dist} away from the requested coordinates.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/4 centroid: (201.39504365744267, 201.46837962104274)
    Position 2/4: (0, 1023) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:32:25,344 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.11/x64/lib/python3.11/site-packages/webbpsf/opds.py:1746: UserWarning: For (V2,V3) = [-6.21257653 -5.39972458] arcmin, Field point -6.21738 arcmin, -2.4002754231217454 arcmin not within valid region for field dependence model of OTE WFE for MIRI: -8.254199999999999 arcmin--6.21738 arcmin, -2.557224 arcmin--0.5632056 arcmin. Clipping to closest available valid location, 0.00480347054204433 arcmin away from the requested coordinates.
  warnings.warn(f&#39;For (V2,V3) = {v2v3}, Field point {x_field_pt}, {y_field_pt} not within valid region for field dependence model of OTE WFE for {instrument}: {min_x_field}-{max_x_field}, {min_y_field}-{max_y_field}. Clipping to closest available valid location, {clip_dist} away from the requested coordinates.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 2/4 centroid: (201.3020934606855, 201.31984343070152)
    Position 3/4: (1023, 0) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 3/4 centroid: (201.42830769164877, 201.59926840411686)
    Position 4/4: (1023, 1023) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:32:36,977 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.11/x64/lib/python3.11/site-packages/astropy/io/fits/card.py:1038: VerifyWarning: Card is too long, comment will be truncated.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 4/4 centroid: (201.75498594600958, 201.4970454286807)
  Saving file: miri_mirim_f560w_fovp101_samp4_npsf4.fits
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;GriddedPSFModel(flux=1., x_0=0., y_0=0.)&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psf_model</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/af866449bb6deefc49c1d0fcbc5eb4dbde24c2cd50e73a3d76275ae61ea1d511.png" src="../../../_images/af866449bb6deefc49c1d0fcbc5eb4dbde24c2cd50e73a3d76275ae61ea1d511.png" />
<img alt="../../../_images/af866449bb6deefc49c1d0fcbc5eb4dbde24c2cd50e73a3d76275ae61ea1d511.png" src="../../../_images/af866449bb6deefc49c1d0fcbc5eb4dbde24c2cd50e73a3d76275ae61ea1d511.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the level 2 image</span>
<span class="c1"># here, we&#39;ll use the PID 1171 files</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./mast/01171/&quot;</span>
<span class="n">level2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;jw01171004*cal.fits&#39;</span><span class="p">)))</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">level2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c1"># load data and convert units from MJy/sr to uJy</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">bunit_data</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">dq</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">err</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    
    <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">photometry</span><span class="o">.</span><span class="n">pixelarea_steradians</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span>
    <span class="n">data</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    <span class="n">error</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>

    <span class="n">wcs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span>

<span class="n">data</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">unit</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./mast/01171/jw01171004001_02101_00001_mirimage_cal.fits
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Unit(&quot;uJy&quot;), Unit(&quot;uJy&quot;))
</pre></div>
</div>
</div>
</div>
</section>
<section id="psf-photometry-a-class-anchor-id-lmc3-a">
<h2>5.3 PSF Photometry <a class="anchor" id="lmc3"></a><a class="headerlink" href="#psf-photometry-a-class-anchor-id-lmc3-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># translate (x, y) positions from the level 3 image to the level 2 image</span>
<span class="n">xc</span> <span class="o">=</span> <span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]</span>
<span class="n">yc</span> <span class="o">=</span> <span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">wcs_l3</span><span class="o">.</span><span class="n">pixel_to_world</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">wcs</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="n">init_params</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>

<span class="c1"># we need to remove stars in the masked region of</span>
<span class="c1"># the level-2 data</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">400</span>
<span class="n">init_params</span> <span class="o">=</span> <span class="n">init_params</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([False,  True,  True,  True,  True, False,  True,  True,  True,
        True,  True,  True,  True])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the selected stars</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

<span class="n">xypos</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="n">aper</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">(</span><span class="n">xypos</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">aper</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.patches.Circle at 0x7f7acdc53350&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acda3c490&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b10f5e2d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b60ba90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b60ab90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b609d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b60b8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdabcdd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdabce10&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7b0b60be90&gt;,
 &lt;matplotlib.patches.Circle at 0x7f7acdaa7e90&gt;]
</pre></div>
</div>
<img alt="../../../_images/a0fbda196c2515ed71dcd32fba53908412be1b7b1e52ec9ce974267f5a261c19.png" src="../../../_images/a0fbda196c2515ed71dcd32fba53908412be1b7b1e52ec9ce974267f5a261c19.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_shape</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">localbkg_estimator</span> <span class="o">=</span> <span class="n">LocalBackground</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">bkg_estimator</span><span class="o">=</span><span class="n">MMMBackground</span><span class="p">())</span>
<span class="n">psfphot</span> <span class="o">=</span> <span class="n">PSFPhotometry</span><span class="p">(</span><span class="n">psf_model</span><span class="p">,</span> <span class="n">fit_shape</span><span class="p">,</span> <span class="n">finder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aperture_radius</span><span class="o">=</span><span class="n">fit_shape</span><span class="p">,</span> 
                        <span class="n">localbkg_estimator</span><span class="o">=</span><span class="n">localbkg_estimator</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">phot</span> <span class="o">=</span> <span class="n">psfphot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">init_params</span><span class="o">=</span><span class="n">init_params</span><span class="p">)</span>
<span class="n">phot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:32:38,306 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.11/x64/lib/python3.11/site-packages/photutils/psf/photometry.py:346: AstropyUserWarning: Input data contains unmasked non-finite values (NaN or inf), which were automatically ignored.
  warnings.warn(&#39;Input data contains unmasked non-finite values &#39;
</pre></div>
</div>
<div class="output text_html"><div><i>QTable length=11</i>
<table id="table140166449019216" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>group_id</th><th>local_bkg</th><th>x_init</th><th>y_init</th><th>flux_init</th><th>x_fit</th><th>y_fit</th><th>flux_fit</th><th>x_err</th><th>y_err</th><th>flux_err</th><th>npixfit</th><th>group_size</th><th>qfit</th><th>cfit</th><th>flags</th></tr></thead>
<thead><tr><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>int64</th></tr></thead>
<tr><td>1</td><td>1</td><td>0.6448802831437852</td><td>660.8682340958862</td><td>73.30952825775023</td><td>99.22615357989018</td><td>660.9286846394467</td><td>73.20923844919115</td><td>60.868198060066106</td><td>0.00508560759583491</td><td>0.005213347960630993</td><td>0.35070448135682786</td><td>25</td><td>1</td><td>0.6875349675263613</td><td>0.0507190914432771</td><td>0</td></tr>
<tr><td>2</td><td>2</td><td>0.5874391903047975</td><td>464.1246542280646</td><td>137.46955055574392</td><td>146.60569021592204</td><td>464.1612736578599</td><td>137.47656054126384</td><td>118.86790586339693</td><td>0.0036127479969553576</td><td>0.00332654031132284</td><td>0.4934731425162559</td><td>25</td><td>1</td><td>0.7937337032069842</td><td>0.0458428871200886</td><td>0</td></tr>
<tr><td>3</td><td>3</td><td>0.6104557472178589</td><td>481.9300536591688</td><td>142.74569905705442</td><td>122.16382552364978</td><td>481.7942336547994</td><td>142.85534595605364</td><td>93.13605371445458</td><td>0.004066468627209195</td><td>0.0037182540675848004</td><td>0.4370216793482647</td><td>25</td><td>1</td><td>0.6532491049959812</td><td>0.05590328925087897</td><td>0</td></tr>
<tr><td>4</td><td>4</td><td>0.5496421364243962</td><td>553.43672949644</td><td>147.6140915866477</td><td>110.58509932779731</td><td>553.3332687437463</td><td>147.6279956521992</td><td>81.38350059142448</td><td>0.0040451298749260445</td><td>0.0040049668954863765</td><td>0.3840827233584572</td><td>25</td><td>1</td><td>0.7618745097066745</td><td>0.06556201317924007</td><td>0</td></tr>
<tr><td>5</td><td>5</td><td>0.5802685211656431</td><td>493.8538169846163</td><td>220.82325504415456</td><td>170.9292596067879</td><td>493.8793157655576</td><td>220.62652265893462</td><td>150.22386179966216</td><td>0.003358635097457586</td><td>0.0031756031119978185</td><td>0.604400981865906</td><td>25</td><td>1</td><td>0.5327777896677033</td><td>0.05003401088019915</td><td>0</td></tr>
<tr><td>6</td><td>6</td><td>0.5552616705110063</td><td>633.1485658474755</td><td>324.17790497032087</td><td>116.40546174421459</td><td>633.1391855542114</td><td>324.1804492328962</td><td>88.43072429485113</td><td>0.004024860983398037</td><td>0.004004495142547085</td><td>0.4125289249159527</td><td>25</td><td>1</td><td>0.9902255297083485</td><td>0.12838325600826472</td><td>0</td></tr>
<tr><td>7</td><td>7</td><td>0.5410288111266928</td><td>597.6581645996761</td><td>447.6985048034759</td><td>121.35040364262599</td><td>597.3590198542189</td><td>447.56140193618455</td><td>98.56227008651472</td><td>0.00411653953630617</td><td>0.003647216028470465</td><td>0.4631820087267053</td><td>24</td><td>1</td><td>1.0760066465813405</td><td>0.045988202193837834</td><td>1</td></tr>
<tr><td>8</td><td>8</td><td>0.5712058916028622</td><td>546.6143269821247</td><td>529.1914918633589</td><td>259.8907892997661</td><td>546.8404355606814</td><td>529.2634236784783</td><td>251.86227681431046</td><td>0.0024193218378376147</td><td>0.0023130923903441785</td><td>0.7294551139699648</td><td>25</td><td>1</td><td>0.6666010174304933</td><td>0.02801968559292353</td><td>0</td></tr>
<tr><td>9</td><td>9</td><td>0.5766501870561154</td><td>453.82949747513493</td><td>549.258081072752</td><td>238.8740045482744</td><td>453.64985222857916</td><td>549.1688932057833</td><td>230.6362230696203</td><td>0.0025260579257618395</td><td>0.0027603261287867066</td><td>0.7252348583173828</td><td>25</td><td>1</td><td>0.7916554339315172</td><td>0.05213277450198142</td><td>0</td></tr>
<tr><td>10</td><td>10</td><td>0.543873813275104</td><td>581.7237520077483</td><td>589.2362246196259</td><td>150.4488293995264</td><td>581.8579817852578</td><td>589.3358089492639</td><td>129.7767129600465</td><td>0.0034935348032658553</td><td>0.003275752444225367</td><td>0.5187529531837481</td><td>25</td><td>1</td><td>0.9165073112371286</td><td>0.040711935582376686</td><td>0</td></tr>
<tr><td>11</td><td>11</td><td>0.5791730733885281</td><td>626.719046718948</td><td>619.1527113454913</td><td>252.4189435162317</td><td>626.6242165721334</td><td>619.0989132934759</td><td>231.22037687602779</td><td>0.00247478201995571</td><td>0.0028746739738682086</td><td>0.7257771750537931</td><td>25</td><td>1</td><td>0.778471055791462</td><td>0.03879531357454251</td><td>0</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert fit flux from uJy to ABmag</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_fit&#39;</span><span class="p">]</span>
<span class="n">flux_err</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_err&#39;</span><span class="p">]</span>
<span class="n">mag</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_fit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ABmag</span><span class="p">)</span>
<span class="n">magerr</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">flux_err</span> <span class="o">/</span> <span class="n">flux</span><span class="p">))</span>
<span class="n">magerr</span> <span class="o">=</span> <span class="n">magerr</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">ABmag</span>
<span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Magnitude [19.43902389, 18.71233847, 18.97720542, 19.12365908,
             18.45815269, 19.03349204, 18.91572326, 17.89709219,
             17.99268121, 18.61700808, 17.98993474] mag(AB)&gt;,
 &lt;Magnitude [0.00623774, 0.00449804, 0.00508268, 0.00511199, 0.00435952,
             0.00505318, 0.00509034, 0.00314001, 0.00340874, 0.00433133,
             0.00340268] mag(AB)&gt;)
</pre></div>
</div>
</div>
</div>
<hr style="border:1px solid gray"> </hr><a class="reference internal image-reference" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></a>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/MIRI/psf_photometry"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">MIRI PSF Photometry with Photutils</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of contents</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-class-anchor-id-intro-a">1. Introduction <a class="anchor" id="intro"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-imports-a-class-anchor-id-imports-a">1.1 Python Imports <a class="anchor" id="imports"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-set-up-required-data-for-webbpsf-and-synphot-a-class-anchor-id-setup-a">1.2 Download and Set up Required Data for WebbPSF and Synphot <a class="anchor" id="setup"></a></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download-jwst-miri-data-a-class-anchor-id-data-a">2. Download JWST MIRI Data <a class="anchor" id="data"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#single-bright-star-a-class-anchor-id-bso-a">3. Single Bright Star <a class="anchor" id="bso"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#single-level-2-file-a-class-anchor-id-bso2-a">3.1 Single Level 2 File <a class="anchor" id="bso2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-empirical-psf-grid-for-miri-f770w-using-webbpsf-a-class-anchor-id-bso3-a">3.2 Generate empirical PSF grid for MIRI F770W using WebbPSF <a class="anchor" id="bso3"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-photometry-a-class-anchor-id-bso4-a">3.3 PSF Photometry <a class="anchor" id="bso4"></a></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#faint-upper-limit-single-object-a-class-anchor-id-fso-a">4. Faint/Upper Limit, Single Object <a class="anchor" id="fso"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#note-you-can-go-significantly-deeper-with-the-level-3-combined-data-product">Note: you can go significantly deeper with the Level 3 combined data product</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#stellar-field-lmc-a-class-anchor-id-lmc-a">5. Stellar Field (LMC) <a class="anchor" id="lmc"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-stars-single-level-2-file-a-class-anchor-id-lmc2-a">5.1 Multiple Stars, Single Level 2 File <a class="anchor" id="lmc2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-empirical-psf-grid-for-miri-f560w-using-webbpsf-a-class-anchor-id-grid2-a">5.2 Generate empirical PSF grid for MIRI F560W using WebbPSF <a class="anchor" id="grid2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-photometry-a-class-anchor-id-lmc3-a">5.3 PSF Photometry <a class="anchor" id="lmc3"></a></a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>