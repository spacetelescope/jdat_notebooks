

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>MIRI PSF Photometry with Photutils &#8212; STScI JDAT Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-D46G4HKJY3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/MIRI/psf_photometry/miri_1028_photutils';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="STScI JDAT Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="STScI JDAT Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">General</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebook_development_workflow.html">Notebook Development Workflow</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/submitting_notebooks.html">Submitting Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/requirements.html">Requirements file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebooks.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/data_files.html">Data Files</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">GitHub Guidelines</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_setup.html">GitHub Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_workflow.html">GitHub Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_pr.html">GitHub PR</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Cross-Instrument</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/asdf_example/asdf_example.html">ASDF Example</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/background_estimation_imaging/Imaging_Sky_Background_Estimation.html">Complex 2D Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/composite_model_fitting/specfit_demo_3.html">Composite Model Spectral Fitting</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">MAST Query</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/rgb_imviz/imviz_rgb_carina.html">RGB images with Imviz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">Specviz Simple Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/update_pure_parallel_wcs/NIRISS_correct_pure_parallel_WCS.html">Improving Accuracy of WCS of Pure Parallel Dataset</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MIRI</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">MRS Mstar - Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">IFU of YSOs in LMC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MIRI_LRS_spectral_extraction/miri_lrs_advanced_extraction_part1.html">LRS Optimal Spectral Extraction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRCam</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/aperture_photometry/NIRCam_Aperture_Photometry_Example.html">Point Source Aperture Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_photometry/NIRCam_multiband_photometry.html">Extended Aperture Photometry</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">Cross-Filter PSF Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/psf_photometry/NIRCam_PSF_Photometry_Example.html">PSF Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_wisp_subtraction/nircam_wisp_subtraction.html">NIRCam Wisp Removal</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRISS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/00_Optimal_extraction.html">WFSS Spectra - Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/01_Combine_and_normalize_1D_spectra.html">WFSS Spectra - Combine and Normalize 1D Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/02_Cross_correlation_template.html">WFSS Spectra - Cross-Correlation Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map.html">WFSS Spectra - Emission Line Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/00_niriss_mast_query_data_setup.html">NIRISS MAST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/01_niriss_wfss_image2_image3.html">Direct imaging for WFSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/02_niriss_wfss_spec2.html">Spec2 pipeline for WFSS</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRSpec</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html">IFU Cube Fitting</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/cube_fitting/cube_fitting.html">IFU Cube Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/ifu_optimal/ifu_optimal.html">IFU Optimal Spectral Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/optimal_extraction/Spectral_Extraction-static.html">MOS Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/mos_spectroscopy_advanced/MOSspec_advanced.html">MOS Spectroscopy of Extragalactic Field</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">BOTS Time Series Observations</a></li>








<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/galaxy_redshift/redshift_fitting.html">Redshift and Template Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/FS_NSClean_example.html">FS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/IFU_NSClean_example.html">IFU Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/MOS_NSClean_example.html">MOS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/BOTS_NSClean_example.html">BOTS Products with NSClean</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/MIRI/psf_photometry/miri_1028_photutils.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/MIRI/psf_photometry/miri_1028_photutils.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>MIRI PSF Photometry with Photutils</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">MIRI PSF Photometry with Photutils</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of contents</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-class-anchor-id-intro-a">1. Introduction <a class="anchor" id="intro"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-imports-a-class-anchor-id-imports-a">1.1 Python Imports <a class="anchor" id="imports"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-set-up-required-data-for-webbpsf-and-synphot-a-class-anchor-id-setup-a">1.2 Download and Set up Required Data for WebbPSF and Synphot <a class="anchor" id="setup"></a></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download-jwst-miri-data-a-class-anchor-id-data-a">2. Download JWST MIRI Data <a class="anchor" id="data"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#single-bright-star-a-class-anchor-id-bso-a">3. Single Bright Star <a class="anchor" id="bso"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#single-level-2-file-a-class-anchor-id-bso2-a">3.1 Single Level 2 File <a class="anchor" id="bso2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-empirical-psf-grid-for-miri-f770w-using-webbpsf-a-class-anchor-id-bso3-a">3.2 Generate empirical PSF grid for MIRI F770W using WebbPSF <a class="anchor" id="bso3"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-photometry-a-class-anchor-id-bso4-a">3.3 PSF Photometry <a class="anchor" id="bso4"></a></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#faint-upper-limit-single-object-a-class-anchor-id-fso-a">4. Faint/Upper Limit, Single Object <a class="anchor" id="fso"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#note-you-can-go-significantly-deeper-with-the-level-3-combined-data-product">Note: you can go significantly deeper with the Level 3 combined data product</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#stellar-field-lmc-a-class-anchor-id-lmc-a">5. Stellar Field (LMC) <a class="anchor" id="lmc"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-stars-single-level-2-file-a-class-anchor-id-lmc2-a">5.1 Multiple Stars, Single Level 2 File <a class="anchor" id="lmc2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-empirical-psf-grid-for-miri-f560w-using-webbpsf-a-class-anchor-id-grid2-a">5.2 Generate empirical PSF grid for MIRI F560W using WebbPSF <a class="anchor" id="grid2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-photometry-a-class-anchor-id-lmc3-a">5.3 PSF Photometry <a class="anchor" id="lmc3"></a></a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="miri-psf-photometry-with-photutils">
<h1>MIRI PSF Photometry with Photutils<a class="headerlink" href="#miri-psf-photometry-with-photutils" title="Permalink to this heading">#</a></h1>
<p><strong>Author</strong>: Ori Fox<br></p>
<p><strong>Submitted</strong>: November, 2023<br>
<strong>Updated</strong>: November, 2023<br></p>
<p><strong>Use case</strong>: PSF Photometry using <a class="reference external" href="https://photutils.readthedocs.io/en/stable/">Photutils</a>. The purpose here is to illustrate the workflow and runtime for using Photutils in a variety of use cases.</p>
<p>Generally, PSF photometry for data from a space telescope is most accurately performed on pre-mosaiced data. The mosaic process changes the inherent PSF, blurring it both due to resampling and mixing PSFs at different detector positions and rotations.  Additionally, accurate theoretical PSF models (e.g., from <a class="reference external" href="https://webbpsf.readthedocs.io/en/latest/">WebbPSF</a>) are not available for mosaiced data. While an empirical PSF could be constructed (e.g., using Photutils <a class="reference external" href="https://photutils.readthedocs.io/en/latest/epsf.html">ePSFBuilder</a>) for mosaiced data, the results will generally not be as accurate as performing PSF photometry on the pre-mosaiced data.</p>
<p><strong>NOTE:</strong> A companion notebook exists that illustrates how to use perform PSF photometry on both Level 2 and Level 3 data using a new software program called space_phot.<br>
<strong>Data</strong>: MIRI Data PID 1028 (Calibration Program; Single Star Visit 006 A5V dwarf 2MASSJ17430448+6655015) and MIRI Data PID 1171 (LMC; Multiple Stars).<br>
<strong>Tools</strong>: photutils, webbpsf, jwst <br>
<strong>Cross-Instrument</strong>: MIRI<br>
<strong>Documentation:</strong> This notebook is part of a STScI’s larger <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-post-pipeline-data-analysis">post-pipeline Data Analysis Tools Ecosystem</a> and can be <a class="reference external" href="https://github.com/spacetelescope/dat_pyinthesky/tree/main/jdat_notebooks/MRS_Mstar_analysis">downloaded</a> directly from the <a class="reference external" href="https://github.com/spacetelescope/jdat_notebooks">JDAT Notebook Github directory</a>.<br></p>
<section id="table-of-contents">
<h2>Table of contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><span class="xref myst">Introduction</span><br>
1.1 <span class="xref myst">Python Imports</span><br>
1.2 <span class="xref myst">Set up WebbPSF and Synphot</span><br></p></li>
<li><p><span class="xref myst">Download JWST MIRI Data</span><br></p></li>
<li><p><span class="xref myst">Single Bright Object</span><br>
3.1 <span class="xref myst">Single Level 2 File</span><br>
3.2 <span class="xref myst">Generate empirical PSF grid for MIRI F770W using WebbPSF</span><br>
3.3 <span class="xref myst">PSF Photometry</span><br></p></li>
<li><p><span class="xref myst">Faint/Upper Limit, Single Object</span><br>
4.1 <span class="xref myst">Multiple, Level2 Files</span><br></p></li>
<li><p><span class="xref myst">Stellar Field (LMC)</span><br>
5.1 <span class="xref myst">Multiple Stars, Single Level 2 File</span><br>
5.2 <span class="xref myst">Generate empirical PSF grid for MIRI F560W using WebbPSF</span><br>
5.3 <span class="xref myst">PSF Photometry</span><br></p></li>
</ol>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="introduction-a-class-anchor-id-intro-a">
<h1>1. Introduction <a class="anchor" id="intro"></a><a class="headerlink" href="#introduction-a-class-anchor-id-intro-a" title="Permalink to this heading">#</a></h1>
<p><strong>GOALS</strong>:<br></p>
<p>Perform PSF photometry on JWST MIRI images with the <a class="reference external" href="https://photutils.readthedocs.io/en/latest/psf.html">Photutils PSF Photometry tools</a> using a grid of empirical PSF models from WebbPSF.</p>
<p>The notebook shows how to:<br></p>
<ul class="simple">
<li><p>generate a <a class="reference external" href="https://webbpsf.readthedocs.io/en/latest/psf_grids.html">grid of empirical PSF models</a> from WebbPSF<br></p></li>
<li><p>perform PSF photometry on the image using the <a class="reference external" href="https://photutils.readthedocs.io/en/latest/api/photutils.psf.PSFPhotometry.html#photutils.psf.PSFPhotometry">PSFPhotometry class</a><br></p></li>
</ul>
<p><strong>Data</strong>:<br></p>
<p>MIRI Data PID 1028 (Calibration Program), F770W <br>
MIRI Data PID 1171 (LMC), F560W/F770W</p>
<section id="python-imports-a-class-anchor-id-imports-a">
<h2>1.1 Python Imports <a class="anchor" id="imports"></a><a class="headerlink" href="#python-imports-a-class-anchor-id-imports-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">tarfile</span>

<span class="kn">import</span> <span class="nn">astropy.units</span> <span class="k">as</span> <span class="nn">u</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">webbpsf</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">from</span> <span class="nn">urllib.parse</span> <span class="kn">import</span> <span class="n">urlparse</span>
<span class="kn">from</span> <span class="nn">astropy.coordinates</span> <span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">extract_array</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span> <span class="nn">astropy.visualization</span> <span class="kn">import</span> <span class="n">simple_norm</span>
<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">from</span> <span class="nn">jwst.datamodels</span> <span class="kn">import</span> <span class="n">ImageModel</span>
<span class="kn">from</span> <span class="nn">photutils.aperture</span> <span class="kn">import</span> <span class="n">CircularAperture</span>
<span class="kn">from</span> <span class="nn">photutils.background</span> <span class="kn">import</span> <span class="n">LocalBackground</span><span class="p">,</span> <span class="n">MADStdBackgroundRMS</span><span class="p">,</span> <span class="n">MMMBackground</span>
<span class="kn">from</span> <span class="nn">photutils.detection</span> <span class="kn">import</span> <span class="n">DAOStarFinder</span>
<span class="kn">from</span> <span class="nn">photutils.psf</span> <span class="kn">import</span> <span class="n">GriddedPSFModel</span><span class="p">,</span> <span class="n">PSFPhotometry</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="download-and-set-up-required-data-for-webbpsf-and-synphot-a-class-anchor-id-setup-a">
<h2>1.2 Download and Set up Required Data for WebbPSF and Synphot <a class="anchor" id="setup"></a><a class="headerlink" href="#download-and-set-up-required-data-for-webbpsf-and-synphot-a-class-anchor-id-setup-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set environmental variables</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;WEBBPSF_PATH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;./webbpsf-data/webbpsf-data&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PYSYN_CDBS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;./grp/redcat/trds/&quot;</span>

<span class="c1"># required webbpsf data</span>
<span class="n">boxlink</span> <span class="o">=</span> <span class="s1">&#39;https://stsci.box.com/shared/static/qxpiaxsjwo15ml6m4pkhtk36c9jgj70k.gz&#39;</span>                                                          
<span class="n">boxfile</span> <span class="o">=</span> <span class="s1">&#39;./webbpsf-data/webbpsf-data-LATEST.tar.gz&#39;</span>
<span class="n">synphot_url</span> <span class="o">=</span> <span class="s1">&#39;http://ssb.stsci.edu/trds/tarfiles/synphot5.tar.gz&#39;</span>
<span class="n">synphot_file</span> <span class="o">=</span> <span class="s1">&#39;./synphot5.tar.gz&#39;</span>

<span class="n">webbpsf_folder</span> <span class="o">=</span> <span class="s1">&#39;./webbpsf-data&#39;</span>
<span class="n">synphot_folder</span> <span class="o">=</span> <span class="s1">&#39;./grp&#39;</span>


<span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported URL scheme: </span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dest_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>


<span class="c1"># Gather webbpsf files</span>
<span class="n">psfExist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">webbpsf_folder</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">psfExist</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">webbpsf_folder</span><span class="p">)</span>
    <span class="n">download_file</span><span class="p">(</span><span class="n">boxlink</span><span class="p">,</span> <span class="n">boxfile</span><span class="p">)</span>
    <span class="n">gzf</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">boxfile</span><span class="p">)</span>
    <span class="n">gzf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">webbpsf_folder</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="c1"># Gather synphot files</span>
<span class="n">synExist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">synphot_folder</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">synExist</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">synphot_folder</span><span class="p">)</span>
    <span class="n">download_file</span><span class="p">(</span><span class="n">synphot_url</span><span class="p">,</span> <span class="n">synphot_file</span><span class="p">)</span>
    <span class="n">gzf</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">synphot_file</span><span class="p">)</span>
    <span class="n">gzf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="download-jwst-miri-data-a-class-anchor-id-data-a">
<h1>2. Download JWST MIRI Data <a class="anchor" id="data"></a><a class="headerlink" href="#download-jwst-miri-data-a-class-anchor-id-data-a" title="Permalink to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download Proposal ID 1028 F770W data</span>

<span class="c1"># Define source and destination directories</span>
<span class="n">source_dir</span> <span class="o">=</span> <span class="s1">&#39;mastDownload/JWST/&#39;</span>
<span class="n">destination_dir</span> <span class="o">=</span> <span class="s1">&#39;mast/01028/&#39;</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data already downloaded to </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Query the MAST (Mikulski Archive for Space Telescopes) database for observations</span>
    <span class="c1"># with proposal ID 1028 and the F770W filter</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">proposal_id</span><span class="o">=</span><span class="mi">1028</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F770W&#39;</span><span class="p">])</span>
    
    <span class="c1"># Get a list of products associated with the located observation</span>
    <span class="n">plist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    
    <span class="c1"># Filter the product list to include only specific product subgroups</span>
    <span class="n">fplist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span><span class="n">plist</span><span class="p">,</span> <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CAL&#39;</span><span class="p">,</span> <span class="s1">&#39;I2D&#39;</span><span class="p">,</span> <span class="s1">&#39;ASN&#39;</span><span class="p">])</span>
    
    <span class="c1"># Download the selected products from the MAST database</span>
    <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">fplist</span><span class="p">)</span>
    
    <span class="c1"># Create the destination directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span>
    
    <span class="c1"># Use glob to find all files matching the pattern</span>
    <span class="n">files_to_copy</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="s1">&#39;j*/jw01028*&#39;</span><span class="p">))</span>

    <span class="c1"># Copy the matching files to the destination directory</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files_to_copy</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241028t203024_image2_00013_asn.json to ./mastDownload/JWST/jw01028006001_02101_00004_mirimage/jw01028-o006_20241028t203024_image2_00013_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241028t203024_image2_00014_asn.json to ./mastDownload/JWST/jw01028006001_02101_00003_mirimage/jw01028-o006_20241028t203024_image2_00014_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241028t203024_image2_00015_asn.json to ./mastDownload/JWST/jw01028006001_02101_00002_mirimage/jw01028-o006_20241028t203024_image2_00015_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241028t203024_image2_00016_asn.json to ./mastDownload/JWST/jw01028006001_02101_00001_mirimage/jw01028-o006_20241028t203024_image2_00016_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241028t203024_image3_00004_asn.json to ./mastDownload/JWST/jw01028-o006_t001_miri_f770w/jw01028-o006_20241028t203024_image3_00004_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01028-o006_t001_miri_f770w/jw01028-o006_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00001_mirimage/jw01028006001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00001_mirimage/jw01028006001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00002_mirimage/jw01028006001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00002_mirimage/jw01028006001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00003_mirimage/jw01028006001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00003_mirimage/jw01028006001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00004_mirimage/jw01028006001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00004_mirimage/jw01028006001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download Proposal ID 1171 F560W and F770W data</span>

<span class="c1"># Define source and destination directories</span>
<span class="n">source_dir</span> <span class="o">=</span> <span class="s1">&#39;mastDownload/JWST/&#39;</span>
<span class="n">destination_dir</span> <span class="o">=</span> <span class="s1">&#39;mast/01171/&#39;</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Data already downloaded to </span><span class="si">{</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Query the MAST (Mikulski Archive for Space Telescopes) database for observations</span>
    <span class="c1"># with proposal ID 1171 and the F550W and F770W filters</span>
    <span class="n">obs</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">proposal_id</span><span class="o">=</span><span class="mi">1171</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F560W&#39;</span><span class="p">,</span> <span class="s1">&#39;F770W&#39;</span><span class="p">])</span>
    
    <span class="c1"># Get a list of products associated with the located observation</span>
    <span class="n">plist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>
    
    <span class="c1"># Filter the product list to include only specific product subgroups</span>
    <span class="n">fplist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span><span class="n">plist</span><span class="p">,</span> <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CAL&#39;</span><span class="p">,</span> <span class="s1">&#39;I2D&#39;</span><span class="p">,</span> <span class="s1">&#39;ASN&#39;</span><span class="p">])</span>
    
    <span class="c1"># Download the selected products from the MAST database</span>
    <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">fplist</span><span class="p">)</span>
    
    <span class="c1"># Create the destination directory</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span>
    
    <span class="c1"># Use glob to find all files matching the pattern</span>
    <span class="n">files_to_copy</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="s1">&#39;j*/jw01171*&#39;</span><span class="p">))</span>
    
    <span class="c1"># Copy the matching files to the destination directory</span>
    <span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files_to_copy</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171001001_02101_00004_mirimage/jw01171-o001_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171001001_02101_00003_mirimage/jw01171-o001_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171001001_02101_00002_mirimage/jw01171-o001_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171001001_02101_00001_mirimage/jw01171-o001_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o001_t001_miri_f770w/jw01171-o001_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o001_t001_miri_f770w/jw01171-o001_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171002001_02101_00004_mirimage/jw01171-o002_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171002001_02101_00003_mirimage/jw01171-o002_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171002001_02101_00002_mirimage/jw01171-o002_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171002001_02101_00001_mirimage/jw01171-o002_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o002_t001_miri_f770w/jw01171-o002_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o002_t001_miri_f770w/jw01171-o002_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171003001_02101_00004_mirimage/jw01171-o003_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171003001_02101_00003_mirimage/jw01171-o003_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171003001_02101_00002_mirimage/jw01171-o003_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171003001_02101_00001_mirimage/jw01171-o003_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o003_t001_miri_f770w/jw01171-o003_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o003_t001_miri_f770w/jw01171-o003_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171004001_02101_00004_mirimage/jw01171-o004_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171004001_02101_00003_mirimage/jw01171-o004_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171004001_02101_00002_mirimage/jw01171-o004_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171004001_02101_00001_mirimage/jw01171-o004_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o004_t001_miri_f560w/jw01171-o004_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_t001_miri_f560w_i2d.fits to ./mastDownload/JWST/jw01171-o004_t001_miri_f560w/jw01171-o004_t001_miri_f560w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171005001_02101_00004_mirimage/jw01171-o005_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171005001_02101_00003_mirimage/jw01171-o005_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171005001_02101_00002_mirimage/jw01171-o005_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171005001_02101_00001_mirimage/jw01171-o005_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o005_t001_miri_f770w/jw01171-o005_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o005_t001_miri_f770w/jw01171-o005_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00001_mirimage/jw01171001001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00001_mirimage/jw01171001001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00002_mirimage/jw01171001001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00002_mirimage/jw01171001001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00003_mirimage/jw01171001001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00003_mirimage/jw01171001001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00004_mirimage/jw01171001001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00004_mirimage/jw01171001001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00001_mirimage/jw01171002001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00001_mirimage/jw01171002001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00002_mirimage/jw01171002001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00002_mirimage/jw01171002001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00003_mirimage/jw01171002001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00003_mirimage/jw01171002001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00004_mirimage/jw01171002001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00004_mirimage/jw01171002001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00001_mirimage/jw01171003001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00001_mirimage/jw01171003001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00002_mirimage/jw01171003001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00002_mirimage/jw01171003001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00003_mirimage/jw01171003001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00003_mirimage/jw01171003001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00004_mirimage/jw01171003001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00004_mirimage/jw01171003001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00001_mirimage/jw01171004001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00001_mirimage/jw01171004001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00002_mirimage/jw01171004001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00002_mirimage/jw01171004001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00003_mirimage/jw01171004001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00003_mirimage/jw01171004001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00004_mirimage/jw01171004001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00004_mirimage/jw01171004001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00001_mirimage/jw01171005001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00001_mirimage/jw01171005001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00002_mirimage/jw01171005001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00002_mirimage/jw01171005001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00003_mirimage/jw01171005001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00003_mirimage/jw01171005001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00004_mirimage/jw01171005001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00004_mirimage/jw01171005001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="single-bright-star-a-class-anchor-id-bso-a">
<h1>3. Single Bright Star <a class="anchor" id="bso"></a><a class="headerlink" href="#single-bright-star-a-class-anchor-id-bso-a" title="Permalink to this heading">#</a></h1>
<p>The purpose of this section is to illustrate how to perform PSF photometry on a single bright star. While aperture photometry is feasible in isolated cases, the user may find PSF photometry preferable in crowded fields or complicated backgrounds.</p>
<section id="single-level-2-file-a-class-anchor-id-bso2-a">
<h2>3.1 Single Level 2 File <a class="anchor" id="bso2"></a><a class="headerlink" href="#single-level-2-file-a-class-anchor-id-bso2-a" title="Permalink to this heading">#</a></h2>
<p>In this example, we fit a single, bright source in a single Level 2 images. For a collection of Level 2 images, we could fit each Level 2 image individually and then average the measured fluxes.</p>
<p>Useful references:<br>
HST Documentation on PSF Photometry: https://www.stsci.edu/hst/instrumentation/wfc3/data-analysis/psf<br>
WFPC2 Stellar Photometry with HSTPHOT: https://ui.adsabs.harvard.edu/abs/2000PASP..112.1383D/abstract<br>
Photutils PSF Fitting Photometry: https://photutils.readthedocs.io/en/stable/psf.html</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the level 2 filenames</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./mast/01028/&quot;</span>
<span class="n">level2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;*cal.fits&#39;</span><span class="p">)))</span>
<span class="n">level2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits&#39;,
 &#39;./mast/01028/jw01028006001_02101_00002_mirimage_cal.fits&#39;,
 &#39;./mast/01028/jw01028006001_02101_00003_mirimage_cal.fits&#39;,
 &#39;./mast/01028/jw01028006001_02101_00004_mirimage_cal.fits&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the first level-2 image</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">level2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MJy/sr&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Pixels&#39;)
</pre></div>
</div>
<img alt="../../../_images/21a6474ea1dc424e8506119240ac778eb2d773a41a47e6f7d8505ee9fde0050c.png" src="../../../_images/21a6474ea1dc424e8506119240ac778eb2d773a41a47e6f7d8505ee9fde0050c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change all DQ flagged pixels to NaN.</span>
<span class="c1"># Here, we&#39;ll overwrite the original CAL file.</span>
<span class="c1"># Reference for JWST DQ Flag Definitions: https://jwst-pipeline.readthedocs.io/en/latest/jwst/references_general/references_general.html</span>
<span class="c1"># In this case, we choose all DQ &gt; 10, but users are encouraged to choose their own values accordingly.</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">level2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">dq</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">model</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Re-display the image</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getdata</span><span class="p">(</span><span class="n">level2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MJy/sr&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Pixels&#39;)
</pre></div>
</div>
<img alt="../../../_images/8f3b7b77fa50b85fe385efaf9b1d7b791ace6c12985bcbc60e746bf306a5c24a.png" src="../../../_images/8f3b7b77fa50b85fe385efaf9b1d7b791ace6c12985bcbc60e746bf306a5c24a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zoom in to see the source. In this case, our source is from MIRI Program ID #1028, a Calibration Program.</span>
<span class="c1"># We are using Visit 006, which targets the A5V dwarf 2MASSJ17430448+6655015</span>
<span class="c1"># Reference Link: http://simbad.cds.unistra.fr/simbad/sim-basic?Ident=2MASSJ17430448%2B6655015&amp;submit=SIMBAD+search</span>
<span class="n">source_location</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="s1">&#39;17:43:04.4879&#39;</span><span class="p">,</span> <span class="s1">&#39;+66:55:01.837&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">source_location</span><span class="p">)</span>

<span class="n">cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">norm2</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">cutout</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm2</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MJy/sr&#39;</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PID1028, Obs006&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Pixels&#39;)
</pre></div>
</div>
<img alt="../../../_images/71fd7b5600c5c9af0b4d3773250c4ebff47a04ebf3e02f6db2327b9ffe013a93.png" src="../../../_images/71fd7b5600c5c9af0b4d3773250c4ebff47a04ebf3e02f6db2327b9ffe013a93.png" />
</div>
</div>
</section>
<section id="generate-empirical-psf-grid-for-miri-f770w-using-webbpsf-a-class-anchor-id-bso3-a">
<h2>3.2 Generate empirical PSF grid for MIRI F770W using WebbPSF <a class="anchor" id="bso3"></a><a class="headerlink" href="#generate-empirical-psf-grid-for-miri-f770w-using-webbpsf-a-class-anchor-id-bso3-a" title="Permalink to this heading">#</a></h2>
<p>Let’s now use WebbPSF to generate an empirical grid of ePSF models for MIRI F770W.
The output will be a Photutils <a class="reference external" href="https://photutils.readthedocs.io/en/latest/api/photutils.psf.GriddedPSFModel.html#photutils.psf.GriddedPSFModel">GriddedPSFModel</a> containing a 2x2 grid of detector-position-dependent empirical PSFs, each oversampled by a factor of 4. Note that we save the PSF grid to a FITS file (via <code class="docutils literal notranslate"><span class="pre">save=True</span></code>) called <code class="docutils literal notranslate"><span class="pre">miri_mirim_f770w_fovp101_samp4_npsf4.fits</span></code>.  To save time in future runs, we load this FITS file directly into a <code class="docutils literal notranslate"><span class="pre">GriddedPSFModel</span></code> object:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psfgrid_filename</span> <span class="o">=</span> <span class="s1">&#39;miri_mirim_f770w_fovp101_samp4_npsf4.fits&#39;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">psfgrid_filename</span><span class="p">):</span>
    <span class="n">miri</span> <span class="o">=</span> <span class="n">webbpsf</span><span class="o">.</span><span class="n">MIRI</span><span class="p">()</span>
    <span class="n">miri</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="s1">&#39;F770W&#39;</span>
    <span class="n">psf_model</span> <span class="o">=</span> <span class="n">miri</span><span class="o">.</span><span class="n">psf_grid</span><span class="p">(</span><span class="n">num_psfs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">all_detectors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">psf_model</span> <span class="o">=</span> <span class="n">GriddedPSFModel</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">psfgrid_filename</span><span class="p">)</span>

<span class="n">psf_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/4: (0, 0) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:16:49,885 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/webbpsf/opds.py:1746: UserWarning: For (V2,V3) = [-6.36389848 -7.26853851] arcmin, Field point -6.3638984816102235 arcmin, -0.5632056 arcmin not within valid region for field dependence model of OTE WFE for MIRI: -8.254199999999999 arcmin--6.21738 arcmin, -2.557224 arcmin--0.5632056 arcmin. Clipping to closest available valid location, 0.031744109903437345 arcmin away from the requested coordinates.
  warnings.warn(f&#39;For (V2,V3) = {v2v3}, Field point {x_field_pt}, {y_field_pt} not within valid region for field dependence model of OTE WFE for {instrument}: {min_x_field}-{max_x_field}, {min_y_field}-{max_y_field}. Clipping to closest available valid location, {clip_dist} away from the requested coordinates.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/4 centroid: (201.4023624749013, 201.47046390597333)
    Position 2/4: (0, 1023) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:16:57,794 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/webbpsf/opds.py:1746: UserWarning: For (V2,V3) = [-6.21257653 -5.39972458] arcmin, Field point -6.21738 arcmin, -2.4002754231217454 arcmin not within valid region for field dependence model of OTE WFE for MIRI: -8.254199999999999 arcmin--6.21738 arcmin, -2.557224 arcmin--0.5632056 arcmin. Clipping to closest available valid location, 0.00480347054204433 arcmin away from the requested coordinates.
  warnings.warn(f&#39;For (V2,V3) = {v2v3}, Field point {x_field_pt}, {y_field_pt} not within valid region for field dependence model of OTE WFE for {instrument}: {min_x_field}-{max_x_field}, {min_y_field}-{max_y_field}. Clipping to closest available valid location, {clip_dist} away from the requested coordinates.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 2/4 centroid: (201.30690755776234, 201.33283949933355)
    Position 3/4: (1023, 0) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 3/4 centroid: (201.46001999611343, 201.57406698621335)
    Position 4/4: (1023, 1023) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:17:09,580 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/astropy/io/fits/card.py:1038: VerifyWarning: Card is too long, comment will be truncated.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 4/4 centroid: (201.71435554877664, 201.48197003471253)
  Saving file: miri_mirim_f770w_fovp101_samp4_npsf4.fits
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;GriddedPSFModel(flux=1., x_0=0., y_0=0.)&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the PSF grid</span>
<span class="n">psf_model</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/83d7dbca4bc26a51cdacf1c9fa734894d77d9f998892226b5445d795cce6a624.png" src="../../../_images/83d7dbca4bc26a51cdacf1c9fa734894d77d9f998892226b5445d795cce6a624.png" />
<img alt="../../../_images/83d7dbca4bc26a51cdacf1c9fa734894d77d9f998892226b5445d795cce6a624.png" src="../../../_images/83d7dbca4bc26a51cdacf1c9fa734894d77d9f998892226b5445d795cce6a624.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display the PSF grid deltas from the mean ePSF</span>
<span class="n">psf_model</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">(</span><span class="n">deltas</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/c46cc4b49f6f070ee2c240fac888718655425202313b5b046aee44077b23fee3.png" src="../../../_images/c46cc4b49f6f070ee2c240fac888718655425202313b5b046aee44077b23fee3.png" />
<img alt="../../../_images/c46cc4b49f6f070ee2c240fac888718655425202313b5b046aee44077b23fee3.png" src="../../../_images/c46cc4b49f6f070ee2c240fac888718655425202313b5b046aee44077b23fee3.png" />
</div>
</div>
</section>
<section id="psf-photometry-a-class-anchor-id-bso4-a">
<h2>3.3 PSF Photometry <a class="anchor" id="bso4"></a><a class="headerlink" href="#psf-photometry-a-class-anchor-id-bso4-a" title="Permalink to this heading">#</a></h2>
<p>Now let’s use our gridded PSF model to perform PSF photometry.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load data and convert units from MJy/sr to uJy</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">bunit_data</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">err</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>

    <span class="c1"># use pixel area map because of geometric distortion in level-2 data </span>
    <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">area</span> <span class="o">*</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">photometry</span><span class="o">.</span><span class="n">pixelarea_steradians</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span>
    <span class="n">data</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    <span class="n">error</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>

<span class="n">data</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">unit</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Unit(&quot;uJy&quot;), Unit(&quot;uJy&quot;))
</pre></div>
</div>
</div>
</div>
<p>To perform photometry on a single source we can input a Table containing its (x, y) position.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">init_params</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>
<span class="n">init_params</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=1</i>
<table id="table140411481129232" class="table-striped table-bordered table-condensed">
<thead><tr><th>x</th><th>y</th></tr></thead>
<thead><tr><th>float64</th><th>float64</th></tr></thead>
<tr><td>691.0126389412841</td><td>512.5838903335235</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we turn off the finder because we input the source position</span>
<span class="n">fit_shape</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">localbkg_estimator</span> <span class="o">=</span> <span class="n">LocalBackground</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">bkg_estimator</span><span class="o">=</span><span class="n">MMMBackground</span><span class="p">())</span>
<span class="n">psfphot</span> <span class="o">=</span> <span class="n">PSFPhotometry</span><span class="p">(</span><span class="n">psf_model</span><span class="p">,</span> <span class="n">fit_shape</span><span class="p">,</span> <span class="n">finder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aperture_radius</span><span class="o">=</span><span class="n">fit_shape</span><span class="p">,</span> 
                        <span class="n">localbkg_estimator</span><span class="o">=</span><span class="n">localbkg_estimator</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">phot</span> <span class="o">=</span> <span class="n">psfphot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">init_params</span><span class="o">=</span><span class="n">init_params</span><span class="p">)</span>
<span class="n">phot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:17:10,728 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/photutils/psf/photometry.py:346: AstropyUserWarning: Input data contains unmasked non-finite values (NaN or inf), which were automatically ignored.
  warnings.warn(&#39;Input data contains unmasked non-finite values &#39;
</pre></div>
</div>
<div class="output text_html"><div><i>QTable length=1</i>
<table id="table140411479733200" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>group_id</th><th>local_bkg</th><th>x_init</th><th>y_init</th><th>flux_init</th><th>x_fit</th><th>y_fit</th><th>flux_fit</th><th>x_err</th><th>y_err</th><th>flux_err</th><th>npixfit</th><th>group_size</th><th>qfit</th><th>cfit</th><th>flags</th></tr></thead>
<thead><tr><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>int64</th></tr></thead>
<tr><td>1</td><td>1</td><td>1.4397037772319776</td><td>691.0126389412841</td><td>512.5838903335235</td><td>475.7886379871932</td><td>691.179636780988</td><td>512.9113038644382</td><td>452.42267160623965</td><td>0.0010104372890293197</td><td>0.0010233534547689721</td><td>0.49982426715183176</td><td>25</td><td>1</td><td>0.7077179013668748</td><td>-0.01809988847561868</td><td>0</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert fit flux from uJy to ABmag</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_fit&#39;</span><span class="p">]</span>
<span class="n">flux_err</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_err&#39;</span><span class="p">]</span>
<span class="n">mag</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_fit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ABmag</span><span class="p">)</span>
<span class="n">magerr</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">flux_err</span> <span class="o">/</span> <span class="n">flux</span><span class="p">))</span>
<span class="n">magerr</span> <span class="o">=</span> <span class="n">magerr</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">ABmag</span>
<span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Magnitude [17.2611391] mag(AB)&gt;, &lt;Magnitude [0.00119883] mag(AB)&gt;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>

<span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">)</span>
<span class="n">cutout1</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">cutout1</span><span class="p">,</span> <span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">98</span><span class="p">)</span>
<span class="n">im1</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout1</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Data ($\mu$Jy)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im1</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">psfphot</span><span class="o">.</span><span class="n">make_model_image</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
<span class="n">cutout2</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">im2</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout2</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Fit PSF Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im2</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>

<span class="n">resid</span> <span class="o">=</span> <span class="n">psfphot</span><span class="o">.</span><span class="n">make_residual_image</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">shape</span><span class="p">)</span>
<span class="n">cutout3</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">resid</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>
<span class="n">norm3</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">cutout3</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">im3</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout3</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm3</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Residual&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im3</span><span class="p">,</span> <span class="n">shrink</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.colorbar.Colorbar at 0x7fb41ffad650&gt;
</pre></div>
</div>
<img alt="../../../_images/39508729849faa20bf3b0aa1cc7caa126e0fddf15ea7183d0e3d9f9259148c7c.png" src="../../../_images/39508729849faa20bf3b0aa1cc7caa126e0fddf15ea7183d0e3d9f9259148c7c.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="faint-upper-limit-single-object-a-class-anchor-id-fso-a">
<h1>4. Faint/Upper Limit, Single Object <a class="anchor" id="fso"></a><a class="headerlink" href="#faint-upper-limit-single-object-a-class-anchor-id-fso-a" title="Permalink to this heading">#</a></h1>
<p>The purpose of this section is to illustrate how to calculate an upper limit at a fixed (x, y) position using forced PSF photometry a blank part of the sky.</p>
<p>We’ll use the same data as Section 3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load data and convert units from MJy/sr to uJy</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">bunit_data</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">err</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    
    <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">photometry</span><span class="o">.</span><span class="n">pixelarea_steradians</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span>
    <span class="n">data</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    <span class="n">error</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>

<span class="n">source_location</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="s1">&#39;17:43:00.0332&#39;</span><span class="p">,</span> <span class="s1">&#39;+66:54:42.677&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">source_location</span><span class="p">)</span>

<span class="n">cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">cutout</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">95</span><span class="p">)</span>
<span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mu$Jy&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PID1028, Obs006&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Pixels&#39;)
</pre></div>
</div>
<img alt="../../../_images/0bef0c96631711b8c1bb83bdcfc1db15857f1e6483cd98a9a8b459340500a394.png" src="../../../_images/0bef0c96631711b8c1bb83bdcfc1db15857f1e6483cd98a9a8b459340500a394.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># to perform forced photometry, we set the (x, y) source position</span>
<span class="c1"># AND we fix the PSF model position so that it does not vary in the fit</span>
<span class="c1"># (only flux will be fit)</span>
<span class="n">init_params</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">y</span><span class="p">]</span>

<span class="c1"># This requires photutils 1.11.0</span>
<span class="n">psf_model_forced</span> <span class="o">=</span> <span class="n">psf_model</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">psf_model_forced</span><span class="o">.</span><span class="n">x_0</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">psf_model_forced</span><span class="o">.</span><span class="n">y_0</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">psf_model_forced</span><span class="o">.</span><span class="n">fixed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>{&#39;flux&#39;: False, &#39;x_0&#39;: True, &#39;y_0&#39;: True}
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_shape</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">localbkg_estimator</span> <span class="o">=</span> <span class="n">LocalBackground</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">bkg_estimator</span><span class="o">=</span><span class="n">MMMBackground</span><span class="p">())</span>
<span class="n">psfphot</span> <span class="o">=</span> <span class="n">PSFPhotometry</span><span class="p">(</span><span class="n">psf_model_forced</span><span class="p">,</span> <span class="n">fit_shape</span><span class="p">,</span> <span class="n">finder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aperture_radius</span><span class="o">=</span><span class="n">fit_shape</span><span class="p">,</span> 
                        <span class="n">localbkg_estimator</span><span class="o">=</span><span class="n">localbkg_estimator</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">phot</span> <span class="o">=</span> <span class="n">psfphot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">init_params</span><span class="o">=</span><span class="n">init_params</span><span class="p">)</span>
<span class="n">phot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:17:12,226 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/photutils/psf/photometry.py:346: AstropyUserWarning: Input data contains unmasked non-finite values (NaN or inf), which were automatically ignored.
  warnings.warn(&#39;Input data contains unmasked non-finite values &#39;
</pre></div>
</div>
<div class="output text_html"><div><i>QTable length=1</i>
<table id="table140410354101200" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>group_id</th><th>local_bkg</th><th>x_init</th><th>y_init</th><th>flux_init</th><th>x_fit</th><th>y_fit</th><th>flux_fit</th><th>x_err</th><th>y_err</th><th>flux_err</th><th>npixfit</th><th>group_size</th><th>qfit</th><th>cfit</th><th>flags</th></tr></thead>
<thead><tr><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>int64</th></tr></thead>
<tr><td>1</td><td>1</td><td>1.2926637902219071</td><td>559.0832487866571</td><td>772.8615809732944</td><td>99.6914129363197</td><td>559.0832487866571</td><td>772.8615809732944</td><td>-0.3700018357369572</td><td>nan</td><td>nan</td><td>0.061692716759511525</td><td>25</td><td>1</td><td>-96.08235647948484</td><td>0.4232093213516833</td><td>4</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># To calculate upper limit, multiply the flux_err by your desired sigma</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">3.0</span>
<span class="n">limit</span> <span class="o">=</span> <span class="n">sigma</span> <span class="o">*</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_err&#39;</span><span class="p">]</span>
<span class="n">limit</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ABmag</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_latex math notranslate nohighlight">
\[[25.731612] \; \mathrm{mag}$$\mathrm{\left( \mathrm{AB} \right)}\]</div>
</div>
</div>
<section id="note-you-can-go-significantly-deeper-with-the-level-3-combined-data-product">
<h2>Note: you can go significantly deeper with the Level 3 combined data product<a class="headerlink" href="#note-you-can-go-significantly-deeper-with-the-level-3-combined-data-product" title="Permalink to this heading">#</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="stellar-field-lmc-a-class-anchor-id-lmc-a">
<h1>5. Stellar Field (LMC) <a class="anchor" id="lmc"></a><a class="headerlink" href="#stellar-field-lmc-a-class-anchor-id-lmc-a" title="Permalink to this heading">#</a></h1>
<p>In this case, we are going to do the same steps as in Section 3, but for multiple stars. The purpose is to illustrate the workflow and runtime for using Photutils on a large number of stars.</p>
<section id="multiple-stars-single-level-2-file-a-class-anchor-id-lmc2-a">
<h2>5.1 Multiple Stars, Single Level 2 File <a class="anchor" id="lmc2"></a><a class="headerlink" href="#multiple-stars-single-level-2-file-a-class-anchor-id-lmc2-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find stars in Level 3 File</span>
<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;./mast/01171/&#39;</span>
<span class="n">level3</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;jw01171-o004_t001_miri_f560w_i2d.fits&#39;</span><span class="p">)</span>
<span class="n">level3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;./mast/01171/jw01171-o004_t001_miri_f560w_i2d.fits&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get rough estimate of background (there are better ways to do background subtraction)</span>
<span class="n">bkgrms</span> <span class="o">=</span> <span class="n">MADStdBackgroundRMS</span><span class="p">()</span>
<span class="n">mmm_bkg</span> <span class="o">=</span> <span class="n">MMMBackground</span><span class="p">()</span>

<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">level3</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">wcs_l3</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">bkgrms</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">bkg</span> <span class="o">=</span> <span class="n">mmm_bkg</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">data_bkgsub</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">data_bkgsub</span> <span class="o">-=</span> <span class="n">bkg</span> 

<span class="c1"># Find stars</span>
<span class="c1"># F560W FWHM = 1.882 pix</span>
<span class="n">fwhm_psf</span> <span class="o">=</span> <span class="mf">1.882</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">daofind</span> <span class="o">=</span> <span class="n">DAOStarFinder</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span> <span class="o">*</span> <span class="n">std</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="n">fwhm_psf</span><span class="p">,</span> <span class="n">exclude_border</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_separation</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">found_stars</span> <span class="o">=</span> <span class="n">daofind</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">)</span>

<span class="c1"># print first 10 rows</span>
<span class="n">found_stars</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>QTable length=10</i>
<table id="table140410352037328" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>xcentroid</th><th>ycentroid</th><th>sharpness</th><th>roundness1</th><th>roundness2</th><th>npix</th><th>sky</th><th>peak</th><th>flux</th><th>mag</th></tr></thead>
<thead><tr><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float32</th><th>float64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>1</td><td>546.2615248590856</td><td>5.40090706700177</td><td>0.7041937380599614</td><td>0.46773428</td><td>0.04273256330788055</td><td>25</td><td>0.0</td><td>-0.8653272390365601</td><td>1.6463868618011475</td><td>-0.5413297293846483</td></tr>
<tr><td>2</td><td>789.0983970730795</td><td>6.312157835017226</td><td>0.6691237944354219</td><td>-0.17942303</td><td>-0.8079555096758742</td><td>25</td><td>0.0</td><td>-0.5761210918426514</td><td>1.1000438928604126</td><td>-0.10352503572911273</td></tr>
<tr><td>3</td><td>845.9799634503643</td><td>3.6757970986043205</td><td>0.6829976607805458</td><td>0.043498766</td><td>-0.42254093349077776</td><td>25</td><td>0.0</td><td>-1.171976923942566</td><td>1.1794757843017578</td><td>-0.17922257214246215</td></tr>
<tr><td>4</td><td>899.9897053947699</td><td>6.39779821296389</td><td>0.5563295885896342</td><td>-0.13047144</td><td>0.2603567958961923</td><td>25</td><td>0.0</td><td>-0.9210708141326904</td><td>1.282814621925354</td><td>-0.2704097537749816</td></tr>
<tr><td>5</td><td>933.9483297710668</td><td>6.082630968636201</td><td>0.5395764543423918</td><td>-0.30286184</td><td>0.31405623969522456</td><td>25</td><td>0.0</td><td>-0.8810544013977051</td><td>1.310049295425415</td><td>-0.2932190947280454</td></tr>
<tr><td>6</td><td>385.6695305861909</td><td>5.6695305861908665</td><td>0.7041937004909312</td><td>0.32498807</td><td>0.0</td><td>25</td><td>0.0</td><td>-0.24849343299865723</td><td>2.248995780944824</td><td>-0.8799716017792757</td></tr>
<tr><td>7</td><td>385.3304694138091</td><td>5.6695305861908665</td><td>0.7041937004909312</td><td>-0.75487006</td><td>-7.402970179157126e-16</td><td>25</td><td>0.0</td><td>-0.24849343299865723</td><td>2.248995780944824</td><td>-0.8799716017792757</td></tr>
<tr><td>8</td><td>444.15413979694966</td><td>6.5255939563821155</td><td>0.5542676488294513</td><td>0.54399556</td><td>-0.0043752550961698635</td><td>25</td><td>0.0</td><td>-0.6147366762161255</td><td>1.59718656539917</td><td>-0.508389121265139</td></tr>
<tr><td>9</td><td>457.96743096331807</td><td>6.572213266744114</td><td>0.5819540250110783</td><td>-0.37343192</td><td>0.32949080159621963</td><td>25</td><td>0.0</td><td>-0.6794391870498657</td><td>1.4479076862335205</td><td>-0.40185218393906974</td></tr>
<tr><td>10</td><td>504.80151790231764</td><td>6.318931006256025</td><td>0.7041936997157474</td><td>-0.40236253</td><td>0.013733775120274237</td><td>25</td><td>0.0</td><td>-0.3774709701538086</td><td>2.122992515563965</td><td>-0.817371157747781</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the found stars</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

<span class="n">xypos</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">])</span>
<span class="n">aper</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">(</span><span class="n">xypos</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">aper</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.patches.Circle at 0x7fb3d527ea50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d51bd410&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d50ee450&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d53d9410&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d525a390&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d525b0d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d525be90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d51b7e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d51b7f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d525afd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d525a690&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d51a7990&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d52d8610&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d52db190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d52db750&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d50d0810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412edca50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d526d910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d526ffd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d526ef50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e68250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e6a650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e6bed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e6b1d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d712d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d72990&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d71310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d71b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d731d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d73d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d72ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d5328bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d5329250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d532be10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d532ae50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d532b4d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d532bcd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412eef990&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412eec650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412dbb290&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412f0a790&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412f0ae90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412f082d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412f08c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412f0a850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412f09c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412f0bbd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee58d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee5e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee7a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee4c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee7bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee7090&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee72d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee5ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee7010&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee5510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee4710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee6ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee6150&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ee6b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412dc0510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412dc3150&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412dc2290&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412dc11d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412dc2f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412dc1510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d7b950&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d7bd90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d7a9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d79c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d7bc90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d7a950&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d7aad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d78690&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d7a890&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d7a090&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d78950&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de1690&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de2c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de1a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de0790&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de1e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de2650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de35d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de3b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de05d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de0a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de3d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de8390&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de8710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de8a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de8990&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de9310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de9710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de9910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de98d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de9890&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412dea310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412de9fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412dea4d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412dea490&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412deae10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412deac50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412dead50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412deb3d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412debb10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412debad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412deb9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdec10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdc250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdc550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdc850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdcb50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdce50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdd150&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdd450&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdd750&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdda50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cddd50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cde050&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cde350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cde450&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdea10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdebd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdf190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdf6d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdfa90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdff10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf8210&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf8510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf8810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf8b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf8e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf9110&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf9410&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf9710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf9a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf9d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cfa010&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cfa350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cfa650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cfaa90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cfadd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cfb110&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cfb410&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cfb650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cfba10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cfbcd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cfbfd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca0410&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca0750&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca0a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca0d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca1050&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca1350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca1810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca1950&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca1c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca1f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca2250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca2550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca2850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca2b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca2f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca3250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca3550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca3850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca3b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca3e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca0350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cee510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cee810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ceeb10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ceec10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cef0d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cef350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cef7d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cef9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cefc90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ceffd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cec550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cec9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cece50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ced2d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ced750&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cedbd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cee050&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e58210&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e58510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e58810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e58b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e58e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e59110&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e59410&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e59710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e59a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e59d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e5a010&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e5a310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e5a610&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e5a910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e5ac10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e5af10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e5b210&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e5b510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e5b810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e5bb10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e5be10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e44150&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e44450&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e44750&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e44a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e44d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e45050&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e45350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e45650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e45950&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e45c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e45f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e46250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e46550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e46850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e46b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e46e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e47150&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e47450&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e47750&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e47a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412e47d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c93dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c90350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c90490&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c90690&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c90f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c90d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c90fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c91210&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c91650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c91950&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c91410&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c92450&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c91f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c92550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c92850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c92b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c92e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c93150&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c93510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c93850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c93b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c93f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca42d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca45d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca48d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca4bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca4ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca51d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca54d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca57d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca5ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca5dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca60d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca63d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca66d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca69d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca6cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca6fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca72d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca75d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca78d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca7bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca7ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca8210&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca8510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca8810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca8b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca8e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca9110&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca9410&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca9710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca9a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ca9d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412caa010&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412caa310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412caa550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412caa9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412caac50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412caaf10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cab210&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cab510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cab810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cabb10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cabe10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cac150&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cac450&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cac750&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412caca50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cacd50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cad050&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cad350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cad650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cad950&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cadc50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cadf50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cae250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cae550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cae850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412caeb50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412caee50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412caf150&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412caf450&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412caf750&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cafa50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cafd50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb80d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb8290&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb8590&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb8890&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb8b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb8e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb9190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb9490&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb9790&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb9a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb9e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cba090&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cba390&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cba690&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cba990&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cbac90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cbaf90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cbb290&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cbb590&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cbb890&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cbbb90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cbbe90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c642d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c645d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c648d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c64cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c64f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c651d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c654d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c657d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c65ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c65dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c660d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c663d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c666d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c669d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c66cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c66fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c672d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c675d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c678d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c67bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c67ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc0210&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc0510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc0810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc0b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc0e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc1110&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc1410&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc1710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc1a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc1d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc2010&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc2310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc2610&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc2910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc2c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc2f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc3210&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc3510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc3810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc3b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc3e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc4150&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc4450&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc4750&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc4a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc4d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc5050&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc5350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc5650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc5950&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc5c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc5f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc6250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc6550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc6850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d5261710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb3d527ce10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc7010&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc7290&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc7550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc7850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc7b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cc7e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccc190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccc490&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccc790&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccca90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cccd90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccd090&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccd390&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccd690&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccd990&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccdc90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccdf90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cce290&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cce590&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cce890&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cceb90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccee90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccf190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccf490&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccf790&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccfa90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ccfd90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c700d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c703d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c706d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c709d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c70cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c70fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c712d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c715d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c718d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c71bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c71ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c721d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c724d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c727d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c72ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c72dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c730d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c733d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c736d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c739d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c73cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c73fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c74310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c74610&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c74910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c74c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c74f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c75310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c75590&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c75810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c75b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c75e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c76110&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c76410&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c76710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c76a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c76d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c77010&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c77310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c77610&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c77910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c77c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c77f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd4250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd4550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd4850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd4b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd4e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd5150&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd5450&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd5750&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd5a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd5d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd6050&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd6350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd6650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd6950&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd6c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd6f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd7250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd7550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd7850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd7b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd7e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c78190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c78490&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c78790&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c78a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c78d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c79090&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c79390&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c79690&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c79990&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c79c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c79f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c7a290&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c7a590&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c7a890&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c7ab90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c7ae90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c7b190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c7b5d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c7b850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c7bad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c7bd90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c840d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c843d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c846d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c849d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c84cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c84fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c852d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c855d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c858d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c85bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c85ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c861d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c864d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c867d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c86ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c86dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c870d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c873d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c876d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c879d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c87cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c87fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce0310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce0610&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce0910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce0c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce0f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce1210&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce1510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce1810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce1b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce1e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce2110&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce2410&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce2710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce2a10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce2d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce3010&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce3310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce3610&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce3910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce3c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce3f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce8250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce8550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce8850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce8b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce8e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce9150&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce9450&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce9710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce9b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ce9dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cea050&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cea350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cea650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cea950&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ceac50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ceaf50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ceb250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ceb550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ceb850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cebb50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cebe50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c94190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c94490&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c94790&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c94a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c94d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c95090&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c95390&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c95690&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c95990&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c95c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c95f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c96290&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c96590&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c96890&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c96b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c96e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c97190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c97490&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c97790&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c97a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c97d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf00d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf03d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf06d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf09d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf0cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf0fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf12d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf15d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf18d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf1bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf1ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf21d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf24d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf27d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf2ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf2dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf30d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf33d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf36d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf39d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cf3dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd8090&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd8310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd8610&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd8910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd8c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd8f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd9210&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd9510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd9810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd9b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cd9e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cda110&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cda410&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cda710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdaa10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdad10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdb010&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdb310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdb610&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdb910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdbc10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cdbf10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb4250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb4550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb4850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb4b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb4e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb5150&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb5450&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb5750&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb5a50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb5d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb6050&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb6350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb6650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb6950&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb6c50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb6f50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb7250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb7550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb7850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb7b50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412cb7e50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c80190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c80490&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c80790&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c80a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c80d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c81090&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c81390&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c81690&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c81990&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c81c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c81ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c82350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c825d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c82890&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c82b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c82e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c83190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c83490&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c83790&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c83a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412c83d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d040d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d043d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d046d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d049d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d04cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d04fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d052d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d055d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d058d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d05bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d05ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d061d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d064d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d067d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d06ad0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d06dd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d070d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d073d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d076d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d079d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d07cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d07fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d08310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d08610&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d08910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d08c10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d08f10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d09210&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d09510&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d09810&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d09b10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d09e10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0a110&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0a410&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0a710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0aa10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0ad10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0b010&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0b310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0b610&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0b910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0bc10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0bf10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0c250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0c650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0c8d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0cb50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0ce50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0d150&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0d450&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0d750&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0da50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0dd50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0e050&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0e350&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0e650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0e950&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0ec50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0ef50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0f250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0f550&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0f850&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0fb50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d0fe50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d14190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d14490&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d14790&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d14a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d14d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d15090&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d15390&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d15690&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d15990&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d15c90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d15f90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d16290&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d16590&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d16890&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d16b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d16e90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d17190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d17490&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d17790&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d17a90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d17d90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d180d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d183d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d186d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d189d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d18cd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d18fd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d192d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d195d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d198d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d19bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d19ed0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1a1d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1a4d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1a910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1ab90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1ae10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1b0d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1b3d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1b6d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1b9d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1bcd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1bfd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1c310&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1c610&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1c910&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1cc10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1cf10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d1d210&gt;]
</pre></div>
</div>
<img alt="../../../_images/6d3a3b9b4990e31f7254cfd16b0ed731357d21673d34428069c535dbc6520c1c.png" src="../../../_images/6d3a3b9b4990e31f7254cfd16b0ed731357d21673d34428069c535dbc6520c1c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">],</span> <span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;sharpness&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">],</span> <span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;roundness&#39;</span><span class="p">)</span>

<span class="n">mag0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.0</span>
<span class="n">mag1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span>
<span class="k">for</span> <span class="n">ax_</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">:</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mag0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
    <span class="n">ax_</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mag1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>

<span class="n">sh0</span> <span class="o">=</span> <span class="mf">0.40</span>
<span class="n">sh1</span> <span class="o">=</span> <span class="mf">0.82</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">sh0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">sh1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>

<span class="n">rnd0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.40</span>
<span class="n">rnd1</span> <span class="o">=</span> <span class="mf">0.40</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">rnd0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">rnd1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.lines.Line2D at 0x7fb4186a7510&gt;
</pre></div>
</div>
<img alt="../../../_images/d1798d3737c8bf8cfe36df4063aee234552352b1751f97739811dfbd81327836.png" src="../../../_images/d1798d3737c8bf8cfe36df4063aee234552352b1751f97739811dfbd81327836.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">mag0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">mag1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">rnd0</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">rnd1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sh0</span><span class="p">)</span> 
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sh1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">700</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">700</span><span class="p">))</span>

<span class="n">found_stars_sel</span> <span class="o">=</span> <span class="n">found_stars</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of stars found originally:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_stars</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of stars in final selection:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_stars_sel</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of stars found originally: 790
Number of stars in final selection: 13
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the selected stars</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

<span class="n">xypos</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">])</span>
<span class="n">aper</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">(</span><span class="n">xypos</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">aper</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.patches.Circle at 0x7fb41291f090&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412944650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412946650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412930d50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb41295add0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb41277c190&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb41277c210&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb41277c490&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb41277c710&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb41276cc10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb41277cbd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb41277ce50&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb41277d0d0&gt;]
</pre></div>
</div>
<img alt="../../../_images/725865398721a13deec8352d2264d6a26fa1bb147f1d0edaa41653a69d5942c6.png" src="../../../_images/725865398721a13deec8352d2264d6a26fa1bb147f1d0edaa41653a69d5942c6.png" />
</div>
</div>
</section>
<section id="generate-empirical-psf-grid-for-miri-f560w-using-webbpsf-a-class-anchor-id-grid2-a">
<h2>5.2 Generate empirical PSF grid for MIRI F560W using WebbPSF <a class="anchor" id="grid2"></a><a class="headerlink" href="#generate-empirical-psf-grid-for-miri-f560w-using-webbpsf-a-class-anchor-id-grid2-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psfgrid_filename</span> <span class="o">=</span> <span class="s1">&#39;miri_mirim_f560w_fovp101_samp4_npsf4.fits&#39;</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">psfgrid_filename</span><span class="p">):</span>
    <span class="n">miri</span> <span class="o">=</span> <span class="n">webbpsf</span><span class="o">.</span><span class="n">MIRI</span><span class="p">()</span>
    <span class="n">miri</span><span class="o">.</span><span class="n">filter</span> <span class="o">=</span> <span class="s1">&#39;F560W&#39;</span>
    <span class="n">psf_model</span> <span class="o">=</span> <span class="n">miri</span><span class="o">.</span><span class="n">psf_grid</span><span class="p">(</span><span class="n">num_psfs</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">all_detectors</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">psf_model</span> <span class="o">=</span> <span class="n">GriddedPSFModel</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">psfgrid_filename</span><span class="p">)</span>

<span class="n">psf_model</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/4: (0, 0) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:17:17,602 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/webbpsf/opds.py:1746: UserWarning: For (V2,V3) = [-6.36389848 -7.26853851] arcmin, Field point -6.3638984816102235 arcmin, -0.5632056 arcmin not within valid region for field dependence model of OTE WFE for MIRI: -8.254199999999999 arcmin--6.21738 arcmin, -2.557224 arcmin--0.5632056 arcmin. Clipping to closest available valid location, 0.031744109903437345 arcmin away from the requested coordinates.
  warnings.warn(f&#39;For (V2,V3) = {v2v3}, Field point {x_field_pt}, {y_field_pt} not within valid region for field dependence model of OTE WFE for {instrument}: {min_x_field}-{max_x_field}, {min_y_field}-{max_y_field}. Clipping to closest available valid location, {clip_dist} away from the requested coordinates.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/4 centroid: (201.39504365744267, 201.46837962104274)
    Position 2/4: (0, 1023) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:17:21,652 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/webbpsf/opds.py:1746: UserWarning: For (V2,V3) = [-6.21257653 -5.39972458] arcmin, Field point -6.21738 arcmin, -2.4002754231217454 arcmin not within valid region for field dependence model of OTE WFE for MIRI: -8.254199999999999 arcmin--6.21738 arcmin, -2.557224 arcmin--0.5632056 arcmin. Clipping to closest available valid location, 0.00480347054204433 arcmin away from the requested coordinates.
  warnings.warn(f&#39;For (V2,V3) = {v2v3}, Field point {x_field_pt}, {y_field_pt} not within valid region for field dependence model of OTE WFE for {instrument}: {min_x_field}-{max_x_field}, {min_y_field}-{max_y_field}. Clipping to closest available valid location, {clip_dist} away from the requested coordinates.&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 2/4 centroid: (201.3020934606855, 201.31984343070152)
    Position 3/4: (1023, 0) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 3/4 centroid: (201.42830769164877, 201.59926840411686)
    Position 4/4: (1023, 1023) pixels
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:17:33,411 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/astropy/io/fits/card.py:1038: VerifyWarning: Card is too long, comment will be truncated.
  warnings.warn(
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 4/4 centroid: (201.75498594600958, 201.4970454286807)
  Saving file: miri_mirim_f560w_fovp101_samp4_npsf4.fits
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;GriddedPSFModel(flux=1., x_0=0., y_0=0.)&gt;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">psf_model</span><span class="o">.</span><span class="n">plot_grid</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/3c34df4822b7838e7423801e69374a736e877e36a017ee416a94bf55042a3372.png" src="../../../_images/3c34df4822b7838e7423801e69374a736e877e36a017ee416a94bf55042a3372.png" />
<img alt="../../../_images/3c34df4822b7838e7423801e69374a736e877e36a017ee416a94bf55042a3372.png" src="../../../_images/3c34df4822b7838e7423801e69374a736e877e36a017ee416a94bf55042a3372.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the level 2 image</span>
<span class="c1"># here, we&#39;ll use the PID 1171 files</span>
<span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;./mast/01171/&quot;</span>
<span class="n">level2</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;jw01171004*cal.fits&#39;</span><span class="p">)))</span>
<span class="n">filename</span> <span class="o">=</span> <span class="n">level2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="c1"># load data and convert units from MJy/sr to uJy</span>
<span class="k">with</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">model</span><span class="p">:</span>
    <span class="n">unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">Unit</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">bunit_data</span><span class="p">)</span>
    <span class="n">model</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">dq</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">data</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">err</span> <span class="o">&lt;&lt;</span> <span class="n">unit</span>
    
    <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">pixel_area</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">photometry</span><span class="o">.</span><span class="n">pixelarea_steradians</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">sr</span>
    <span class="n">data</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    <span class="n">error</span> <span class="o">*=</span> <span class="n">pixel_area</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>
    <span class="n">error</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">uJy</span><span class="p">)</span>

    <span class="n">wcs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">wcs</span>

<span class="n">data</span><span class="o">.</span><span class="n">unit</span><span class="p">,</span> <span class="n">error</span><span class="o">.</span><span class="n">unit</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./mast/01171/jw01171004001_02101_00001_mirimage_cal.fits
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Unit(&quot;uJy&quot;), Unit(&quot;uJy&quot;))
</pre></div>
</div>
</div>
</div>
</section>
<section id="psf-photometry-a-class-anchor-id-lmc3-a">
<h2>5.3 PSF Photometry <a class="anchor" id="lmc3"></a><a class="headerlink" href="#psf-photometry-a-class-anchor-id-lmc3-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># translate (x, y) positions from the level 3 image to the level 2 image</span>
<span class="n">xc</span> <span class="o">=</span> <span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]</span>
<span class="n">yc</span> <span class="o">=</span> <span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]</span>
<span class="n">sc</span> <span class="o">=</span> <span class="n">wcs_l3</span><span class="o">.</span><span class="n">pixel_to_world</span><span class="p">(</span><span class="n">xc</span><span class="p">,</span> <span class="n">yc</span><span class="p">)</span>

<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">wcs</span><span class="o">.</span><span class="n">world_to_pixel</span><span class="p">(</span><span class="n">sc</span><span class="p">)</span>
<span class="n">init_params</span> <span class="o">=</span> <span class="n">Table</span><span class="p">()</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span>
<span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>

<span class="c1"># we need to remove stars in the masked region of</span>
<span class="c1"># the level-2 data</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">400</span>
<span class="n">init_params</span> <span class="o">=</span> <span class="n">init_params</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([False,  True,  True,  True,  True, False,  True,  True,  True,
        True,  True,  True,  True])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the selected stars</span>
<span class="n">norm</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s1">&#39;sqrt&#39;</span><span class="p">,</span> <span class="n">percent</span><span class="o">=</span><span class="mi">99</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

<span class="n">xypos</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">],</span> <span class="n">init_params</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">])</span>
<span class="n">aper</span> <span class="o">=</span> <span class="n">CircularAperture</span><span class="p">(</span><span class="n">xypos</span><span class="p">,</span> <span class="n">r</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">aper</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&lt;matplotlib.patches.Circle at 0x7fb4127321d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412d68d10&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412f34650&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ec3790&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ec1090&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ec1950&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ec0bd0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ec2250&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ec2b90&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412ec28d0&gt;,
 &lt;matplotlib.patches.Circle at 0x7fb412f3f050&gt;]
</pre></div>
</div>
<img alt="../../../_images/688ca2508baa3dea517881a7fce2f727909abdaf244aee95fd3693d2185a34d8.png" src="../../../_images/688ca2508baa3dea517881a7fce2f727909abdaf244aee95fd3693d2185a34d8.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fit_shape</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">localbkg_estimator</span> <span class="o">=</span> <span class="n">LocalBackground</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">bkg_estimator</span><span class="o">=</span><span class="n">MMMBackground</span><span class="p">())</span>
<span class="n">psfphot</span> <span class="o">=</span> <span class="n">PSFPhotometry</span><span class="p">(</span><span class="n">psf_model</span><span class="p">,</span> <span class="n">fit_shape</span><span class="p">,</span> <span class="n">finder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">aperture_radius</span><span class="o">=</span><span class="n">fit_shape</span><span class="p">,</span> 
                        <span class="n">localbkg_estimator</span><span class="o">=</span><span class="n">localbkg_estimator</span><span class="p">,</span> <span class="n">progress_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">phot</span> <span class="o">=</span> <span class="n">psfphot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">,</span> <span class="n">init_params</span><span class="o">=</span><span class="n">init_params</span><span class="p">)</span>
<span class="n">phot</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024-12-10 20:17:34,604 - stpipe - WARNING - /opt/hostedtoolcache/Python/3.11.10/x64/lib/python3.11/site-packages/photutils/psf/photometry.py:346: AstropyUserWarning: Input data contains unmasked non-finite values (NaN or inf), which were automatically ignored.
  warnings.warn(&#39;Input data contains unmasked non-finite values &#39;
</pre></div>
</div>
<div class="output text_html"><div><i>QTable length=11</i>
<table id="table140411375699088" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>group_id</th><th>local_bkg</th><th>x_init</th><th>y_init</th><th>flux_init</th><th>x_fit</th><th>y_fit</th><th>flux_fit</th><th>x_err</th><th>y_err</th><th>flux_err</th><th>npixfit</th><th>group_size</th><th>qfit</th><th>cfit</th><th>flags</th></tr></thead>
<thead><tr><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th>uJy</th><th></th><th></th><th></th><th></th><th></th></tr></thead>
<thead><tr><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>int64</th></tr></thead>
<tr><td>1</td><td>1</td><td>0.6448802831437852</td><td>660.8682340958862</td><td>73.30952825775023</td><td>99.22615357989018</td><td>660.9286846394467</td><td>73.20923844919115</td><td>60.868198060066106</td><td>0.00508560759583491</td><td>0.005213347960630993</td><td>0.35070448135682786</td><td>25</td><td>1</td><td>0.6875349675263613</td><td>0.0507190914432771</td><td>0</td></tr>
<tr><td>2</td><td>2</td><td>0.5874391903047975</td><td>464.1246542280646</td><td>137.46955055574392</td><td>146.60569021592204</td><td>464.1612736578599</td><td>137.47656054126384</td><td>118.86790586339693</td><td>0.0036127479969553576</td><td>0.00332654031132284</td><td>0.4934731425162559</td><td>25</td><td>1</td><td>0.7937337032069842</td><td>0.0458428871200886</td><td>0</td></tr>
<tr><td>3</td><td>3</td><td>0.6104557472178589</td><td>481.9300536591688</td><td>142.74569905705442</td><td>122.16382552364978</td><td>481.7942336547994</td><td>142.85534595605364</td><td>93.13605371445458</td><td>0.004066468627209195</td><td>0.0037182540675848004</td><td>0.4370216793482647</td><td>25</td><td>1</td><td>0.6532491049959812</td><td>0.05590328925087897</td><td>0</td></tr>
<tr><td>4</td><td>4</td><td>0.5496421364243962</td><td>553.43672949644</td><td>147.6140915866477</td><td>110.58509932779731</td><td>553.3332687437463</td><td>147.6279956521992</td><td>81.38350059142448</td><td>0.0040451298749260445</td><td>0.0040049668954863765</td><td>0.3840827233584572</td><td>25</td><td>1</td><td>0.7618745097066745</td><td>0.06556201317924007</td><td>0</td></tr>
<tr><td>5</td><td>5</td><td>0.5802685211656431</td><td>493.8538169846163</td><td>220.82325504415456</td><td>170.9292596067879</td><td>493.8793157655576</td><td>220.62652265893462</td><td>150.22386179966216</td><td>0.003358635097457586</td><td>0.0031756031119978185</td><td>0.604400981865906</td><td>25</td><td>1</td><td>0.5327777896677033</td><td>0.05003401088019915</td><td>0</td></tr>
<tr><td>6</td><td>6</td><td>0.5552616705110063</td><td>633.1485658474755</td><td>324.17790497032087</td><td>116.40546174421459</td><td>633.1391855542114</td><td>324.1804492328962</td><td>88.43072429485113</td><td>0.004024860983398037</td><td>0.004004495142547085</td><td>0.4125289249159527</td><td>25</td><td>1</td><td>0.9902255297083485</td><td>0.12838325600826472</td><td>0</td></tr>
<tr><td>7</td><td>7</td><td>0.5410288111266928</td><td>597.6581645996761</td><td>447.6985048034759</td><td>121.35040364262599</td><td>597.3590198542189</td><td>447.56140193618455</td><td>98.56227008651472</td><td>0.00411653953630617</td><td>0.003647216028470465</td><td>0.4631820087267053</td><td>24</td><td>1</td><td>1.0760066465813405</td><td>0.045988202193837834</td><td>1</td></tr>
<tr><td>8</td><td>8</td><td>0.5712058916028622</td><td>546.6143269821247</td><td>529.1914918633589</td><td>259.8907892997661</td><td>546.8404355606814</td><td>529.2634236784783</td><td>251.86227681431046</td><td>0.0024193218378376147</td><td>0.0023130923903441785</td><td>0.7294551139699648</td><td>25</td><td>1</td><td>0.6666010174304933</td><td>0.02801968559292353</td><td>0</td></tr>
<tr><td>9</td><td>9</td><td>0.5766501870561154</td><td>453.82949747513493</td><td>549.258081072752</td><td>238.8740045482744</td><td>453.64985222857916</td><td>549.1688932057833</td><td>230.6362230696203</td><td>0.0025260579257618395</td><td>0.0027603261287867066</td><td>0.7252348583173828</td><td>25</td><td>1</td><td>0.7916554339315172</td><td>0.05213277450198142</td><td>0</td></tr>
<tr><td>10</td><td>10</td><td>0.543873813275104</td><td>581.7237520077483</td><td>589.2362246196259</td><td>150.4488293995264</td><td>581.8579817852578</td><td>589.3358089492639</td><td>129.7767129600465</td><td>0.0034935348032658553</td><td>0.003275752444225367</td><td>0.5187529531837481</td><td>25</td><td>1</td><td>0.9165073112371286</td><td>0.040711935582376686</td><td>0</td></tr>
<tr><td>11</td><td>11</td><td>0.5791730733885281</td><td>626.719046718948</td><td>619.1527113454913</td><td>252.4189435162317</td><td>626.6242165721334</td><td>619.0989132934759</td><td>231.22037687602779</td><td>0.00247478201995571</td><td>0.0028746739738682086</td><td>0.7257771750537931</td><td>25</td><td>1</td><td>0.778471055791462</td><td>0.03879531357454251</td><td>0</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert fit flux from uJy to ABmag</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_fit&#39;</span><span class="p">]</span>
<span class="n">flux_err</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_err&#39;</span><span class="p">]</span>
<span class="n">mag</span> <span class="o">=</span> <span class="n">phot</span><span class="p">[</span><span class="s1">&#39;flux_fit&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">ABmag</span><span class="p">)</span>
<span class="n">magerr</span> <span class="o">=</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="p">(</span><span class="n">flux_err</span> <span class="o">/</span> <span class="n">flux</span><span class="p">))</span>
<span class="n">magerr</span> <span class="o">=</span> <span class="n">magerr</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">u</span><span class="o">.</span><span class="n">ABmag</span>
<span class="n">mag</span><span class="p">,</span> <span class="n">magerr</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(&lt;Magnitude [19.43902389, 18.71233847, 18.97720542, 19.12365908,
             18.45815269, 19.03349204, 18.91572326, 17.89709219,
             17.99268121, 18.61700808, 17.98993474] mag(AB)&gt;,
 &lt;Magnitude [0.00623774, 0.00449804, 0.00508268, 0.00511199, 0.00435952,
             0.00505318, 0.00509034, 0.00314001, 0.00340874, 0.00433133,
             0.00340268] mag(AB)&gt;)
</pre></div>
</div>
</div>
</div>
<hr style="border:1px solid gray"> </hr><a class="reference internal image-reference" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></a>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/MIRI/psf_photometry"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">MIRI PSF Photometry with Photutils</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of contents</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction-a-class-anchor-id-intro-a">1. Introduction <a class="anchor" id="intro"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#python-imports-a-class-anchor-id-imports-a">1.1 Python Imports <a class="anchor" id="imports"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-set-up-required-data-for-webbpsf-and-synphot-a-class-anchor-id-setup-a">1.2 Download and Set up Required Data for WebbPSF and Synphot <a class="anchor" id="setup"></a></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download-jwst-miri-data-a-class-anchor-id-data-a">2. Download JWST MIRI Data <a class="anchor" id="data"></a></a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#single-bright-star-a-class-anchor-id-bso-a">3. Single Bright Star <a class="anchor" id="bso"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#single-level-2-file-a-class-anchor-id-bso2-a">3.1 Single Level 2 File <a class="anchor" id="bso2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-empirical-psf-grid-for-miri-f770w-using-webbpsf-a-class-anchor-id-bso3-a">3.2 Generate empirical PSF grid for MIRI F770W using WebbPSF <a class="anchor" id="bso3"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-photometry-a-class-anchor-id-bso4-a">3.3 PSF Photometry <a class="anchor" id="bso4"></a></a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#faint-upper-limit-single-object-a-class-anchor-id-fso-a">4. Faint/Upper Limit, Single Object <a class="anchor" id="fso"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#note-you-can-go-significantly-deeper-with-the-level-3-combined-data-product">Note: you can go significantly deeper with the Level 3 combined data product</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#stellar-field-lmc-a-class-anchor-id-lmc-a">5. Stellar Field (LMC) <a class="anchor" id="lmc"></a></a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiple-stars-single-level-2-file-a-class-anchor-id-lmc2-a">5.1 Multiple Stars, Single Level 2 File <a class="anchor" id="lmc2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generate-empirical-psf-grid-for-miri-f560w-using-webbpsf-a-class-anchor-id-grid2-a">5.2 Generate empirical PSF grid for MIRI F560W using WebbPSF <a class="anchor" id="grid2"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#psf-photometry-a-class-anchor-id-lmc3-a">5.3 PSF Photometry <a class="anchor" id="lmc3"></a></a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>