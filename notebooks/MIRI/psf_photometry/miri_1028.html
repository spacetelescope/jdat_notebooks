

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>MIRI PSF Photometry With Space_Phot &#8212; STScI JDAT Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-D46G4HKJY3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/MIRI/psf_photometry/miri_1028';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="STScI JDAT Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="STScI JDAT Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">General</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebook_development_workflow.html">Notebook Development Workflow</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/submitting_notebooks.html">Submitting Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/requirements.html">Requirements file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebooks.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/data_files.html">Data Files</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">GitHub Guidelines</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_setup.html">GitHub Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_workflow.html">GitHub Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_pr.html">GitHub PR</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Cross-Instrument</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/asdf_example/asdf_example.html">ASDF Example</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/background_estimation_imaging/Imaging_Sky_Background_Estimation.html">Complex 2D Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/composite_model_fitting/specfit_demo_3.html">Composite Model Spectral Fitting</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">MAST Query</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/rgb_imviz/imviz_rgb_carina.html">RGB images with Imviz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">Specviz Simple Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/update_pure_parallel_wcs/NIRISS_correct_pure_parallel_WCS.html">Improving Accuracy of WCS of Pure Parallel Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/stpsf_examples/stpsf_examples.html">JWST Using Wavefronts Measured On Orbit</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MIRI</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">MRS Mstar - Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">IFU of YSOs in LMC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../MIRI_LRS_spectral_extraction/miri_lrs_advanced_extraction_part1.html">LRS Optimal Spectral Extraction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRCam</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/aperture_photometry/NIRCam_Aperture_Photometry_Example.html">Point Source Aperture Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_photometry/NIRCam_multiband_photometry.html">Extended Aperture Photometry</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">Cross-Filter PSF Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/psf_photometry/NIRCam_PSF_Photometry_Example.html">PSF Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_wisp_subtraction/nircam_wisp_subtraction.html">NIRCam Wisp Removal</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRISS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/00_Optimal_extraction.html">WFSS Spectra - Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/01_Combine_and_normalize_1D_spectra.html">WFSS Spectra - Combine and Normalize 1D Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/02_Cross_correlation_template.html">WFSS Spectra - Cross-Correlation Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map.html">WFSS Spectra - Emission Line Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/00_niriss_mast_query_data_setup.html">NIRISS MAST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/01_niriss_wfss_image2_image3.html">Direct imaging for WFSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/02_niriss_wfss_spec2.html">Spec2 pipeline for WFSS</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRSpec</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html">IFU Cube Fitting</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/cube_fitting/cube_fitting.html">IFU Cube Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/ifu_optimal/ifu_optimal.html">IFU Optimal Spectral Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/optimal_extraction/Spectral_Extraction-static.html">MOS Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/mos_spectroscopy_advanced/MOSspec_advanced.html">MOS Spectroscopy of Extragalactic Field</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">BOTS Time Series Observations</a></li>








<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/galaxy_redshift/redshift_fitting.html">Redshift and Template Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/FS_NSClean_example.html">FS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/IFU_NSClean_example.html">IFU Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/MOS_NSClean_example.html">MOS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/BOTS_NSClean_example.html">BOTS Products with NSClean</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/MIRI/psf_photometry/miri_1028.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/MIRI/psf_photometry/miri_1028.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>MIRI PSF Photometry With Space_Phot</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-introduction-a-class-anchor-id-intro-a">1.<font color="white">-</font>Introduction <a class="anchor" id="intro"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-setup-webbpsf-and-synphot-directories-a-class-anchor-id-webbpsf-a">1.1<font color="white">-</font>Setup WebbPSF and Synphot Directories<a class="anchor" id="webbpsf"></a></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-python-imports-a-class-anchor-id-py-imports-a">1.2<font color="white">-</font>Python Imports<a class="anchor" id="py_imports"></a></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-download-data-a-class-anchor-id-data-a">2.<font color="white">-</font>Download Data<a class="anchor" id="data"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-bright-single-object-a-class-anchor-id-bso-a">3.<font color="white">-</font>Bright, Single Object<a class="anchor" id="bso"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-multiple-level2-files-a-class-anchor-id-bso2-a">3.1<font color="white">-</font>Multiple, Level2 Files<a class="anchor" id="bso2"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#notes-on-the-psf-fitting-in-space-phot-br">Notes on the PSF Fitting in Space_Phot: <br/></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-single-level3-mosaicked-file-a-class-anchor-id-bso3-a">3.2<font color="white">-</font>Single, Level3 Mosaicked File<a class="anchor" id="bso3"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Notes on the PSF Fitting in Space_Phot: <br/></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#good-agreement-between-level2-and-level3-results">Good agreement between Level2 and level3 results!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-faint-upper-limit-single-object-a-class-anchor-id-fso-a">4.<font color="white">-</font>Faint/Upper Limit, Single Object<a class="anchor" id="fso"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-multiple-level2-files-a-class-anchor-id-fso2-a">4.1<font color="white">-</font>Multiple, Level2 Files<a class="anchor" id="fso2"></a></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-single-level3-mosaicked-file-a-class-anchor-id-fso3-a">4.2<font color="white">-</font>Single, Level3 Mosaicked File<a class="anchor" id="fso3"></a></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#note-you-can-go-significantly-deeper-with-the-level3-combined-data-product">Note you can go significantly deeper with the Level3 combined data product</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-stellar-field-lmc-a-class-anchor-id-lmc-a">5.<font color="white">-</font>Stellar Field (LMC)<a class="anchor" id="lmc"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-this-case-we-are-going-to-do-the-same-steps-as-in-section-3-but-for-multiple-stars-the-purpose-is-to-illustrate-the-workflow-and-runtime-for-using-space-phot-on-a-large-number-of-stars-we-suggest-that-space-phot-may-be-less-optimal-for-large-numbers-of-bright-stars-other-programs-such-as-dolphot-or-photutils-may-be-better-suited-for-this-use-case-the-primary-advantage-to-space-phot-is-on-faint-single-sources-but-it-can-be-extended-to-a-larger-number-if-desired">In this case, we are going to do the same steps as in Section 3, but for multiple stars. The purpose is to illustrate the workflow and runtime for using space_phot on a large number of stars. We suggest that space_phot may be less optimal for large numbers of bright stars. Other programs, such as DOLPHOT or Photutils, may be better suited for this use case. The primary advantage to space_phot is on faint, single sources. But it can be extended to a larger number if desired.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-multiple-level2-files-a-class-anchor-id-lmc2-a">5.1<font color="white">-</font>Multiple, Level2 Files<a class="anchor" id="lmc2"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#now-do-the-same-thing-for-a-larger-group-of-stars-and-test-for-speed">Now do the same thing for a larger group of stars and test for speed</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-single-level3-mosaicked-file-a-class-anchor-id-lmc3-a">5.2<font color="white">-</font>Single, Level3 Mosaicked File<a class="anchor" id="lmc3"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#readers-should-refer-to-all-diagnostics-discussed-above-in-general-this-loop-shows-the-difficulty-in-doing-psf-photometry-on-a-wide-variety-of-stars-brightness-distribution-on-the-detector-etc-without-visual-inspection-especially-when-dealing-with-low-snr-sources-this-is-true-for-all-photometry-packages-users-should-inspect-the-associated-metrics-and-consider-optimizing-the-parameters-for-specific-stars-of-interest-nonetheless-the-success-of-the-fits-can-always-be-quantified-in-with-the-associated-error-bars">Readers should refer to all diagnostics discussed above. In general, this loop shows the difficulty in doing PSF photometry on a wide variety of stars (brightness, distribution on the detector, etc) without visual inspection. Especially when dealing with low SNR sources.This is true for all photometry packages. Users should inspect the associated metrics and consider optimizing the parameters for specific stars of interest. Nonetheless, the success of the fits can always be quantified in with the associated error bars.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="miri-psf-photometry-with-space-phot">
<h1>MIRI PSF Photometry With Space_Phot<a class="headerlink" href="#miri-psf-photometry-with-space-phot" title="Permalink to this heading">#</a></h1>
<p><strong>Author</strong>: Ori Fox<br></p>
<p><strong>Submitted</strong>: August, 2023<br>
<strong>Updated</strong>: November, 2023<br></p>
<p><strong>Use case</strong>: PSF Photometry on Level3 data using dedicated package Space_Phot (https://github.com/jpierel14/space_phot). Space_phot is built on Astropy’s Photutils package. Unlike photutils, space_phot can be used on Level3 data. This is because has built in functionality that can generate a resampled Level3 PSF at a given detector position. Such use cases are particularly useful for faint, point source targets or deep upper limits where observers need to take advantage of the combined image stack. For a large number of bright sources, users may find space_phot to be too slow and should consider other packages, such as DOLPHOT and/or Photutils. <strong>NOTE:</strong> A companion notebook exists that illustrates how to use Photutils for the same Level2 data set.<br>
<strong>Important Note</strong>: When not to use. Due to the sensitivity of the space_phot parameters, this tool is not meant to be used for a large sample of stars (i.e., Section 5 below). If a user would like to use space_phot on more than one source, they should carefully construct a table of parameters that are carefully refined for each source.
<strong>Data</strong>: MIRI Data PID 1028 (Calibration Program; Single Star Visit 006 A5V dwarf 2MASSJ17430448+6655015) and MIRI Data PID 1171 (LMC; Multiple Stars).<br>
<strong>Tools</strong>: photutils, space_phot drizzlepac, jupyter <br>
<strong>Cross-Instrument</strong>: NIRCam, MIRI.<br>
<strong>Documentation</strong>: This notebook is part of a STScI’s larger post-pipeline Data Analysis Tools Ecosystem and can be downloaded directly from the JDAT Notebook Github directory.<br>
<strong>Pipeline Version</strong>: JWST Pipeline<br></p>
<section id="table-of-contents">
<h2>Table of contents<a class="headerlink" href="#table-of-contents" title="Permalink to this heading">#</a></h2>
<ol class="arabic simple">
<li><p><span class="xref myst">Introduction</span><br>
1.1 <span class="xref myst">Setup</span><br>
1.2 <span class="xref myst">Python imports</span><br></p></li>
<li><p><span class="xref myst">Download Data</span><br></p></li>
<li><p><span class="xref myst">Bright, Single Object</span><br>
3.1 <span class="xref myst">Multiple, Level2 Files</span><br>
3.2 <span class="xref myst">Single, Level3 Mosaicked File</span><br></p></li>
<li><p><span class="xref myst">Faint/Upper Limit, Single Object</span><br>
4.1 <span class="xref myst">Multiple, Level2 Files</span><br>
4.2 <span class="xref myst">Single, Level3 Mosaicked File</span><br></p></li>
<li><p><span class="xref myst">Stellar Field (LMC)</span><br>
5.1 <span class="xref myst">Multiple, Level2 Files</span><br>
5.2 <span class="xref myst">Single, Level3 Mosaicked File</span><br></p></li>
</ol>
</section>
<section id="font-color-white-font-introduction-a-class-anchor-id-intro-a">
<h2>1.<font color='white'>-</font>Introduction <a class="anchor" id="intro"></a><a class="headerlink" href="#font-color-white-font-introduction-a-class-anchor-id-intro-a" title="Permalink to this heading">#</a></h2>
<p>GOALS:<br></p>
<p>PSF Photometry can be obtained using:<br></p>
<ul class="simple">
<li><p>grid of PSF models from WebbPSF<br></p></li>
<li><p>single effective PSF (ePSF) NOT YET AVAILABLE<br></p></li>
<li><p>grid of effective PSF NOT YET AVAILABLE<br></p></li>
</ul>
<p>The notebook shows:<br></p>
<ul class="simple">
<li><p>how to obtain the PSF model from WebbPSF (or build an ePSF)<br></p></li>
<li><p>how to perform PSF photometry on the image<br></p></li>
</ul>
<p><strong>Data</strong>:<br></p>
<p>MIRI Data PID 1028 (Calibration Program), F770W <br>
MIRI Data PID 1171 (LMC), F560W/F770W</p>
<section id="font-color-white-font-setup-webbpsf-and-synphot-directories-a-class-anchor-id-webbpsf-a">
<h3>1.1<font color='white'>-</font>Setup WebbPSF and Synphot Directories<a class="anchor" id="webbpsf"></a><a class="headerlink" href="#font-color-white-font-setup-webbpsf-and-synphot-directories-a-class-anchor-id-webbpsf-a" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">space_phot</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">importlib.metadata</span><span class="w"> </span><span class="kn">import</span> <span class="n">version</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;space-phot version : &#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">(</span><span class="s1">&#39;space_phot&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;jwst version : &#39;</span><span class="p">,</span> <span class="n">version</span><span class="p">(</span><span class="s1">&#39;jwst&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following task in the stsci.skypac package can be run with TEAL:
                                    skymatch                                    
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The following tasks in the drizzlepac package can be run with TEAL:
    astrodrizzle       config_testbed      imagefindpars           mapreg       
       photeq            pixreplace           pixtopix            pixtosky      
  refimagefindpars       resetbits          runastrodriz          skytopix      
     tweakback            tweakreg           updatenpol
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Important:  Gaia archive will be intermittently unavailable due to scheduled maintenance on 13-01-2025 from 08:00 to 18:00 (CET)
space-phot version :  0.2.5
jwst version :  1.17.1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">requests</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">tarfile</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">urllib.parse</span><span class="w"> </span><span class="kn">import</span> <span class="n">urlparse</span>

<span class="c1"># Set environmental variables</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;WEBBPSF_PATH&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;./webbpsf-data/webbpsf-data&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PYSYN_CDBS&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;./grp/redcat/trds/&quot;</span>

<span class="c1"># WEBBPSF Data</span>
<span class="n">boxlink</span> <span class="o">=</span> <span class="s1">&#39;https://stsci.box.com/shared/static/qxpiaxsjwo15ml6m4pkhtk36c9jgj70k.gz&#39;</span>                                                           
<span class="n">boxfile</span> <span class="o">=</span> <span class="s1">&#39;./webbpsf-data/webbpsf-data-1.0.0.tar.gz&#39;</span>
<span class="n">synphot_url</span> <span class="o">=</span> <span class="s1">&#39;http://ssb.stsci.edu/trds/tarfiles/synphot5.tar.gz&#39;</span>
<span class="n">synphot_file</span> <span class="o">=</span> <span class="s1">&#39;./synphot5.tar.gz&#39;</span>

<span class="n">webbpsf_folder</span> <span class="o">=</span> <span class="s1">&#39;./webbpsf-data&#39;</span>
<span class="n">synphot_folder</span> <span class="o">=</span> <span class="s1">&#39;./grp&#39;</span>


<span class="k">def</span><span class="w"> </span><span class="nf">download_file</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">dest_path</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">60</span><span class="p">):</span>
    <span class="n">parsed_url</span> <span class="o">=</span> <span class="n">urlparse</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;http&quot;</span><span class="p">,</span> <span class="s2">&quot;https&quot;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported URL scheme: </span><span class="si">{</span><span class="n">parsed_url</span><span class="o">.</span><span class="n">scheme</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dest_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>


<span class="c1"># Gather webbpsf files</span>
<span class="n">psfExist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">webbpsf_folder</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">psfExist</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">webbpsf_folder</span><span class="p">)</span>
    <span class="n">download_file</span><span class="p">(</span><span class="n">boxlink</span><span class="p">,</span> <span class="n">boxfile</span><span class="p">)</span>
    <span class="n">gzf</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">boxfile</span><span class="p">)</span>
    <span class="n">gzf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="n">webbpsf_folder</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>

<span class="c1"># Gather synphot files</span>
<span class="n">synExist</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">synphot_folder</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">synExist</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">synphot_folder</span><span class="p">)</span>
    <span class="n">download_file</span><span class="p">(</span><span class="n">synphot_url</span><span class="p">,</span> <span class="n">synphot_file</span><span class="p">)</span>
    <span class="n">gzf</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">synphot_file</span><span class="p">)</span>
    <span class="n">gzf</span><span class="o">.</span><span class="n">extractall</span><span class="p">(</span><span class="s1">&#39;./&#39;</span><span class="p">,</span> <span class="nb">filter</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="font-color-white-font-python-imports-a-class-anchor-id-py-imports-a">
<h3>1.2<font color='white'>-</font>Python Imports<a class="anchor" id="py_imports"></a><a class="headerlink" href="#font-color-white-font-python-imports-a-class-anchor-id-py-imports-a" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.nddata</span><span class="w"> </span><span class="kn">import</span> <span class="n">extract_array</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.coordinates</span><span class="w"> </span><span class="kn">import</span> <span class="n">SkyCoord</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy</span><span class="w"> </span><span class="kn">import</span> <span class="n">wcs</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">QTable</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.wcs.utils</span><span class="w"> </span><span class="kn">import</span> <span class="n">skycoord_to_pixel</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy</span><span class="w"> </span><span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astroquery.mast</span><span class="w"> </span><span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.visualization</span><span class="w"> </span><span class="kn">import</span> <span class="n">simple_norm</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">math</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># JWST models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jwst.datamodels</span><span class="w"> </span><span class="kn">import</span> <span class="n">ImageModel</span>

<span class="c1"># Background and PSF Functions</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">photutils.background</span><span class="w"> </span><span class="kn">import</span> <span class="n">MMMBackground</span><span class="p">,</span> <span class="n">MADStdBackgroundRMS</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">photutils.detection</span><span class="w"> </span><span class="kn">import</span> <span class="n">DAOStarFinder</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="font-color-white-font-download-data-a-class-anchor-id-data-a">
<h2>2.<font color='white'>-</font>Download Data<a class="anchor" id="data"></a><a class="headerlink" href="#font-color-white-font-download-data-a-class-anchor-id-data-a" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Query the MAST (Mikulski Archive for Space Telescopes) database for observations</span>
<span class="c1"># with proposal ID 1028 and a specific filter &#39;F770W&#39;</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">proposal_id</span><span class="o">=</span><span class="mi">1028</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F770W&#39;</span><span class="p">])</span>

<span class="c1"># Get a list of products associated with the located observation</span>
<span class="n">plist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

<span class="c1"># Filter the product list to include only specific product subgroups: &#39;RATE&#39;, &#39;CAL&#39;, &#39;I2D&#39;, and &#39;ASN&#39;</span>
<span class="n">fplist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span><span class="n">plist</span><span class="p">,</span> <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CAL&#39;</span><span class="p">,</span> <span class="s1">&#39;I2D&#39;</span><span class="p">,</span> <span class="s1">&#39;ASN&#39;</span><span class="p">])</span>

<span class="c1"># Download the selected products from the MAST database</span>
<span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">fplist</span><span class="p">)</span>

<span class="c1"># Define source and destination directories</span>
<span class="n">source_dir</span> <span class="o">=</span> <span class="s1">&#39;mastDownload/JWST/&#39;</span>
<span class="n">destination_dir</span> <span class="o">=</span> <span class="s1">&#39;mast/01028/&#39;</span>

<span class="c1"># Create the destination directory if it doesn&#39;t exist</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span>

<span class="c1"># Use glob to find all files matching the pattern &#39;mastDownload/JWST/j*/jw01537*cal.fits&#39;</span>
<span class="n">files_to_copy</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="s1">&#39;j*/jw01028*&#39;</span><span class="p">))</span>

<span class="c1"># Copy the matching files to the destination directory</span>
<span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files_to_copy</span><span class="p">:</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241218t003622_image2_00013_asn.json to ./mastDownload/JWST/jw01028006001_02101_00004_mirimage/jw01028-o006_20241218t003622_image2_00013_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241218t003622_image2_00014_asn.json to ./mastDownload/JWST/jw01028006001_02101_00003_mirimage/jw01028-o006_20241218t003622_image2_00014_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241218t003622_image2_00015_asn.json to ./mastDownload/JWST/jw01028006001_02101_00002_mirimage/jw01028-o006_20241218t003622_image2_00015_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241218t003622_image2_00016_asn.json to ./mastDownload/JWST/jw01028006001_02101_00001_mirimage/jw01028-o006_20241218t003622_image2_00016_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_20241218t003622_image3_00004_asn.json to ./mastDownload/JWST/jw01028-o006_t001_miri_f770w/jw01028-o006_20241218t003622_image3_00004_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028-o006_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01028-o006_t001_miri_f770w/jw01028-o006_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00001_mirimage/jw01028006001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00001_mirimage/jw01028006001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00002_mirimage/jw01028006001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00002_mirimage/jw01028006001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00003_mirimage/jw01028006001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00003_mirimage/jw01028006001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01028006001_02101_00004_mirimage/jw01028006001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01028006001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01028006001_02101_00004_mirimage/jw01028006001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Query the MAST (Mikulski Archive for Space Telescopes) database for observations</span>
<span class="c1"># with proposal ID 1171 and a specific filters &#39;F560W&#39; and &#39;F770W&#39;</span>
<span class="n">obs</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">proposal_id</span><span class="o">=</span><span class="mi">1171</span><span class="p">,</span> <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F560W&#39;</span><span class="p">,</span> <span class="s1">&#39;F770W&#39;</span><span class="p">])</span>

<span class="c1"># Get a list of products associated with the located observation</span>
<span class="n">plist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obs</span><span class="p">)</span>

<span class="c1"># Filter the product list to include only specific product subgroups: &#39;RATE&#39;, &#39;CAL&#39;, &#39;I2D&#39;, and &#39;ASN&#39;</span>
<span class="n">fplist</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span><span class="n">plist</span><span class="p">,</span> <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;CAL&#39;</span><span class="p">,</span> <span class="s1">&#39;I2D&#39;</span><span class="p">,</span> <span class="s1">&#39;ASN&#39;</span><span class="p">])</span>
<span class="n">fplist</span>

<span class="c1"># Download the selected products from the MAST database (UNCOMMENT TO DOWNLOAD)</span>
<span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">fplist</span><span class="p">)</span>

<span class="c1"># Define source and destination directories</span>
<span class="n">source_dir</span> <span class="o">=</span> <span class="s1">&#39;mastDownload/JWST/&#39;</span>
<span class="n">destination_dir</span> <span class="o">=</span> <span class="s1">&#39;mast/01171/&#39;</span>

<span class="c1"># Create the destination directory if it doesn&#39;t exist</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">destination_dir</span><span class="p">)</span>

<span class="c1"># Use glob to find all files matching the pattern &#39;mastDownload/JWST/j*/jw01537*cal.fits&#39;</span>
<span class="n">files_to_copy</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">source_dir</span><span class="p">,</span> <span class="s1">&#39;j*/jw01171*&#39;</span><span class="p">))</span>

<span class="c1"># Copy the matching files to the destination directory</span>
<span class="k">for</span> <span class="n">file_path</span> <span class="ow">in</span> <span class="n">files_to_copy</span><span class="p">:</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">destination_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171001001_02101_00004_mirimage/jw01171-o001_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171001001_02101_00003_mirimage/jw01171-o001_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171001001_02101_00002_mirimage/jw01171-o001_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171001001_02101_00001_mirimage/jw01171-o001_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o001_t001_miri_f770w/jw01171-o001_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o001_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o001_t001_miri_f770w/jw01171-o001_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171002001_02101_00004_mirimage/jw01171-o002_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171002001_02101_00003_mirimage/jw01171-o002_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171002001_02101_00002_mirimage/jw01171-o002_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171002001_02101_00001_mirimage/jw01171-o002_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o002_t001_miri_f770w/jw01171-o002_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o002_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o002_t001_miri_f770w/jw01171-o002_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171003001_02101_00004_mirimage/jw01171-o003_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171003001_02101_00003_mirimage/jw01171-o003_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171003001_02101_00002_mirimage/jw01171-o003_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171003001_02101_00001_mirimage/jw01171-o003_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o003_t001_miri_f770w/jw01171-o003_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o003_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o003_t001_miri_f770w/jw01171-o003_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171004001_02101_00004_mirimage/jw01171-o004_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171004001_02101_00003_mirimage/jw01171-o004_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171004001_02101_00002_mirimage/jw01171-o004_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171004001_02101_00001_mirimage/jw01171-o004_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o004_t001_miri_f560w/jw01171-o004_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o004_t001_miri_f560w_i2d.fits to ./mastDownload/JWST/jw01171-o004_t001_miri_f560w/jw01171-o004_t001_miri_f560w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00005_asn.json to ./mastDownload/JWST/jw01171005001_02101_00004_mirimage/jw01171-o005_20231102t191130_image2_00005_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00006_asn.json to ./mastDownload/JWST/jw01171005001_02101_00003_mirimage/jw01171-o005_20231102t191130_image2_00006_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00007_asn.json to ./mastDownload/JWST/jw01171005001_02101_00002_mirimage/jw01171-o005_20231102t191130_image2_00007_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image2_00008_asn.json to ./mastDownload/JWST/jw01171005001_02101_00001_mirimage/jw01171-o005_20231102t191130_image2_00008_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_20231102t191130_image3_00002_asn.json to ./mastDownload/JWST/jw01171-o005_t001_miri_f770w/jw01171-o005_20231102t191130_image3_00002_asn.json ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171-o005_t001_miri_f770w_i2d.fits to ./mastDownload/JWST/jw01171-o005_t001_miri_f770w/jw01171-o005_t001_miri_f770w_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00001_mirimage/jw01171001001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00001_mirimage/jw01171001001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00002_mirimage/jw01171001001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00002_mirimage/jw01171001001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00003_mirimage/jw01171001001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00003_mirimage/jw01171001001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171001001_02101_00004_mirimage/jw01171001001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171001001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171001001_02101_00004_mirimage/jw01171001001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00001_mirimage/jw01171002001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00001_mirimage/jw01171002001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00002_mirimage/jw01171002001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00002_mirimage/jw01171002001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00003_mirimage/jw01171002001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00003_mirimage/jw01171002001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171002001_02101_00004_mirimage/jw01171002001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171002001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171002001_02101_00004_mirimage/jw01171002001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00001_mirimage/jw01171003001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00001_mirimage/jw01171003001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00002_mirimage/jw01171003001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00002_mirimage/jw01171003001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00003_mirimage/jw01171003001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00003_mirimage/jw01171003001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171003001_02101_00004_mirimage/jw01171003001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171003001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171003001_02101_00004_mirimage/jw01171003001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00001_mirimage/jw01171004001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00001_mirimage/jw01171004001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00002_mirimage/jw01171004001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00002_mirimage/jw01171004001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00003_mirimage/jw01171004001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00003_mirimage/jw01171004001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171004001_02101_00004_mirimage/jw01171004001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171004001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171004001_02101_00004_mirimage/jw01171004001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00001_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00001_mirimage/jw01171005001_02101_00001_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00001_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00001_mirimage/jw01171005001_02101_00001_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00002_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00002_mirimage/jw01171005001_02101_00002_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00002_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00002_mirimage/jw01171005001_02101_00002_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00003_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00003_mirimage/jw01171005001_02101_00003_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00003_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00003_mirimage/jw01171005001_02101_00003_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00004_mirimage_cal.fits to ./mastDownload/JWST/jw01171005001_02101_00004_mirimage/jw01171005001_02101_00004_mirimage_cal.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/jw01171005001_02101_00004_mirimage_i2d.fits to ./mastDownload/JWST/jw01171005001_02101_00004_mirimage/jw01171005001_02101_00004_mirimage_i2d.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
</div>
</div>
</section>
<section id="font-color-white-font-bright-single-object-a-class-anchor-id-bso-a">
<h2>3.<font color='white'>-</font>Bright, Single Object<a class="anchor" id="bso"></a><a class="headerlink" href="#font-color-white-font-bright-single-object-a-class-anchor-id-bso-a" title="Permalink to this heading">#</a></h2>
<p>The purpose of this section is to illustrate how to perform PSF photometry on a single, bright object. While aperture photometry is feasible in isolated cases, the user may find PSF photometry preferable in crowded fields or complicated backgrounds.</p>
<section id="font-color-white-font-multiple-level2-files-a-class-anchor-id-bso2-a">
<h3>3.1<font color='white'>-</font>Multiple, Level2 Files<a class="anchor" id="bso2"></a><a class="headerlink" href="#font-color-white-font-multiple-level2-files-a-class-anchor-id-bso2-a" title="Permalink to this heading">#</a></h3>
<p>Generally, PSF photometry for data from a space telescope is most accurately performed on pre-mosaiced data. In the case of HST, that corresponds to FLT files rather than DRZ. And in the case of JWST, this corresponds to Level2 files rather than Level3. The reason is that a mosaiced PSF changes the inherent PSF as a function of position on the detector so that there is no adequate model (theoretical or empirical) to use.<br></p>
<p>In this example, we aim to fit a source simultaneously across multiple Level 2 images. A more basic approach would be to fit each Level 2 file individually and then average together the measured fluxes. However, this approach more easily corrects for bad pixels or cosmic rays that are only in one image and allows for a more accurate photometric solution by reducing the number of free parameters per source.<br></p>
<p>Useful references:<br>
HST Documentation on PSF Photometry: https://www.stsci.edu/hst/instrumentation/wfc3/data-analysis/psf<br>
WFPC2 Stellar Photometry with HSTPHOT: https://ui.adsabs.harvard.edu/abs/2000PASP..112.1383D/abstract<br>
Space-Phot Documentation on Level2 Fitting: https://space-phot.readthedocs.io/en/latest/examples/plot_a_psf.html#jwst-images<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define Level 3 File</span>
<span class="n">lvl3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;./mast/01028/jw01028-o006_t001_miri_f770w_i2d.fits&#39;</span><span class="p">]</span>
<span class="n">lvl3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;./mast/01028/jw01028-o006_t001_miri_f770w_i2d.fits&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create Level 2 Data List from ASN files</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;./mast/01028/&quot;</span>
<span class="n">asn</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;jw01028-o006_*_image3_00004_asn.json&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">asn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fi</span><span class="p">:</span>
    <span class="n">lvl2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">fi</span><span class="p">:</span>
        <span class="c1">#print(ln)</span>
        <span class="k">if</span> <span class="n">ln</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;                    &quot;expname&quot;:&#39;</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="n">lvl2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">lvl2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits&#39;, &#39;./mast/01028/jw01028006001_02101_00002_mirimage_cal.fits&#39;, &#39;./mast/01028/jw01028006001_02101_00003_mirimage_cal.fits&#39;, &#39;./mast/01028/jw01028006001_02101_00004_mirimage_cal.fits&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Examine the First Image (Before DQ Flags Set)</span>
<span class="n">ref_image</span> <span class="o">=</span> <span class="n">lvl2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_fits</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_data</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># The scale should highlight the background noise so it is possible to see all faint sources.</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits
</pre></div>
</div>
<img alt="../../../_images/8c929706df395e7b45523f00fa2903e328119e36d5153e238709db259863faa0.png" src="../../../_images/8c929706df395e7b45523f00fa2903e328119e36d5153e238709db259863faa0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Examine the First Image (Before DQ Flags Set)</span>
<span class="n">ref_image</span> <span class="o">=</span> <span class="n">lvl2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_fits</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits
</pre></div>
</div>
<img alt="../../../_images/35e9aa386705b6df0b32a0c83476bf6af407c14ed0f03075ec74248980bf2135.png" src="../../../_images/35e9aa386705b6df0b32a0c83476bf6af407c14ed0f03075ec74248980bf2135.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change all DQ flagged pixels to NANs</span>

<span class="c1"># Reference for JWST DQ Flag Definitions: https://jwst-pipeline.readthedocs.io/en/latest/jwst/references_general/references_general.html</span>
<span class="c1"># In this case, we choose all DQ &gt; 10, but users are encouraged to choose their own values accordingly.</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">lvl2</span><span class="p">:</span>
    <span class="n">ref_fits</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">dq</span>
    <span class="n">data</span><span class="p">[</span><span class="n">dq</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">ref_fits</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change all DQ flagged pixels to NANs</span>

<span class="c1"># Reference for JWST DQ Flag Definitions: https://jwst-pipeline.readthedocs.io/en/latest/jwst/references_general/references_general.html</span>
<span class="c1"># In this case, we choose all DQ &gt; 10, but users are encouraged to choose their own values accordingly.</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">lvl2</span><span class="p">:</span>
    <span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;update&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file</span><span class="p">)[</span><span class="s1">&#39;DQ&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">data</span><span class="p">[</span><span class="n">dq</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">hdul</span><span class="p">[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">hdul</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Examine the First Image (After DQ Flags Set)</span>
<span class="n">ref_image</span> <span class="o">=</span> <span class="n">lvl2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_fits</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_data</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># The scale should highlight the background noise so it is possible to see all faint sources.</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits
</pre></div>
</div>
<img alt="../../../_images/8c929706df395e7b45523f00fa2903e328119e36d5153e238709db259863faa0.png" src="../../../_images/8c929706df395e7b45523f00fa2903e328119e36d5153e238709db259863faa0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zoom in to see the source. In this case, our source is from MIRI Program ID #1028, a Calibration Program.</span>
<span class="c1"># We are using Visit 006, which targets the A5V dwarf 2MASSJ17430448+6655015</span>
<span class="c1"># Reference Link: http://simbad.cds.unistra.fr/simbad/sim-basic?Ident=2MASSJ17430448%2B6655015&amp;submit=SIMBAD+search</span>

<span class="n">source_location</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="s1">&#39;17:43:04.4879&#39;</span><span class="p">,</span> <span class="s1">&#39;+66:55:01.837&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>

<span class="n">ref_wcs</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">get_fits_wcs</span><span class="p">()</span>
<span class="c1">#ref_wcs = WCS(ref_fits[0].header)</span>

<span class="n">ref_y</span><span class="p">,</span> <span class="n">ref_x</span> <span class="o">=</span> <span class="n">skycoord_to_pixel</span><span class="p">(</span><span class="n">source_location</span><span class="p">,</span> <span class="n">ref_wcs</span><span class="p">)</span>
<span class="n">ref_cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="p">(</span><span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">))</span>

<span class="c1"># The scale should highlight the background noise so it is possible to see all faint sources.</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">4.3</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PID1028,Obs006&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/a4f63e1bba27f8acbd2b62baddaf0b873cbdd69fd742acad77d3faa1be4fee6a.png" src="../../../_images/a4f63e1bba27f8acbd2b62baddaf0b873cbdd69fd742acad77d3faa1be4fee6a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Examine the First Image (After DQ Flags Set)</span>
<span class="n">ref_image</span> <span class="o">=</span> <span class="n">lvl2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_fits</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits
</pre></div>
</div>
<img alt="../../../_images/35e9aa386705b6df0b32a0c83476bf6af407c14ed0f03075ec74248980bf2135.png" src="../../../_images/35e9aa386705b6df0b32a0c83476bf6af407c14ed0f03075ec74248980bf2135.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Zoom in to see the source</span>
<span class="n">source_location</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="s1">&#39;17:43:04.4879&#39;</span><span class="p">,</span> <span class="s1">&#39;+66:55:01.837&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
<span class="n">ref_y</span><span class="p">,</span> <span class="n">ref_x</span> <span class="o">=</span> <span class="n">skycoord_to_pixel</span><span class="p">(</span><span class="n">source_location</span><span class="p">,</span> <span class="n">wcs</span><span class="o">.</span><span class="n">WCS</span><span class="p">(</span><span class="n">ref_fits</span><span class="p">[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ref_fits</span><span class="p">))</span>
<span class="n">ref_cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">))</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
           <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PID1028,Obs006&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/0d2ef548fdb14702ae10c29f0a3da4e6a3fbbd4da5450c47e794e03d078feb34.png" src="../../../_images/0d2ef548fdb14702ae10c29f0a3da4e6a3fbbd4da5450c47e794e03d078feb34.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get the PSF from WebbPSF using defaults.</span>
<span class="n">jwst_obs</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">observation2</span><span class="p">(</span><span class="n">lvl2</span><span class="p">)</span>
<span class="n">psfs</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">get_jwst_psf</span><span class="p">(</span><span class="n">jwst_obs</span><span class="p">,</span> <span class="n">source_location</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Setting up sim to match ./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>iterating query, tdelta=3.0

MAST OPD query around UTC: 2022-05-25T01:14:08.073
                        MJD: 59724.05148232639

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/O2022052501-NRCA3_FP1-59.fits
	Date (MJD):	 59723.8076
	Delta time:	 -0.2439 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022052701-NRCA3_FP1-0.fits
	Date (MJD):	 59726.0139
	Delta time:	 1.9624 days
User requested choosing OPD time closest in time to 2022-05-25T01:14:08.073, which is O2022052501-NRCA3_FP1-59.fits, delta time -0.244 days
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/O2022052501-NRCA3_FP1-59.fits to ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/O2022052501-NRCA3_FP1-59.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/O2022052501-NRCA3_FP1-59.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F770W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(512.58446788), array(691.01192923)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (121.51240355224516, 121.46005973914637)

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(512.0823346), array(703.49975178)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (121.51086191643049, 121.4622239877099)

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(507.07857065), array(701.00356235)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (121.51028045414718, 121.46207330662133)

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(502.58093657), array(694.50845109)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (121.51039393601155, 121.46118840344465)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The scale should highlight the background noise so it is possible to see all faint sources.</span>
<span class="n">ref_cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">psfs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">41</span><span class="p">,</span> <span class="mi">41</span><span class="p">),</span> <span class="p">(</span><span class="mi">122</span><span class="p">,</span> <span class="mi">122</span><span class="p">))</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;WebbPSF Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/f6097ef2a2a175cfd6ac1c8971aa9286ec3eb54dd26221f65a80e2e4867872d8.png" src="../../../_images/f6097ef2a2a175cfd6ac1c8971aa9286ec3eb54dd26221f65a80e2e4867872d8.png" />
</div>
</div>
<section id="notes-on-the-psf-fitting-in-space-phot-br">
<h4>Notes on the PSF Fitting in Space_Phot: <br><a class="headerlink" href="#notes-on-the-psf-fitting-in-space-phot-br" title="Permalink to this heading">#</a></h4>
<p>https://st-phot.readthedocs.io/en/latest/examples/plot_a_psf.html#jwst-images
As noted above, improved documentation will be coming. For now, here are some important points to consider.</p>
<p>All fitting is performed with Astropy’s Photutils. As with any photometry program, the printed statistical errors are good indicators of your success.</p>
<p>There are different fitting techniques, but when the fit_flux parameter is set to ‘single’, the source is fit simultaneously in all Level2 images. There is good reason for this outlined in a paper for PSF fitting in Hubble: https://iopscience.iop.org/article/10.1086/316630/pdf</p>
<p>As a result, the flux and corresponding error take into account a single overall fit. As part of this, the fitting therefore assumes a constant zero point across all images. While this is not exactly true, it is typically true to within 1% and good enough for our purposes. Users can alternatively fit with the fit_flux parameter set to ‘multi’, which treats each image independently. The final flux must therefore be averaged.</p>
<p>When you run space_phot, you will see some additional diagnositics displayed in the cell. At the top, the % value printed is the fraction of flux remaining in the residual and can be considered a good indicator of a successful model and subtraction. Next are three columns displaying the original, the model, and the residual, respectively, for each Level2 image. Finally, there are corner plots suggesting the success of the fits (more documentation and explanation of these plots is coming).</p>
<p>In this case, you will notice a systematic trend in the residuals. The PSF is oversubtracted in the centermost pixel and undersubtracted in the wings. The cause is unknown. It may be due to a poor PSF model. The user should consider generating more complex PSF models, but that is beyond the scope of this notebook. Nonetheless, the residual value is pretty good so the overall statistical error is relatively small.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Do PSF Photometry using space_phot (details of fitting are in documentation)</span>
<span class="n">jwst_obs</span><span class="o">.</span><span class="n">psf_photometry</span><span class="p">(</span>
    <span class="n">psfs</span><span class="p">,</span>
    <span class="n">source_location</span><span class="p">,</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;flux&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">],</span>
        <span class="s1">&#39;centroid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="s1">&#39;bkg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="n">fit_width</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">fit_bkg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fit_flux</span><span class="o">=</span><span class="s1">&#39;single&#39;</span>
<span class="p">)</span>

<span class="n">jwst_obs</span><span class="o">.</span><span class="n">plot_psf_fit</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">jwst_obs</span><span class="o">.</span><span class="n">plot_psf_posterior</span><span class="p">(</span><span class="n">minweight</span><span class="o">=</span><span class="mf">.0005</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">jwst_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 2.31%
</pre></div>
</div>
<img alt="../../../_images/452ad0ca4a52871a5b9a70566eb059bb0427071a838b8fa26e3af29400943215.png" src="../../../_images/452ad0ca4a52871a5b9a70566eb059bb0427071a838b8fa26e3af29400943215.png" />
<img alt="../../../_images/15e88ecdc5af29bbf94fe833aa8c8db6b2c9e83f18b80adaae75b00d580073ef.png" src="../../../_images/15e88ecdc5af29bbf94fe833aa8c8db6b2c9e83f18b80adaae75b00d580073ef.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        ra         ...                     exp                    
------------------ ... -------------------------------------------
  265.768699137531 ... jw01028006001_02101_00001_mirimage_cal.fits
265.76869976591996 ... jw01028006001_02101_00002_mirimage_cal.fits
 265.7686991563031 ... jw01028006001_02101_00003_mirimage_cal.fits
  265.768698979314 ... jw01028006001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jwst_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>Table length=4</i>
<table id="table140451058900176" class="table-striped table-bordered table-condensed">
<thead><tr><th>ra</th><th>ra_err</th><th>dec</th><th>dec_err</th><th>x</th><th>x_err</th><th>y</th><th>y_err</th><th>mjd</th><th>flux</th><th>fluxerr</th><th>filter</th><th>zp</th><th>mag</th><th>magerr</th><th>zpsys</th><th>exp</th></tr></thead>
<thead><tr><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>str5</th><th>float64</th><th>float64</th><th>float64</th><th>str2</th><th>str43</th></tr></thead>
<tr><td>265.768699137531</td><td>3.304648998891935e-08</td><td>66.91716537780025</td><td>4.0334171558242815e-08</td><td>512.9208330613394</td><td>0.0009751101566321761</td><td>691.1795322514705</td><td>0.0009773286589659317</td><td>59724.05148232454</td><td>4.479753458866522e-10</td><td>2.68227562688183e-13</td><td>F770W</td><td>-6.100000000000005</td><td>17.271864716343973</td><td>0.0006498956412025414</td><td>ab</td><td>jw01028006001_02101_00001_mirimage_cal.fits</td></tr>
<tr><td>265.76869976591996</td><td>3.011092530869064e-08</td><td>66.91716477233997</td><td>4.255322494373104e-08</td><td>512.4326275446663</td><td>0.0010561509602273146</td><td>703.6835917805605</td><td>0.0009773048639063289</td><td>59724.05578601667</td><td>4.479753452721602e-10</td><td>2.6822756232025277e-13</td><td>F770W</td><td>-6.100000000000005</td><td>17.27186471783329</td><td>0.0006498956412025414</td><td>ab</td><td>jw01028006001_02101_00002_mirimage_cal.fits</td></tr>
<tr><td>265.7686991563031</td><td>3.227370370950666e-08</td><td>66.91716508118752</td><td>4.1049332821785356e-08</td><td>507.4234209638825</td><td>0.0010003174234407824</td><td>701.1758392388076</td><td>0.000979278411089562</td><td>59724.06012231296</td><td>4.479753453526981e-10</td><td>2.682275623684752e-13</td><td>F770W</td><td>-6.100000000000001</td><td>17.271864717638092</td><td>0.0006498956412025414</td><td>ab</td><td>jw01028006001_02101_00003_mirimage_cal.fits</td></tr>
<tr><td>265.768698979314</td><td>3.2161949548026314e-08</td><td>66.91716493592946</td><td>4.2155406276833673e-08</td><td>502.93096606205745</td><td>0.0010327549685662744</td><td>694.6808379210811</td><td>0.0009943475791366594</td><td>59724.064394164816</td><td>4.479753456231649e-10</td><td>2.6822756253041864e-13</td><td>F770W</td><td>-6.100000000000005</td><td>17.271864716982574</td><td>0.0006498956412025414</td><td>ab</td><td>jw01028006001_02101_00004_mirimage_cal.fits</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Print Magnitude from Table</span>
<span class="c1"># As noted above, As a result, the flux and corresponding error take into account a single overall fit. </span>
<span class="c1"># Therefore, there is no need to average the resulting magnitudes or errors. They should all be the same to within their individual zero-point differences (typically &lt;1%).</span>
<span class="n">mag_lvl2_arr</span> <span class="o">=</span> <span class="n">jwst_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span>
<span class="n">magerr_lvl2_arr</span> <span class="o">=</span> <span class="n">jwst_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">[</span><span class="s1">&#39;magerr&#39;</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">mag_lvl2_arr</span><span class="p">,</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">magerr_lvl2_arr</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       mag        
------------------
17.271864716343973
 17.27186471783329
17.271864717638092
17.271864716982574 
         magerr       
---------------------
0.0006498956412025414
0.0006498956412025414
0.0006498956412025414
0.0006498956412025414
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jwst_obs_fast</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">observation2</span><span class="p">(</span><span class="n">lvl2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ref_x</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array(512.58446788)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">centers</span> <span class="o">=</span> <span class="p">[</span><span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">]</span>
<span class="n">jwst_obs_fast</span><span class="o">.</span><span class="n">fast_psf</span><span class="p">(</span><span class="n">psfs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">centers</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>QTable length=1</i>
<table id="table140449154587408" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>group_id</th><th>local_bkg</th><th>x_init</th><th>y_init</th><th>flux_init</th><th>x_fit</th><th>y_fit</th><th>flux_fit</th><th>x_err</th><th>y_err</th><th>flux_err</th><th>npixfit</th><th>group_size</th><th>qfit</th><th>cfit</th><th>flags</th><th>flux</th><th>fluxerr</th><th>mag</th><th>magerr</th><th>zp</th></tr></thead>
<thead><tr><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>int64</th><th>int64</th><th>float64</th><th>float64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>1</td><td>1</td><td>0.0</td><td>691.0119292269617</td><td>512.5844678797273</td><td>1668.2629074618387</td><td>691.1736423963373</td><td>512.9081319598845</td><td>1861.7546481804886</td><td>0.0008250237966256781</td><td>0.0008332862486822053</td><td>1.7352060017478144</td><td>25</td><td>1</td><td>0.4383646707471222</td><td>-0.02855987894870955</td><td>0</td><td>5.342907155405971e-10</td><td>4.979734881769984e-13</td><td>17.080555931398994</td><td>0.0010114644093129814</td><td>-6.100000000000001</td></tr>
</table></div></div></div>
</div>
</section>
</section>
<section id="font-color-white-font-single-level3-mosaicked-file-a-class-anchor-id-bso3-a">
<h3>3.2<font color='white'>-</font>Single, Level3 Mosaicked File<a class="anchor" id="bso3"></a><a class="headerlink" href="#font-color-white-font-single-level3-mosaicked-file-a-class-anchor-id-bso3-a" title="Permalink to this heading">#</a></h3>
<p>Despite the above discussion on performing PSF photometry on the pre-mosaiced data products, space_phot has the functionality to create a mosaiced Level3 PSF at a given single position on the detector based on the Level2 images. The advantage to this is the ability to perform PSF photometry on the deep, stacked data in cases where faint sources are expected to have prohibitively low signal-to-noise in Level2 data. The disadvantage is the amount of time required to make mosaiced Level3 PSF, so that this method is most useful when dealing with a small number of low signal-to-noise sources.<br></p>
<p>Useful references:<br>
Space-Phot Documentation on Level3 Fitting: https://space-phot.readthedocs.io/en/latest/examples/plot_a_psf.html#level-3-psf<br></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Level3 data file the same as above.</span>
<span class="n">lvl3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;./mast/01028/jw01028-o006_t001_miri_f770w_i2d.fits&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now do the same photometry on the Level 3 Data</span>
<span class="n">ref_image</span> <span class="o">=</span> <span class="n">lvl3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ref_fits</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_data</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># The scale should highlight the background noise so it is possible to see all faint sources.</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/238d96cd2e110c16a037d5f424562b8fa01b02f2666c22603a66ac5152c3640f.png" src="../../../_images/238d96cd2e110c16a037d5f424562b8fa01b02f2666c22603a66ac5152c3640f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">source_location</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="s1">&#39;17:43:04.4879&#39;</span><span class="p">,</span> <span class="s1">&#39;+66:55:01.837&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>

<span class="n">ref_wcs</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">get_fits_wcs</span><span class="p">()</span>
<span class="n">ref_y</span><span class="p">,</span> <span class="n">ref_x</span> <span class="o">=</span> <span class="n">skycoord_to_pixel</span><span class="p">(</span><span class="n">source_location</span><span class="p">,</span> <span class="n">ref_wcs</span><span class="p">)</span>
<span class="n">ref_cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="p">(</span><span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">))</span>

<span class="c1"># The scale should highlight the background noise so it is possible to see all faint sources.</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PID1028,Obs006&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/c47c8e0b3fd85fea889e6c5ea689f1ff907922c18046be70c9384638964f258f.png" src="../../../_images/c47c8e0b3fd85fea889e6c5ea689f1ff907922c18046be70c9384638964f258f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now do the same photometry on the Level 3 Data</span>
<span class="n">ref_image</span> <span class="o">=</span> <span class="n">lvl3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ref_fits</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
           <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/60eb7ff8404f2ffcb806499a759af01afe6a4ec2eece35479ffd1cfaaed63a0b.png" src="../../../_images/60eb7ff8404f2ffcb806499a759af01afe6a4ec2eece35479ffd1cfaaed63a0b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get PSF from WebbPSF</span>

<span class="c1"># The function get_jwst_psf is a space_phot wrapper for the WebbPSF calc_psf function and uses a lot of the same keywords.</span>
<span class="c1"># There are more advanced methods for generating your WebbPSF, but those are beyond the scope of this notebook.</span>
<span class="c1"># The defaults used by get_jwst_psf in this notebook are:</span>
<span class="c1"># oversample=4</span>
<span class="c1"># normalize=&#39;last&#39;</span>
<span class="c1"># Non-distorted PSF</span>
<span class="c1"># Useful reference: https://webbpsf.readthedocs.io/en/latest/api/webbpsf.JWInstrument.html#webbpsf.JWInstrument.calc_psf</span>

<span class="n">jwst3_obs</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">observation3</span><span class="p">(</span><span class="n">lvl3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">psf3</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">get_jwst3_psf</span><span class="p">(</span><span class="n">jwst_obs</span><span class="p">,</span> <span class="n">jwst3_obs</span><span class="p">,</span> <span class="n">source_location</span><span class="p">)</span> <span class="c1"># ,num_psfs=4)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Setting up sim to match ./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>iterating query, tdelta=3.0
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-05-25T01:14:08.073
                        MJD: 59724.05148232639

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/O2022052501-NRCA3_FP1-59.fits
	Date (MJD):	 59723.8076
	Delta time:	 -0.2439 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022052701-NRCA3_FP1-0.fits
	Date (MJD):	 59726.0139
	Delta time:	 1.9624 days
User requested choosing OPD time closest in time to 2022-05-25T01:14:08.073, which is O2022052501-NRCA3_FP1-59.fits, delta time -0.244 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/O2022052501-NRCA3_FP1-59.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F770W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(512.58446788), array(691.01192923)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.5124035522455, 201.4600597391466)

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(512.0823346), array(703.49975178)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.51086191643108, 201.4622239877097)

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(507.07857065), array(701.00356235)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.51028045414768, 201.46207330662145)

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(502.58093657), array(694.50845109)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.5103939360115, 201.46118840344508)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:07,937 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:07,938 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:07,941 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:07,942 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:07,944 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:07,945 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:07,946 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:08,110 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:08,124 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        pt2dQvpkvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:08,125 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:08,566 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd361093d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:08,567 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,402 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd361093d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,402 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,565 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd361093d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,566 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,731 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd361093d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,733 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,733 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,734 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,734 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,737 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,737 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,737 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,738 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,739 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,740 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,741 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,741 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,742 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,743 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,743 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,744 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,746 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,746 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,746 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,747 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,747 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11091579557784445 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:09,768 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:10,570 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01028006001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:10,571 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01028006001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:10,572 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01028006001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:11,325 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01028006001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:11,327 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01028006001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:11,327 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01028006001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:12,084 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01028006001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:12,085 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01028006001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:12,086 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01028006001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:12,840 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01028006001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:12,841 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01028006001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:12,841 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01028006001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:13,100 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  265.737953477 66.940980694 265.701111178 66.912738191 265.773940695 66.898122976 265.810845165 66.926348568
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:13,403 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:13,403 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:13,573 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1030, 1042) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:13,574 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:13,580 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:33:13,580 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The scale should highlight the background noise so it is possible to see all faint sources.</span>
<span class="n">ref_cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">psf3</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">161</span><span class="p">,</span> <span class="mi">161</span><span class="p">),</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;WebbPSF Model (Mosaiced)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/abff0598b13ebe24bc877da7f26fce3b0dd5d92500a148f55f439a3c58d9ea57.png" src="../../../_images/abff0598b13ebe24bc877da7f26fce3b0dd5d92500a148f55f439a3c58d9ea57.png" />
</div>
</div>
<section id="id1">
<h4>Notes on the PSF Fitting in Space_Phot: <br><a class="headerlink" href="#id1" title="Permalink to this heading">#</a></h4>
<p>https://st-phot.readthedocs.io/en/latest/examples/plot_a_psf.html#jwst-images
As noted above, improved documentation will be coming. For now, here are some important points to consider.
See detailed notes in Section 3.1 above about the fitting process and diagnostics</p>
<p>In addition, consider here that jwst3_obs is generating a Level3 PSF by using the JWST pipeline to resample and combine multiple Level2 PSFs. The Level2 PSFs are generated at the precise location of the source in each Level2 file to account for detector level effects. The resampling uses default resampling paramters. However, users should be aware that if they performed customized resampling for their Level2 data products, they should use similar resampling steps for their PSF below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Do PSF Photometry using space_phot (details of fitting are in documentation)</span>
<span class="c1"># See detailed notes in Section 3.1 above about the fitting process and diagnostics</span>
<span class="n">jwst3_obs</span><span class="o">.</span><span class="n">psf_photometry</span><span class="p">(</span>
    <span class="n">psf3</span><span class="p">,</span>
    <span class="n">source_location</span><span class="p">,</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;flux&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">],</span>
        <span class="s1">&#39;centroid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
        <span class="s1">&#39;bkg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="n">fit_width</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">fit_bkg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fit_flux</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">jwst_obs</span><span class="o">.</span><span class="n">plot_psf_fit</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">jwst_obs</span><span class="o">.</span><span class="n">plot_psf_posterior</span><span class="p">(</span><span class="n">minweight</span><span class="o">=</span><span class="mf">.0005</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 0.60%
</pre></div>
</div>
<img alt="../../../_images/452ad0ca4a52871a5b9a70566eb059bb0427071a838b8fa26e3af29400943215.png" src="../../../_images/452ad0ca4a52871a5b9a70566eb059bb0427071a838b8fa26e3af29400943215.png" />
<img alt="../../../_images/15e88ecdc5af29bbf94fe833aa8c8db6b2c9e83f18b80adaae75b00d580073ef.png" src="../../../_images/15e88ecdc5af29bbf94fe833aa8c8db6b2c9e83f18b80adaae75b00d580073ef.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mag_lvl3psf</span> <span class="o">=</span> <span class="n">jwst3_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">magerr_lvl3psf</span> <span class="o">=</span> <span class="n">jwst3_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">[</span><span class="s1">&#39;magerr&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mag_lvl2_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">magerr_lvl2_arr</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mag_lvl3psf</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="nb">round</span><span class="p">(</span><span class="n">magerr_lvl3psf</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17.2719 0.0006
17.28634 0.00074
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="good-agreement-between-level2-and-level3-results">
<h2>Good agreement between Level2 and level3 results!<a class="headerlink" href="#good-agreement-between-level2-and-level3-results" title="Permalink to this heading">#</a></h2>
</section>
<section id="font-color-white-font-faint-upper-limit-single-object-a-class-anchor-id-fso-a">
<h2>4.<font color='white'>-</font>Faint/Upper Limit, Single Object<a class="anchor" id="fso"></a><a class="headerlink" href="#font-color-white-font-faint-upper-limit-single-object-a-class-anchor-id-fso-a" title="Permalink to this heading">#</a></h2>
<p>The purpose of this section is to illustrate how to calculate an upper limit using PSF photometry a blank part of the sky.</p>
<section id="font-color-white-font-multiple-level2-files-a-class-anchor-id-fso2-a">
<h3>4.1<font color='white'>-</font>Multiple, Level2 Files<a class="anchor" id="fso2"></a><a class="headerlink" href="#font-color-white-font-multiple-level2-files-a-class-anchor-id-fso2-a" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Level 3 Files</span>
<span class="n">lvl3</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;mast/01028/jw01028-o006_t001_miri_f770w_i2d.fits&#39;</span><span class="p">]</span>
<span class="n">lvl3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;mast/01028/jw01028-o006_t001_miri_f770w_i2d.fits&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create Level 2 Data List from ASN files</span>
<span class="n">prefix</span> <span class="o">=</span> <span class="s2">&quot;./mast/01028/&quot;</span>
<span class="n">asn</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="s1">&#39;jw01028-o006_*_image3_00004_asn.json&#39;</span><span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">asn</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fi</span><span class="p">:</span>
    <span class="n">lvl2</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ln</span> <span class="ow">in</span> <span class="n">fi</span><span class="p">:</span>
        <span class="c1">#print(ln)</span>
        <span class="k">if</span> <span class="n">ln</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;                    &quot;expname&quot;:&#39;</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">ln</span><span class="p">[</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
            <span class="n">lvl2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prefix</span><span class="o">+</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            
<span class="nb">print</span><span class="p">(</span><span class="n">lvl2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits&#39;, &#39;./mast/01028/jw01028006001_02101_00002_mirimage_cal.fits&#39;, &#39;./mast/01028/jw01028006001_02101_00003_mirimage_cal.fits&#39;, &#39;./mast/01028/jw01028006001_02101_00004_mirimage_cal.fits&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change all DQ flagged pixels to NANs</span>

<span class="c1"># Reference for JWST DQ Flag Definitions: https://jwst-pipeline.readthedocs.io/en/latest/jwst/references_general/references_general.html</span>
<span class="c1"># In this case, we choose all DQ &gt; 10, but users are encouraged to choose their own values accordingly.</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">lvl2</span><span class="p">:</span>
    <span class="n">ref_fits</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">dq</span>
    <span class="n">data</span><span class="p">[</span><span class="n">dq</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">ref_fits</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Examine the First Image (After DQ Flags Set)</span>
<span class="n">ref_image</span> <span class="o">=</span> <span class="n">lvl2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_fits</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_data</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># The scale should highlight the background noise so it is possible to see all faint sources.</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits
</pre></div>
</div>
<img alt="../../../_images/8c929706df395e7b45523f00fa2903e328119e36d5153e238709db259863faa0.png" src="../../../_images/8c929706df395e7b45523f00fa2903e328119e36d5153e238709db259863faa0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pick a blank part of the sky to calculate the upper limit</span>
<span class="n">source_location</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="s1">&#39;17:43:00.0332&#39;</span><span class="p">,</span> <span class="s1">&#39;+66:54:42.677&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
<span class="n">ref_wcs</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">get_fits_wcs</span><span class="p">()</span>
<span class="n">ref_y</span><span class="p">,</span> <span class="n">ref_x</span> <span class="o">=</span> <span class="n">skycoord_to_pixel</span><span class="p">(</span><span class="n">source_location</span><span class="p">,</span> <span class="n">ref_wcs</span><span class="p">)</span>
<span class="n">ref_cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="p">(</span><span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">))</span>

<span class="c1"># The scale should highlight the background noise so it is possible to see all faint sources.</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PID1028,Obs006&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/fed1196581356b374786a0bfcfb9d177ec9e9848878830ac6d9cef377651d898.png" src="../../../_images/fed1196581356b374786a0bfcfb9d177ec9e9848878830ac6d9cef377651d898.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Examine the First Image</span>
<span class="n">ref_image</span> <span class="o">=</span> <span class="n">lvl2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_fits</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits
</pre></div>
</div>
<img alt="../../../_images/35e9aa386705b6df0b32a0c83476bf6af407c14ed0f03075ec74248980bf2135.png" src="../../../_images/35e9aa386705b6df0b32a0c83476bf6af407c14ed0f03075ec74248980bf2135.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pick a blank part of the sky to calculate the upper limit</span>
<span class="n">source_location</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="s1">&#39;17:43:00.0332&#39;</span><span class="p">,</span> <span class="s1">&#39;+66:54:42.677&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
<span class="n">ref_y</span><span class="p">,</span> <span class="n">ref_x</span> <span class="o">=</span> <span class="n">skycoord_to_pixel</span><span class="p">(</span><span class="n">source_location</span><span class="p">,</span> <span class="n">wcs</span><span class="o">.</span><span class="n">WCS</span><span class="p">(</span><span class="n">ref_fits</span><span class="p">[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ref_fits</span><span class="p">))</span>
<span class="n">ref_cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">))</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
           <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PID1028,Obs006&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/1fdc243a3e6725466467246781b148b5c5cbe5825cedfc53c713241432354bad.png" src="../../../_images/1fdc243a3e6725466467246781b148b5c5cbe5825cedfc53c713241432354bad.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get PSF from WebbPSF</span>
<span class="c1"># The function get_jwst_psf is a space_phot wrapper for the WebbPSF calc_psf function and uses a lot of the same keywords.</span>
<span class="c1"># There are more advanced methods for generating your WebbPSF, but those are beyond the scope of this notebook.</span>
<span class="c1"># The defaults used by get_jwst_psf in this notebook are:</span>
<span class="c1"># oversample=4</span>
<span class="c1"># normalize=&#39;last&#39;</span>
<span class="c1"># Non-distorted PSF</span>
<span class="c1"># Useful reference: https://webbpsf.readthedocs.io/en/latest/api/webbpsf.JWInstrument.html#webbpsf.JWInstrument.calc_psf</span>

<span class="n">jwst_obs</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">observation2</span><span class="p">(</span><span class="n">lvl2</span><span class="p">)</span>
<span class="n">psfs</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">get_jwst_psf</span><span class="p">(</span><span class="n">jwst_obs</span><span class="p">,</span> <span class="n">source_location</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Setting up sim to match ./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>iterating query, tdelta=3.0

MAST OPD query around UTC: 2022-05-25T01:14:08.073
                        MJD: 59724.05148232639

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/O2022052501-NRCA3_FP1-59.fits
	Date (MJD):	 59723.8076
	Delta time:	 -0.2439 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022052701-NRCA3_FP1-0.fits
	Date (MJD):	 59726.0139
	Delta time:	 1.9624 days
User requested choosing OPD time closest in time to 2022-05-25T01:14:08.073, which is O2022052501-NRCA3_FP1-59.fits, delta time -0.244 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/O2022052501-NRCA3_FP1-59.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F770W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(772.86069511), array(559.08387297)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (121.51420939304742, 121.52381573784315)

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(772.32944238), array(571.63330681)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (121.5174643701714, 121.52330511426992)

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(767.30763827), array(569.1357543)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (121.51685314039858, 121.52145590349731)

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(762.80321923), array(562.61868067)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (121.51503596024747, 121.51983614651763)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The scale should highlight the background noise so it is possible to see all faint sources.</span>
<span class="n">ref_cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">psf3</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">161</span><span class="p">,</span> <span class="mi">161</span><span class="p">),</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;WebbPSF Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/fca40c7e075150f92a3a645c60611ba90e1e16679d93bd6bc69dd48a30f14c7a.png" src="../../../_images/fca40c7e075150f92a3a645c60611ba90e1e16679d93bd6bc69dd48a30f14c7a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Do PSF Photometry using space_phot (details of fitting are in documentation)</span>
<span class="c1"># https://st-phot.readthedocs.io/en/latest/examples/plot_a_psf.html#jwst-images</span>
<span class="n">jwst_obs</span><span class="o">.</span><span class="n">psf_photometry</span><span class="p">(</span>
    <span class="n">psfs</span><span class="p">,</span>
    <span class="n">source_location</span><span class="p">,</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;flux&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
        <span class="s1">&#39;bkg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="n">fit_width</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">fit_bkg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fit_centroid</span><span class="o">=</span><span class="s1">&#39;fixed&#39;</span><span class="p">,</span>
    <span class="n">fit_flux</span><span class="o">=</span><span class="s1">&#39;single&#39;</span>
<span class="p">)</span>

<span class="n">jwst_obs</span><span class="o">.</span><span class="n">plot_psf_fit</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">jwst_obs</span><span class="o">.</span><span class="n">plot_psf_posterior</span><span class="p">(</span><span class="n">minweight</span><span class="o">=</span><span class="mf">.0005</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">jwst_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 137.95%
</pre></div>
</div>
<img alt="../../../_images/fd0be6177308a21c90ca32ddf97c79898e6713972aaafb0cdb2ab50593a25dbf.png" src="../../../_images/fd0be6177308a21c90ca32ddf97c79898e6713972aaafb0cdb2ab50593a25dbf.png" />
<img alt="../../../_images/396a1d4b62331303bcacbd8943a62ee6edb1b382fbae2f30721e53ab95ed6716.png" src="../../../_images/396a1d4b62331303bcacbd8943a62ee6edb1b382fbae2f30721e53ab95ed6716.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>        ra         ...                     exp                    
------------------ ... -------------------------------------------
 265.7501383333533 ... jw01028006001_02101_00001_mirimage_cal.fits
 265.7501383333496 ... jw01028006001_02101_00002_mirimage_cal.fits
265.75013833334884 ... jw01028006001_02101_00003_mirimage_cal.fits
 265.7501383333493 ... jw01028006001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># As noted above, As a result, the flux and corresponding error take into account a single overall fit. </span>
<span class="c1"># Therefore, there is no need to average the resulting magnitudes or errors. They should all be the same to within their individual zero-point differences (typically &lt;1%).</span>
<span class="n">magupper_lvl2psf</span> <span class="o">=</span> <span class="n">jwst_obs</span><span class="o">.</span><span class="n">upper_limit</span><span class="p">(</span><span class="n">nsigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">magupper_lvl2psf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([25.63606332, 25.63606333, 25.63606333, 25.63606332])
</pre></div>
</div>
</div>
</div>
</section>
<section id="font-color-white-font-single-level3-mosaicked-file-a-class-anchor-id-fso3-a">
<h3>4.2<font color='white'>-</font>Single, Level3 Mosaicked File<a class="anchor" id="fso3"></a><a class="headerlink" href="#font-color-white-font-single-level3-mosaicked-file-a-class-anchor-id-fso3-a" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Level3 data file the same as above.</span>
<span class="n">lvl3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;mast/01028/jw01028-o006_t001_miri_f770w_i2d.fits&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now do the same photometry on the Level 3 Data</span>
<span class="n">ref_image</span> <span class="o">=</span> <span class="n">lvl3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ref_fits</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_data</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># The scale should highlight the background noise so it is possible to see all faint sources.</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/238d96cd2e110c16a037d5f424562b8fa01b02f2666c22603a66ac5152c3640f.png" src="../../../_images/238d96cd2e110c16a037d5f424562b8fa01b02f2666c22603a66ac5152c3640f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pick a blank part of the sky to calculate the upper limit</span>
<span class="n">source_location</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="s1">&#39;17:43:00.0332&#39;</span><span class="p">,</span> <span class="s1">&#39;+66:54:42.677&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>
<span class="n">ref_wcs</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">get_fits_wcs</span><span class="p">()</span>
<span class="n">ref_y</span><span class="p">,</span> <span class="n">ref_x</span> <span class="o">=</span> <span class="n">skycoord_to_pixel</span><span class="p">(</span><span class="n">source_location</span><span class="p">,</span> <span class="n">ref_wcs</span><span class="p">)</span>
<span class="n">ref_cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="p">(</span><span class="mi">21</span><span class="p">,</span> <span class="mi">21</span><span class="p">),</span> <span class="p">(</span><span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">))</span>

<span class="c1"># The scale should highlight the background noise so it is possible to see all faint sources.</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">4.5</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PID1028,Obs006&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/234aebc8e3deda35a456b53e8410a53075b77592709e358d2a8dbcac63be318a.png" src="../../../_images/234aebc8e3deda35a456b53e8410a53075b77592709e358d2a8dbcac63be318a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now do the same photometry on the Level 3 Data</span>
<span class="n">ref_image</span> <span class="o">=</span> <span class="n">lvl3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ref_fits</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_data</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
           <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/60eb7ff8404f2ffcb806499a759af01afe6a4ec2eece35479ffd1cfaaed63a0b.png" src="../../../_images/60eb7ff8404f2ffcb806499a759af01afe6a4ec2eece35479ffd1cfaaed63a0b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Pick a blank part of the sky to calculate the upper limit</span>
<span class="n">source_location</span> <span class="o">=</span> <span class="n">SkyCoord</span><span class="p">(</span><span class="s1">&#39;17:43:00.0332&#39;</span><span class="p">,</span> <span class="s1">&#39;+66:54:42.677&#39;</span><span class="p">,</span> <span class="n">unit</span><span class="o">=</span><span class="p">(</span><span class="n">u</span><span class="o">.</span><span class="n">hourangle</span><span class="p">,</span> <span class="n">u</span><span class="o">.</span><span class="n">deg</span><span class="p">))</span>

<span class="n">ref_y</span><span class="p">,</span> <span class="n">ref_x</span> <span class="o">=</span> <span class="n">skycoord_to_pixel</span><span class="p">(</span><span class="n">source_location</span><span class="p">,</span> <span class="n">wcs</span><span class="o">.</span><span class="n">WCS</span><span class="p">(</span><span class="n">ref_fits</span><span class="p">[</span><span class="s1">&#39;SCI&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">ref_fits</span><span class="p">))</span>
<span class="n">ref_cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="p">(</span><span class="mi">11</span><span class="p">,</span> <span class="mi">11</span><span class="p">),</span> <span class="p">(</span><span class="n">ref_x</span><span class="p">,</span> <span class="n">ref_y</span><span class="p">))</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span>
           <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;PID1028,Obs006 (level 3)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/88daafab9bc907880758a90255d5ca0881a2ac342e76314123dc630ce5a245a4.png" src="../../../_images/88daafab9bc907880758a90255d5ca0881a2ac342e76314123dc630ce5a245a4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get PSF from WebbPSF</span>
<span class="c1"># The function get_jwst_psf is a space_phot wrapper for the WebbPSF calc_psf function and uses a lot of the same keywords.</span>
<span class="c1"># There are more advanced methods for generating your WebbPSF, but those are beyond the scope of this notebook.</span>
<span class="c1"># The defaults used by get_jwst_psf in this notebook are:</span>
<span class="c1"># oversample=4</span>
<span class="c1"># normalize=&#39;last&#39;</span>
<span class="c1"># Non-distorted PSF</span>
<span class="c1"># Useful reference: https://webbpsf.readthedocs.io/en/latest/api/webbpsf.JWInstrument.html#webbpsf.JWInstrument.calc_psf</span>

<span class="n">jwst3_obs</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">observation3</span><span class="p">(</span><span class="n">lvl3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">psf3</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">get_jwst3_psf</span><span class="p">(</span><span class="n">jwst_obs</span><span class="p">,</span> <span class="n">jwst3_obs</span><span class="p">,</span> <span class="n">source_location</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Setting up sim to match ./mast/01028/jw01028006001_02101_00001_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>iterating query, tdelta=3.0

MAST OPD query around UTC: 2022-05-25T01:14:08.073
                        MJD: 59724.05148232639

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/O2022052501-NRCA3_FP1-59.fits
	Date (MJD):	 59723.8076
	Delta time:	 -0.2439 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022052701-NRCA3_FP1-0.fits
	Date (MJD):	 59726.0139
	Delta time:	 1.9624 days
User requested choosing OPD time closest in time to 2022-05-25T01:14:08.073, which is O2022052501-NRCA3_FP1-59.fits, delta time -0.244 days
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/O2022052501-NRCA3_FP1-59.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F770W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(772.86069511), array(559.08387297)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.51420939304728, 201.52381573784302)

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(772.32944238), array(571.63330681)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.5174643701711, 201.52330511426985)

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(767.30763827), array(569.1357543)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.51685314039872, 201.5214559034972)

Running instrument: MIRI, filter: F770W
  Running detector: MIRIM
    Position 1/1: (array(762.80321923), array(562.61868067)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.51503596024762, 201.51983614651743)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:05,072 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:05,073 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:05,075 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:05,077 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:05,079 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:05,080 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:05,082 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:05,269 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:05,283 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        pt2dQvpkvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:05,284 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:05,730 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd2c053dd0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:05,731 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,588 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd2c053dd0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,589 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,773 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd2c053dd0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,774 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,955 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd2c053dd0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,957 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,957 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,958 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,958 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,960 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,960 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,961 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,961 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,962 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,963 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,963 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,964 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,965 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,966 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,966 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,966 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,968 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,968 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,969 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,969 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,970 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11091579557784445 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:06,990 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:07,790 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01028006001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:07,791 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01028006001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:07,791 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01028006001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:08,540 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01028006001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:08,542 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01028006001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:08,542 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01028006001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:09,295 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01028006001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:09,296 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01028006001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:09,297 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01028006001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:10,047 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01028006001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:10,048 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01028006001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:10,048 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01028006001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:10,297 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  265.737953477 66.940980694 265.701111178 66.912738191 265.773940695 66.898122976 265.810845165 66.926348568
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:10,595 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:10,596 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:10,773 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1030, 1042) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:10,773 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:10,777 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:34:10,777 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The scale should highlight the background noise so it is possible to see all faint sources.</span>
<span class="n">ref_cutout</span> <span class="o">=</span> <span class="n">extract_array</span><span class="p">(</span><span class="n">psf3</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="p">(</span><span class="mi">161</span><span class="p">,</span> <span class="mi">161</span><span class="p">),</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">))</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_cutout</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;WebbPSF Model&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/757120c3c6b13865653ccd3f4b1b714f7b59eeff655a4d49c25a31559dafa592.png" src="../../../_images/757120c3c6b13865653ccd3f4b1b714f7b59eeff655a4d49c25a31559dafa592.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">jwst3_obs</span><span class="o">.</span><span class="n">psf_photometry</span><span class="p">(</span>
    <span class="n">psf3</span><span class="p">,</span>
    <span class="n">source_location</span><span class="p">,</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">{</span>
        <span class="s1">&#39;flux&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">],</span>
        <span class="c1"># &#39;centroid&#39;: [-2, 2],</span>
        <span class="s1">&#39;bkg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="n">fit_width</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
    <span class="n">fit_bkg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">fit_centroid</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">fit_flux</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>

<span class="n">jwst3_obs</span><span class="o">.</span><span class="n">plot_psf_fit</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">jwst3_obs</span><span class="o">.</span><span class="n">plot_psf_posterior</span><span class="p">(</span><span class="n">minweight</span><span class="o">=</span><span class="mf">.0005</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of -3.45%
</pre></div>
</div>
<img alt="../../../_images/5c5b6614aa8b0a2692e64a0ccbd57eaf1bfd86471a7223296889f92e4bf4c783.png" src="../../../_images/5c5b6614aa8b0a2692e64a0ccbd57eaf1bfd86471a7223296889f92e4bf4c783.png" />
<img alt="../../../_images/bfd9980ddb33f7a2e74cc34ff2180f925ff651ad74db0879a1d99b32ace0e69e.png" src="../../../_images/bfd9980ddb33f7a2e74cc34ff2180f925ff651ad74db0879a1d99b32ace0e69e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">magupper_lvl3psf</span> <span class="o">=</span> <span class="n">jwst3_obs</span><span class="o">.</span><span class="n">upper_limit</span><span class="p">(</span><span class="n">nsigma</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">magupper_lvl2psf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">4</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">magupper_lvl3psf</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">5</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>25.6361
25.81344
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="note-you-can-go-significantly-deeper-with-the-level3-combined-data-product">
<h2>Note you can go significantly deeper with the Level3 combined data product<a class="headerlink" href="#note-you-can-go-significantly-deeper-with-the-level3-combined-data-product" title="Permalink to this heading">#</a></h2>
</section>
<section id="font-color-white-font-stellar-field-lmc-a-class-anchor-id-lmc-a">
<h2>5.<font color='white'>-</font>Stellar Field (LMC)<a class="anchor" id="lmc"></a><a class="headerlink" href="#font-color-white-font-stellar-field-lmc-a-class-anchor-id-lmc-a" title="Permalink to this heading">#</a></h2>
<section id="in-this-case-we-are-going-to-do-the-same-steps-as-in-section-3-but-for-multiple-stars-the-purpose-is-to-illustrate-the-workflow-and-runtime-for-using-space-phot-on-a-large-number-of-stars-we-suggest-that-space-phot-may-be-less-optimal-for-large-numbers-of-bright-stars-other-programs-such-as-dolphot-or-photutils-may-be-better-suited-for-this-use-case-the-primary-advantage-to-space-phot-is-on-faint-single-sources-but-it-can-be-extended-to-a-larger-number-if-desired">
<h3>In this case, we are going to do the same steps as in Section 3, but for multiple stars. The purpose is to illustrate the workflow and runtime for using space_phot on a large number of stars. We suggest that space_phot may be less optimal for large numbers of bright stars. Other programs, such as DOLPHOT or Photutils, may be better suited for this use case. The primary advantage to space_phot is on faint, single sources. But it can be extended to a larger number if desired.<a class="headerlink" href="#in-this-case-we-are-going-to-do-the-same-steps-as-in-section-3-but-for-multiple-stars-the-purpose-is-to-illustrate-the-workflow-and-runtime-for-using-space-phot-on-a-large-number-of-stars-we-suggest-that-space-phot-may-be-less-optimal-for-large-numbers-of-bright-stars-other-programs-such-as-dolphot-or-photutils-may-be-better-suited-for-this-use-case-the-primary-advantage-to-space-phot-is-on-faint-single-sources-but-it-can-be-extended-to-a-larger-number-if-desired" title="Permalink to this heading">#</a></h3>
</section>
<section id="font-color-white-font-multiple-level2-files-a-class-anchor-id-lmc2-a">
<h3>5.1<font color='white'>-</font>Multiple, Level2 Files<a class="anchor" id="lmc2"></a><a class="headerlink" href="#font-color-white-font-multiple-level2-files-a-class-anchor-id-lmc2-a" title="Permalink to this heading">#</a></h3>
<section id="now-do-the-same-thing-for-a-larger-group-of-stars-and-test-for-speed">
<h4>Now do the same thing for a larger group of stars and test for speed<a class="headerlink" href="#now-do-the-same-thing-for-a-larger-group-of-stars-and-test-for-speed" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Level 3 Files</span>
<span class="n">lvl3</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;./mast/01171/jw01171-o004_t001_miri_f560w_i2d.fits&quot;</span><span class="p">]</span>
<span class="n">lvl3</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;./mast/01171/jw01171-o004_t001_miri_f560w_i2d.fits&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Level 2 Files</span>
<span class="n">lvl2</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;./mast/01171/jw01171004*cal.fits&#39;</span><span class="p">)</span>
<span class="n">lvl2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits&#39;,
 &#39;./mast/01171/jw01171004001_02101_00003_mirimage_cal.fits&#39;,
 &#39;./mast/01171/jw01171004001_02101_00002_mirimage_cal.fits&#39;,
 &#39;./mast/01171/jw01171004001_02101_00001_mirimage_cal.fits&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find Stars in Level 3 File</span>
<span class="c1"># Get rough estimate of background (There are Better Ways to Do Background Subtraction)</span>
<span class="n">bkgrms</span> <span class="o">=</span> <span class="n">MADStdBackgroundRMS</span><span class="p">()</span>
<span class="n">mmm_bkg</span> <span class="o">=</span> <span class="n">MMMBackground</span><span class="p">()</span>

<span class="n">ref_fits</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">lvl3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">get_fits_wcs</span><span class="p">()</span>

<span class="n">std</span> <span class="o">=</span> <span class="n">bkgrms</span><span class="p">(</span><span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">bkg</span> <span class="o">=</span> <span class="n">mmm_bkg</span><span class="p">(</span><span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
<span class="n">data_bkgsub</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">data_bkgsub</span> <span class="o">-=</span> <span class="n">bkg</span>        
<span class="n">sigma_psf</span> <span class="o">=</span> <span class="mf">1.636</span> <span class="c1"># pixels for F770W</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="mf">5.</span>

<span class="n">daofind</span> <span class="o">=</span> <span class="n">DAOStarFinder</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="n">threshold</span> <span class="o">*</span> <span class="n">std</span><span class="p">,</span> <span class="n">fwhm</span><span class="o">=</span><span class="n">sigma_psf</span><span class="p">,</span> <span class="n">exclude_border</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">found_stars</span> <span class="o">=</span> <span class="n">daofind</span><span class="p">(</span><span class="n">data_bkgsub</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">found_stars</span><span class="o">.</span><span class="n">pprint_all</span><span class="p">(</span><span class="n">max_lines</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> id      xcentroid         ycentroid          sharpness       roundness1      roundness2      npix sky         peak                flux                 mag         
---- ----------------- ------------------ ------------------ ----------- -------------------- ---- --- -------------------- ------------------ ---------------------
   1 546.3366588406968  5.398882130273244 0.7216108098543021  0.42706507   0.0327047943515513   25 0.0  -0.8653272390365601 1.6044420003890991   -0.5133100555790514
   2 579.1090334369383  5.270107063151424 0.7034689294973233 -0.07913096  -0.8541384674101066   25 0.0   -0.670994758605957 1.0608985424041748  -0.06418463180595672
   3 583.2893136620834  5.869637735574443 0.8212823650919728 -0.49647078   0.7449057965878985   25 0.0  -0.5979987382888794 1.4969946146011353   -0.4380505949571353
 ...               ...                ...                ...         ...                  ...  ... ...                  ...                ...                   ...
1020 823.1909217052859 1063.9062041971058 0.6719764600218959    -0.28535  -0.8398970665868767   25 0.0 -0.07174539566040039 1.0094515085220337 -0.010213653451457479
1021 1005.185892839383 1062.4099060710946 0.6971610988174167 -0.47630343  -0.9494361838311032   25 0.0  -0.6988779306411743  1.017919659614563 -0.019283755505403833
1022 566.9706646831828 1065.1072835008604 0.6029184554786975 -0.30431855 -0.47832912292568897   25 0.0   0.5157880783081055  1.533209204673767  -0.46400354472969885
Length = 1022 rows
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Filter out only stars you want</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

<span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;sharpness&#39;</span><span class="p">)</span>

<span class="n">xlim0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.25</span>
<span class="n">xlim1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.25</span>
<span class="n">ylim0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.15</span>
<span class="n">ylim1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">])</span> <span class="o">+</span> <span class="mf">0.15</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim0</span><span class="p">,</span> <span class="n">xlim1</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim0</span><span class="p">,</span> <span class="n">ylim1</span><span class="p">)</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">],</span> <span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">sh_inf</span> <span class="o">=</span> <span class="mf">0.40</span>
<span class="n">sh_sup</span> <span class="o">=</span> <span class="mf">0.82</span>
<span class="c1">#mag_lim = -5.0</span>
<span class="n">lmag_lim</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.0</span>
<span class="n">umag_lim</span> <span class="o">=</span> <span class="o">-</span><span class="mf">5.0</span>

<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xlim0</span><span class="p">,</span> <span class="n">xlim1</span><span class="p">],</span> <span class="p">[</span><span class="n">sh_sup</span><span class="p">,</span> <span class="n">sh_sup</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xlim0</span><span class="p">,</span> <span class="n">xlim1</span><span class="p">],</span> <span class="p">[</span><span class="n">sh_inf</span><span class="p">,</span> <span class="n">sh_inf</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">lmag_lim</span><span class="p">,</span> <span class="n">lmag_lim</span><span class="p">],</span> <span class="p">[</span><span class="n">ylim0</span><span class="p">,</span> <span class="n">ylim1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">umag_lim</span><span class="p">,</span> <span class="n">umag_lim</span><span class="p">],</span> <span class="p">[</span><span class="n">ylim0</span><span class="p">,</span> <span class="n">ylim1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;mag&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;roundness&#39;</span><span class="p">)</span>

<span class="n">ylim0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.25</span>
<span class="n">ylim1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">])</span> <span class="o">-</span> <span class="mf">0.25</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">xlim0</span><span class="p">,</span> <span class="n">xlim1</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ylim0</span><span class="p">,</span> <span class="n">ylim1</span><span class="p">)</span>

<span class="n">round_inf</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.40</span>
<span class="n">round_sup</span> <span class="o">=</span> <span class="mf">0.40</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">],</span> <span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xlim0</span><span class="p">,</span> <span class="n">xlim1</span><span class="p">],</span> <span class="p">[</span><span class="n">round_sup</span><span class="p">,</span> <span class="n">round_sup</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">xlim0</span><span class="p">,</span> <span class="n">xlim1</span><span class="p">],</span> <span class="p">[</span><span class="n">round_inf</span><span class="p">,</span> <span class="n">round_inf</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">lmag_lim</span><span class="p">,</span> <span class="n">lmag_lim</span><span class="p">],</span> <span class="p">[</span><span class="n">ylim0</span><span class="p">,</span> <span class="n">ylim1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">umag_lim</span><span class="p">,</span> <span class="n">umag_lim</span><span class="p">],</span> <span class="p">[</span><span class="n">ylim0</span><span class="p">,</span> <span class="n">ylim1</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/f58e5560b7f1b66466df47c01e4b49966cdd731e81c0d5cf00592bf8f2ceb2a5.png" src="../../../_images/f58e5560b7f1b66466df47c01e4b49966cdd731e81c0d5cf00592bf8f2ceb2a5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mask</span> <span class="o">=</span> <span class="p">((</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">lmag_lim</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">umag_lim</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">round_inf</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;roundness2&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">round_sup</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">sh_inf</span><span class="p">)</span> 
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;sharpness&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">sh_sup</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">700</span><span class="p">)</span>
        <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">found_stars</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">700</span><span class="p">))</span>

<span class="n">found_stars_sel</span> <span class="o">=</span> <span class="n">found_stars</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of stars found originally:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_stars</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Number of stars in final selection:&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">found_stars_sel</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of stars found originally: 1022
Number of stars in final selection: 13
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">found_stars_sel</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div><i>QTable length=13</i>
<table id="table140450632977872" class="table-striped table-bordered table-condensed">
<thead><tr><th>id</th><th>xcentroid</th><th>ycentroid</th><th>sharpness</th><th>roundness1</th><th>roundness2</th><th>npix</th><th>sky</th><th>peak</th><th>flux</th><th>mag</th></tr></thead>
<thead><tr><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float32</th><th>float64</th><th>int64</th><th>float64</th><th>float64</th><th>float64</th><th>float64</th></tr></thead>
<tr><td>154</td><td>378.7447860048902</td><td>106.99556381787069</td><td>0.746396419837587</td><td>-0.060909897</td><td>-0.06528081842863379</td><td>25</td><td>0.0</td><td>51.20432662963867</td><td>46.19735336303711</td><td>-4.161542739066019</td></tr>
<tr><td>163</td><td>699.3979436707866</td><td>121.32571956929932</td><td>0.6839113896426745</td><td>-0.44503638</td><td>-0.16064184840194462</td><td>25</td><td>0.0</td><td>21.92721176147461</td><td>18.855628967285156</td><td>-3.18860255936475</td></tr>
<tr><td>215</td><td>520.4738859889501</td><td>190.2470844467611</td><td>0.801939515793906</td><td>0.29336134</td><td>-0.10283372682390177</td><td>25</td><td>0.0</td><td>23.034168243408203</td><td>17.11179542541504</td><td>-3.083238948815109</td></tr>
<tr><td>218</td><td>591.9608924578399</td><td>194.86544163362754</td><td>0.7537782857133695</td><td>-0.37401316</td><td>-0.2174607202451072</td><td>25</td><td>0.0</td><td>21.18755340576172</td><td>15.98092269897461</td><td>-3.0090046269794324</td></tr>
<tr><td>252</td><td>388.9901978969254</td><td>248.16827827738035</td><td>0.726416615195482</td><td>0.20260607</td><td>0.2397623279230829</td><td>25</td><td>0.0</td><td>19.440757751464844</td><td>18.035749435424805</td><td>-3.1403354829247307</td></tr>
<tr><td>270</td><td>532.4073709451064</td><td>267.73564351673207</td><td>0.7293613535465368</td><td>-0.2966984</td><td>-0.16983160454011637</td><td>25</td><td>0.0</td><td>43.17793273925781</td><td>34.43391418457031</td><td>-3.8424659819824254</td></tr>
<tr><td>355</td><td>671.4881295228383</td><td>370.5420770001648</td><td>0.6900003175282557</td><td>0.20748842</td><td>-0.26339732280995043</td><td>25</td><td>0.0</td><td>21.814945220947266</td><td>16.73634147644043</td><td>-3.059151320785358</td></tr>
<tr><td>425</td><td>635.9256442579762</td><td>494.58156627181285</td><td>0.8118165178964439</td><td>-0.07866803</td><td>0.25792515575227165</td><td>25</td><td>0.0</td><td>29.927074432373047</td><td>23.537675857543945</td><td>-3.4294089444763682</td></tr>
<tr><td>502</td><td>584.9740628030005</td><td>576.5201775316028</td><td>0.7828437409321344</td><td>-0.21265483</td><td>0.009297936681535182</td><td>25</td><td>0.0</td><td>76.73455047607422</td><td>58.97472381591797</td><td>-4.426664789302999</td></tr>
<tr><td>517</td><td>492.66388855545836</td><td>596.8658745779884</td><td>0.7347661751700872</td><td>-0.23544124</td><td>-0.10054281229297801</td><td>25</td><td>0.0</td><td>78.58627319335938</td><td>63.12621307373047</td><td>-4.50052434221938</td></tr>
<tr><td>551</td><td>619.8508990777472</td><td>636.6907164193356</td><td>0.7724248531773827</td><td>0.010845675</td><td>-0.013285777867112663</td><td>25</td><td>0.0</td><td>56.14342498779297</td><td>47.28252029418945</td><td>-4.186751544084827</td></tr>
<tr><td>581</td><td>668.7617674291404</td><td>663.1785750635981</td><td>0.7084816978596876</td><td>0.0063561467</td><td>-0.0022812641884474333</td><td>25</td><td>0.0</td><td>25.993396759033203</td><td>22.530733108520508</td><td>-3.3819383077389165</td></tr>
<tr><td>585</td><td>664.5922000845243</td><td>666.5834497058925</td><td>0.6994057542908438</td><td>0.5473958</td><td>0.026616053925189155</td><td>25</td><td>0.0</td><td>80.94784545898438</td><td>65.27168273925781</td><td>-4.536812022966915</td></tr>
</table></div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert pixel to wcs coords</span>
<span class="n">skycoords</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">pixel_to_world</span><span class="p">(</span><span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;xcentroid&#39;</span><span class="p">],</span> <span class="n">found_stars_sel</span><span class="p">[</span><span class="s1">&#39;ycentroid&#39;</span><span class="p">])</span>
<span class="nb">len</span><span class="p">(</span><span class="n">skycoords</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Change all DQ flagged pixels to NANs</span>
<span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">lvl2</span><span class="p">:</span>
    <span class="n">ref_fits</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">dq</span>
    <span class="n">data</span><span class="p">[</span><span class="n">dq</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">ref_fits</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a grid for fast lookup using WebbPSF. The larger the number of grid points, the better the photometric precision.</span>
<span class="c1"># Developer note. Would be great to have a fast/approximate look up table. </span>
<span class="n">jwst_obs</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">observation2</span><span class="p">(</span><span class="n">lvl2</span><span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_jwst_psf_grid</span><span class="p">(</span><span class="n">jwst_obs</span><span class="p">,</span> <span class="n">num_psfs</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading URL https://mast.stsci.edu/api/v0.1/Download/file?uri=mast:JWST/product/R2022041201-NRCA3_FP1-2.fits to ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits ...
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> [Done]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/4: (0, 0) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/4 centroid: (201.39896123096594, 201.57462168473992)
    Position 2/4: (0, 1023) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 2/4 centroid: (201.30665784716913, 201.41346936543644)
    Position 3/4: (1023, 0) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 3/4 centroid: (201.44216164335302, 201.69986266797625)
    Position 4/4: (1023, 1023) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 4/4 centroid: (201.77312450805107, 201.60334597442935)
  Saving file: miri_mirim_f560w_fovp101_samp4_npsf4.fits
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="n">QTable</span><span class="p">([</span><span class="n">skycoords</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;skycoord&quot;</span><span class="p">])</span>
<span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;skycoord.ecsv&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now Loop Through All Stars and Build Photometry Table</span>
<span class="c1"># Readers should refer to all diagnostics discussed above. </span>
<span class="c1"># It should be noted that empty plots correspond to LVL2 files with dither positions that do not cover that particular coordinate.</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">badindex</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">jwst_obs</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">observation2</span><span class="p">(</span><span class="n">lvl2</span><span class="p">)</span>
<span class="k">for</span> <span class="n">source_location</span> <span class="ow">in</span> <span class="n">skycoords</span><span class="p">:</span>
    <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting&#39;</span><span class="p">,</span> <span class="n">counter</span><span class="o">+</span><span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39; of&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">skycoords</span><span class="p">),</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">source_location</span><span class="p">)</span>
    <span class="n">psfs</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">get_jwst_psf_from_grid</span><span class="p">(</span><span class="n">jwst_obs</span><span class="p">,</span> <span class="n">source_location</span><span class="p">,</span> <span class="n">grid</span><span class="p">)</span>
    <span class="n">jwst_obs</span><span class="o">.</span><span class="n">psf_photometry</span><span class="p">(</span><span class="n">psfs</span><span class="p">,</span> <span class="n">source_location</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;flux&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">100000</span><span class="p">,</span> <span class="mi">100000</span><span class="p">],</span>
                            <span class="s1">&#39;centroid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">2.</span><span class="p">],</span>
                            <span class="s1">&#39;bkg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">]},</span>
                            <span class="n">fit_width</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
                            <span class="n">fit_bkg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                            <span class="n">fit_flux</span><span class="o">=</span><span class="s1">&#39;single&#39;</span><span class="p">,</span>
                            <span class="n">maxiter</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
    
    <span class="n">jwst_obs</span><span class="o">.</span><span class="n">plot_psf_fit</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    
    <span class="n">ra</span> <span class="o">=</span> <span class="n">jwst_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dec</span> <span class="o">=</span> <span class="n">jwst_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mag_arr</span> <span class="o">=</span> <span class="n">jwst_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">]</span>
    <span class="n">magerr_arr</span> <span class="o">=</span> <span class="n">jwst_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">[</span><span class="s1">&#39;magerr&#39;</span><span class="p">]</span>
    <span class="n">mag_lvl2psf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mag_arr</span><span class="p">)</span>
    <span class="n">magerr_lvl2psf</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">p</span><span class="o">**</span><span class="mi">2</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">magerr_arr</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">mag_lvl2psf</span><span class="p">,</span> <span class="n">magerr_lvl2psf</span><span class="p">]]),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;magerr&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">mag_lvl2psf</span><span class="p">,</span> <span class="n">magerr_lvl2psf</span><span class="p">]]),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;magerr&#39;</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mf">1.</span>
    
    <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Elapsed Time for Photometry:&quot;</span><span class="p">,</span> <span class="n">toc</span> <span class="o">-</span> <span class="n">tic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting 1.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.6875184, -69.44522229)&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 3.66%
</pre></div>
</div>
<img alt="../../../_images/a68561b02689de81752f4b03cbfa2902b0bf5089b00e079f70c6765db8a20e17.png" src="../../../_images/a68561b02689de81752f4b03cbfa2902b0bf5089b00e079f70c6765db8a20e17.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 19.169411358000048
Starting 2.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.70519765, -69.43753467)&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 2.07%
</pre></div>
</div>
<img alt="../../../_images/fd9d04cde7916a59eed23f4bd36f5898c57e248a256b10cb6ff5c6f78417a909.png" src="../../../_images/fd9d04cde7916a59eed23f4bd36f5898c57e248a256b10cb6ff5c6f78417a909.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 28.712075343999913
Starting 3.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.70076463, -69.44322855)&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 2.68%
</pre></div>
</div>
<img alt="../../../_images/22173025f36fb7f8b00dc702689a29076f0859a86692ddc98417ec32e80263b7.png" src="../../../_images/22173025f36fb7f8b00dc702689a29076f0859a86692ddc98417ec32e80263b7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 31.09890727300001
Starting 4.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.70480626, -69.44154049)&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 2.97%
</pre></div>
</div>
<img alt="../../../_images/a8f892839140372316857f08cf1b41561165cb24d8afb25dc5ab175ad780b6e8.png" src="../../../_images/a8f892839140372316857f08cf1b41561165cb24d8afb25dc5ab175ad780b6e8.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 31.787859657000013
Starting 5.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.69801915, -69.44754544)&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 1.28%
</pre></div>
</div>
<img alt="../../../_images/e3e51990e54d28a329decfd2f995b5c8daea5912125d7cbda360aa34c96e4d36.png" src="../../../_images/e3e51990e54d28a329decfd2f995b5c8daea5912125d7cbda360aa34c96e4d36.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 19.494438378999916
Starting 6.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.70685634, -69.4443469)&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 3.73%
</pre></div>
</div>
<img alt="../../../_images/be60a42c3b2e2ddd43f403371f3ff8fc951ced6e416929de2d3406b145a7db47.png" src="../../../_images/be60a42c3b2e2ddd43f403371f3ff8fc951ced6e416929de2d3406b145a7db47.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 28.26133561000006
Starting 7.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.72134362, -69.44277411)&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 1.92%
</pre></div>
</div>
<img alt="../../../_images/e772bb243e0ea81e9f0041a7d76551d316a3f3af68c20a34d74ced5d56021a3e.png" src="../../../_images/e772bb243e0ea81e9f0041a7d76551d316a3f3af68c20a34d74ced5d56021a3e.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 39.662753649000024
Starting 8.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.72825681, -69.44591877)&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 2.48%
</pre></div>
</div>
<img alt="../../../_images/c39d6aa1a11856ed09d97cd210d7ef21559df7a239e964c842a81107b3ee1abc.png" src="../../../_images/c39d6aa1a11856ed09d97cd210d7ef21559df7a239e964c842a81107b3ee1abc.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 51.99780270399992
Starting 9.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.73139798, -69.44867697)&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 5.54%
</pre></div>
</div>
<img alt="../../../_images/afdc576dff7a60c501fe97ee8b96c068526549518d8902298719b9816880574d.png" src="../../../_images/afdc576dff7a60c501fe97ee8b96c068526549518d8902298719b9816880574d.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 28.66691333899996
Starting 10.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.72803877, -69.45133743)&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 4.94%
</pre></div>
</div>
<img alt="../../../_images/149d30238080b975d7b3da3ea8c96bb29625dd442fdc3c1aab13c5fe06f5b0d3.png" src="../../../_images/149d30238080b975d7b3da3ea8c96bb29625dd442fdc3c1aab13c5fe06f5b0d3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 28.95111452699996
Starting 11.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.73746115, -69.44890936)&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 3.30%
</pre></div>
</div>
<img alt="../../../_images/c46c9cbe6ad7c1ce5659878bc53206f273793d61681dbed08f6723074310410a.png" src="../../../_images/c46c9cbe6ad7c1ce5659878bc53206f273793d61681dbed08f6723074310410a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 31.199620938000066
Starting 12.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.74187347, -69.44817923)&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 59.75%
</pre></div>
</div>
<img alt="../../../_images/4cb9fabafa4baf942ca8f6401c7f4b05b4775da2a2fcfb2500096c492eb51bde.png" src="../../../_images/4cb9fabafa4baf942ca8f6401c7f4b05b4775da2a2fcfb2500096c492eb51bde.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 34.00642738600004
Starting 13.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.74189746, -69.44834474)&gt;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 17.70%
</pre></div>
</div>
<img alt="../../../_images/268121f05bc450db0dfd0dfe5b17d80fade18aec127a1a5cba0bce488dd18005.png" src="../../../_images/268121f05bc450db0dfd0dfe5b17d80fade18aec127a1a5cba0bce488dd18005.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 27.38631318399996
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ra</th>
      <th>dec</th>
      <th>mag</th>
      <th>magerr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>80.687509</td>
      <td>-69.445224</td>
      <td>18.887427</td>
      <td>0.007685</td>
    </tr>
    <tr>
      <th>1</th>
      <td>80.705202</td>
      <td>-69.437531</td>
      <td>19.414112</td>
      <td>0.006510</td>
    </tr>
    <tr>
      <th>2</th>
      <td>80.700771</td>
      <td>-69.443235</td>
      <td>18.927437</td>
      <td>0.005284</td>
    </tr>
    <tr>
      <th>3</th>
      <td>80.704789</td>
      <td>-69.441546</td>
      <td>19.108198</td>
      <td>0.005637</td>
    </tr>
    <tr>
      <th>4</th>
      <td>80.698004</td>
      <td>-69.447549</td>
      <td>19.872468</td>
      <td>0.011260</td>
    </tr>
    <tr>
      <th>5</th>
      <td>80.706844</td>
      <td>-69.444349</td>
      <td>18.436834</td>
      <td>0.004292</td>
    </tr>
    <tr>
      <th>6</th>
      <td>80.721349</td>
      <td>-69.442773</td>
      <td>18.982821</td>
      <td>0.005462</td>
    </tr>
    <tr>
      <th>7</th>
      <td>80.728230</td>
      <td>-69.445926</td>
      <td>18.864782</td>
      <td>0.004729</td>
    </tr>
    <tr>
      <th>8</th>
      <td>80.731419</td>
      <td>-69.448673</td>
      <td>17.858025</td>
      <td>0.003220</td>
    </tr>
    <tr>
      <th>9</th>
      <td>80.728022</td>
      <td>-69.451340</td>
      <td>17.965327</td>
      <td>0.003422</td>
    </tr>
    <tr>
      <th>10</th>
      <td>80.737474</td>
      <td>-69.448908</td>
      <td>18.553636</td>
      <td>0.004060</td>
    </tr>
    <tr>
      <th>11</th>
      <td>80.741862</td>
      <td>-69.448183</td>
      <td>19.303803</td>
      <td>0.005774</td>
    </tr>
    <tr>
      <th>12</th>
      <td>80.741881</td>
      <td>-69.448345</td>
      <td>17.996295</td>
      <td>0.003692</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
</section>
<section id="font-color-white-font-single-level3-mosaicked-file-a-class-anchor-id-lmc3-a">
<h3>5.2<font color='white'>-</font>Single, Level3 Mosaicked File<a class="anchor" id="lmc3"></a><a class="headerlink" href="#font-color-white-font-single-level3-mosaicked-file-a-class-anchor-id-lmc3-a" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lvl2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now do the same photometry on the Level 3 Data</span>
<span class="n">ref_image</span> <span class="o">=</span> <span class="n">lvl3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">ref_fits</span> <span class="o">=</span> <span class="n">ImageModel</span><span class="p">(</span><span class="n">ref_image</span><span class="p">)</span>
<span class="n">ref_data</span> <span class="o">=</span> <span class="n">ref_fits</span><span class="o">.</span><span class="n">data</span>
<span class="n">norm1</span> <span class="o">=</span> <span class="n">simple_norm</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">stretch</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">min_cut</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">max_cut</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">12</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">ref_data</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;MJy/Str&#39;</span><span class="p">,</span> <span class="n">labelpad</span><span class="o">=-</span><span class="mi">40</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.05</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Pixels&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/00bf3bb2880419001bc897cd6405a8ef56ca3dedb8c78519363de1589e6c6876.png" src="../../../_images/00bf3bb2880419001bc897cd6405a8ef56ca3dedb8c78519363de1589e6c6876.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get PSF from WebbPSF and drizzle it to the source location</span>
<span class="n">jwst3_obs</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">observation3</span><span class="p">(</span><span class="n">lvl3</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lvl3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;./mast/01171/jw01171-o004_t001_miri_f560w_i2d.fits&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">skycoords</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;SkyCoord (ICRS): (ra, dec) in deg
    [(80.6875184 , -69.44522229), (80.70519765, -69.43753467),
     (80.70076463, -69.44322855), (80.70480626, -69.44154049),
     (80.69801915, -69.44754544), (80.70685634, -69.4443469 ),
     (80.72134362, -69.44277411), (80.72825681, -69.44591877),
     (80.73139798, -69.44867697), (80.72803877, -69.45133743),
     (80.73746115, -69.44890936), (80.74187347, -69.44817923),
     (80.74189746, -69.44834474)]&gt;
</pre></div>
</div>
</div>
</div>
<section id="readers-should-refer-to-all-diagnostics-discussed-above-in-general-this-loop-shows-the-difficulty-in-doing-psf-photometry-on-a-wide-variety-of-stars-brightness-distribution-on-the-detector-etc-without-visual-inspection-especially-when-dealing-with-low-snr-sources-this-is-true-for-all-photometry-packages-users-should-inspect-the-associated-metrics-and-consider-optimizing-the-parameters-for-specific-stars-of-interest-nonetheless-the-success-of-the-fits-can-always-be-quantified-in-with-the-associated-error-bars">
<h4>Readers should refer to all diagnostics discussed above. In general, this loop shows the difficulty in doing PSF photometry on a wide variety of stars (brightness, distribution on the detector, etc) without visual inspection. Especially when dealing with low SNR sources.This is true for all photometry packages. Users should inspect the associated metrics and consider optimizing the parameters for specific stars of interest. Nonetheless, the success of the fits can always be quantified in with the associated error bars.<a class="headerlink" href="#readers-should-refer-to-all-diagnostics-discussed-above-in-general-this-loop-shows-the-difficulty-in-doing-psf-photometry-on-a-wide-variety-of-stars-brightness-distribution-on-the-detector-etc-without-visual-inspection-especially-when-dealing-with-low-snr-sources-this-is-true-for-all-photometry-packages-users-should-inspect-the-associated-metrics-and-consider-optimizing-the-parameters-for-specific-stars-of-interest-nonetheless-the-success-of-the-fits-can-always-be-quantified-in-with-the-associated-error-bars" title="Permalink to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now Loop Through All Stars and Build Photometry Table</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mf">0.</span>
<span class="n">badindex</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">source_location</span> <span class="ow">in</span> <span class="n">skycoords</span><span class="p">:</span>
    <span class="n">tic</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting&#39;</span><span class="p">,</span> <span class="n">counter</span><span class="o">+</span><span class="mf">1.</span><span class="p">,</span> <span class="s1">&#39; of&#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">skycoords</span><span class="p">),</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">source_location</span><span class="p">)</span>
    <span class="n">psf3</span> <span class="o">=</span> <span class="n">space_phot</span><span class="o">.</span><span class="n">get_jwst3_psf</span><span class="p">(</span><span class="n">jwst_obs</span><span class="p">,</span> <span class="n">jwst3_obs</span><span class="p">,</span> <span class="n">source_location</span><span class="p">,</span> <span class="n">num_psfs</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">jwst3_obs</span><span class="o">.</span><span class="n">psf_photometry</span><span class="p">(</span><span class="n">psf3</span><span class="p">,</span> <span class="n">source_location</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;flux&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">10000</span><span class="p">,</span> <span class="mi">10000</span><span class="p">],</span>
                             <span class="s1">&#39;centroid&#39;</span><span class="p">:</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
                             <span class="s1">&#39;bkg&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">]},</span>
                             <span class="n">fit_width</span><span class="o">=</span><span class="mi">9</span><span class="p">,</span>
                             <span class="n">fit_bkg</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                             <span class="n">fit_flux</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">jwst3_obs</span><span class="o">.</span><span class="n">plot_psf_fit</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="n">ra</span> <span class="o">=</span> <span class="n">jwst3_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">dec</span> <span class="o">=</span> <span class="n">jwst3_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">[</span><span class="s1">&#39;dec&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">mag_lvl3psf</span> <span class="o">=</span> <span class="n">jwst3_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">[</span><span class="s1">&#39;mag&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">magerr_lvl3psf</span> <span class="o">=</span> <span class="n">jwst3_obs</span><span class="o">.</span><span class="n">psf_result</span><span class="o">.</span><span class="n">phot_cal_table</span><span class="p">[</span><span class="s1">&#39;magerr&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">counter</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">mag_lvl3psf</span><span class="p">,</span> <span class="n">magerr_lvl3psf</span><span class="p">]]),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;magerr&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">ra</span><span class="p">,</span> <span class="n">dec</span><span class="p">,</span> <span class="n">mag_lvl3psf</span><span class="p">,</span> <span class="n">magerr_lvl3psf</span><span class="p">]]),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ra&#39;</span><span class="p">,</span> <span class="s1">&#39;dec&#39;</span><span class="p">,</span> <span class="s1">&#39;mag&#39;</span><span class="p">,</span> <span class="s1">&#39;magerr&#39;</span><span class="p">])],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mf">1.</span>
    <span class="n">toc</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">perf_counter</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Elapsed Time for Photometry:&quot;</span><span class="p">,</span> <span class="n">toc</span> <span class="o">-</span> <span class="n">tic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting 1.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.6875184, -69.44522229)&gt;
Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(108.16016136), array(378.91287696)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.36457069453377, 201.7782739113487)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(60.77951216), array(341.19525753)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.32020140480185, 201.7927421539016)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(105.05489775), array(378.04020065)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.36232944983183, 201.77970029627062)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(57.78188432), array(340.24354019)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.31773175959825, 201.79372349979025)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:35,699 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:35,700 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:35,702 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:35,704 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:35,705 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:35,707 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:35,708 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:35,895 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:35,908 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        S8+wK09fvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:35,909 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:36,380 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3aa201d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:36,380 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,269 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3aa201d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,270 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,470 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3aa201d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,471 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,662 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3aa201d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,663 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,664 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,664 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,665 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,666 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,667 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,667 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,668 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,669 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,670 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,670 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,671 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,672 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,673 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,673 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,673 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,675 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,676 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,676 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,676 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,677 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11082930390039995 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:37,695 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:38,489 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:38,490 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:38,490 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:39,239 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:39,240 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:39,241 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:40,002 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:40,003 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:40,004 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:40,753 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:40,754 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:40,755 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:40,993 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  80.660307842 -69.452650714 80.735816161 -69.472158466 80.791402231 -69.445614065 80.715936684 -69.426130394
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:41,297 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:41,298 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:41,495 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1069, 1070) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:41,496 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:41,499 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:41:41,500 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 2.19%
</pre></div>
</div>
<img alt="../../../_images/e2ca589f191289ca36d9e766dc4dca4a37ae0b949ed5e95fb2805fd7f0fe0260.png" src="../../../_images/e2ca589f191289ca36d9e766dc4dca4a37ae0b949ed5e95fb2805fd7f0fe0260.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 29.15438626499997
Starting 2.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.70519765, -69.43753467)&gt;
Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(123.55715254), array(699.52894191)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.34368596613945, 201.7628797397261)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(76.318041), array(661.79144185)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.32154273036554, 201.80099578112635)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(120.45650977), array(698.65297148)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.34212605742846, 201.76493480669592)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(73.33050953), array(660.83890567)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.31952743828327, 201.80291255054078)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:04,076 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:04,077 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:04,080 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:04,082 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:04,083 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:04,085 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:04,086 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:04,285 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:04,299 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        S8+wK09fvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:04,299 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:04,785 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3c0c6450&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:04,785 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:05,699 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3c0c6450&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:05,699 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:05,895 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3c0c6450&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:05,896 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,086 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3c0c6450&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,088 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,088 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,089 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,089 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,091 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,092 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,092 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,092 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,094 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,094 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,095 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,095 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,097 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,097 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,098 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,098 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,100 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,100 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,100 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,101 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,101 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11082930390039995 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,120 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,911 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,913 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:06,913 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:07,666 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:07,668 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:07,668 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:08,426 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:08,427 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:08,428 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:09,171 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:09,173 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:09,173 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:09,411 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  80.660307842 -69.452650714 80.735816161 -69.472158466 80.791402231 -69.445614065 80.715936684 -69.426130394
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:09,711 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:09,712 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:09,908 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1069, 1070) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:09,909 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:09,915 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:09,915 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 1.89%
</pre></div>
</div>
<img alt="../../../_images/96d36df9ed2b40a5c9fde85e54cad5c2658f06d0038ed594b41462cd3fdf2608.png" src="../../../_images/96d36df9ed2b40a5c9fde85e54cad5c2658f06d0038ed594b41462cd3fdf2608.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 28.200233417999925
Starting 3.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.70076463, -69.44322855)&gt;
Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(192.62459502), array(520.63589611)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.4376289597017, 201.7338225119554)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(145.69349681), array(482.90572377)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.40682507982595, 201.75980292521777)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(189.54438243), array(519.76159984)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.4356507491598, 201.73578899876756)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(142.72676529), array(481.95371219)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.4046449086048, 201.76147939328513)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:32,489 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:32,490 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:32,493 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:32,494 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:32,496 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:32,497 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:32,498 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:32,701 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:32,714 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        S8+wK09fvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:32,715 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:33,211 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd368761d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:33,212 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,124 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd368761d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,125 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,332 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd368761d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,332 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,538 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd368761d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,539 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,540 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,540 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,541 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,542 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,543 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,543 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,543 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,545 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,545 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,546 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,546 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,548 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,548 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,548 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,549 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,550 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,551 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,551 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,552 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,552 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11082930390039995 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:34,571 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:35,359 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:35,361 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:35,361 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:36,158 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:36,159 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:36,160 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:36,914 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:36,915 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:36,916 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:37,659 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:37,661 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:37,661 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:37,901 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  80.660307842 -69.452650714 80.735816161 -69.472158466 80.791402231 -69.445614065 80.715936684 -69.426130394
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:38,200 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:38,201 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:38,408 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1069, 1070) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:38,409 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:38,413 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:42:38,414 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 8.72%
</pre></div>
</div>
<img alt="../../../_images/0d04f5c549615c32c4b56688984f500b6d3003ca17c7c23d746dd212c54452d6.png" src="../../../_images/0d04f5c549615c32c4b56688984f500b6d3003ca17c7c23d746dd212c54452d6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 28.585865769999828
Starting 4.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.70480626, -69.44154049)&gt;
Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(197.467415), array(592.14073978)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.4281791950631, 201.7292804042469)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(150.55259302), array(554.39246167)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.40303159992743, 201.75946826849326)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(194.38780581), array(591.26491374)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.42642198482469, 201.7313614449224)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(147.58760193), array(553.43941275)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.4009030162979, 201.7613121831568)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:00,975 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:00,976 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:00,978 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:00,979 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:00,981 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:00,982 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:00,983 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:01,188 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:01,201 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        S8+wK09fvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:01,202 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:01,691 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3b319a50&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:01,692 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:02,607 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3b319a50&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:02,607 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:02,815 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3b319a50&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:02,816 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,024 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3b319a50&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,026 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,026 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,026 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,027 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,029 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,029 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,029 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,030 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,031 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,032 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,032 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,032 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,034 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,034 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,035 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,035 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,037 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,037 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,038 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,039 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,039 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11082930390039995 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,057 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,852 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,853 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:03,854 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:04,601 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:04,602 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:04,602 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:05,362 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:05,363 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:05,363 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:06,110 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:06,111 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:06,112 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:06,353 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  80.660307842 -69.452650714 80.735816161 -69.472158466 80.791402231 -69.445614065 80.715936684 -69.426130394
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:06,658 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:06,658 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:06,871 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1069, 1070) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:06,872 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:06,875 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:06,876 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 7.17%
</pre></div>
</div>
<img alt="../../../_images/28dd1ee20ead1b039fdab13bb50fb7a5fb94ce27a36b8fd3ab1b2d539546a32f.png" src="../../../_images/28dd1ee20ead1b039fdab13bb50fb7a5fb94ce27a36b8fd3ab1b2d539546a32f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 28.451313242000197
Starting 5.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.69801915, -69.44754544)&gt;
Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(250.47819928), array(389.03371324)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.46095337680683, 201.6980593948559)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(203.72919918), array(351.32263788)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.42128049989316, 201.72491113852192)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(247.40864214), array(388.16230079)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.4590319011726, 201.69994810035928)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(200.7736245), array(350.37256755)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.41906852109688, 201.72656704060736)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:29,615 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:29,616 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:29,619 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:29,621 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:29,622 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:29,623 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:29,625 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:29,825 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:29,838 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        S8+wK09fvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:29,839 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:30,307 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd495336d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:30,307 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,205 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd495336d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,206 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,400 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd495336d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,400 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,599 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd495336d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,600 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,600 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,601 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,602 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,603 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,604 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,604 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,605 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,606 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,607 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,607 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,608 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,609 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,609 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,610 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,610 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,612 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,613 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,613 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,613 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,614 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11082930390039995 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:31,632 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:32,417 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:32,418 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:32,419 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:33,161 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:33,162 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:33,162 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:33,913 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:33,914 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:33,914 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:34,657 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:34,658 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:34,658 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:34,900 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  80.660307842 -69.452650714 80.735816161 -69.472158466 80.791402231 -69.445614065 80.715936684 -69.426130394
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:35,200 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:35,201 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:35,395 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1069, 1070) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:35,396 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:35,400 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:35,400 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 1.62%
</pre></div>
</div>
<img alt="../../../_images/20aa4463a83e05de330901a504f4a0f64f274a82b02fb52620b8b91579db94b9.png" src="../../../_images/20aa4463a83e05de330901a504f4a0f64f274a82b02fb52620b8b91579db94b9.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 28.598962217999997
Starting 6.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.70685634, -69.4443469)&gt;
Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(270.41595422), array(532.5810879)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.48318148490097, 201.67877528548456)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(223.73759419), array(494.82246558)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.46004203820556, 201.71187188567248)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(267.35045533), array(531.70578858)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.48170115434127, 201.68105645027674)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(220.78866282), array(493.8695383)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.4582998761485, 201.71386890590742)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:58,064 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:58,065 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:58,067 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:58,069 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:58,070 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:58,071 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:58,072 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:58,263 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:58,276 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        S8+wK09fvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:58,277 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:58,739 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3653a690&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:58,740 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:59,643 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3653a690&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:59,643 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:59,842 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3653a690&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:43:59,843 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,054 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3653a690&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,055 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,056 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,056 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,056 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,058 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,058 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,059 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,060 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,061 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,062 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,062 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,062 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,064 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,065 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,065 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,066 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,067 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,067 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,068 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,068 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,069 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11082930390039995 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,089 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,874 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,875 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:00,875 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:01,630 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:01,631 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:01,632 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:02,387 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:02,388 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:02,389 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:03,141 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:03,142 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:03,143 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:03,379 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  80.660307842 -69.452650714 80.735816161 -69.472158466 80.791402231 -69.445614065 80.715936684 -69.426130394
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:03,677 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:03,677 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:03,875 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1069, 1070) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:03,875 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:03,880 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:03,880 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 6.04%
</pre></div>
</div>
<img alt="../../../_images/048692924c54e71760961c2a598c0ed88727d8be0d32721c906374c2a4f54d07.png" src="../../../_images/048692924c54e71760961c2a598c0ed88727d8be0d32721c906374c2a4f54d07.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 28.43476365100014
Starting 7.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.72134362, -69.44277411)&gt;
Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(373.59400746), array(671.96205316)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.5026829678264, 201.5823721169552)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(327.06989508), array(634.08704799)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.48931399865492, 201.62647553345647)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(370.53789518), array(671.08033361)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.50109189092134, 201.58495329873404)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(324.13516613), array(633.12828452)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.48809501728533, 201.62914387506436)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:26,186 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:26,187 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:26,190 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:26,191 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:26,193 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:26,194 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:26,196 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:26,404 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:26,417 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        S8+wK09fvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:26,418 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:26,910 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbcdeaff250&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:26,911 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:27,816 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbcdeaff250&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:27,816 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,021 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbcdeaff250&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,022 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,231 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbcdeaff250&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,232 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,233 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,233 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,233 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,235 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,236 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,236 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,237 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,238 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,239 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,239 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,240 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,241 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,242 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,242 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,242 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,244 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,244 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,245 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,245 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,246 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11082930390039995 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:28,264 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:29,060 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:29,062 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:29,062 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:29,815 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:29,816 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:29,816 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:30,587 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:30,588 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:30,588 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:31,340 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:31,341 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:31,341 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:31,581 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  80.660307842 -69.452650714 80.735816161 -69.472158466 80.791402231 -69.445614065 80.715936684 -69.426130394
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:31,881 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:31,882 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:32,082 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1069, 1070) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:32,083 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:32,087 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:32,087 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 8.64%
</pre></div>
</div>
<img alt="../../../_images/eb353b7ea118154b004a5731265741abfd4f4cc2302f3a50ace0543aeed81c0f.png" src="../../../_images/eb353b7ea118154b004a5731265741abfd4f4cc2302f3a50ace0543aeed81c0f.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 28.1140751989999
Starting 8.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.72825681, -69.44591877)&gt;
Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(497.07915679), array(636.56018133)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.55654052604694, 201.50798657049626)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(450.65743722), array(598.62155656)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.5514889975097, 201.5227304000734)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(494.02825067), array(635.6772768)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.55621458552167, 201.50830983444305)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(447.73086169), array(597.66099949)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.55071986429965, 201.52465749975383)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:53,676 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:53,677 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:53,680 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:53,681 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:53,683 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:53,684 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:53,685 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:53,886 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:53,899 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        S8+wK09fvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:53,900 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:54,378 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3b23e890&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:54,379 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,283 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3b23e890&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,284 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,481 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3b23e890&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,481 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,681 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3b23e890&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,682 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,683 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,684 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,684 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,686 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,686 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,686 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,687 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,689 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,689 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,690 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,690 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,692 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,692 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,692 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,693 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,695 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,695 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,696 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,696 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,696 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11082930390039995 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:55,718 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:56,535 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:56,536 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:56,537 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:57,290 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:57,291 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:57,291 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:58,048 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:58,049 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:58,050 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:58,793 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:58,794 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:58,794 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:59,033 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  80.660307842 -69.452650714 80.735816161 -69.472158466 80.791402231 -69.445614065 80.715936684 -69.426130394
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:59,333 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:59,334 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:59,526 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1069, 1070) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:59,526 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:59,530 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:44:59,530 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 8.31%
</pre></div>
</div>
<img alt="../../../_images/e9bed7999b7dbbdf7e02f925b8d056b8da93742ebb9f0cb549cde099c3abd71d.png" src="../../../_images/e9bed7999b7dbbdf7e02f925b8d056b8da93742ebb9f0cb549cde099c3abd71d.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 27.752272253
Starting 9.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.73139798, -69.44867697)&gt;
Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(578.521951), array(585.52745358)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.5640866023399, 201.51164222525637)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(532.1182843), array(547.56588162)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.5653042561024, 201.50931218587124)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(575.47051017), array(584.6454609)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.56415771606822, 201.51111219755308)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(529.19263402), array(546.60566468)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.5653423401724, 201.5092672199106)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:21,341 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:21,342 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:21,345 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:21,347 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:21,348 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:21,349 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:21,351 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:21,549 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:21,562 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        S8+wK09fvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:21,562 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:22,040 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3ae18f50&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:22,041 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:22,952 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3ae18f50&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:22,953 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,153 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3ae18f50&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,154 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,349 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd3ae18f50&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,350 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,350 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,351 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,351 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,353 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,353 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,354 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,354 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,356 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,356 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,357 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,357 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,359 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,359 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,360 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,360 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,362 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,362 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,363 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,363 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,364 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11082930390039995 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:23,384 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:24,170 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:24,171 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:24,171 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:24,917 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:24,918 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:24,918 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:25,674 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:25,675 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:25,676 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:26,423 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:26,424 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:26,424 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:26,661 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  80.660307842 -69.452650714 80.735816161 -69.472158466 80.791402231 -69.445614065 80.715936684 -69.426130394
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:26,958 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:26,959 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:27,160 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1069, 1070) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:27,160 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:27,164 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:27,164 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 9.78%
</pre></div>
</div>
<img alt="../../../_images/8eb4a1add6ce73578e7c66c7621b91ca7478e2c48b3ba65aac76263e4fc268c5.png" src="../../../_images/8eb4a1add6ce73578e7c66c7621b91ca7478e2c48b3ba65aac76263e4fc268c5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 27.36825168700011
Starting 10.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.72803877, -69.45133743)&gt;
Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(598.56497101), array(492.7352119)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.55632224320937, 201.52934645590085)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(552.20348893), array(454.82466592)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.55531343876754, 201.52866001727517)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(595.51406166), array(491.85750236)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.55655193667363, 201.52882781672005)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(549.27809811), array(453.86828958)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.55539067072684, 201.528499803373)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:48,797 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:48,798 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:48,801 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:48,802 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:48,804 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:48,805 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:48,807 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:49,008 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:49,021 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        S8+wK09fvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:49,022 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:49,507 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd368ae1d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:49,507 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,408 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd368ae1d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,409 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,610 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd368ae1d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,611 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,807 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd368ae1d0&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,807 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,808 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,808 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,809 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,811 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,811 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,812 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,812 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,814 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,814 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,815 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,815 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,817 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,817 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,817 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,818 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,819 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,820 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,820 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,820 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,821 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11082930390039995 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:50,839 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:51,629 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:51,630 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:51,631 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:52,375 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:52,376 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:52,377 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:53,122 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:53,123 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:53,124 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:53,867 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:53,868 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:53,868 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:54,116 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  80.660307842 -69.452650714 80.735816161 -69.472158466 80.791402231 -69.445614065 80.715936684 -69.426130394
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:54,417 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:54,418 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:54,615 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1069, 1070) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:54,616 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:54,620 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:45:54,620 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 4.16%
</pre></div>
</div>
<img alt="../../../_images/b08f4251eda4b363252ae3048b2f933d7323362278065720075b013ff22dbf41.png" src="../../../_images/b08f4251eda4b363252ae3048b2f933d7323362278065720075b013ff22dbf41.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 27.479921640000157
Starting 11.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.73746115, -69.44890936)&gt;
Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(638.6377912), array(620.70166505)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.5642192535976, 201.52917460178813)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(592.17544088), array(582.67409601)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.56371672425522, 201.51489308455942)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(635.58281301), array(619.81693016)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.56411972189602, 201.5280179079131)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(589.24767918), array(581.71091384)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.5638041632133, 201.5142355439668)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:16,110 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:16,111 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:16,114 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:16,115 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:16,117 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:16,119 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:16,120 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:16,330 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:16,344 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        S8+wK09fvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:16,345 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:16,830 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbcddfc8850&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:16,831 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:17,738 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbcddfc8850&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:17,739 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:17,948 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbcddfc8850&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:17,949 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,161 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbcddfc8850&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,162 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,163 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,163 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,164 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,165 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,165 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,166 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,166 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,168 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,168 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,168 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,169 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,170 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,171 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,171 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,172 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,173 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,174 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,175 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,175 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,175 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11082930390039995 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,193 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,989 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,991 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:18,991 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:19,753 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:19,754 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:19,755 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:20,517 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:20,519 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:20,519 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:21,267 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:21,269 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:21,269 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:21,510 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  80.660307842 -69.452650714 80.735816161 -69.472158466 80.791402231 -69.445614065 80.715936684 -69.426130394
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:21,816 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:21,816 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:22,030 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1069, 1070) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:22,031 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:22,037 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:22,038 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 2.83%
</pre></div>
</div>
<img alt="../../../_images/97763f51eb94d2ba10d6d0f4ae7645a294261eebb3a8b949ec66f428067ad5ed.png" src="../../../_images/97763f51eb94d2ba10d6d0f4ae7645a294261eebb3a8b949ec66f428067ad5ed.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 27.464163815999882
Starting 12.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.74187347, -69.44817923)&gt;
Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(665.28250869), array(669.9804073)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.57008276659948, 201.54576814039473)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(618.76313027), array(631.90069339)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.56412107740027, 201.52297642823274)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(662.22483906), array(669.09280989)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.56972254047167, 201.54452557234018)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(615.83342367), array(630.93459203)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.56400499580542, 201.52193437905086)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:43,513 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:43,514 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:43,516 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:43,517 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:43,519 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:43,520 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:43,521 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:43,725 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:43,738 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        S8+wK09fvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:43,739 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:44,224 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd84c9a850&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:44,225 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,128 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd84c9a850&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,129 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,334 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd84c9a850&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,335 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,538 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbd84c9a850&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,539 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,539 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,539 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,540 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,542 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,542 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,542 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,543 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,545 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,545 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,546 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,546 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,548 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,548 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,549 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,549 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,551 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,552 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,552 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,552 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,553 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11082930390039995 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:45,571 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:46,357 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:46,359 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:46,359 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:47,103 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:47,104 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:47,104 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:47,856 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:47,858 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:47,858 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:48,605 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:48,606 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:48,606 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:48,847 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  80.660307842 -69.452650714 80.735816161 -69.472158466 80.791402231 -69.445614065 80.715936684 -69.426130394
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:49,146 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:49,147 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:49,347 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1069, 1070) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:49,348 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:49,352 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:46:49,352 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 58.59%
</pre></div>
</div>
<img alt="../../../_images/817ada861ad7bfcce2df78bd4e70718679a72a53e62af0e9ea28ef12bf390bf6.png" src="../../../_images/817ada861ad7bfcce2df78bd4e70718679a72a53e62af0e9ea28ef12bf390bf6.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 27.236165430000028
Starting 13.0  of 13 : &lt;SkyCoord (ICRS): (ra, dec) in deg
    (80.74189746, -69.44834474)&gt;
Setting up sim to match ./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>MAST OPD query around UTC: 2022-04-13T03:08:10.578
                        MJD: 59682.13067798611

OPD immediately preceding the given datetime:
	URI:	 mast:JWST/product/R2022041201-NRCA3_FP1-2.fits
	Date (MJD):	 59681.7791
	Delta time:	 -0.3516 days

OPD immediately following the given datetime:
	URI:	 mast:JWST/product/R2022041301-NRCA3_FP1-1.fits
	Date (MJD):	 59682.8401
	Delta time:	 0.7094 days
User requested choosing OPD time closest in time to 2022-04-13T03:08:10.578, which is R2022041201-NRCA3_FP1-2.fits, delta time -0.352 days
Importing and format-converting OPD from ./webbpsf-data/webbpsf-data/MAST_JWST_WSS_OPDs/R2022041201-NRCA3_FP1-2.fits
Backing out SI WFE and OTE field dependence at the WF sensing field point
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Configured simulation instrument for:
    Instrument: MIRI
    Filter: F560W
    Detector: MIRIM
    Apername: MIRIM_FULL
    Det. Pos.: (693, 512) 
    Image plane mask: None
    Pupil plane mask: None
    

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(668.66091354), array(665.79422596)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.5699569719903, 201.54634877851865)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(622.14131818), array(627.7148714)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.56415520563206, 201.52397148875409)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(665.60311112), array(664.90677443)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.56950199341014, 201.54492321615234)

Running instrument: MIRI, filter: F560W
  Running detector: MIRIM
    Position 1/1: (array(619.21151073), array(626.74888407)) pixels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Position 1/1 centroid: (201.56405184638245, 201.5229082226684)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:10,736 - stpipe.Image3Pipeline - INFO - Image3Pipeline instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:10,738 - stpipe.Image3Pipeline.assign_mtwcs - INFO - AssignMTWcsStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:10,740 - stpipe.Image3Pipeline.tweakreg - INFO - TweakRegStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:10,741 - stpipe.Image3Pipeline.skymatch - INFO - SkyMatchStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:10,743 - stpipe.Image3Pipeline.outlier_detection - INFO - OutlierDetectionStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:10,744 - stpipe.Image3Pipeline.resample - INFO - ResampleStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:10,745 - stpipe.Image3Pipeline.source_catalog - INFO - SourceCatalogStep instance created.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:10,944 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline running with args (&#39;./temp_psf_dir/cal_data_asn.json&#39;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:10,957 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline parameters are:
  pre_hooks: []
  post_hooks: []
  output_file: None
  output_dir: ./temp_psf_dir
  output_ext: .fits
  output_use_model: False
  output_use_index: True
  save_results: True
  skip: False
  suffix: None
  search_output_file: True
  input_dir: &#39;&#39;
  in_memory: True
  steps:
    assign_mtwcs:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: False
      suffix: assign_mtwcs
      search_output_file: True
      input_dir: &#39;&#39;
    tweakreg:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: True
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      save_catalogs: False
      use_custom_catalogs: False
      catalog_format: ecsv
      catfile: &#39;&#39;
      starfinder: iraf
      snr_threshold: 10.0
      bkg_boxsize: 400
      kernel_fwhm: 2.5
      minsep_fwhm: 0.0
      sigma_radius: 1.5
      sharplo: 0.5
      sharphi: 2.0
      roundlo: 0.0
      roundhi: 0.2
      brightest: 200
      peakmax: None
      npixels: 10
      connectivity: &#39;8&#39;
      nlevels: 32
      contrast: 0.001
      multithresh_mode: exponential
      localbkg_width: 0
      apermask_method: correct
      kron_params: None
      enforce_user_order: False
      expand_refcat: False
      minobj: 15
      fitgeometry: rshift
      nclip: 3
      sigma: 3.0
      searchrad: 2.0
      use2dhist: True
      separation: 1.0
      tolerance: 0.7
      xoffset: 0.0
      yoffset: 0.0
      abs_refcat: &#39;&#39;
      save_abs_catalog: False
      abs_minobj: 15
      abs_fitgeometry: rshift
      abs_nclip: 3
      abs_sigma: 3.0
      abs_searchrad: 6.0
      abs_use2dhist: True
      abs_separation: 1.0
      abs_tolerance: 0.7
      sip_approx: True
      sip_max_pix_error: 0.01
      sip_degree: None
      sip_max_inv_pix_error: 0.01
      sip_inv_degree: None
      sip_npoints: 12
      in_memory: True
    skymatch:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      skymethod: match
      match_down: True
      subtract: False
      stepsize: None
      skystat: mode
      dqbits: ~DO_NOT_USE+NON_SCIENCE
      lower: None
      upper: None
      nclip: 5
      lsigma: 4.0
      usigma: 4.0
      binwidth: 0.1
      in_memory: True
    outlier_detection:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: None
      search_output_file: False
      input_dir: &#39;&#39;
      weight_type: ivm
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      maskpt: 0.7
      snr: 5.0 4.0
      scale: 1.2 0.7
      backg: 0.0
      kernel_size: 7 7
      threshold_percent: 99.8
      rolling_window_width: 25
      ifu_second_check: False
      save_intermediate_results: False
      resample_data: True
      good_bits: ~DO_NOT_USE
      in_memory: False
    resample:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: False
      suffix: None
      search_output_file: True
      input_dir: &#39;&#39;
      pixfrac: 1.0
      kernel: square
      fillval: NAN
      weight_type: ivm
      output_shape: None
      crpix: None
      crval: None
      rotation: None
      pixel_scale_ratio: 1.0
      pixel_scale: !!python/object/apply:numpy.core.multiarray.scalar
      - !!python/object/apply:numpy.dtype
        args:
        - f8
        - False
        - True
        state: !!python/tuple
        - 3
        - &lt;
        - None
        - None
        - None
        - -1
        - -1
        - 0
      - !!binary |
        S8+wK09fvD8=
      output_wcs: &#39;&#39;
      single: False
      blendheaders: True
      in_memory: True
    source_catalog:
      pre_hooks: []
      post_hooks: []
      output_file: None
      output_dir: None
      output_ext: .fits
      output_use_model: False
      output_use_index: True
      save_results: False
      skip: True
      suffix: cat
      search_output_file: True
      input_dir: &#39;&#39;
      bkg_boxsize: 1000
      kernel_fwhm: 2.0
      snr_threshold: 3.0
      npixels: 25
      deblend: False
      aperture_ee1: 30
      aperture_ee2: 50
      aperture_ee3: 70
      ci1_star_threshold: 2.0
      ci2_star_threshold: 1.8
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:10,958 - stpipe.Image3Pipeline - INFO - Starting calwebb_image3 ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:11,441 - stpipe.Image3Pipeline.tweakreg - INFO - Step tweakreg running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbcde430290&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:11,442 - stpipe.Image3Pipeline.tweakreg - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,342 - stpipe.Image3Pipeline.skymatch - INFO - Step skymatch running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbcde430290&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,343 - stpipe.Image3Pipeline.skymatch - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,553 - stpipe.Image3Pipeline.outlier_detection - INFO - Step outlier_detection running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbcde430290&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,554 - stpipe.Image3Pipeline.outlier_detection - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,761 - stpipe.Image3Pipeline.resample - INFO - Step resample running with args (&lt;jwst.datamodels.library.ModelLibrary object at 0x7fbcde430290&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,763 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,764 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,764 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,765 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,766 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,767 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,767 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,767 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,769 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,769 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,770 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,770 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,772 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;err&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,772 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_rnoise&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,772 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_poisson&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,773 - stpipe.Image3Pipeline.resample - WARNING - Mismatched data shapes; skipping invalid data updates for extension &#39;var_flat&#39;
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,775 - stpipe.Image3Pipeline.resample - INFO - Driz parameter kernel: square
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,775 - stpipe.Image3Pipeline.resample - INFO - Driz parameter pixfrac: 1.0
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,775 - stpipe.Image3Pipeline.resample - INFO - Driz parameter fillval: NAN
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,776 - stpipe.Image3Pipeline.resample - INFO - Driz parameter weight_type: ivm
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,776 - stpipe.Image3Pipeline.resample - INFO - Output pixel scale: 0.11082930390039995 arcsec.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:12,794 - stpipe.Image3Pipeline.resample - INFO - Resampling science and variance data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:13,581 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:13,582 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:13,583 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00004_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:14,331 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:14,333 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:14,333 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00003_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:15,086 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:15,088 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:15,089 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00002_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:15,844 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_rnoise&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:15,845 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_poisson&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:15,846 - stpipe.Image3Pipeline.resample - WARNING - Data shape mismatch for &#39;var_flat&#39; for model &#39;jw01171004001_02101_00001_mirimage_cal.fits&#39;. Skipping ...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:16,085 - stpipe.Image3Pipeline.resample - INFO - Update S_REGION to POLYGON ICRS  80.660307842 -69.452650714 80.735816161 -69.472158466 80.791402231 -69.445614065 80.715936684 -69.426130394
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:16,386 - stpipe.Image3Pipeline.resample - INFO - Saved model in ./temp_psf_dir/temp_psf_cals_i2d.fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:16,386 - stpipe.Image3Pipeline.resample - INFO - Step resample done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:16,586 - stpipe.Image3Pipeline.source_catalog - INFO - Step source_catalog running with args (&lt;ImageModel(1069, 1070) from temp_psf_cals_i2d.fits&gt;,).
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:16,587 - stpipe.Image3Pipeline.source_catalog - INFO - Step skipped.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:16,591 - stpipe.Image3Pipeline - INFO - Step Image3Pipeline done
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2025-01-10 19:47:16,591 - stpipe - INFO - Results used jwst version: 1.17.1
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Finished PSF psf_photometry with median residuals of 11.89%
</pre></div>
</div>
<img alt="../../../_images/25ce9f7797a53b4ffbdac08a1224ea3b671fe7604983769928b488b704d8df33.png" src="../../../_images/25ce9f7797a53b4ffbdac08a1224ea3b671fe7604983769928b488b704d8df33.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Elapsed Time for Photometry: 27.28789321699992
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lvl2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;./mast/01171/jw01171004001_02101_00004_mirimage_cal.fits&#39;,
 &#39;./mast/01171/jw01171004001_02101_00003_mirimage_cal.fits&#39;,
 &#39;./mast/01171/jw01171004001_02101_00002_mirimage_cal.fits&#39;,
 &#39;./mast/01171/jw01171004001_02101_00001_mirimage_cal.fits&#39;]
</pre></div>
</div>
</div>
</div>
<p><strong>Important Note</strong>: When not to use. Due to the sensitivity of the space_phot parameters, this tool is not meant to be used for a large sample of stars (i.e., Section 5 below). If a user would like to use space_phot on more than one source, they should carefully construct a table of parameters that are carefully refined for each source.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ra</th>
      <th>dec</th>
      <th>mag</th>
      <th>magerr</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>80.687522</td>
      <td>-69.445225</td>
      <td>18.866232</td>
      <td>0.004060</td>
    </tr>
    <tr>
      <th>1</th>
      <td>80.705201</td>
      <td>-69.437531</td>
      <td>19.530557</td>
      <td>0.003212</td>
    </tr>
    <tr>
      <th>2</th>
      <td>80.700761</td>
      <td>-69.443231</td>
      <td>19.597094</td>
      <td>0.003080</td>
    </tr>
    <tr>
      <th>3</th>
      <td>80.704803</td>
      <td>-69.441535</td>
      <td>19.667044</td>
      <td>0.003331</td>
    </tr>
    <tr>
      <th>4</th>
      <td>80.698027</td>
      <td>-69.447544</td>
      <td>19.916835</td>
      <td>0.005623</td>
    </tr>
    <tr>
      <th>5</th>
      <td>80.706849</td>
      <td>-69.444348</td>
      <td>18.836841</td>
      <td>0.002551</td>
    </tr>
    <tr>
      <th>6</th>
      <td>80.721346</td>
      <td>-69.442774</td>
      <td>19.485592</td>
      <td>0.003210</td>
    </tr>
    <tr>
      <th>7</th>
      <td>80.728253</td>
      <td>-69.445914</td>
      <td>19.429921</td>
      <td>0.002779</td>
    </tr>
    <tr>
      <th>8</th>
      <td>80.731407</td>
      <td>-69.448674</td>
      <td>18.320808</td>
      <td>0.001761</td>
    </tr>
    <tr>
      <th>9</th>
      <td>80.728019</td>
      <td>-69.451341</td>
      <td>18.199165</td>
      <td>0.001623</td>
    </tr>
    <tr>
      <th>10</th>
      <td>80.737454</td>
      <td>-69.448911</td>
      <td>18.756751</td>
      <td>0.002089</td>
    </tr>
    <tr>
      <th>11</th>
      <td>80.741873</td>
      <td>-69.448183</td>
      <td>19.549786</td>
      <td>0.003122</td>
    </tr>
    <tr>
      <th>12</th>
      <td>80.741879</td>
      <td>-69.448346</td>
      <td>18.084723</td>
      <td>0.001668</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<hr style="border:1px solid gray"> </hr><a class="reference internal image-reference" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></a>
</section>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/MIRI/psf_photometry"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#table-of-contents">Table of contents</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-introduction-a-class-anchor-id-intro-a">1.<font color="white">-</font>Introduction <a class="anchor" id="intro"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-setup-webbpsf-and-synphot-directories-a-class-anchor-id-webbpsf-a">1.1<font color="white">-</font>Setup WebbPSF and Synphot Directories<a class="anchor" id="webbpsf"></a></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-python-imports-a-class-anchor-id-py-imports-a">1.2<font color="white">-</font>Python Imports<a class="anchor" id="py_imports"></a></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-download-data-a-class-anchor-id-data-a">2.<font color="white">-</font>Download Data<a class="anchor" id="data"></a></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-bright-single-object-a-class-anchor-id-bso-a">3.<font color="white">-</font>Bright, Single Object<a class="anchor" id="bso"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-multiple-level2-files-a-class-anchor-id-bso2-a">3.1<font color="white">-</font>Multiple, Level2 Files<a class="anchor" id="bso2"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#notes-on-the-psf-fitting-in-space-phot-br">Notes on the PSF Fitting in Space_Phot: <br/></a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-single-level3-mosaicked-file-a-class-anchor-id-bso3-a">3.2<font color="white">-</font>Single, Level3 Mosaicked File<a class="anchor" id="bso3"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Notes on the PSF Fitting in Space_Phot: <br/></a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#good-agreement-between-level2-and-level3-results">Good agreement between Level2 and level3 results!</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-faint-upper-limit-single-object-a-class-anchor-id-fso-a">4.<font color="white">-</font>Faint/Upper Limit, Single Object<a class="anchor" id="fso"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-multiple-level2-files-a-class-anchor-id-fso2-a">4.1<font color="white">-</font>Multiple, Level2 Files<a class="anchor" id="fso2"></a></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-single-level3-mosaicked-file-a-class-anchor-id-fso3-a">4.2<font color="white">-</font>Single, Level3 Mosaicked File<a class="anchor" id="fso3"></a></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#note-you-can-go-significantly-deeper-with-the-level3-combined-data-product">Note you can go significantly deeper with the Level3 combined data product</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-stellar-field-lmc-a-class-anchor-id-lmc-a">5.<font color="white">-</font>Stellar Field (LMC)<a class="anchor" id="lmc"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-this-case-we-are-going-to-do-the-same-steps-as-in-section-3-but-for-multiple-stars-the-purpose-is-to-illustrate-the-workflow-and-runtime-for-using-space-phot-on-a-large-number-of-stars-we-suggest-that-space-phot-may-be-less-optimal-for-large-numbers-of-bright-stars-other-programs-such-as-dolphot-or-photutils-may-be-better-suited-for-this-use-case-the-primary-advantage-to-space-phot-is-on-faint-single-sources-but-it-can-be-extended-to-a-larger-number-if-desired">In this case, we are going to do the same steps as in Section 3, but for multiple stars. The purpose is to illustrate the workflow and runtime for using space_phot on a large number of stars. We suggest that space_phot may be less optimal for large numbers of bright stars. Other programs, such as DOLPHOT or Photutils, may be better suited for this use case. The primary advantage to space_phot is on faint, single sources. But it can be extended to a larger number if desired.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-multiple-level2-files-a-class-anchor-id-lmc2-a">5.1<font color="white">-</font>Multiple, Level2 Files<a class="anchor" id="lmc2"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#now-do-the-same-thing-for-a-larger-group-of-stars-and-test-for-speed">Now do the same thing for a larger group of stars and test for speed</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#font-color-white-font-single-level3-mosaicked-file-a-class-anchor-id-lmc3-a">5.2<font color="white">-</font>Single, Level3 Mosaicked File<a class="anchor" id="lmc3"></a></a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#readers-should-refer-to-all-diagnostics-discussed-above-in-general-this-loop-shows-the-difficulty-in-doing-psf-photometry-on-a-wide-variety-of-stars-brightness-distribution-on-the-detector-etc-without-visual-inspection-especially-when-dealing-with-low-snr-sources-this-is-true-for-all-photometry-packages-users-should-inspect-the-associated-metrics-and-consider-optimizing-the-parameters-for-specific-stars-of-interest-nonetheless-the-success-of-the-fits-can-always-be-quantified-in-with-the-associated-error-bars">Readers should refer to all diagnostics discussed above. In general, this loop shows the difficulty in doing PSF photometry on a wide variety of stars (brightness, distribution on the detector, etc) without visual inspection. Especially when dealing with low SNR sources.This is true for all photometry packages. Users should inspect the associated metrics and consider optimizing the parameters for specific stars of interest. Nonetheless, the success of the fits can always be quantified in with the associated error bars.</a></li>
</ul>
</li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>