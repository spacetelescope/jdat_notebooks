
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>BOTS Time Series Observations &#8212; STScI JDAT Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css?v=b44a18d9" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-D46G4HKJY3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-D46G4HKJY3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/NIRSpec/transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Redshift and Template Fitting" href="../galaxy_redshift/redshift_fitting.html" />
    <link rel="prev" title="NIRSpec MOS Slits to Sky" href="../mos_slits_to_sky/NIRSpec_MOS_slits_to_sky.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="STScI JDAT Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="STScI JDAT Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">General</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebook_development_workflow.html">Notebook Development Workflow</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/submitting_notebooks.html">Submitting Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/requirements.html">Requirements file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebooks.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/data_files.html">Data Files</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">GitHub Guidelines</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_setup.html">GitHub Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_workflow.html">GitHub Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_pr.html">GitHub PR</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">JDAViz Demo Notebooks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../jdaviz_demo/notebooks/Cubeviz.html">Cubeviz with NIRSpec data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jdaviz_demo/notebooks/Imviz.html">Jdaviz Imviz Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jdaviz_demo/notebooks/Specviz_Specviz2d.html">Specviz and Specviz2D Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jdaviz_demo/notebooks/specreduce_extraction.html">Specreduce Demo</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Cross-Instrument</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/asdf_example/asdf_example.html">ASDF Example</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/background_estimation_imaging/Imaging_Sky_Background_Estimation.html">Complex 2D Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/composite_model_fitting/specfit_demo_3.html">Composite Model Spectral Fitting</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/rgb_imviz/imviz_rgb_carina.html">RGB images with Imviz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">Specviz Simple Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/update_pure_parallel_wcs/NIRISS_correct_pure_parallel_WCS.html">Improving Accuracy of WCS of Pure Parallel Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/photometry_extragalactic/imviz.html">Photometry with JWST - Imviz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/photometry_extragalactic/photutils_example.html">Photometry of a JWST/NIRCam extragalactic field with Photutils</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/stpsf_examples/stpsf_examples.html">JWST PSFs Using Wavefronts Measured On Orbit</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MIRI</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">MRS Mstar - Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">IFU of YSOs in LMC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/MIRI_LRS_spectral_extraction/miri_lrs_advanced_extraction.html">LRS Optimal Spectral Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/psf_photometry/miri_1028.html">MIRI PSF Photometry With Space_Phot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/psf_photometry/miri_1028_photutils.html">MIRI PSF Photometry with Photutils</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../MIRI/psf_photometry/miri_photutils.html">MIRI PSF Photometry with Photutils</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../MIRI/psf_photometry/miri_spacephot.html">MIRI PSF Photometry With Space_Phot</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRCam</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/aperture_photometry/NIRCam_Aperture_Photometry_Example.html">Point Source Aperture Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_photometry/NIRCam_multiband_photometry.html">Extended Aperture Photometry</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">Cross-Filter PSF Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/psf_photometry/NIRCam_PSF_Photometry_Example.html">PSF Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_wisp_subtraction/nircam_wisp_subtraction.html">NIRCam Wisp Removal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_claw_detection/nircam_claw_detection.html">NIRCam Claw Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_WFSS_Box_extraction/BoxExtraction_using_Grismconf_CRDS.html">WFSS Box Extraction Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_WFSS_simulating_spectra/Simulating_WFSS_spectra_CRDS.html">WFSS Spectra Simulation for Contamination Correction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/psf_photometry_basics/psf_photometry_basics.html">PSF Photometry Basics with Photutils</a></li>









<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/psf_photometry_with_space_phot/nircam_spacephot.html">NIRCam PSF Photometry With Space_Phot</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRISS</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/00_Optimal_extraction.html">WFSS Spectra - Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/01_Combine_and_normalize_1D_spectra.html">WFSS Spectra - Combine and Normalize 1D Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/02_Cross_correlation_template.html">WFSS Spectra - Cross-Correlation Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map.html">WFSS Spectra - Emission Line Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/00_niriss_mast_query_data_setup.html">NIRISS MAST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/01_niriss_wfss_image2_image3.html">Direct imaging for WFSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/02_niriss_wfss_spec2.html">Spec2 pipeline for WFSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRISS/NIRISS_WFSS_advanced/extra_niriss_individual_steps.html">Running Individual Pipline Steps</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRSpec</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html">IFU Cube Fitting</a></li>

<li class="toctree-l1"><a class="reference internal" href="../cube_fitting/cube_fitting.html">IFU Cube Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ifu_optimal/ifu_optimal.html">IFU Optimal Spectral Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../optimal_extraction/Spectral_Extraction-static.html">MOS Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mos_spectroscopy_advanced/MOSspec_advanced.html">MOS Spectroscopy of Extragalactic Field</a></li>

<li class="toctree-l1"><a class="reference internal" href="../mos_master_background/Master_Background_MOS_Demo.html">Master Background Subtraction for Multi-Object Spectroscopy (MOS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../msa_metafile/NIRSpec_MOS_MSA_metafile.html">NIRSpec MOS MSA Metafile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../mos_slits_to_sky/NIRSpec_MOS_slits_to_sky.html">NIRSpec MOS Slits to Sky</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">BOTS Time Series Observations</a></li>








<li class="toctree-l1"><a class="reference internal" href="../galaxy_redshift/redshift_fitting.html">Redshift and Template Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NIRSpec_NSClean/FS_NSClean_example.html">FS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NIRSpec_NSClean/IFU_NSClean_example.html">IFU Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NIRSpec_NSClean/MOS_NSClean_example.html">MOS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NIRSpec_NSClean/BOTS_NSClean_example.html">BOTS Products with NSClean</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/NIRSpec/transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/NIRSpec/transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>BOTS Time Series Observations</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">BOTS Time Series Observations</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-packages">Load packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-parameters">Setup Parameters</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-load-nirspec-data">Download and Load NIRSpec data</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-2d-spectral-data">Visualizing the 2D spectral data</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-1d-spectra-from-2d-array-of-images">Extract 1D spectra from 2D array of images</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-1d-spectral-data">Visualizing the 1D spectral data</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-orbital-phase-and-a-separate-fine-grid-model-used-for-plotting-purposes">Calculate Orbital Phase and a separate fine grid model used for plotting purposes</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-systematic-drift-on-the-detector">Dealing with Systematic Drift On the Detector</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-arrays-of-the-vectors-used-for-detrending">Create arrays of the vectors used for detrending.</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#transit-and-limb-darkening-model-functions">Transit and Limb-Darkening Model Functions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#now-define-the-transit-model-function">Now define the transit model function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#now-define-the-function-to-generate-the-transit-light-curve-and-compare-it-to-the-data">Now define the function to generate the transit light curve and compare it to the data</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-transit-light-curves">FIT Transit Light Curves</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-wavelengths-to-fit-over">Setup Wavelengths to fit over</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loop-over-wavelength-bins-fitting-each-lightcurve">Loop Over Wavelength Bins Fitting Each Lightcurve</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-this-step-takes-considerable-time-to-complete-20-min-few-minutes-bin">Note this step takes considerable time to complete (~20 min, few minutes/bin)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-measured-exoplanet-transmission-spectrum-vs-injected">Plot Measured Exoplanet Transmission Spectrum vs Injected</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="bots-time-series-observations">
<h1>BOTS Time Series Observations<a class="headerlink" href="#bots-time-series-observations" title="Link to this heading">#</a></h1>
<p><strong>Use case:</strong> Bright Object Time Series; extracting exoplanet spectra.<br>
<strong>Data:</strong> JWST simulated NIRSpec data from ground-based campaign; GJ436b spectra from the Goyal et al. (2018).<br>
<strong>Tools:</strong>  scikit, lmfit, scipy, matplotlip, astropy, pandas.<br>
<strong>Cross-intrument:</strong> . <br>
<strong>Documentation:</strong> This notebook is part of a STScIâ€™s larger <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-post-pipeline-data-analysis">post-pipeline Data Analysis Tools Ecosystem</a>.<br>
<strong>Author:</strong> David K. Sing (dsing&#64;jhu.edu)<br>
<strong>Last updated:</strong> 2 July 2020</p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This notebook uses time series JWST NIRSpec data taken during a ground-based campaign to illustrate extracting exoplanet spectra from time-series observations.</p>
<p>The data are derived from the ISIM-CV3, the cryovacuum campaign of the JWST Integrated Science Instrument Module (ISIM), that took place at Goddard Space Flight Center during the winter 2015-2016 (Kimble et al. 2016). The data can be found at https://www.cosmos.esa.int/web/jwst-nirspec/test-data, and detailed and insightful report of the data by G. Giardino, S. Birkmann, P. Ferruit, B. Dorner, B. Rauscher can be found here: ftp://ftp.cosmos.esa.int/jwstlib/ReleasedCV3dataTimeSeries/CV3_TimeSeries_PRM.tgz</p>
<p>This NIRSpec time series dataset has had a transit light curve injected at the pixel-level, which closely mimics a bright object time series (BOTS) observation of a transiting exoplanet. In this case, a GJ436b spectra from the
<strong><a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2018MNRAS.474.5158G/">Goyal et al. (2018)</a></strong>
exoplanet grid was selected (clear atmosphere at solar metallicity).  With an actual NIRSpec dataset, the noise properties of the detector, jitter, and the effects on extracting exoplanet spectra from time-series observations can more accurately simulated.</p>
<p>Broadly the aim of this notebook is to work with these time series observations to:</p>
<ol class="arabic simple">
<li><p>Extract 1D spectra from the 2D spectral images.</p></li>
<li><p>Define a time series model to fit to the wavelength dependent transit light curve.</p></li>
<li><p>Fit each time series wavelength bin of the 1D spectra, measuring the desired quantity <span class="math notranslate nohighlight">\(R_{pl}(\lambda)/R_{star}\)</span>.</p></li>
<li><p>Produce a measured transmission spectrum that can then be compared to models.</p></li>
</ol>
<p>The example outputs the fit light curves for each spectral bin, along with fitting statistics.</p>
</section>
<section id="load-packages">
<h2>Load packages<a class="headerlink" href="#load-packages" title="Link to this heading">#</a></h2>
<p>This notebook uses packages (matplotlib, astropy, scipy, glob, lmfit, pickle, os, sklearn) which can all be installed in a standard fashion through pip.</p>
<p>Several routines to calculate limb-darkening and a transit model were extracted from ExoTiC-ISm
(<strong><a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2020JOSS....5.2281L/">Laginja &amp; Wakeford 2020</a></strong> ;
https://github.com/hrwakeford/ExoTiC-ISM), and slightly adapted. The full set of stellar models used for the limb-darkening calculation can also be downloaded from ExoTiC-ISM, as this notebook only downloads and loads the single stellar model used to generate the limb darkening.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.ticker</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ticker</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">matplotlib.backends.backend_pdf</span><span class="w"> </span><span class="kn">import</span> <span class="n">PdfPages</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.utils.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">download_file</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.table</span><span class="w"> </span><span class="kn">import</span> <span class="n">Table</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fits</span><span class="p">,</span> <span class="n">ascii</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.modeling.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">custom_model</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.modeling.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="n">LevMarLSQFitter</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">interp1d</span><span class="p">,</span> <span class="n">splev</span><span class="p">,</span> <span class="n">splrep</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">readsav</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy</span><span class="w"> </span><span class="kn">import</span> <span class="n">stats</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">glob</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">lmfit</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pickle</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">os</span><span class="w"> </span><span class="kn">import</span> <span class="n">path</span><span class="p">,</span> <span class="n">mkdir</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">sklearn.linear_model</span><span class="w"> </span><span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">shutil</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="setup-parameters">
<h2>Setup Parameters<a class="headerlink" href="#setup-parameters" title="Link to this heading">#</a></h2>
<p>Parameters of the fit include directories where the data and limb darkening stellar models are held, along with properties of the planet and star. The stellar and planet values that have been entered here (modeled after GJ436) are the same as was used to model the injected transit.  Note, the 4500K stellar model used to inject the transit was hotter than GJ436A.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># SETUP  ----------------------------------------------</span>
<span class="c1"># Setup directories</span>
<span class="n">save_directory</span> <span class="o">=</span> <span class="s1">&#39;./notebookrun2/&#39;</span>          <span class="c1"># Local directory to save files to</span>
<span class="n">data_directory</span> <span class="o">=</span> <span class="s1">&#39;./&#39;</span>                       <span class="c1"># Local data to work with fits files if desired</span>

<span class="c1"># Setup Detector Properties &amp; Rednoise measurement timescale </span>
<span class="n">gain</span> <span class="o">=</span> <span class="mf">1.0</span>   <span class="c1"># 2D spectra has already converted to counts, gain of detector is 1.0</span>
<span class="n">binmeasure</span> <span class="o">=</span> <span class="mi">256</span>   <span class="c1"># Binning technique to measure rednoise, choose bin size to evaluate sigma_r</span>
<span class="n">number_of_images</span> <span class="o">=</span> <span class="mi">8192</span>  <span class="c1"># Number of images in the dataset</span>

<span class="c1"># Setup Planet Properties</span>
<span class="n">grating</span> <span class="o">=</span> <span class="s1">&#39;NIRSpecPrism&#39;</span>
<span class="n">ld_model</span> <span class="o">=</span> <span class="s1">&#39;3D&#39;</span>      <span class="c1"># 3D/1D stellar model choice (transit was injected with the 3D model)</span>

<span class="c1"># Setup Stellar Properties for Limb-Darkening Calculation</span>
<span class="n">Teff</span> <span class="o">=</span> <span class="mi">4500</span>           <span class="c1"># Effective Temperature (K)</span>
<span class="n">logg</span> <span class="o">=</span> <span class="mf">4.5</span>            <span class="c1"># Surface Gravity</span>
<span class="n">M_H</span> <span class="o">=</span> <span class="mf">0.0</span>            <span class="c1"># Stellar Metallicity log_10[M/H]</span>
<span class="n">Rstar</span> <span class="o">=</span> <span class="mf">0.455</span>          <span class="c1"># Planet radius (in units of solar radii Run)</span>

<span class="c1"># Setup Transit parameters (can get from NASA exoplanet archive)</span>
<span class="n">t0</span> <span class="o">=</span> <span class="mf">2454865.084034</span>              <span class="c1"># bjd time of inferior conjunction </span>
<span class="n">per</span> <span class="o">=</span> <span class="mf">2.64389803</span>                  <span class="c1"># orbital period (days) BJD_TDB</span>
<span class="n">rp</span> <span class="o">=</span> <span class="mf">0.0804</span>                      <span class="c1"># Planet radius (in units of stellar radii)</span>
<span class="n">a_Rs</span> <span class="o">=</span> <span class="mf">14.54</span>                       <span class="c1"># Semi-major axis (input a/Rstar so units of stellar radii)</span>
<span class="n">inc</span> <span class="o">=</span> <span class="mf">86.858</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">360</span><span class="p">)</span>      <span class="c1"># Orbital inclination (in degrees-&gt;radians)</span>
<span class="n">ecc</span> <span class="o">=</span> <span class="mf">0.0</span>                         <span class="c1"># Eccentricity</span>
<span class="n">omega</span> <span class="o">=</span> <span class="mf">0.0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mi">360</span><span class="p">)</span>         <span class="c1"># Longitude of periastron (in degrees-&gt;radians)</span>

<span class="n">rho_star</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="mf">6.67259E-8</span><span class="o">*</span><span class="p">(</span><span class="n">per</span><span class="o">*</span><span class="mi">86400</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a_Rs</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span>     <span class="c1"># Stellar Density (g/cm^3) from a/Rs</span>
<span class="c1"># a_Rs=(rho_star*6.67259E-8*per_sec*per_sec/(3*np.pi))**(1/3)  # a/Rs from Stellar Density (g/cm^3)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create local directories</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_directory</span><span class="p">):</span>
    <span class="n">mkdir</span><span class="p">(</span><span class="n">save_directory</span><span class="p">)</span>      <span class="c1"># Create a new directory to save outputs to if needed</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_directory</span><span class="o">+</span><span class="s1">&#39;3DGrid&#39;</span><span class="p">):</span> 
    <span class="n">mkdir</span><span class="p">(</span><span class="n">save_directory</span><span class="o">+</span><span class="s1">&#39;3DGrid&#39;</span><span class="p">)</span>      <span class="c1"># Create new directory to save</span>
<span class="n">limb_dark_directory</span> <span class="o">=</span> <span class="n">save_directory</span>    <span class="c1"># Point to limb darkeing directory contaning 3DGrid/ directory</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="download-and-load-nirspec-data">
<h1>Download and Load NIRSpec data<a class="headerlink" href="#download-and-load-nirspec-data" title="Link to this heading">#</a></h1>
<p>The fits images are loaded, and information including the image date and science spectra are saved.</p>
<p>A default flux offset value BZERO is also taken from the header and subtracted from every science frame.</p>
<p>Reading in the 2^13 fits files is slow.  To speed things up, we created a pickle file of the for first instance the fits images are loaded.  This 1GB pickle file is loaded instead of reading the fits files if found.</p>
<p>Alternatively, the fits files can be downloaded here:
https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/transit_spectroscopy_notebook/Archive.Trace_SLIT_A_1600_SRAD-PRM-PS-6007102143_37803_JLAB88_injected.tar.gz.  The images are in a tar.gz archvie, which needs to be un-archived and data_directory variable set to the directory in the SETUP cell above.</p>
<p>The cell below downloads the 1GB JWST data pickle file, and several other files needed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download 1GB NIRSpec Data</span>
<span class="n">fn_jw</span> <span class="o">=</span> <span class="n">save_directory</span><span class="o">+</span><span class="s1">&#39;jwst_data.pickle&#39;</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn_jw</span><span class="p">):</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/transit_spectroscopy_notebook/jwst_data.pickle&#39;</span><span class="p">)</span>
    <span class="n">dest</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">fn</span><span class="p">,</span> <span class="n">save_directory</span><span class="o">+</span><span class="s1">&#39;jwst_data.pickle&#39;</span><span class="p">)</span>  
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;JWST Data Download Complete&#39;</span><span class="p">)</span>

<span class="c1"># Download further files needed, move to local directory for easier repeated access</span>
<span class="n">fn_sens</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/transit_spectroscopy_notebook/NIRSpec.prism.sensitivity.sav&#39;</span><span class="p">)</span>
<span class="n">dest</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">fn_sens</span><span class="p">,</span> <span class="n">save_directory</span><span class="o">+</span><span class="s1">&#39;NIRSpec.prism.sensitivity.sav&#39;</span><span class="p">)</span>  <span class="c1"># Move files to save_directory</span>

<span class="n">fn_ld</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/transit_spectroscopy_notebook/3DGrid/mmu_t45g45m00v05.flx&#39;</span><span class="p">)</span>
<span class="n">destld</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">fn_ld</span><span class="p">,</span> <span class="n">save_directory</span><span class="o">+</span><span class="s1">&#39;3DGrid/mmu_t45g45m00v05.flx&#39;</span><span class="p">)</span>        
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>JWST Data Download Complete
</pre></div>
</div>
</div>
</div>
<p>Loads the Pickle File data.  Alternatly, the data can be read from the original fits files.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn_jw</span><span class="p">):</span>
    <span class="n">dbfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fn_jw</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="c1"># for reading also binary mode is important</span>
    <span class="n">jwst_data</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">dbfile</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Loading JWST data from Pickle File&#39;</span><span class="p">)</span>
    <span class="n">bjd</span> <span class="o">=</span> <span class="n">jwst_data</span><span class="p">[</span><span class="s1">&#39;bjd&#39;</span><span class="p">]</span>
    <span class="n">wsdata_all</span> <span class="o">=</span> <span class="n">jwst_data</span><span class="p">[</span><span class="s1">&#39;wsdata_all&#39;</span><span class="p">]</span>
    <span class="n">shx</span> <span class="o">=</span> <span class="n">jwst_data</span><span class="p">[</span><span class="s1">&#39;shx&#39;</span><span class="p">]</span>
    <span class="n">shy</span> <span class="o">=</span> <span class="n">jwst_data</span><span class="p">[</span><span class="s1">&#39;shy&#39;</span><span class="p">]</span>
    <span class="n">common_mode</span> <span class="o">=</span> <span class="n">jwst_data</span><span class="p">[</span><span class="s1">&#39;common_mode&#39;</span><span class="p">]</span>
    <span class="n">all_spec</span> <span class="o">=</span> <span class="n">jwst_data</span><span class="p">[</span><span class="s1">&#39;all_spec&#39;</span><span class="p">]</span>
    <span class="n">exposure_length</span> <span class="o">=</span> <span class="n">jwst_data</span><span class="p">[</span><span class="s1">&#39;exposure_length&#39;</span><span class="p">]</span>
    <span class="n">dbfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Done&#39;</span><span class="p">)</span>
<span class="k">elif</span> <span class="ow">not</span> <span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">fn_jw</span><span class="p">):</span>
    <span class="c1"># Load all fits images</span>
    <span class="c1"># Arrays created for BJD time, and the white light curve total_counts</span>
    <span class="nb">list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">data_directory</span><span class="o">+</span><span class="s2">&quot;*.fits&quot;</span><span class="p">)</span>
    <span class="n">index_of_images</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">number_of_images</span><span class="p">)</span> 
    <span class="n">bjd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_images</span><span class="p">))</span>
    <span class="n">exposure_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_images</span><span class="p">))</span>
    <span class="n">all_spec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">32</span><span class="p">,</span> <span class="mi">512</span><span class="p">,</span> <span class="n">number_of_images</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">index_of_images</span><span class="p">:</span>
        <span class="n">img</span> <span class="o">=</span> <span class="nb">list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="n">hdul</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
        <span class="c1"># hdul.info()</span>
        <span class="n">bjd_image</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;BJD_TDB&#39;</span><span class="p">]</span>
        <span class="n">BZERO</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;BZERO&#39;</span><span class="p">]</span>        <span class="c1"># flux value offset</span>
        <span class="n">bjd</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">bjd_image</span>
        <span class="n">expleng</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;INTTIME&#39;</span><span class="p">]</span>    <span class="c1"># Total integration time for one MULTIACCUM (seconds)</span>
        <span class="n">exposure_length</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">expleng</span><span class="o">/</span><span class="mf">86400.</span>    <span class="c1"># Total integration time for one MULTIACCUM (days)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">bjd</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">hdul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="c1"># total counts in image</span>
        <span class="c1"># total_counts[i]=gain*np.sum(data[11:18,170:200]-BZERO) # total counts in 12 pix wide aperture around pixel 60 image</span>
        <span class="n">all_spec</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">gain</span> <span class="o">*</span> <span class="p">(</span><span class="n">data</span><span class="o">-</span><span class="n">BZERO</span><span class="p">)</span>     <span class="c1"># Load all spectra into an array subtract flux value offset</span>
        <span class="n">hdul</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="c1"># Sort data</span>
    <span class="n">srt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">bjd</span><span class="p">)</span> <span class="c1"># index to sort</span>
    <span class="n">bjd</span> <span class="o">=</span> <span class="n">bjd</span><span class="p">[</span><span class="n">srt</span><span class="p">]</span>
    <span class="c1"># total_counts=total_counts[srt]</span>
    <span class="n">exposure_length</span> <span class="o">=</span> <span class="n">exposure_length</span><span class="p">[</span><span class="n">srt</span><span class="p">]</span>
    <span class="n">all_spec</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">all_spec</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">srt</span><span class="p">]</span>

    <span class="c1"># Get Wavelength of Data</span>
    <span class="n">file_wave</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/transit_spectroscopy_notebook/JWST_NIRSpec_wavelength_microns.txt&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_wave</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">wsdata_all</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wsdata size :&#39;</span><span class="p">,</span> <span class="n">wsdata_all</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Data wavelength Loaded :&#39;</span><span class="p">,</span> <span class="n">wsdata_all</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;wsdata new size :&#39;</span><span class="p">,</span> <span class="n">wsdata_all</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    
    <span class="c1"># Read in Detrending parameters</span>
    <span class="c1"># Mean of parameter must be 0.0 to be properly normalized</span>
    <span class="c1"># Idealy standard deviation of parameter = 1.0</span>
    <span class="n">file_xy</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/transit_spectroscopy_notebook/JWST_NIRSpec_Xposs_Yposs_CM_detrending.txt&#39;</span><span class="p">)</span>
    <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_xy</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">shx</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">shy</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">common_mode</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span>
    
    <span class="c1"># Store Data in a pickle file</span>
    <span class="n">jwst_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;bjd&#39;</span><span class="p">:</span> <span class="n">bjd</span><span class="p">,</span> <span class="s1">&#39;wsdata_all&#39;</span><span class="p">:</span> <span class="n">wsdata_all</span><span class="p">,</span> <span class="s1">&#39;shx&#39;</span><span class="p">:</span> <span class="n">shx</span><span class="p">,</span> <span class="s1">&#39;shy&#39;</span><span class="p">:</span> <span class="n">shy</span><span class="p">,</span> <span class="s1">&#39;common_mode&#39;</span><span class="p">:</span> <span class="n">common_mode</span><span class="p">,</span> <span class="s1">&#39;all_spec&#39;</span><span class="p">:</span> <span class="n">all_spec</span><span class="p">,</span> <span class="s1">&#39;exposure_length&#39;</span><span class="p">:</span> <span class="n">exposure_length</span><span class="p">}</span>
    <span class="n">dbfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;jwst_data.pickle&#39;</span><span class="p">,</span> <span class="s1">&#39;ab&#39;</span><span class="p">)</span> <span class="c1"># Its important to use binary mode</span>
    <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">jwst_data</span><span class="p">,</span> <span class="n">dbfile</span><span class="p">)</span>
    <span class="n">dbfile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Loading JWST data from Pickle File
Done
</pre></div>
</div>
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="visualizing-the-2d-spectral-data">
<h1>Visualizing the 2D spectral data<a class="headerlink" href="#visualizing-the-2d-spectral-data" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">expnum</span> <span class="o">=</span> <span class="mi">2</span>                                           <span class="c1"># Choose Exposure number to view</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>           <span class="c1"># Figure dimensions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>                   <span class="c1"># Resolution</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.aspect&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>                     <span class="c1"># Aspect ratio (the CCD is quite long!!!)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">magma</span>
<span class="n">plt</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;magma&#39;</span>                   <span class="c1"># Colormap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.interpolation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lower&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;monospace&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.monospace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DejaVu Sans Mono&#39;</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">all_spec</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">expnum</span><span class="p">]</span>
<span class="n">zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">img</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>     <span class="c1"># Plot on a log scale, so set zero or negative values to a small number </span>
<span class="n">img</span><span class="p">[</span><span class="n">zeros</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1E-10</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Plot image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x-pixel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y-pixel&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;2D NIRSpec Image of Exposure &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">expnum</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Log$_</span><span class="si">{10}</span><span class="s1">$ Electron counts&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/6f63b62b817b47fefe799611540cd5cb5d766791b0d1cbcf442c8363b0e251ef.png" src="../../../_images/6f63b62b817b47fefe799611540cd5cb5d766791b0d1cbcf442c8363b0e251ef.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="extract-1d-spectra-from-2d-array-of-images">
<h1>Extract 1D spectra from 2D array of images<a class="headerlink" href="#extract-1d-spectra-from-2d-array-of-images" title="Link to this heading">#</a></h1>
<p>Ideally, extracting 1D spectra from the 2D images would use optimal aperture extraction along a fit
trace with routines equivalent to IRAF/apall. This functionality is not yet available in astro-py.</p>
<p>Several processing steps have already been applied.  The 2D spectra here have been flat field corrected, and 1/f noise has been removed from each pixel by subtracting the median count rate from the un-illuminated pixels along each column (see <strong><a class="reference internal" href="#ftp://ftp.cosmos.esa.int/jwstlib/ReleasedCV3dataTimeSeries/CV3_TimeSeries_PRM.tgz"><span class="xref myst">Giardino et al.</span></a></strong>
for more information about 1/f noise).  Each 2D image has also been aligned in the X and Y directions, such that each pixel corresponds to the same wavelength.  As the CV3 test had no requirements for flux stability, the ~1% flux variations from the LED have also been removed.</p>
<p>For spectral extraction, the example here simply uses a simple summed box.  The 8192 2D spectra have been
pre-loaded into a numpy array.  The spectra peaks at pixel Y=16. For each column, an aperature sum is taken over Y-axis pixels 11 to 18, which
contains most of the spectrum counts. Wider aperture would add more counts, but also introduces more noise.</p>
<p><strong>Further cleaning steps are not done here</strong></p>
<ol class="arabic simple">
<li><p>Ideally, the pixels flagged as bad for various reasons should be cleaned.</p></li>
<li><p>Cosmic rays should be identified and removed.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_spec</span><span class="o">.</span><span class="n">shape</span>
<span class="n">y_lower</span> <span class="o">=</span> <span class="mi">11</span>                                             <span class="c1"># Lower extraction aperture</span>
<span class="n">y_upper</span> <span class="o">=</span> <span class="mi">18</span>                                             <span class="c1"># Upper extraction aperture</span>
<span class="n">all_spec_1D</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">all_spec</span><span class="p">[</span><span class="n">y_lower</span><span class="p">:</span><span class="n">y_upper</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># Sum along Y-axis from pixels 11 to 18</span>
<span class="c1"># Plot </span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>           <span class="c1"># Figure dimensions</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>                   <span class="c1"># Resolution</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.aspect&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>                     <span class="c1"># Aspect ratio (the CCD is quite long!!!)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">cmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">magma</span>
<span class="n">plt</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_bad</span><span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;magma&#39;</span>                   <span class="c1"># Colormap</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.interpolation&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;image.origin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;lower&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;monospace&quot;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.monospace&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;DejaVu Sans Mono&#39;</span>

<span class="n">img</span> <span class="o">=</span> <span class="n">all_spec</span><span class="p">[:,</span> <span class="p">:,</span> <span class="n">expnum</span><span class="p">]</span>
<span class="n">zeros</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">img</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>     <span class="c1"># Plot on a log scale, so set zero or negative values to a small number </span>
<span class="n">img</span><span class="p">[</span><span class="n">zeros</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1E-10</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">axs</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">img</span><span class="p">),</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Plot image</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x-pixel&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y-pixel&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">50</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y_lower</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y_upper</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;2D NIRSpec Image of Exposure &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">expnum</span><span class="p">))</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Log$_</span><span class="si">{10}</span><span class="s1">$ Electron counts&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/3792db9ac8347ae917acb38c20541f293bc2aeb1a73c8870258a2ef5a65b32c4.png" src="../../../_images/3792db9ac8347ae917acb38c20541f293bc2aeb1a73c8870258a2ef5a65b32c4.png" />
</div>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="visualizing-the-1d-spectral-data">
<h1>Visualizing the 1D spectral data<a class="headerlink" href="#visualizing-the-1d-spectral-data" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wsdata_all</span><span class="p">,</span> <span class="n">all_spec_1D</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># overplot Transit model at data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wavelength ($\mu$m)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux (e-)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;H$_2$O&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">42000</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;CO$_2$&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">4.2</span><span class="p">,</span> <span class="mi">42000</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/b4038d338890272fb40db1b36caf3d7bf8c10d2d1315144cc6a7f6757a047ed2.png" src="../../../_images/b4038d338890272fb40db1b36caf3d7bf8c10d2d1315144cc6a7f6757a047ed2.png" />
</div>
</div>
<p>The CV3 test observed a lamp with a similar PSF as JWST will have, and has significant counts from
about 1.5 to 4.5 <span class="math notranslate nohighlight">\(\mu\)</span>m.</p>
<p>The cryogenic test chamber had CO<span class="math notranslate nohighlight">\(_2\)</span> and H<span class="math notranslate nohighlight">\(_2\)</span>O ice buildup on the window, which can be seen as spectral absorption features in the 2D spectra.</p>
<section id="calculate-orbital-phase-and-a-separate-fine-grid-model-used-for-plotting-purposes">
<h2>Calculate Orbital Phase and a separate fine grid model used for plotting purposes<a class="headerlink" href="#calculate-orbital-phase-and-a-separate-fine-grid-model-used-for-plotting-purposes" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Calculate Orbital Phase</span>
<span class="n">phase</span> <span class="o">=</span> <span class="p">(</span><span class="n">bjd</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">per</span><span class="p">)</span>  <span class="c1"># phase in days relative to T0 ephemeris</span>
<span class="n">phase</span> <span class="o">=</span> <span class="n">phase</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">phase</span><span class="p">[</span><span class="n">number_of_images</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># Have current phase occur at value 0.0</span>

<span class="n">t_fine</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">bjd</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">bjd</span><span class="p">),</span> <span class="mi">1000</span><span class="p">)</span> <span class="c1"># times at which to calculate light curve</span>
<span class="n">phase_fine</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_fine</span><span class="o">-</span><span class="n">t0</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">per</span><span class="p">)</span>  <span class="c1"># phase in days relative to T0 ephemeris</span>
<span class="n">phase_fine</span> <span class="o">=</span> <span class="n">phase_fine</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">fix</span><span class="p">(</span><span class="n">phase</span><span class="p">[</span><span class="n">number_of_images</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># Have current phase occur at value 0.0</span>

<span class="n">b0</span> <span class="o">=</span> <span class="n">a_Rs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">intransit</span> <span class="o">=</span> <span class="p">(</span><span class="n">b0</span><span class="o">-</span><span class="n">rp</span> <span class="o">&lt;</span> <span class="mf">1.0E0</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>  <span class="c1"># Select indicies between first and fourth contact</span>
<span class="n">outtransit</span> <span class="o">=</span> <span class="p">(</span><span class="n">b0</span><span class="o">-</span><span class="n">rp</span> <span class="o">&gt;</span> <span class="mf">1.0E0</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span> <span class="c1"># Select indicies out of transit</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="dealing-with-systematic-drift-on-the-detector">
<h1>Dealing with Systematic Drift On the Detector<a class="headerlink" href="#dealing-with-systematic-drift-on-the-detector" title="Link to this heading">#</a></h1>
<p>The CV3 test assessed the stability of the instrument by introducing a large spatial jitter and drift. This resulted in a significant X,Y movement of the spectra on the 2D detector. While this bulk shift has been removed which aligns the spectra, intra- and inter- pixel sensitivities introduce flux variations which need to be removed. The jitter from the CV3 test was more than 30 mas, which is ~4X larger than the JWST stability requirement. Thus, in orbit these detector effects are expected to be significantly smaller, but they will still be present and will need to be modeled and removed from time series observations.</p>
<p>The detector X, Y positions here were measured from cross-correlation of the 2D images (collapsing the spectra along one dimension first), and are saved in arrays <span class="math notranslate nohighlight">\(shx\)</span> and <span class="math notranslate nohighlight">\(shy\)</span>. These detending vectors would ideally be measured using the trace position values from the spectral extraction of each integration, as that could also accurately measure integration-to-integration how the spectra spatially changed on the detector.</p>
<p>The detector shifts have original amplitudes near 0.2 pixels, though the vectors have had initial normalization. For detrending purposes, these arrays should have a mean of 0 and standard deviation of 1.0.</p>
<p>A residual color-dependent trend with the LED lamp can also been seen in the CV3 data, which can be partly removed by scaling original common-mode lamp trend, which was measured using the CV3 white light curve.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shx_tmp</span> <span class="o">=</span> <span class="n">shx</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">shx</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0E0</span>       <span class="c1"># Set Mean around 0.0</span>
<span class="n">shx_detrend</span> <span class="o">=</span> <span class="n">shx_tmp</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">shx_tmp</span><span class="p">)</span>  <span class="c1"># Set standard deviation to 1.0</span>
<span class="n">shy_tmp</span> <span class="o">=</span> <span class="n">shy</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">shy</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0E0</span>       <span class="c1"># Set Mean around 0.0</span>
<span class="n">shy_detrend</span> <span class="o">=</span> <span class="n">shy_tmp</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">shy_tmp</span><span class="p">)</span>  <span class="c1"># Set standard deviation to 1.0</span>

<span class="n">cm</span> <span class="o">=</span> <span class="n">common_mode</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">common_mode</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1.0E0</span>
<span class="n">cm_detrend</span> <span class="o">=</span> <span class="n">cm</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">shx_detrend</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;X-possition&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">shy_detrend</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Y-possition&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Image Sequence Number&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative Detector Possition&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Time-series Detrending Vectors&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/fb4561fc316c9964e8341a31610c5381995be67624d7140bca49267b81261308.png" src="../../../_images/fb4561fc316c9964e8341a31610c5381995be67624d7140bca49267b81261308.png" />
</div>
</div>
<section id="create-arrays-of-the-vectors-used-for-detrending">
<h2>Create arrays of the vectors used for detrending.<a class="headerlink" href="#create-arrays-of-the-vectors-used-for-detrending" title="Link to this heading">#</a></h2>
<p>From Sing et al. 2019:  Systematic errors are often removed by a parameterized deterministic model, where the non-transit photometric trends are found to correlate with a number <span class="math notranslate nohighlight">\(n\)</span> of external parameters (or optical state vectors, <span class="math notranslate nohighlight">\(X\)</span>). These parameters describe changes in the instrument or other external factors as a function of time during the observations, and are fit with a coefficient for each optical state parameter, <span class="math notranslate nohighlight">\(p_n\)</span>, to model and remove (or detrend) the photometric light curves.</p>
<p>When including systematic trends, the total parameterized model of the flux measurements over time, <span class="math notranslate nohighlight">\(f(t)\)</span>, can be modeled as a combination of the theoretical transit model, <span class="math notranslate nohighlight">\(T(t,\theta)\)</span> (which depends upon the transit parameters <span class="math notranslate nohighlight">\(\theta\)</span>), the total baseline flux detected from the star, <span class="math notranslate nohighlight">\(F_0\)</span>, and the systematics error model <span class="math notranslate nohighlight">\(S(x)\)</span> giving,</p>
<p><span class="math notranslate nohighlight">\(f(t) = T(t,\theta)\times F_0 \times S(x)\)</span>.</p>
<p>We will use a linear model for the instrument systematic effects.</p>
<p><span class="math notranslate nohighlight">\(S(x)= p_1 x + p_2 y + p_3 x^2 + p_4 y^2 + p_5 x y + p_6 cm + p_7 \phi \)</span></p>
<p><span class="math notranslate nohighlight">\(cm\)</span> is the common_mode trend, and <span class="math notranslate nohighlight">\(\phi\)</span> is a linear time trend which helps remove changing H<span class="math notranslate nohighlight">\(_2\)</span>O ice within the H<span class="math notranslate nohighlight">\(_2\)</span>O spectral feature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shx</span> <span class="o">=</span> <span class="n">shx_detrend</span>
<span class="n">shy</span> <span class="o">=</span> <span class="n">shy_detrend</span>
<span class="n">common_mode</span> <span class="o">=</span> <span class="n">cm_detrend</span>

<span class="n">XX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">shx</span><span class="p">,</span> <span class="n">shy</span><span class="p">,</span> <span class="n">shx</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">shy</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">shx</span><span class="o">*</span><span class="n">shy</span><span class="p">,</span> <span class="n">common_mode</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">number_of_images</span><span class="p">)])</span>  <span class="c1"># Detrending array without linear time trend</span>
<span class="n">XX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">XX</span><span class="p">)</span>
<span class="n">XXX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">shx</span><span class="p">,</span> <span class="n">shy</span><span class="p">,</span> <span class="n">shx</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">shy</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">shx</span><span class="o">*</span><span class="n">shy</span><span class="p">,</span> <span class="n">common_mode</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">number_of_images</span><span class="p">)])</span>  <span class="c1"># Detrending array with with linear time trend</span>
<span class="n">XXX</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">XXX</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Linear Regression</strong> can be used to quickly determine the parameters <span class="math notranslate nohighlight">\(p_n\)</span> using the out-of-transit data.</p>
<p>Here, we take a wavelength bin of the data (pixels 170 to 200) to make a time series.  The out-of-transit points are selected and a linear regression of <span class="math notranslate nohighlight">\(S(x)\)</span> is done to determine the optical state parameters <span class="math notranslate nohighlight">\(p_n\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pix1</span> <span class="o">=</span> <span class="mi">170</span>       <span class="c1"># wavelength bin lower range</span>
<span class="n">pix2</span> <span class="o">=</span> <span class="mi">200</span>       <span class="c1"># wavelength bin upper range</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">all_spec_1D</span><span class="p">[</span><span class="n">pix1</span><span class="p">:</span><span class="n">pix2</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>    <span class="c1"># flux over a selected wavelength bin</span>

<span class="n">msize</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;lines.markersize&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mf">2.</span>           <span class="c1"># default marker size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">]</span>           <span class="c1"># Figure dimensions</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wsdata_all</span><span class="p">,</span> <span class="n">all_spec_1D</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Plot Region of wavelength bin</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">wsdata_all</span><span class="p">[</span><span class="n">pix1</span><span class="p">:</span><span class="n">pix2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">all_spec_1D</span><span class="p">[</span><span class="n">pix1</span><span class="p">:</span><span class="n">pix2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wavelength ($\mu$m)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Flux (e-)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;1D Extracted Spectrum&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;H$_2$O&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">3.0</span><span class="p">,</span> <span class="mi">42000</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="s1">&#39;CO$_2$&#39;</span><span class="p">,</span> <span class="n">xy</span><span class="o">=</span><span class="p">(</span><span class="mf">4.2</span><span class="p">,</span> <span class="mi">42000</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bjd</span><span class="p">,</span> <span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f(t)$ Data&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">msize</span><span class="o">*</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Barycentric Julian Date (days)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative Flux&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Time-series Transit Light Curve  $\lambda=$[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wsdata_all</span><span class="p">[</span><span class="n">pix1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wsdata_all</span><span class="p">[</span><span class="n">pix2</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;] $\mu$m&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">regressor</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
<span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">XX</span><span class="p">[</span><span class="n">outtransit</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">]))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Linear Regression Coefficients:&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">regressor</span><span class="o">.</span><span class="n">coef_</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/eb76031b039d249fa6eb487837261623ea53be2e2c40207fa1f18f9b21fba47d.png" src="../../../_images/eb76031b039d249fa6eb487837261623ea53be2e2c40207fa1f18f9b21fba47d.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/1502773371.py:21: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(bjd, y/np.mean(y[outtransit]), label=&#39;$f(t)$ Data&#39;, zorder=1, s=msize*0.75, linewidth=1, alpha=0.4, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<img alt="../../../_images/6bdda9e77cb27850a618752087a1f818d9d7d0945a485670b8c187f33d5d07a5.png" src="../../../_images/6bdda9e77cb27850a618752087a1f818d9d7d0945a485670b8c187f33d5d07a5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Linear Regression Coefficients:
[ 2.35589645e-04  2.33200386e-04 -1.43527088e-04 -4.65560797e-05
  1.94065907e-04 -4.51855007e-04  0.00000000e+00]
</pre></div>
</div>
</div>
</div>
<p>The coefficients are on the order of ~10<span class="math notranslate nohighlight">\(^{-4}\)</span> so the trends have an amplitude on the order of 100â€™s of ppm.</p>
<p>Visualize the fit</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yfit</span> <span class="o">=</span> <span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">XX</span><span class="p">)</span>                         <span class="c1"># Project the fit over the whole time series</span>

<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">]</span>           <span class="c1"># Figure dimensions</span>
<span class="n">msize</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;lines.markersize&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mf">2.</span>           <span class="c1"># default marker size</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bjd</span><span class="p">,</span> <span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f(t)$ Data&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">msize</span><span class="o">*</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bjd</span><span class="p">,</span> <span class="n">yfit</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$S(x)$ Regression fit &#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Barycentric Julian Date (days)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative Flux&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Time-series Transit Light Curve  $\lambda=$[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wsdata_all</span><span class="p">[</span><span class="n">pix1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wsdata_all</span><span class="p">[</span><span class="n">pix2</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;] $\mu$m&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.005</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.002</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))</span>
<span class="n">yplot</span> <span class="o">=</span> <span class="n">y</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">yplot</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.999</span><span class="p">,</span> <span class="n">yplot</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1.001</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">bjd</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">bjd</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3911644354.py:5: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(bjd, y/np.mean(y[outtransit]), label=&#39;$f(t)$ Data&#39;, zorder=1, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<img alt="../../../_images/2fc81925a8c92cbd35a7ab667e5f61c38304b63d353d4f8dcaaf8fd7ac667125.png" src="../../../_images/2fc81925a8c92cbd35a7ab667e5f61c38304b63d353d4f8dcaaf8fd7ac667125.png" />
</div>
</div>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="transit-and-limb-darkening-model-functions">
<h1>Transit and Limb-Darkening Model Functions<a class="headerlink" href="#transit-and-limb-darkening-model-functions" title="Link to this heading">#</a></h1>
<p>Define a functions used by the fitting routines.
These which will take the transit and systematic parameters and create our full transit light curve model</p>
<p><span class="math notranslate nohighlight">\(model = T(t,\theta)\times F_0 \times S(x)\)</span></p>
<p>compares it to the data</p>
<p><span class="math notranslate nohighlight">\(y = f(t)\)</span></p>
<p>by returning the residuals</p>
<p><span class="math notranslate nohighlight">\((y-model)/(\sigma_y)\)</span></p>
<p>To calculate the transit model, here we use  <strong><a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2002ApJ...580L.171M/abstract">Mandel and Agol (2002)</a></strong> as coded in python by H. Wakeford (<strong><a class="reference external" href="https://github.com/hrwakeford/ExoTiC-ISM">ExoTiC-ISM</a></strong>).</p>
<p>To calculate the stellar limb-darkening, we use the procedure from Sing et al. (2010) which uses stellar models and fits for non-linear limb darkening coefficients, with a module as coded in python by H. Wakeford (<strong><a class="reference external" href="https://github.com/hrwakeford/ExoTiC-ISM">ExoTiC-ISM</a></strong>).</p>
<p>A new orbit is first calculated based on the system parameters of <span class="math notranslate nohighlight">\(a/R_{star}\)</span>, the cosine of the inclination <span class="math notranslate nohighlight">\(cos(i)\)</span>, and the orbital phase <span class="math notranslate nohighlight">\(\phi\)</span>.
The inputs are the orbit distance between the planet-star center <span class="math notranslate nohighlight">\(b\)</span> at each phase, limb-darkening parameters (<span class="math notranslate nohighlight">\(c_1,c_2,c_3,c_4\)</span>), and the planet-to-star radius ratio <span class="math notranslate nohighlight">\(R_p/R_{star}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@custom_model</span>
<span class="k">def</span><span class="w"> </span><span class="nf">nonlinear_limb_darkening</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c0</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">c1</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">c2</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">c3</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define non-linear limb darkening model with four parameters c0, c1, c2, c3.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="p">(</span><span class="n">c0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x</span> <span class="o">**</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x</span> <span class="o">**</span> <span class="p">(</span><span class="mf">2.</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x</span> <span class="o">**</span> <span class="p">(</span><span class="mf">3.</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span> <span class="o">+</span> <span class="n">c3</span> <span class="o">*</span>
                   <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x</span> <span class="o">**</span> <span class="p">(</span><span class="mf">4.</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))))</span>
    <span class="k">return</span> <span class="n">model</span>


<span class="nd">@custom_model</span>
<span class="k">def</span><span class="w"> </span><span class="nf">quadratic_limb_darkening</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">aLD</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">bLD</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Define linear limb darkening model with parameters aLD and bLD.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">model</span> <span class="o">=</span> <span class="mf">1.</span> <span class="o">-</span> <span class="n">aLD</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">bLD</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="mf">4.</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>


<span class="k">def</span><span class="w"> </span><span class="nf">limb_dark_fit</span><span class="p">(</span><span class="n">grating</span><span class="p">,</span> <span class="n">wsdata</span><span class="p">,</span> <span class="n">M_H</span><span class="p">,</span> <span class="n">Teff</span><span class="p">,</span> <span class="n">logg</span><span class="p">,</span> <span class="n">dirsen</span><span class="p">,</span> <span class="n">ld_model</span><span class="o">=</span><span class="s1">&#39;1D&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates stellar limb-darkening coefficients for a given wavelength bin.</span>

<span class="sd">    Currently supports:</span>
<span class="sd">    HST STIS G750L, G750M, G430L gratings</span>
<span class="sd">    HST WFC3 UVIS/G280, IR/G102, IR/G141 grisms</span>

<span class="sd">    What is used for 1D models - Kurucz (?)</span>
<span class="sd">    Procedure from Sing et al. (2010, A&amp;A, 510, A21).</span>
<span class="sd">    Uses 3D limb darkening from Magic et al. (2015, A&amp;A, 573, 90).</span>
<span class="sd">    Uses photon FLUX Sum over (lambda*dlamba).</span>
<span class="sd">    :param grating: string; grating to use (&#39;G430L&#39;,&#39;G750L&#39;,&#39;G750M&#39;, &#39;G280&#39;, &#39;G102&#39;, &#39;G141&#39;)</span>
<span class="sd">    :param wsdata: array; data wavelength solution</span>
<span class="sd">    :param M_H: float; stellar metallicity</span>
<span class="sd">    :param Teff: float; stellar effective temperature (K)</span>
<span class="sd">    :param logg: float; stellar gravity</span>
<span class="sd">    :param dirsen: string; path to main limb darkening directory</span>
<span class="sd">    :param ld_model: string; &#39;1D&#39; or &#39;3D&#39;, makes choice between limb darkening models; default is 1D</span>
<span class="sd">    :return: uLD: float; linear limb darkening coefficient</span>
<span class="sd">    aLD, bLD: float; quadratic limb darkening coefficients</span>
<span class="sd">    cp1, cp2, cp3, cp4: float; three-parameter limb darkening coefficients</span>
<span class="sd">    c1, c2, c3, c4: float; non-linear limb-darkening coefficients</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;You are using the&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ld_model</span><span class="p">),</span> <span class="s1">&#39;limb darkening models.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">ld_model</span> <span class="o">==</span> <span class="s1">&#39;1D&#39;</span><span class="p">:</span>

        <span class="n">direc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirsen</span><span class="p">,</span> <span class="s1">&#39;Kurucz&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current Directories Entered:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="n">dirsen</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="n">direc</span><span class="p">)</span>

        <span class="c1"># Select metallicity</span>
        <span class="n">M_H_Grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.3</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">5.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
        <span class="n">M_H_Grid_load</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">24</span><span class="p">])</span>
        <span class="n">optM</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">M_H</span> <span class="o">-</span> <span class="n">M_H_Grid</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
        <span class="n">MH_ind</span> <span class="o">=</span> <span class="n">M_H_Grid_load</span><span class="p">[</span><span class="n">optM</span><span class="p">]</span>

        <span class="c1"># Determine which model is to be used, by using the input metallicity M_H to figure out the file name we need</span>
        <span class="n">direc</span> <span class="o">=</span> <span class="s1">&#39;Kurucz&#39;</span>
        <span class="n">file_list</span> <span class="o">=</span> <span class="s1">&#39;kuruczlist.sav&#39;</span>
        <span class="n">sav1</span> <span class="o">=</span> <span class="n">readsav</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirsen</span><span class="p">,</span> <span class="n">file_list</span><span class="p">))</span>
        <span class="n">model</span> <span class="o">=</span> <span class="nb">bytes</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="n">sav1</span><span class="p">[</span><span class="s1">&#39;li&#39;</span><span class="p">][</span><span class="n">MH_ind</span><span class="p">])</span>  <span class="c1"># Convert object of type &quot;byte&quot; to &quot;string&quot;</span>

        <span class="c1"># Select Teff and subsequently logg</span>
        <span class="n">Teff_Grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">3500</span><span class="p">,</span> <span class="mi">3750</span><span class="p">,</span> <span class="mi">4000</span><span class="p">,</span> <span class="mi">4250</span><span class="p">,</span> <span class="mi">4500</span><span class="p">,</span> <span class="mi">4750</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">5250</span><span class="p">,</span> <span class="mi">5500</span><span class="p">,</span> <span class="mi">5750</span><span class="p">,</span> <span class="mi">6000</span><span class="p">,</span> <span class="mi">6250</span><span class="p">,</span> <span class="mi">6500</span><span class="p">])</span>
        <span class="n">optT</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Teff</span> <span class="o">-</span> <span class="n">Teff_Grid</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>

        <span class="n">logg_Grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">])</span>
        <span class="n">optG</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">logg</span> <span class="o">-</span> <span class="n">logg_Grid</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">logg_Grid</span><span class="p">[</span><span class="n">optG</span><span class="p">]</span> <span class="o">==</span> <span class="mf">4.0</span><span class="p">:</span>
            <span class="n">Teff_Grid_load</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">8</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">63</span><span class="p">,</span> <span class="mi">74</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="mi">96</span><span class="p">,</span> <span class="mi">107</span><span class="p">,</span> <span class="mi">118</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">138</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">logg_Grid</span><span class="p">[</span><span class="n">optG</span><span class="p">]</span> <span class="o">==</span> <span class="mf">4.5</span><span class="p">:</span>
            <span class="n">Teff_Grid_load</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">9</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">31</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">53</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">86</span><span class="p">,</span> <span class="mi">97</span><span class="p">,</span> <span class="mi">108</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">129</span><span class="p">,</span> <span class="mi">139</span><span class="p">])</span>

        <span class="k">elif</span> <span class="n">logg_Grid</span><span class="p">[</span><span class="n">optG</span><span class="p">]</span> <span class="o">==</span> <span class="mf">5.0</span><span class="p">:</span>
            <span class="n">Teff_Grid_load</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">21</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">43</span><span class="p">,</span> <span class="mi">54</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">76</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">98</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">140</span><span class="p">])</span>

        <span class="c1"># Where in the model file is the section for the Teff we want? Index T_ind tells us that.</span>
        <span class="n">T_ind</span> <span class="o">=</span> <span class="n">Teff_Grid_load</span><span class="p">[</span><span class="n">optT</span><span class="p">]</span>
        <span class="n">header_rows</span> <span class="o">=</span> <span class="mi">3</span>    <span class="c1"># How many rows in each section we ignore for the data reading</span>
        <span class="n">data_rows</span> <span class="o">=</span> <span class="mi">1221</span>   <span class="c1"># How  many rows of data we read</span>
        <span class="n">line_skip_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">T_ind</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">header_rows</span> <span class="o">+</span> <span class="n">T_ind</span> <span class="o">*</span> <span class="n">data_rows</span>   <span class="c1"># Calculate how many lines in the model file we need to skip in order to get to the part we need (for the Teff we want).</span>
        <span class="n">line_skip_header</span> <span class="o">=</span> <span class="n">T_ind</span> <span class="o">*</span> <span class="p">(</span><span class="n">data_rows</span> <span class="o">+</span> <span class="n">header_rows</span><span class="p">)</span>

        <span class="c1"># Read the header, in case we want to have the actual Teff, logg and M_H info.</span>
        <span class="c1"># headerinfo is a pandas object.</span>
        <span class="n">headerinfo</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirsen</span><span class="p">,</span> <span class="n">direc</span><span class="p">,</span> <span class="n">model</span><span class="p">),</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                 <span class="n">skiprows</span><span class="o">=</span><span class="n">line_skip_header</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">Teff_model</span> <span class="o">=</span> <span class="n">headerinfo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">logg_model</span> <span class="o">=</span> <span class="n">headerinfo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">MH_model</span> <span class="o">=</span> <span class="n">headerinfo</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">MH_model</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">MH_model</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Closest values to your inputs:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Teff: &#39;</span><span class="p">,</span> <span class="n">Teff_model</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;M_H: &#39;</span><span class="p">,</span> <span class="n">MH_model</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;log(g): &#39;</span><span class="p">,</span> <span class="n">logg_model</span><span class="p">)</span>

        <span class="c1"># Read the data; data is a pandas object.</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirsen</span><span class="p">,</span> <span class="n">direc</span><span class="p">,</span> <span class="n">model</span><span class="p">),</span> <span class="n">delim_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                           <span class="n">skiprows</span><span class="o">=</span><span class="n">line_skip_data</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="n">data_rows</span><span class="p">)</span>

        <span class="c1"># Unpack the data</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="mi">10</span>   <span class="c1"># Import wavelength data</span>
        <span class="n">f0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="p">(</span><span class="n">ws</span> <span class="o">*</span> <span class="n">ws</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f3</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f4</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f5</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f6</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f7</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f8</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f9</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f10</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f11</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f12</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f13</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f14</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f15</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>
        <span class="n">f16</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">17</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">*</span> <span class="n">f0</span> <span class="o">/</span> <span class="mf">100000.</span>

        <span class="c1"># Make single big array of them</span>
        <span class="n">fcalc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">f4</span><span class="p">,</span> <span class="n">f5</span><span class="p">,</span> <span class="n">f6</span><span class="p">,</span> <span class="n">f7</span><span class="p">,</span> <span class="n">f8</span><span class="p">,</span> <span class="n">f9</span><span class="p">,</span> <span class="n">f10</span><span class="p">,</span> <span class="n">f11</span><span class="p">,</span> <span class="n">f12</span><span class="p">,</span> <span class="n">f13</span><span class="p">,</span> <span class="n">f14</span><span class="p">,</span> <span class="n">f15</span><span class="p">,</span> <span class="n">f16</span><span class="p">])</span>
        <span class="n">phot1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">fcalc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Define mu</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.000</span><span class="p">,</span> <span class="mf">.900</span><span class="p">,</span> <span class="mf">.800</span><span class="p">,</span> <span class="mf">.700</span><span class="p">,</span> <span class="mf">.600</span><span class="p">,</span> <span class="mf">.500</span><span class="p">,</span> <span class="mf">.400</span><span class="p">,</span> <span class="mf">.300</span><span class="p">,</span> <span class="mf">.250</span><span class="p">,</span> <span class="mf">.200</span><span class="p">,</span> <span class="mf">.150</span><span class="p">,</span> <span class="mf">.125</span><span class="p">,</span> <span class="mf">.100</span><span class="p">,</span> <span class="mf">.075</span><span class="p">,</span> <span class="mf">.050</span><span class="p">,</span> <span class="mf">.025</span><span class="p">,</span> <span class="mf">.010</span><span class="p">])</span>

        <span class="c1"># Passed on to main body of function are: ws, fcalc, phot1, mu</span>

    <span class="k">elif</span> <span class="n">ld_model</span> <span class="o">==</span> <span class="s1">&#39;3D&#39;</span><span class="p">:</span>

        <span class="n">direc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirsen</span><span class="p">,</span> <span class="s1">&#39;3DGrid&#39;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Current Directories Entered:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="n">dirsen</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;  &#39;</span> <span class="o">+</span> <span class="n">direc</span><span class="p">)</span>

        <span class="c1"># Select metallicity</span>
        <span class="n">M_H_Grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>  <span class="c1"># Available metallicity values in 3D models</span>
        <span class="n">M_H_Grid_load</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;30&#39;</span><span class="p">,</span> <span class="s1">&#39;20&#39;</span><span class="p">,</span> <span class="s1">&#39;10&#39;</span><span class="p">,</span> <span class="s1">&#39;00&#39;</span><span class="p">]</span>  <span class="c1"># The according identifiers to individual available M_H values</span>
        <span class="n">optM</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">M_H</span> <span class="o">-</span> <span class="n">M_H_Grid</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>  <span class="c1"># Find index at which the closes M_H values from available values is to the input M_H.</span>

        <span class="c1"># Select Teff</span>
        <span class="n">Teff_Grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4000</span><span class="p">,</span> <span class="mi">4500</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mi">5500</span><span class="p">,</span> <span class="mi">5777</span><span class="p">,</span> <span class="mi">6000</span><span class="p">,</span> <span class="mi">6500</span><span class="p">,</span> <span class="mi">7000</span><span class="p">])</span>  <span class="c1"># Available Teff values in 3D models</span>
        <span class="n">optT</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">Teff</span> <span class="o">-</span> <span class="n">Teff_Grid</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>  <span class="c1"># Find index at which the Teff values is, that is closest to input Teff.</span>

        <span class="c1"># Select logg, depending on Teff. If several logg possibilities are given for one Teff, pick the one that is</span>
        <span class="c1"># closest to user input (logg).</span>

        <span class="k">if</span> <span class="n">Teff_Grid</span><span class="p">[</span><span class="n">optT</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4000</span><span class="p">:</span>
            <span class="n">logg_Grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">])</span>
            <span class="n">optG</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">logg</span> <span class="o">-</span> <span class="n">logg_Grid</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">Teff_Grid</span><span class="p">[</span><span class="n">optT</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4500</span><span class="p">:</span>
            <span class="n">logg_Grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">])</span>
            <span class="n">optG</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">logg</span> <span class="o">-</span> <span class="n">logg_Grid</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">Teff_Grid</span><span class="p">[</span><span class="n">optT</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5000</span><span class="p">:</span>
            <span class="n">logg_Grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">])</span>
            <span class="n">optG</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">logg</span> <span class="o">-</span> <span class="n">logg_Grid</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">Teff_Grid</span><span class="p">[</span><span class="n">optT</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5500</span><span class="p">:</span>
            <span class="n">logg_Grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">])</span>
            <span class="n">optG</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">logg</span> <span class="o">-</span> <span class="n">logg_Grid</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">Teff_Grid</span><span class="p">[</span><span class="n">optT</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5777</span><span class="p">:</span>
            <span class="n">logg_Grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.4</span><span class="p">])</span>
            <span class="n">optG</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">elif</span> <span class="n">Teff_Grid</span><span class="p">[</span><span class="n">optT</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6000</span><span class="p">:</span>
            <span class="n">logg_Grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">])</span>
            <span class="n">optG</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">logg</span> <span class="o">-</span> <span class="n">logg_Grid</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">Teff_Grid</span><span class="p">[</span><span class="n">optT</span><span class="p">]</span> <span class="o">==</span> <span class="mi">6500</span><span class="p">:</span>
            <span class="n">logg_Grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.0</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">])</span>
            <span class="n">optG</span> <span class="o">=</span> <span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">logg</span> <span class="o">-</span> <span class="n">logg_Grid</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>

        <span class="k">elif</span> <span class="n">Teff_Grid</span><span class="p">[</span><span class="n">optT</span><span class="p">]</span> <span class="o">==</span> <span class="mi">7000</span><span class="p">:</span>
            <span class="n">logg_Grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.5</span><span class="p">])</span>
            <span class="n">optG</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Select Teff and Log g. Mtxt, Ttxt and Gtxt are then put together as string to load correct files.</span>
        <span class="n">Mtxt</span> <span class="o">=</span> <span class="n">M_H_Grid_load</span><span class="p">[</span><span class="n">optM</span><span class="p">]</span>
        <span class="n">Ttxt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:2.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Teff_Grid</span><span class="p">[</span><span class="n">optT</span><span class="p">]</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Teff_Grid</span><span class="p">[</span><span class="n">optT</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5777</span><span class="p">:</span>
            <span class="n">Ttxt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:4.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Teff_Grid</span><span class="p">[</span><span class="n">optT</span><span class="p">])</span>
        <span class="n">Gtxt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{:2.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">logg_Grid</span><span class="p">[</span><span class="n">optG</span><span class="p">]</span> <span class="o">*</span> <span class="mi">10</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="n">file</span> <span class="o">=</span> <span class="s1">&#39;mmu_t&#39;</span> <span class="o">+</span> <span class="n">Ttxt</span> <span class="o">+</span> <span class="s1">&#39;g&#39;</span> <span class="o">+</span> <span class="n">Gtxt</span> <span class="o">+</span> <span class="s1">&#39;m&#39;</span> <span class="o">+</span> <span class="n">Mtxt</span> <span class="o">+</span> <span class="s1">&#39;v05.flx&#39;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Filename:&#39;</span><span class="p">,</span> <span class="n">file</span><span class="p">)</span>

        <span class="c1"># Read data from IDL .sav file</span>
        <span class="n">sav</span> <span class="o">=</span> <span class="n">readsav</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">direc</span><span class="p">,</span> <span class="n">file</span><span class="p">))</span>  <span class="c1"># readsav reads an IDL .sav file</span>
        <span class="n">ws</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;mmd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lam</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># read in wavelength</span>
        <span class="n">flux</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;mmd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">flx</span>  <span class="c1"># read in flux</span>
        <span class="n">Teff_model</span> <span class="o">=</span> <span class="n">Teff_Grid</span><span class="p">[</span><span class="n">optT</span><span class="p">]</span>
        <span class="n">logg_model</span> <span class="o">=</span> <span class="n">logg_Grid</span><span class="p">[</span><span class="n">optG</span><span class="p">]</span>
        <span class="n">MH_model</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">M_H_Grid</span><span class="p">[</span><span class="n">optM</span><span class="p">])</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Closest values to your inputs:&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Teff  : &#39;</span><span class="p">,</span> <span class="n">Teff_model</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;M_H   : &#39;</span><span class="p">,</span> <span class="n">MH_model</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;log(g): &#39;</span><span class="p">,</span> <span class="n">logg_model</span><span class="p">)</span>

        <span class="n">f0</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">f3</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="n">f4</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
        <span class="n">f5</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">f6</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">f7</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
        <span class="n">f8</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">f9</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span>
        <span class="n">f10</span> <span class="o">=</span> <span class="n">flux</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>

        <span class="c1"># Make single big array of them</span>
        <span class="n">fcalc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f0</span><span class="p">,</span> <span class="n">f1</span><span class="p">,</span> <span class="n">f2</span><span class="p">,</span> <span class="n">f3</span><span class="p">,</span> <span class="n">f4</span><span class="p">,</span> <span class="n">f5</span><span class="p">,</span> <span class="n">f6</span><span class="p">,</span> <span class="n">f7</span><span class="p">,</span> <span class="n">f8</span><span class="p">,</span> <span class="n">f9</span><span class="p">,</span> <span class="n">f10</span><span class="p">])</span>
        <span class="n">phot1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">fcalc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Mu from grid</span>
        <span class="c1"># 0.00000    0.0100000    0.0500000     0.100000     0.200000     0.300000   0.500000     0.700000     0.800000     0.900000      1.00000</span>
        <span class="n">mu</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;mmd&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mu</span>

        <span class="c1"># Passed on to main body of function are: ws, fcalc, phot1, mu</span>

    <span class="c1"># Load response function and interpolate onto kurucz model grid</span>

    <span class="c1"># FOR STIS</span>
    <span class="k">if</span> <span class="n">grating</span> <span class="o">==</span> <span class="s1">&#39;G430L&#39;</span><span class="p">:</span>
        <span class="n">sav</span> <span class="o">=</span> <span class="n">readsav</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirsen</span><span class="p">,</span> <span class="s1">&#39;G430L.STIS.sensitivity.sav&#39;</span><span class="p">))</span>  <span class="c1"># wssens,sensitivity</span>
        <span class="n">wssens</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;wssens&#39;</span><span class="p">]</span>
        <span class="n">sensitivity</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;sensitivity&#39;</span><span class="p">]</span>
        <span class="n">wdel</span> <span class="o">=</span> <span class="mi">3</span>

    <span class="k">if</span> <span class="n">grating</span> <span class="o">==</span> <span class="s1">&#39;G750M&#39;</span><span class="p">:</span>
        <span class="n">sav</span> <span class="o">=</span> <span class="n">readsav</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirsen</span><span class="p">,</span> <span class="s1">&#39;G750M.STIS.sensitivity.sav&#39;</span><span class="p">))</span>  <span class="c1"># wssens, sensitivity</span>
        <span class="n">wssens</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;wssens&#39;</span><span class="p">]</span>
        <span class="n">sensitivity</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;sensitivity&#39;</span><span class="p">]</span>
        <span class="n">wdel</span> <span class="o">=</span> <span class="mf">0.554</span>

    <span class="k">if</span> <span class="n">grating</span> <span class="o">==</span> <span class="s1">&#39;G750L&#39;</span><span class="p">:</span>
        <span class="n">sav</span> <span class="o">=</span> <span class="n">readsav</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirsen</span><span class="p">,</span> <span class="s1">&#39;G750L.STIS.sensitivity.sav&#39;</span><span class="p">))</span>  <span class="c1"># wssens, sensitivity</span>
        <span class="n">wssens</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;wssens&#39;</span><span class="p">]</span>
        <span class="n">sensitivity</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;sensitivity&#39;</span><span class="p">]</span>
        <span class="n">wdel</span> <span class="o">=</span> <span class="mf">4.882</span>

    <span class="c1"># FOR WFC3</span>
    <span class="k">if</span> <span class="n">grating</span> <span class="o">==</span> <span class="s1">&#39;G141&#39;</span><span class="p">:</span>  <span class="c1"># http://www.stsci.edu/hst/acs/analysis/reference_files/synphot_tables.html</span>
        <span class="n">sav</span> <span class="o">=</span> <span class="n">readsav</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirsen</span><span class="p">,</span> <span class="s1">&#39;G141.WFC3.sensitivity.sav&#39;</span><span class="p">))</span>  <span class="c1"># wssens, sensitivity</span>
        <span class="n">wssens</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;wssens&#39;</span><span class="p">]</span>
        <span class="n">sensitivity</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;sensitivity&#39;</span><span class="p">]</span>
        <span class="n">wdel</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">grating</span> <span class="o">==</span> <span class="s1">&#39;G102&#39;</span><span class="p">:</span>  <span class="c1"># http://www.stsci.edu/hst/acs/analysis/reference_files/synphot_tables.html</span>
        <span class="n">sav</span> <span class="o">=</span> <span class="n">readsav</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirsen</span><span class="p">,</span> <span class="s1">&#39;G141.WFC3.sensitivity.sav&#39;</span><span class="p">))</span>  <span class="c1"># wssens, sensitivity</span>
        <span class="n">wssens</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;wssens&#39;</span><span class="p">]</span>
        <span class="n">sensitivity</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;sensitivity&#39;</span><span class="p">]</span>
        <span class="n">wdel</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">grating</span> <span class="o">==</span> <span class="s1">&#39;G280&#39;</span><span class="p">:</span>  <span class="c1"># http://www.stsci.edu/hst/acs/analysis/reference_files/synphot_tables.html</span>
        <span class="n">sav</span> <span class="o">=</span> <span class="n">readsav</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirsen</span><span class="p">,</span> <span class="s1">&#39;G280.WFC3.sensitivity.sav&#39;</span><span class="p">))</span>  <span class="c1"># wssens, sensitivity</span>
        <span class="n">wssens</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;wssens&#39;</span><span class="p">]</span>
        <span class="n">sensitivity</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;sensitivity&#39;</span><span class="p">]</span>
        <span class="n">wdel</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># FOR JWST</span>
    <span class="k">if</span> <span class="n">grating</span> <span class="o">==</span> <span class="s1">&#39;NIRSpecPrism&#39;</span><span class="p">:</span>  <span class="c1"># http://www.stsci.edu/hst/acs/analysis/reference_files/synphot_tables.html</span>
        <span class="n">sav</span> <span class="o">=</span> <span class="n">readsav</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirsen</span><span class="p">,</span> <span class="s1">&#39;NIRSpec.prism.sensitivity.sav&#39;</span><span class="p">))</span>  <span class="c1"># wssens, sensitivity</span>
        <span class="n">wssens</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;wssens&#39;</span><span class="p">]</span>
        <span class="n">sensitivity</span> <span class="o">=</span> <span class="n">sav</span><span class="p">[</span><span class="s1">&#39;sensitivity&#39;</span><span class="p">]</span>
        <span class="n">wdel</span> <span class="o">=</span> <span class="mi">12</span>

    <span class="n">widek</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">wsdata</span><span class="p">))</span>
    <span class="n">wsHST</span> <span class="o">=</span> <span class="n">wssens</span>
    <span class="n">wsHST</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wsHST</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">wdel</span> <span class="o">-</span> <span class="n">wdel</span><span class="p">,</span> <span class="n">wsHST</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">wdel</span><span class="p">]),</span>
                            <span class="n">wsHST</span><span class="p">,</span>
                            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wsHST</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">wsHST</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">wdel</span><span class="p">,</span>
                                      <span class="n">wsHST</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">wsHST</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">wdel</span> <span class="o">+</span> <span class="n">wdel</span><span class="p">])))</span>

    <span class="n">respoutHST</span> <span class="o">=</span> <span class="n">sensitivity</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sensitivity</span><span class="p">)</span>
    <span class="n">respoutHST</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="n">respoutHST</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">2</span><span class="p">)))</span>
    <span class="n">inter_resp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">wsHST</span><span class="p">,</span> <span class="n">respoutHST</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">respout</span> <span class="o">=</span> <span class="n">inter_resp</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>  <span class="c1"># interpolate sensitivity curve onto model wavelength grid</span>

    <span class="n">wsdata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wsdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">wdel</span> <span class="o">-</span> <span class="n">wdel</span><span class="p">,</span> <span class="n">wsdata</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">wdel</span><span class="p">]),</span> <span class="n">wsdata</span><span class="p">,</span>
                             <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">wsdata</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">wsdata</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">wdel</span><span class="p">,</span> <span class="n">wsdata</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">wsdata</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">wdel</span> <span class="o">+</span> <span class="n">wdel</span><span class="p">])))</span>
    <span class="n">respwavebin</span> <span class="o">=</span> <span class="n">wsdata</span> <span class="o">/</span> <span class="n">wsdata</span> <span class="o">*</span> <span class="mf">0.0</span>
    <span class="n">widek</span> <span class="o">=</span> <span class="n">widek</span> <span class="o">+</span> <span class="mi">2</span>  <span class="c1"># need to add two indicies to compensate for padding with 2 zeros</span>
    <span class="n">respwavebin</span><span class="p">[</span><span class="n">widek</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="n">data_resp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">wsdata</span><span class="p">,</span> <span class="n">respwavebin</span><span class="p">,</span> <span class="n">bounds_error</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">reswavebinout</span> <span class="o">=</span> <span class="n">data_resp</span><span class="p">(</span><span class="n">ws</span><span class="p">)</span>  <span class="c1"># interpolate data onto model wavelength grid</span>

    <span class="c1"># Integrate over the spectra to make synthetic photometric points.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">fcalc</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>  <span class="c1"># Loop over spectra at diff angles</span>
        <span class="n">fcal</span> <span class="o">=</span> <span class="n">fcalc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
        <span class="n">Tot</span> <span class="o">=</span> <span class="n">int_tabulated</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">ws</span> <span class="o">*</span> <span class="n">respout</span> <span class="o">*</span> <span class="n">reswavebinout</span><span class="p">)</span>
        <span class="n">phot1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">int_tabulated</span><span class="p">(</span><span class="n">ws</span><span class="p">,</span> <span class="n">ws</span> <span class="o">*</span> <span class="n">respout</span> <span class="o">*</span> <span class="n">reswavebinout</span> <span class="o">*</span> <span class="n">fcal</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span> <span class="o">/</span> <span class="n">Tot</span>

    <span class="k">if</span> <span class="n">ld_model</span> <span class="o">==</span> <span class="s1">&#39;1D&#39;</span><span class="p">:</span>
        <span class="n">yall</span> <span class="o">=</span> <span class="n">phot1</span> <span class="o">/</span> <span class="n">phot1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">elif</span> <span class="n">ld_model</span> <span class="o">==</span> <span class="s1">&#39;3D&#39;</span><span class="p">:</span>
        <span class="n">yall</span> <span class="o">=</span> <span class="n">phot1</span> <span class="o">/</span> <span class="n">phot1</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span>

    <span class="c1"># Co = np.zeros((6, 4))   # NOT-REUSED</span>

    <span class="c1"># A = [0.0, 0.0, 0.0, 0.0]  # c1, c2, c3, c4      # NOT-REUSED</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">mu</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>     <span class="c1"># wavelength</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">yall</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>   <span class="c1"># flux</span>
    <span class="c1"># weights = x / x   # NOT-REUSED</span>

    <span class="c1"># Start fitting the different models</span>
    <span class="n">fitter</span> <span class="o">=</span> <span class="n">LevMarLSQFitter</span><span class="p">()</span>

    <span class="c1"># Fit a four parameter non-linear limb darkening model and get fitted variables, c1, c2, c3, c4.</span>
    <span class="n">corot_4_param</span> <span class="o">=</span> <span class="n">nonlinear_limb_darkening</span><span class="p">()</span>
    <span class="n">corot_4_param</span> <span class="o">=</span> <span class="n">fitter</span><span class="p">(</span><span class="n">corot_4_param</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span> <span class="o">=</span> <span class="n">corot_4_param</span><span class="o">.</span><span class="n">parameters</span>

    <span class="c1"># Fit a three parameter non-linear limb darkening model and get fitted variables, cp2, cp3, cp4 (cp1 = 0).</span>
    <span class="n">corot_3_param</span> <span class="o">=</span> <span class="n">nonlinear_limb_darkening</span><span class="p">()</span>
    <span class="n">corot_3_param</span><span class="o">.</span><span class="n">c0</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># 3 param is just 4 param with c0 = 0.0</span>
    <span class="n">corot_3_param</span> <span class="o">=</span> <span class="n">fitter</span><span class="p">(</span><span class="n">corot_3_param</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">cp1</span><span class="p">,</span> <span class="n">cp2</span><span class="p">,</span> <span class="n">cp3</span><span class="p">,</span> <span class="n">cp4</span> <span class="o">=</span> <span class="n">corot_3_param</span><span class="o">.</span><span class="n">parameters</span>

    <span class="c1"># Fit a quadratic limb darkening model and get fitted parameters aLD and bLD.</span>
    <span class="n">quadratic</span> <span class="o">=</span> <span class="n">quadratic_limb_darkening</span><span class="p">()</span>
    <span class="n">quadratic</span> <span class="o">=</span> <span class="n">fitter</span><span class="p">(</span><span class="n">quadratic</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">aLD</span><span class="p">,</span> <span class="n">bLD</span> <span class="o">=</span> <span class="n">quadratic</span><span class="o">.</span><span class="n">parameters</span>

    <span class="c1"># Fit a linear limb darkening model and get fitted variable uLD.</span>
    <span class="n">linear</span> <span class="o">=</span> <span class="n">nonlinear_limb_darkening</span><span class="p">()</span>
    <span class="n">linear</span><span class="o">.</span><span class="n">c0</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">linear</span><span class="o">.</span><span class="n">c2</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">linear</span><span class="o">.</span><span class="n">c3</span><span class="o">.</span><span class="n">fixed</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">linear</span> <span class="o">=</span> <span class="n">fitter</span><span class="p">(</span><span class="n">linear</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">uLD</span> <span class="o">=</span> <span class="n">linear</span><span class="o">.</span><span class="n">c1</span><span class="o">.</span><span class="n">value</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">Limb darkening parameters:&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;4param </span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;3param </span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cp2</span><span class="p">,</span> <span class="n">cp3</span><span class="p">,</span> <span class="n">cp4</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Quad </span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">aLD</span><span class="p">,</span> <span class="n">bLD</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Linear </span><span class="se">\t</span><span class="si">{:0.8f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">uLD</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">uLD</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">cp1</span><span class="p">,</span> <span class="n">cp2</span><span class="p">,</span> <span class="n">cp3</span><span class="p">,</span> <span class="n">cp4</span><span class="p">,</span> <span class="n">aLD</span><span class="p">,</span> <span class="n">bLD</span>


<span class="k">def</span><span class="w"> </span><span class="nf">int_tabulated</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">Xsegments</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="c1"># Sort vectors into ascending order.</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">sort</span><span class="p">:</span>
        <span class="n">ii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">Xsegments</span> <span class="o">%</span> <span class="mi">4</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">Xsegments</span> <span class="o">=</span> <span class="n">Xsegments</span> <span class="o">+</span> <span class="mi">1</span>

    <span class="n">Xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
    <span class="n">Xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="c1"># Uniform step size.</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="n">Xmax</span> <span class="o">+</span> <span class="mf">0.0</span> <span class="o">-</span> <span class="n">Xmin</span><span class="p">)</span> <span class="o">/</span> <span class="n">Xsegments</span>
    <span class="c1"># Compute the interpolates at Xgrid.</span>
    <span class="c1"># x values of interpolates &gt;&gt; Xgrid = h * FINDGEN(Xsegments + 1L) + Xmin</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">splev</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Xsegments</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">Xmin</span><span class="p">,</span> <span class="n">splrep</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">F</span><span class="p">))</span>

    <span class="c1"># Compute the integral using the 5-point Newton-Cotes formula.</span>
    <span class="n">ii</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">4</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">h</span> <span class="o">*</span> <span class="p">(</span><span class="mf">7.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span> <span class="o">-</span> <span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="n">z</span><span class="p">[</span><span class="n">ii</span><span class="p">])</span> <span class="o">+</span> <span class="mf">32.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">ii</span> <span class="o">-</span> <span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">z</span><span class="p">[</span><span class="n">ii</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="mf">12.0</span> <span class="o">*</span> <span class="n">z</span><span class="p">[</span><span class="n">ii</span> <span class="o">-</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="mf">45.0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="now-define-the-transit-model-function">
<h2>Now define the transit model function<a class="headerlink" href="#now-define-the-transit-model-function" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">occultnl</span><span class="p">(</span><span class="n">rl</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">b0</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    MANDEL &amp; AGOL (2002) transit model.</span>
<span class="sd">    :param rl: float, transit depth (Rp/R*)</span>
<span class="sd">    :param c1: float, limb darkening parameter 1</span>
<span class="sd">    :param c2: float, limb darkening parameter 2</span>
<span class="sd">    :param c3: float, limb darkening parameter 3</span>
<span class="sd">    :param c4: float, limb darkening parameter 4</span>
<span class="sd">    :param b0: impact parameter in stellar radii</span>
<span class="sd">    :return: mulimb0: limb-darkened transit model, mulimbf: lightcurves for each component that you put in the model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mulimb0</span> <span class="o">=</span> <span class="n">occultuniform</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="n">rl</span><span class="p">)</span>
    <span class="n">bt0</span> <span class="o">=</span> <span class="n">b0</span>
    <span class="n">fac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mulimb0</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">fac</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">fac</span> <span class="o">=</span> <span class="mf">1e-6</span>  <span class="c1"># DKS edit</span>

    <span class="n">omega</span> <span class="o">=</span> <span class="mi">4</span> <span class="o">*</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">c2</span> <span class="o">-</span> <span class="n">c3</span> <span class="o">-</span> <span class="n">c4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">/</span> <span class="mi">5</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">+</span> <span class="n">c3</span> <span class="o">/</span> <span class="mi">7</span> <span class="o">+</span> <span class="n">c4</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span>
    <span class="n">nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b0</span><span class="p">)</span>
    <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mulimb0</span> <span class="o">!=</span> <span class="mf">1.0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indx</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">indx</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">mulimb</span> <span class="o">=</span> <span class="n">mulimb0</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
    <span class="n">mulimbf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="n">nb</span><span class="p">))</span>
    <span class="n">mulimbf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">mulimbf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">1.</span>
    <span class="n">mulimbf</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">mulimbf</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">0.8</span>
    <span class="n">mulimbf</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">mulimbf</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span>
    <span class="n">mulimbf</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">mulimbf</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">7</span>
    <span class="n">mulimbf</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">mulimbf</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">nr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int64</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">dmumax</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="k">while</span> <span class="p">(</span><span class="n">dmumax</span> <span class="o">&gt;</span> <span class="n">fac</span> <span class="o">*</span> <span class="mf">1.e-3</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">nr</span> <span class="o">&lt;=</span> <span class="mi">131072</span><span class="p">):</span>
        <span class="c1"># print(nr)</span>
        <span class="n">mulimbp</span> <span class="o">=</span> <span class="n">mulimb</span>
        <span class="n">nr</span> <span class="o">=</span> <span class="n">nr</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="n">nr</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">dt</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nr</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">th</span> <span class="o">=</span> <span class="n">t</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">dt</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        <span class="n">sig</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">[</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
        <span class="n">mulimbhalf</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">mulimb0</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">mulimb1</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">mulimb0</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">mulimb3half</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">mulimb0</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">mulimb2</span> <span class="o">=</span> <span class="n">sig</span> <span class="o">**</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">mulimb0</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="n">nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">nr</span><span class="p">):</span>
            <span class="n">mu</span> <span class="o">=</span> <span class="n">occultuniform</span><span class="p">(</span><span class="n">b0</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">/</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">rl</span> <span class="o">/</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">sig1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]))</span>
            <span class="n">sig2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">mulimbhalf</span> <span class="o">=</span> <span class="n">mulimbhalf</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig1</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">sig2</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">mulimb1</span> <span class="o">=</span> <span class="n">mulimb1</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig1</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">sig2</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">mulimb3half</span> <span class="o">=</span> <span class="n">mulimb3half</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig1</span> <span class="o">**</span> <span class="mi">5</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">sig2</span> <span class="o">**</span> <span class="mi">5</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            <span class="n">mulimb2</span> <span class="o">=</span> <span class="n">mulimb2</span> <span class="o">+</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="p">(</span><span class="n">sig1</span> <span class="o">**</span> <span class="mi">6</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">sig2</span> <span class="o">**</span> <span class="mi">6</span> <span class="o">/</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

        <span class="n">mulimb</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c1</span> <span class="o">-</span> <span class="n">c2</span> <span class="o">-</span> <span class="n">c3</span> <span class="o">-</span> <span class="n">c4</span><span class="p">)</span> <span class="o">*</span> <span class="n">mulimb0</span><span class="p">[</span>
            <span class="n">indx</span><span class="p">]</span> <span class="o">+</span> <span class="n">c1</span> <span class="o">*</span> <span class="n">mulimbhalf</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">c2</span> <span class="o">*</span> <span class="n">mulimb1</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">c3</span> <span class="o">*</span> <span class="n">mulimb3half</span> <span class="o">*</span> <span class="n">dt</span> <span class="o">+</span> <span class="n">c4</span> <span class="o">*</span> <span class="n">mulimb2</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span> <span class="o">/</span> <span class="n">omega</span>
        <span class="n">ix1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">mulimb</span> <span class="o">+</span> <span class="n">mulimbp</span> <span class="o">!=</span> <span class="mf">0.</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ix1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ix1</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="c1"># print(ix1)</span>
        <span class="c1"># python cannot index on single values so you need to use atlest_1d for the below to work when mulimb is a single value</span>
        <span class="n">dmumax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">mulimb</span><span class="p">)[</span><span class="n">ix1</span><span class="p">]</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">mulimbp</span><span class="p">)[</span><span class="n">ix1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">mulimb</span><span class="p">)[</span><span class="n">ix1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">mulimbp</span><span class="p">)[</span><span class="n">ix1</span><span class="p">]))</span>

    <span class="n">mulimbf</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">mulimb0</span><span class="p">)[</span><span class="n">indx</span><span class="p">]</span>
    <span class="n">mulimbf</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">mulimbhalf</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">mulimbf</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">mulimb1</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">mulimbf</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">mulimb3half</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">mulimbf</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">mulimb2</span> <span class="o">*</span> <span class="n">dt</span>
    <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">mulimb0</span><span class="p">)[</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">mulimb</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">bt0</span>

    <span class="k">return</span> <span class="n">mulimb0</span><span class="p">,</span> <span class="n">mulimbf</span>


<span class="k">def</span><span class="w"> </span><span class="nf">occultuniform</span><span class="p">(</span><span class="n">b0</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the lightcurve for occultation of a uniform source without microlensing (Mandel &amp; Agol 2002).</span>

<span class="sd">    :param b0: array; impact parameter in units of stellar radii</span>
<span class="sd">    :param w: array; occulting star size in units of stellar radius</span>
<span class="sd">    :return: muo1: float; fraction of flux at each b0 for a uniform source</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">w</span> <span class="o">-</span> <span class="mf">0.5</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1.0e-3</span><span class="p">:</span>
        <span class="n">w</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="n">nb</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">b0</span><span class="p">))</span>
    <span class="n">muo1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nb</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nb</span><span class="p">):</span>
        <span class="c1"># substitute z=b0(i) to shorten expressions</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">b0</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
        <span class="c1"># z = z.value    # stripping it of astropy units</span>
        <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="o">+</span><span class="n">w</span><span class="p">:</span>
            <span class="n">muo1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">w</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">&lt;=</span> <span class="n">w</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">muo1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="n">z</span> <span class="o">&gt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">w</span><span class="p">)</span> <span class="ow">and</span> <span class="n">z</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">+</span><span class="n">w</span><span class="p">:</span>
            <span class="n">kap1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">w</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">z</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">z</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)))</span>
            <span class="n">kap0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">w</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">z</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">w</span> <span class="o">/</span> <span class="n">z</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)))</span>
            <span class="n">lambdae</span> <span class="o">=</span> <span class="n">w</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">kap0</span> <span class="o">+</span> <span class="n">kap1</span>
            <span class="n">lambdae</span> <span class="o">=</span> <span class="p">(</span><span class="n">lambdae</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mf">4.</span> <span class="o">*</span> <span class="n">z</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">z</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">w</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="mf">0.</span><span class="p">))))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span>
            <span class="n">muo1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">lambdae</span>

        <span class="k">if</span> <span class="n">z</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="o">-</span><span class="n">w</span><span class="p">:</span>
            <span class="n">muo1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">w</span> <span class="o">**</span> <span class="mi">2</span>
            <span class="k">continue</span>

    <span class="k">return</span> <span class="n">muo1</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="now-define-the-function-to-generate-the-transit-light-curve-and-compare-it-to-the-data">
<h2>Now define the function to generate the transit light curve and compare it to the data<a class="headerlink" href="#now-define-the-function-to-generate-the-transit-light-curve-and-compare-it-to-the-data" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Functions to call and calculate models</span>
<span class="k">def</span><span class="w"> </span><span class="nf">residual</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">):</span>
    <span class="c1"># calculate new orbit</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_Rs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cosinc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Select indicies between first and fourth contact</span>
    <span class="n">intransit</span> <span class="o">=</span> <span class="p">(</span><span class="n">b0</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mf">1.0E0</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
    <span class="c1"># Make light curve model, set all values initially to 1.0</span>
    <span class="n">light_curve</span> <span class="o">=</span> <span class="n">b0</span><span class="o">/</span><span class="n">b0</span>
    <span class="n">mulimb0</span><span class="p">,</span> <span class="n">mulimbf</span> <span class="o">=</span> <span class="n">occultnl</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">b0</span><span class="p">[</span><span class="n">intransit</span><span class="p">])</span>  <span class="c1"># Madel and Agol</span>
    <span class="n">light_curve</span><span class="p">[</span><span class="n">intransit</span><span class="p">]</span> <span class="o">=</span> <span class="n">mulimb0</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">(</span><span class="n">light_curve</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;Fslope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">phase</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;xsh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">shx</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;x2sh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">shx</span><span class="o">**</span><span class="mf">2.</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ysh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">shy</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;y2sh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">shy</span><span class="o">**</span><span class="mf">2.</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;xysh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">shy</span> <span class="o">*</span> <span class="n">shx</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;comm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">common_mode</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="c1"># transit model is baseline flux X transit model X systematics model</span>
    <span class="n">chi2now</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">model</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">err</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">model</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;rprs: &quot;</span><span class="p">,</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="s2">&quot;current chi^2=&quot;</span><span class="p">,</span> <span class="n">chi2now</span><span class="p">,</span> <span class="s1">&#39; scatter &#39;</span><span class="p">,</span> <span class="n">res</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">model</span><span class="p">)</span><span class="o">/</span><span class="n">err</span>
    <span class="c1"># return np.sum((y-model)**2/err**2)</span>
</pre></div>
</div>
</div>
</div>
<p>A function is also defined to return just the transit model <span class="math notranslate nohighlight">\(T(t,\theta)\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">model_fine</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>  <span class="c1"># Make Transit model with a fine grid for plotting purposes</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_Rs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase_fine</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cosinc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase_fine</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">mulimb0</span><span class="p">,</span> <span class="n">mulimbf</span> <span class="o">=</span> <span class="n">occultnl</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span>  <span class="c1"># Madel and Agol</span>
    <span class="n">model_fine</span> <span class="o">=</span> <span class="n">mulimb0</span>
    <span class="k">return</span> <span class="n">model_fine</span>
</pre></div>
</div>
</div>
</div>
<p>Now add a transit model to the Example Light curve.  Here, weâ€™ve compute the limb darkening coefficients, then use them in the transit light curve.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wave1</span> <span class="o">=</span> <span class="n">wsdata_all</span><span class="p">[</span><span class="n">pix1</span><span class="p">]</span>
<span class="n">wave2</span> <span class="o">=</span> <span class="n">wsdata_all</span><span class="p">[</span><span class="n">pix2</span><span class="p">]</span>
<span class="n">bin_wave_index</span> <span class="o">=</span> <span class="p">((</span><span class="n">wsdata_all</span> <span class="o">&gt;</span> <span class="n">wave1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wsdata_all</span> <span class="o">&lt;=</span> <span class="n">wave2</span><span class="p">))</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
<span class="n">wsdata</span> <span class="o">=</span> <span class="n">wsdata_all</span><span class="p">[</span><span class="n">bin_wave_index</span><span class="p">]</span><span class="o">*</span><span class="mf">1E4</span> <span class="c1"># Select wavelength bin values (um=&gt; angstroms)</span>

<span class="n">_uLD</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">_cp1</span><span class="p">,</span> <span class="n">_cp2</span><span class="p">,</span> <span class="n">_cp3</span><span class="p">,</span> <span class="n">_cp4</span><span class="p">,</span> <span class="n">aLD</span><span class="p">,</span> <span class="n">bLD</span> <span class="o">=</span> <span class="n">limb_dark_fit</span><span class="p">(</span><span class="n">grating</span><span class="p">,</span> <span class="n">wsdata</span><span class="p">,</span> <span class="n">M_H</span><span class="p">,</span> <span class="n">Teff</span><span class="p">,</span> <span class="n">logg</span><span class="p">,</span> <span class="n">limb_dark_directory</span><span class="p">,</span> <span class="n">ld_model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.87682038	-0.73755073	0.57722987	-0.19560354
3param 	2.19231523	-3.11195028	1.36536758
Quad 	0.02781793	0.37167807
Linear 	0.34303528
</pre></div>
</div>
</div>
</div>
<p>Now run the transit model.</p>
<p>The transit parameters such as inclination and <span class="math notranslate nohighlight">\(a/R_{star}\)</span> have been setup at the beginning of the notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Run the Transit Model</span>
<span class="n">rl</span> <span class="o">=</span> <span class="mf">0.0825</span>     <span class="c1"># Planet-to-star Radius Ratio</span>

<span class="n">b0</span> <span class="o">=</span> <span class="n">a_Rs</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">inc</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">intransit</span> <span class="o">=</span> <span class="p">(</span><span class="n">b0</span><span class="o">-</span><span class="n">rl</span> <span class="o">&lt;</span> <span class="mf">1.0E0</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>  <span class="c1"># Select indicies between first and fourth contact</span>

<span class="n">mulimb0</span><span class="p">,</span> <span class="n">mulimbf</span> <span class="o">=</span> <span class="n">occultnl</span><span class="p">(</span><span class="n">rl</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">b0</span><span class="p">)</span>  <span class="c1"># Mandel &amp; Agol non-linear limb darkened transit model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">mulimb0</span><span class="o">*</span><span class="n">yfit</span> 

<span class="c1"># plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">]</span>           <span class="c1"># Figure dimensions</span>
<span class="n">msize</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;lines.markersize&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mf">2.</span>           <span class="c1"># default marker size</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">gs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.00</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.00</span><span class="p">)</span>
<span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bjd</span><span class="p">,</span> <span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">]),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f(t)$ Data&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">msize</span><span class="o">*</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">bjd</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$S(x)$ Regression fit &#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.85</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative Flux&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Time-series Transit Light Curve  $\lambda=$[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wsdata_all</span><span class="p">[</span><span class="n">pix1</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wsdata_all</span><span class="p">[</span><span class="n">pix2</span><span class="p">])</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;] $\mu$m&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.005</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.002</span><span class="p">))</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))</span>
<span class="n">yplot</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">yplot</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">*</span><span class="mf">0.999</span><span class="p">,</span> <span class="n">yplot</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1.001</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">bjd</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">bjd</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
<span class="c1"># Residual</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">bjd</span><span class="p">,</span> <span class="mf">1E6</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">])</span><span class="o">-</span><span class="n">model</span><span class="p">),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$f(t)$ Data&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">msize</span><span class="o">*</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">wsb</span><span class="p">,</span> <span class="n">wsb_bin_edges</span><span class="p">,</span> <span class="n">binnumber</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">binned_statistic</span><span class="p">(</span><span class="n">bjd</span><span class="p">,</span> <span class="mf">1E6</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">])</span><span class="o">-</span><span class="n">model</span><span class="p">),</span> <span class="n">bins</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">wsb_bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">wsb</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Barycentric Julian Date (days)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual (ppm)&#39;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.005</span><span class="p">))</span>
<span class="n">yplot</span> <span class="o">=</span> <span class="n">y</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">bjd</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">bjd</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># print chi^2 value</span>
<span class="n">err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Chi^2 = &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">])</span><span class="o">-</span><span class="n">model</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">err</span><span class="o">**</span><span class="mi">2</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Residual Standard Deviation : &#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mf">1E6</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">])</span><span class="o">-</span><span class="n">model</span><span class="p">)))</span><span class="o">+</span><span class="s1">&#39; ppm&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;256 Bin Standard Deviation  :&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">wsb</span><span class="p">))</span><span class="o">+</span><span class="s1">&#39; ppm&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/1695522111.py:16: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(bjd, y/np.mean(y[outtransit]), label=&#39;$f(t)$ Data&#39;, zorder=1, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/1695522111.py:32: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(bjd, 1E6*(y/np.mean(y[outtransit])-model), label=&#39;$f(t)$ Data&#39;, zorder=1, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<img alt="../../../_images/7cee0fdc76c9452de55f51fd53183b6f753267b46f3ff9ccae690d18028eb5d5.png" src="../../../_images/7cee0fdc76c9452de55f51fd53183b6f753267b46f3ff9ccae690d18028eb5d5.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Chi^2 = 9265.443675786024
Residual Standard Deviation : 789.8093551317617 ppm
256 Bin Standard Deviation  :196.83308658203643 ppm
</pre></div>
</div>
</div>
</div>
<p>Note that the model transit depth is a little too deep compared to the data. The planet radius needs to be smaller, and the parameter <span class="math notranslate nohighlight">\(rl\)</span> is closer to 0.08.  As an exercise you can re-run the above cell changing the planet radius to <span class="math notranslate nohighlight">\(rl\)</span>=0.0805 and compare the <span class="math notranslate nohighlight">\(\chi^2\)</span> value to the previous default value (<span class="math notranslate nohighlight">\(\chi^2\)</span>=9265.4 at <span class="math notranslate nohighlight">\(rl\)</span> = 0.0825).</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="fit-transit-light-curves">
<h1>FIT Transit Light Curves<a class="headerlink" href="#fit-transit-light-curves" title="Link to this heading">#</a></h1>
<p>Now we can fit each light curve, optimizing the fit parameters with a least-squares fit. Here a Levenberg-Marquart fit is used to find a <span class="math notranslate nohighlight">\(\chi^2\)</span> minimum and estimate uncertainties using the lmfit package (https://lmfit.github.io/lmfit-py/fitting.html).</p>
<p>In practice, first we would fit the white light curve, which consists of summing over all of the wavelengths in the entire 1D spectra.  This can then be used to fit for the system parameters such as inclination and transit time, and then the spectroscopic channels are then fixed to these values as they are wavelength-independent.  However, the CV3 data required the overall variations of the lamp to be removed, which prevents our use of using this data for a white light curve analysis.  Here, we proceed to fitting for the spectroscopic light curve bins.</p>
<p>The steps are as follows:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1) Wavelength Bin is selected

2) Limb-darkening coefficients are calculated from a stellar model for each bin. 

3) An initial linear regression is performed on the out-of-transit data to start the 
systematic fit parameters, this greatly speeds up the fit as those parameters start 
near their global minimum.

4) The fit is started, and some statistics are output during the minimization

5) Once the best-fit is found, a number of statistics are displayed 

6) Finally, several plots are generated which are stored as PDFs and the next bin is started.
</pre></div>
</div>
<p>These steps are performed for each spectral bin.</p>
<p>In this example, the planet radius is set to vary in the fit along with the baseline flux and instrument systematic parameters.</p>
<section id="setup-wavelengths-to-fit-over">
<h2>Setup Wavelengths to fit over<a class="headerlink" href="#setup-wavelengths-to-fit-over" title="Link to this heading">#</a></h2>
<p>The spectra must be binned in wavelength to get sufficient counts to reach ~100 ppm levels needed.
The spectra has significant counts from about pixel 100 to 400, we start at pixel <span class="math notranslate nohighlight">\(k0\)</span> and bin the spectra by <span class="math notranslate nohighlight">\(wk\)</span> pixels.</p>
<p>Several arrays are also defined.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k0</span> <span class="o">=</span> <span class="mi">113</span> <span class="c1"># 98   #100</span>
<span class="n">kend</span> <span class="o">=</span> <span class="mi">392</span> <span class="c1"># 422</span>
<span class="n">wk</span> <span class="o">=</span> <span class="mi">15</span>
<span class="n">number_of_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">kend</span><span class="o">-</span><span class="n">k0</span><span class="p">)</span><span class="o">/</span><span class="n">wk</span><span class="p">)</span>
<span class="n">wsd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_bins</span><span class="p">))</span>
<span class="n">werr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_bins</span><span class="p">))</span>
<span class="n">rprs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_bins</span><span class="p">))</span>
<span class="n">rerr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_bins</span><span class="p">))</span>
<span class="n">sig_r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_bins</span><span class="p">))</span>
<span class="n">sig_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_bins</span><span class="p">))</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_bins</span><span class="p">))</span>
<span class="n">depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_bins</span><span class="p">))</span>
<span class="n">depth_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">number_of_bins</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="loop-over-wavelength-bins-fitting-each-lightcurve">
<h2>Loop Over Wavelength Bins Fitting Each Lightcurve<a class="headerlink" href="#loop-over-wavelength-bins-fitting-each-lightcurve" title="Link to this heading">#</a></h2>
<section id="note-this-step-takes-considerable-time-to-complete-20-min-few-minutes-bin">
<h3>Note this step takes considerable time to complete (~20 min, few minutes/bin)<a class="headerlink" href="#note-this-step-takes-considerable-time-to-complete-20-min-few-minutes-bin" title="Link to this heading">#</a></h3>
<p>Each wavelength bin is fit for the transit+systematics model. Various outputs including plots are saved.
Can skip to the next cells to load pre-computed results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">k</span> <span class="o">=</span> <span class="n">k0</span>   <span class="c1"># wavelength to start</span>
<span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Loop over wavelength bins and fit for each one</span>
<span class="k">for</span> <span class="nb">bin</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_bins</span><span class="p">):</span>
    
    <span class="c1"># Select wavelength bin</span>
    <span class="n">wave1</span> <span class="o">=</span> <span class="n">wsdata_all</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
    <span class="n">wave2</span> <span class="o">=</span> <span class="n">wsdata_all</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="n">wk</span><span class="p">]</span>

    <span class="c1"># Indicies to select for wavelgth bin</span>
    <span class="n">bin_wave_index</span> <span class="o">=</span> <span class="p">((</span><span class="n">wsdata_all</span> <span class="o">&gt;</span> <span class="n">wave1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wsdata_all</span> <span class="o">&lt;=</span> <span class="n">wave2</span><span class="p">))</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>

    <span class="c1"># make light curve bin</span>
    <span class="n">wave_bin_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">all_spec_1D</span><span class="p">[</span><span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">:</span><span class="n">k</span><span class="o">+</span><span class="n">wk</span><span class="p">,</span> <span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Sum Wavelength pixels</span>
    <span class="n">wave_bin_counts_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">wave_bin_counts</span><span class="p">)</span>            <span class="c1"># adopt photon noise for errors</span>

    <span class="c1"># Calculate Limb Darkening</span>

    <span class="n">wsdata</span> <span class="o">=</span> <span class="n">wsdata_all</span><span class="p">[</span><span class="n">bin_wave_index</span><span class="p">]</span><span class="o">*</span><span class="mf">1E4</span> <span class="c1"># Select wavelength bin values (um=&gt; angstroms)</span>
    <span class="n">_uLD</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">_cp1</span><span class="p">,</span> <span class="n">_cp2</span><span class="p">,</span> <span class="n">_cp3</span><span class="p">,</span> <span class="n">_cp4</span><span class="p">,</span> <span class="n">aLD</span><span class="p">,</span> <span class="n">bLD</span> <span class="o">=</span> <span class="n">limb_dark_fit</span><span class="p">(</span><span class="n">grating</span><span class="p">,</span> <span class="n">wsdata</span><span class="p">,</span> <span class="n">M_H</span><span class="p">,</span> <span class="n">Teff</span><span class="p">,</span> <span class="n">logg</span><span class="p">,</span> <span class="n">limb_dark_directory</span><span class="p">,</span> <span class="n">ld_model</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">c1 = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c1</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;c2 = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c2</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;c3 = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c3</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;c4 = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c4</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="c1"># u   = [c1,c2,c3,c4]      # limb darkening coefficients</span>
    <span class="c1"># u = [aLD, bLD]</span>

    <span class="c1"># Make initial model</span>
    
    <span class="c1"># Setup LMFIT</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">bjd</span>                    <span class="c1"># X data</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">wave_bin_counts</span>        <span class="c1"># Y data</span>
    <span class="n">err</span> <span class="o">=</span> <span class="n">wave_bin_counts_err</span>  <span class="c1"># Y Error</span>

    <span class="c1"># Perform Quick Linear regression on out-of-transit data to obtain accurate starting Detector fit values</span>
    <span class="k">if</span> <span class="n">wave1</span> <span class="o">&gt;</span> <span class="mf">2.7</span> <span class="ow">and</span> <span class="n">wave1</span> <span class="o">&lt;</span> <span class="mf">3.45</span><span class="p">:</span>
        <span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">XXX</span><span class="p">[</span><span class="n">outtransit</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">]))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">XX</span><span class="p">[</span><span class="n">outtransit</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">]))</span>

    <span class="c1"># create a set of Parameters for LMFIT https://lmfit.github.io/lmfit-py/parameters.html</span>
    <span class="c1"># class Parameter(name, value=None, vary=True, min=- inf, max=inf, expr=None, brute_step=None, user_data=None)Â¶</span>
    <span class="c1"># Set vary=0 to fix</span>
    <span class="c1"># Set vary=1 to fit</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">Parameters</span><span class="p">()</span>  <span class="c1"># object to store L-M fit Parameters           # Parameter Name</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;cosinc&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">inc</span><span class="p">),</span> <span class="n">vary</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>                <span class="c1"># inclination, vary cos(inclin)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;rho_star&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">rho_star</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>                <span class="c1"># stellar density</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;a_Rs&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">a_Rs</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>                <span class="c1"># a/Rstar</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;rprs&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">rp</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># planet-to-star radius ratio</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;t0&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">t0</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>                <span class="c1"># Transit T0</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;f0&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">]),</span> <span class="n">vary</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>         <span class="c1"># Baseline Flux</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;ecc&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">ecc</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># eccentricity</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;omega&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">omega</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>                <span class="c1"># arguments of periatron</span>
    <span class="c1"># Turn on a linear slope in water feature to account for presumably changing H2O ice builtup on widow during cryogenic test</span>
    <span class="k">if</span> <span class="n">wave1</span> <span class="o">&gt;</span> <span class="mf">2.7</span> <span class="ow">and</span> <span class="n">wave1</span> <span class="o">&lt;</span> <span class="mf">3.45</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Fslope&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">regressor</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                <span class="c1"># Orbital phase</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Fslope&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vary</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>                          <span class="c1"># Orbital phase</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;xsh&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">regressor</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                 <span class="c1"># Detector X-shift detrending</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;ysh&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">regressor</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                 <span class="c1"># Detector X-shift detrending</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;x2sh&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">regressor</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                <span class="c1"># Detector X^2-shift detrending</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;y2sh&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">regressor</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                <span class="c1"># Detector Y^2-shift detrending</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;xysh&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">regressor</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                <span class="c1"># Detector X*Y detrending</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;comm&#39;</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="n">regressor</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">vary</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>                <span class="c1"># Common-Mode detrending</span>
    
    <span class="c1"># Perform Minimization https://lmfit.github.io/lmfit-py/fitting.html</span>
    <span class="c1"># create Minimizer</span>
    <span class="c1"># mini = lmfit.Minimizer(residual, p, nan_policy=&#39;omit&#39;,fcn_args=(phase,x,y,err)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Fitting Bin&#39;</span><span class="p">,</span> <span class="nb">bin</span><span class="p">,</span> <span class="s1">&#39; Wavelength =&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wsdata</span><span class="p">)</span><span class="o">/</span><span class="mf">1E4</span><span class="p">,</span> <span class="s1">&#39;  Range= [&#39;</span><span class="p">,</span> <span class="n">wave1</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">wave2</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>

    <span class="c1">#  solve with Levenberg-Marquardt using the</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">lmfit</span><span class="o">.</span><span class="n">minimize</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">p</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">phase</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">))</span>
    <span class="c1"># result = mini.minimize(method=&#39;emcee&#39;)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Re-Fitting Bin&#39;</span><span class="p">,</span> <span class="nb">bin</span><span class="p">,</span> <span class="s1">&#39; Wavelength =&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wsdata</span><span class="p">)</span><span class="o">/</span><span class="mf">1E4</span><span class="p">,</span> <span class="s1">&#39;  Range= [&#39;</span><span class="p">,</span> <span class="n">wave1</span><span class="p">,</span> <span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">wave2</span><span class="p">,</span> <span class="s1">&#39;]&#39;</span><span class="p">)</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;redchi&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">redchi</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;chi2&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">chisqr</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;nfree&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">nfree</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bic&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">bic</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;aic&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">aic</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;L-M FIT Variable&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">lmfit</span><span class="o">.</span><span class="n">fit_report</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>
    <span class="n">text_file</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_directory</span><span class="o">+</span><span class="s1">&#39;JWST_NIRSpec_Prism_fit_light_curve_bin&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">bin</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_statistics.txt&#39;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">redchi &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">redchi</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">chi2   &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">chisqr</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">nfree  &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">nfree</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">bic    &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">bic</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">aic    &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">aic</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">lmfit</span><span class="o">.</span><span class="n">fit_report</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">))</span>
    <span class="c1"># file-output.py</span>

    <span class="c1"># Update with best-fit parameters</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rho_star&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rho_star&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;cosinc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;cosinc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;t0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;Fslope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;Fslope&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;xsh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;xsh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;ysh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;ysh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;x2sh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;x2sh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;y2sh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;y2sh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;xysh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;xysh&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">p</span><span class="p">[</span><span class="s1">&#39;comm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;comm&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="c1"># Update Fit Spectra arrays</span>
    <span class="n">wsd</span><span class="p">[</span><span class="nb">bin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">wsdata</span><span class="p">)</span><span class="o">/</span><span class="mf">1E4</span>
    <span class="n">werr</span><span class="p">[</span><span class="nb">bin</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">wsdata</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">-</span><span class="n">wsdata</span><span class="o">.</span><span class="n">min</span><span class="p">())</span><span class="o">/</span><span class="mf">2E4</span>
    <span class="n">rprs</span><span class="p">[</span><span class="nb">bin</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">rerr</span><span class="p">[</span><span class="nb">bin</span><span class="p">]</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>

    <span class="c1"># Calculate Bestfit Model</span>
    <span class="n">final_model</span> <span class="o">=</span> <span class="n">y</span><span class="o">-</span><span class="n">result</span><span class="o">.</span><span class="n">residual</span><span class="o">*</span><span class="n">err</span>
    <span class="n">final_model_fine</span> <span class="o">=</span> <span class="n">model_fine</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="c1"># More Stats</span>
    <span class="n">resid</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">final_model</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">residppm</span> <span class="o">=</span> <span class="mf">1E6</span><span class="o">*</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">final_model</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">residerr</span> <span class="o">=</span> <span class="n">err</span><span class="o">/</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">final_model</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span><span class="o">*</span><span class="mf">1E6</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Residual standard deviation  (ppm) : &quot;</span><span class="p">,</span> <span class="mf">1E6</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">final_model</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Photon noise                 (ppm) : &quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span><span class="o">*</span><span class="mf">1E6</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Photon noise performance       (%) : &quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span><span class="o">*</span><span class="mf">1E6</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Residual standard deviation  (ppm) : &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mf">1E6</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">((</span><span class="n">y</span><span class="o">-</span><span class="n">final_model</span><span class="p">)</span><span class="o">/</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Photon noise                 (ppm) : &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span><span class="o">*</span><span class="mf">1E6</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Photon noise performance       (%) : &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="mi">1</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">))</span><span class="o">*</span><span class="mf">1E6</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">))</span>
 
    <span class="c1"># Measure Rednoise with Binning Technique</span>
    <span class="n">sig0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">resid</span><span class="p">)</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">number_of_images</span> <span class="o">/</span> <span class="n">binmeasure</span>
    <span class="n">wsb</span><span class="p">,</span> <span class="n">wsb_bin_edges</span><span class="p">,</span> <span class="n">binnumber</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">binned_statistic</span><span class="p">(</span><span class="n">bjd</span><span class="p">,</span> <span class="n">resid</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bins</span><span class="p">)</span>
    <span class="n">sig_binned</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">wsb</span><span class="p">)</span>
    <span class="n">sigrednoise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sig_binned</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">sig0</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">binmeasure</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sigrednoise</span><span class="p">):</span>
        <span class="n">sigrednoise</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># if no rednoise detected, set to zero</span>
    <span class="n">sigwhite</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sig0</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">sigrednoise</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">sigrednoise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sig_binned</span><span class="o">**</span><span class="mi">2</span><span class="o">-</span><span class="n">sigwhite</span><span class="o">**</span><span class="mi">2</span><span class="o">/</span><span class="n">binmeasure</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sigrednoise</span><span class="p">):</span> 
        <span class="n">sigrednoise</span> <span class="o">=</span> <span class="mi">0</span>   <span class="c1"># if no rednoise detected, set to zero</span>
    <span class="n">beta</span><span class="p">[</span><span class="nb">bin</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">sig0</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">binmeasure</span><span class="o">*</span><span class="n">sigrednoise</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">sig0</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;White noise                  (ppm) : &quot;</span><span class="p">,</span> <span class="mf">1E6</span><span class="o">*</span><span class="n">sigwhite</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Red noise                    (ppm) : &quot;</span><span class="p">,</span> <span class="mf">1E6</span><span class="o">*</span><span class="n">sigrednoise</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Transit depth measured error (ppm) : &quot;</span><span class="p">,</span> <span class="mf">2E6</span><span class="o">*</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
    
    <span class="n">n</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">White noise                  (ppm) : &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mf">1E6</span><span class="o">*</span><span class="n">sigwhite</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Red noise                    (ppm) : &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mf">1E6</span><span class="o">*</span><span class="n">sigrednoise</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">text_file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Transit depth measured error (ppm) : &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="mf">2E6</span><span class="o">*</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span><span class="p">))</span>
    <span class="n">text_file</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">depth</span><span class="p">[</span><span class="nb">bin</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1E6</span><span class="o">*</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">depth_err</span><span class="p">[</span><span class="nb">bin</span><span class="p">]</span> <span class="o">=</span> <span class="mf">2E6</span><span class="o">*</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="o">*</span><span class="n">result</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">stderr</span>

    <span class="n">sig_r</span><span class="p">[</span><span class="nb">bin</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigrednoise</span><span class="o">*</span><span class="mf">1E6</span>
    <span class="n">sig_w</span><span class="p">[</span><span class="nb">bin</span><span class="p">]</span> <span class="o">=</span> <span class="n">sigwhite</span><span class="o">*</span><span class="mf">1E6</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="c1"># ---------------------------------------------------------</span>
    <span class="c1"># Write Fit Spectra to ascii file</span>
    <span class="n">ascii_data</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">wsd</span><span class="p">,</span> <span class="n">werr</span><span class="p">,</span> <span class="n">rprs</span><span class="p">,</span> <span class="n">rerr</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">depth_err</span><span class="p">,</span> <span class="n">sig_w</span><span class="p">,</span> <span class="n">sig_r</span><span class="p">,</span> <span class="n">beta</span><span class="p">],</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Wavelength Center (um)&#39;</span><span class="p">,</span> <span class="s1">&#39;Wavelength half-width (um)&#39;</span><span class="p">,</span> <span class="s1">&#39;Rp/Rs&#39;</span><span class="p">,</span> <span class="s1">&#39;Rp/Rs 1-sigma error&#39;</span><span class="p">,</span> <span class="s1">&#39;Transit Depth (ppm)&#39;</span><span class="p">,</span> <span class="s1">&#39;Transit Depth error&#39;</span><span class="p">,</span> <span class="s1">&#39;Sigma_white (ppm)&#39;</span><span class="p">,</span> <span class="s1">&#39;Sigma_red (ppm)&#39;</span><span class="p">,</span> <span class="s1">&#39;Beta Rednoise Inflation factor&#39;</span><span class="p">])</span>
    <span class="n">ascii</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">ascii_data</span><span class="p">,</span> <span class="n">save_directory</span><span class="o">+</span><span class="s1">&#39;JWST_NIRSpec_Prism_fit_transmission_spectra.csv&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1"># ---------------------------------------------------------</span>
    <span class="n">msize</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;lines.markersize&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mf">2.</span> <span class="c1"># default marker size</span>
    <span class="c1"># Plot data models</span>
     
    <span class="c1"># plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mf">10.0</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">]</span>           <span class="c1"># Figure dimensions</span>
    <span class="n">msize</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;lines.markersize&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mf">2.</span>           <span class="c1"># default marker size</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">gs</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_gridspec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">hspace</span><span class="o">=</span><span class="mf">0.00</span><span class="p">,</span> <span class="n">wspace</span><span class="o">=</span><span class="mf">0.00</span><span class="p">)</span>
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">/</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">msize</span><span class="o">*</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">final_model</span><span class="o">/</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;f0&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># overplot Transit model at data</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative Flux&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Time-series Transit Light Curve  $\lambda=$[&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wave1</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">wave2</span><span class="p">)</span> <span class="o">+</span> <span class="sa">r</span><span class="s1">&#39;] $\mu$m&#39;</span><span class="p">)</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.005</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.002</span><span class="p">))</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.001</span><span class="p">))</span>
    <span class="n">yplot</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">yplot</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">*</span><span class="mf">0.999</span><span class="p">,</span> <span class="n">yplot</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">*</span><span class="mf">1.001</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">bjd</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">bjd</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">ax1</span><span class="p">)</span>
    <span class="c1"># Residual</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">residppm</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">msize</span><span class="o">*</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># overplot Transit model at data</span>
    <span class="n">wsb</span><span class="p">,</span> <span class="n">wsb_bin_edges</span><span class="p">,</span> <span class="n">binnumber</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">binned_statistic</span><span class="p">(</span><span class="n">bjd</span><span class="p">,</span> <span class="n">residppm</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">wsb_bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">wsb</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Barycentric Julian Date (days)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Residual (ppm)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">bjd</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">bjd</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">bjd</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">bjd</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="p">[</span><span class="n">sigma</span><span class="p">,</span> <span class="n">sigma</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">bjd</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">bjd</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span> <span class="p">[</span><span class="o">-</span><span class="n">sigma</span><span class="p">,</span> <span class="o">-</span><span class="n">sigma</span><span class="p">],</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.01</span><span class="p">))</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.005</span><span class="p">))</span>
    <span class="n">yplot</span> <span class="o">=</span> <span class="n">y</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">outtransit</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">bjd</span><span class="o">.</span><span class="n">min</span><span class="p">()</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">bjd</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">+</span><span class="mf">0.001</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">ax2</span><span class="p">)</span>
    <span class="c1"># save</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">save_directory</span><span class="o">+</span><span class="s1">&#39;JWST_NIRSpec_Prism_fit_light_curve_bin&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">bin</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_lightcurve.pdf&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>   
    
    <span class="c1"># plot systematic corrected light curve</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;a_Rs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phase</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;cosinc&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phase</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">intransit</span> <span class="o">=</span> <span class="p">(</span><span class="n">b0</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="mf">1.0E0</span><span class="p">)</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()</span>
    <span class="n">light_curve</span> <span class="o">=</span> <span class="n">b0</span><span class="o">/</span><span class="n">b0</span>
    <span class="n">mulimb0</span><span class="p">,</span> <span class="n">mulimbf</span> <span class="o">=</span> <span class="n">occultnl</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="s1">&#39;rprs&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">c3</span><span class="p">,</span> <span class="n">c4</span><span class="p">,</span> <span class="n">b0</span><span class="p">[</span><span class="n">intransit</span><span class="p">])</span>  <span class="c1"># Madel and Agol</span>
    <span class="n">light_curve</span><span class="p">[</span><span class="n">intransit</span><span class="p">]</span> <span class="o">=</span> <span class="n">mulimb0</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">light_curve</span><span class="o">+</span><span class="n">resid</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">msize</span><span class="o">*</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;BJD&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Relative Flux&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">light_curve</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>  <span class="c1"># overplot Transit model at data</span>
    <span class="n">pp</span> <span class="o">=</span> <span class="n">PdfPages</span><span class="p">(</span><span class="n">save_directory</span><span class="o">+</span><span class="s1">&#39;JWST_NIRSpec_Prism_fit_light_curve_bin&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">bin</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_corrected.pdf&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pp</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;pdf&#39;</span><span class="p">)</span>
    <span class="n">pp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span> <span class="c1"># close all figures</span>
    <span class="c1"># --------------------------------------------------------------------------</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="n">wk</span>  <span class="c1"># step wavelength index to next bin</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;** Can Now View Output PDFs in &#39;</span><span class="p">,</span> <span class="n">save_directory</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.93487504	-0.53100790	0.43228942	-0.16657071
3param 	2.59284576	-3.50115296	1.49775298
Quad 	0.08088662	0.45653998
Linear 	0.46807470

c1 = 0.9348750381814881
c2 = -0.5310078997267651
c3 = 0.43228941801541876
c4 = -0.16657071491026204


Fitting Bin 0  Wavelength = 1.5502650866666667   Range= [ 1.3906398 : 1.6900786 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13259.13166655233  scatter  0.002395991127564558
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13259.13166655233  scatter  0.002395991127564558
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13259.13166655233  scatter  0.002395991127564558
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 13259.38074200222  scatter  0.0023959973363420354
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13248.278737808054  scatter  0.0023959681306094903
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13259.130280097768  scatter  0.002395991001516553
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13259.131429252546  scatter  0.002395991105986051
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13259.128587330806  scatter  0.0023959911661302655
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13259.130052164794  scatter  0.002395991156807991
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13259.128612551267  scatter  0.0023959911746075746
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13259.131010275192  scatter  0.002395991067794625
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07871465070060435 current chi^2= 13085.427976810099  scatter  0.002392291458873503
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07871734914035922 current chi^2= 13085.430446645514  scatter  0.002392291573664804
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07871465070060435 current chi^2= 13085.587014370758  scatter  0.0023922675490652486
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07871465070060435 current chi^2= 13085.427963429927  scatter  0.002392291457736874
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07871465070060435 current chi^2= 13085.427976247262  scatter  0.002392291458820945
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07871465070060435 current chi^2= 13085.427966650637  scatter  0.002392291460651128
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07871465070060435 current chi^2= 13085.427969542667  scatter  0.0023922914603166693
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07871465070060435 current chi^2= 13085.427963002876  scatter  0.002392291461733644
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07871465070060435 current chi^2= 13085.42796888552  scatter  0.0023922914582929604
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07869507850297419 current chi^2= 13085.417570023197  scatter  0.0023922893084169137
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07869777683160512 current chi^2= 13085.417701212195  scatter  0.0023922893094966723
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07869507850297419 current chi^2= 13085.645099230947  scatter  0.002392265381629663
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07869507850297419 current chi^2= 13085.417570306718  scatter  0.0023922893085273553
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07869507850297419 current chi^2= 13085.417570023383  scatter  0.002392289308415772
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07869507850297419 current chi^2= 13085.41757009202  scatter  0.0023922893085145626
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07869507850297419 current chi^2= 13085.41757007312  scatter  0.0023922893084357293
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07869507850297419 current chi^2= 13085.417570193436  scatter  0.002392289308529068
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07869507850297419 current chi^2= 13085.41757008867  scatter  0.002392289308566094
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07869514603866212 current chi^2= 13085.417569994974  scatter  0.0023922892879302293
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07869514603866212 current chi^2= 13085.417569994974  scatter  0.0023922892879302293
Re-Fitting Bin 0  Wavelength = 1.5502650866666667   Range= [ 1.3906398 : 1.6900786 ]

redchi 1.598902440126463
chi2 13085.417569994974
nfree 8184
bic 3908.731693909619
aic 3852.6443871313845
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.07869515 +/- 5.4580e-04 (0.69%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        278433.709 +/- 22.2711416 (0.01%) (init = 278410.6)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:      -0.00112032 +/- 9.9569e-05 (8.89%) (init = -0.001091413)
    ysh:       3.3600e-05 +/- 9.2623e-05 (275.66%) (init = 0.0002380423)
    x2sh:     -4.1703e-04 +/- 2.2616e-04 (54.23%) (init = -0.0003157139)
    y2sh:     -3.3390e-04 +/- 2.2424e-04 (67.16%) (init = -0.0001744718)
    xysh:      6.7719e-04 +/- 4.4533e-04 (65.76%) (init = 0.0003395803)
    comm:      5.4547e-04 +/- 8.2561e-05 (15.14%) (init = 0.0002697908)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9820
    C(x2sh, xysh) = -0.9755
    C(x2sh, y2sh) = +0.9376
    C(rprs, f0)   = +0.8090
    C(xsh, ysh)   = -0.6325
    C(xsh, comm)  = -0.4878
    C(f0, x2sh)   = -0.3857
    C(f0, y2sh)   = -0.3280
    C(ysh, comm)  = -0.3010
    C(f0, xysh)   = +0.2739
    C(xsh, x2sh)  = +0.2427
    C(xsh, xysh)  = -0.2134
    C(rprs, x2sh) = -0.1917
    C(xysh, comm) = +0.1795
    C(xsh, y2sh)  = +0.1757
    C(x2sh, comm) = -0.1724
    C(rprs, xsh)  = -0.1644
    C(y2sh, comm) = -0.1486
    C(rprs, y2sh) = -0.1369
    C(rprs, ysh)  = +0.1341
    C(f0, xsh)    = -0.1185
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Residual standard deviation  (ppm) :  2392.2892879302294
Photon noise                 (ppm) :  1895.1303791485568
Photon noise performance       (%) :  79.21827801972032
White noise                  (ppm) :  2387.1294434056217
Red noise                    (ppm) :  157.34481188723825
Transit depth measured error (ppm) :  85.9031200241312
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	1.12080978	-0.97843649	0.75312747	-0.25673904
3param 	2.76671190	-3.96262651	1.73859744
Quad 	0.01052381	0.47328338
Linear 	0.41191185

c1 = 1.1208097816289275
c2 = -0.9784364859067153
c3 = 0.7531274724186052
c4 = -0.25673904162133504


Fitting Bin 1  Wavelength = 1.84545072   Range= [ 1.6900786 : 1.9783379 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 14409.258018796532  scatter  0.0015901487499034492
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 14409.258018796532  scatter  0.0015901487499034492
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 14409.258018796532  scatter  0.0015901487499034492
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 14409.640927768778  scatter  0.001590146481393384
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 14384.26032306856  scatter  0.0015901324693844408
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 14409.256908299743  scatter  0.0015901486882368267
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 14409.257916219321  scatter  0.0015901487443378867
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 14409.25555294551  scatter  0.0015901487404224768
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 14409.2576202528  scatter  0.0015901487487454792
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 14409.25456157607  scatter  0.0015901487376063068
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 14409.256671850297  scatter  0.001590148674606289
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08047646010433446 current chi^2= 14107.324261228376  scatter  0.0015893596671447225
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08047916825772544 current chi^2= 14107.324659469552  scatter  0.0015893596876831995
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08047646010433446 current chi^2= 14107.879803752661  scatter  0.0015893437275776225
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08047646010433446 current chi^2= 14107.324262182954  scatter  0.001589359667150261
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08047646010433446 current chi^2= 14107.324261352853  scatter  0.0015893596670279642
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08047646010433446 current chi^2= 14107.32426131755  scatter  0.001589359667148644
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08047646010433446 current chi^2= 14107.32426127115  scatter  0.001589359667143888
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08047646010433446 current chi^2= 14107.324261251102  scatter  0.0015893596671449827
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08047646010433446 current chi^2= 14107.324262107395  scatter  0.001589359667272411
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08047594215086162 current chi^2= 14107.324257120452  scatter  0.0015893597540903442
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08047594215086162 current chi^2= 14107.324257120452  scatter  0.0015893597540903442
Re-Fitting Bin 1  Wavelength = 1.84545072   Range= [ 1.6900786 : 1.9783379 ]

redchi 1.7237688486217562
chi2 14107.324257120452
nfree 8184
bic 4524.734588062798
aic 4468.647281284564
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.08047594 +/- 3.5164e-04 (0.44%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        679862.650 +/- 36.2424298 (0.01%) (init = 679718.7)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:      -0.00119414 +/- 6.6177e-05 (5.54%) (init = -0.001210365)
    ysh:      -5.0144e-04 +/- 6.1567e-05 (12.28%) (init = -0.0004319937)
    x2sh:     -1.1190e-04 +/- 1.5033e-04 (134.34%) (init = -8.991835e-05)
    y2sh:     -6.4120e-05 +/- 1.4905e-04 (232.45%) (init = -1.47937e-05)
    xysh:     -3.4287e-05 +/- 2.9598e-04 (863.24%) (init = -0.0001337487)
    comm:      0.00107817 +/- 5.4864e-05 (5.09%) (init = 0.001005529)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9820
    C(x2sh, xysh) = -0.9755
    C(x2sh, y2sh) = +0.9376
    C(rprs, f0)   = +0.8102
    C(xsh, ysh)   = -0.6328
    C(xsh, comm)  = -0.4875
    C(f0, x2sh)   = -0.3863
    C(f0, y2sh)   = -0.3290
    C(ysh, comm)  = -0.3011
    C(f0, xysh)   = +0.2747
    C(xsh, x2sh)  = +0.2431
    C(xsh, xysh)  = -0.2139
    C(rprs, x2sh) = -0.1930
    C(xysh, comm) = +0.1791
    C(xsh, y2sh)  = +0.1762
    C(x2sh, comm) = -0.1719
    C(rprs, xsh)  = -0.1654
    C(y2sh, comm) = -0.1482
    C(rprs, y2sh) = -0.1388
    C(rprs, ysh)  = +0.1364
    C(f0, xsh)    = -0.1196
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Residual standard deviation  (ppm) :  1589.3597540903443
Photon noise                 (ppm) :  1212.8006149210241
Photon noise performance       (%) :  76.30749500229793
White noise                  (ppm) :  1588.7050678099595
Red noise                    (ppm) :  45.70298588985219
Transit depth measured error (ppm) :  56.59739905183532
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	1.05423269	-0.97018475	0.77456625	-0.26658155
3param 	2.55249850	-3.66106776	1.61023018
Quad 	0.01394084	0.43332491
Linear 	0.38144040

c1 = 1.054232685478845
c2 = -0.9701847508054255
c3 = 0.7745662498924635
c4 = -0.2665815500226817


Fitting Bin 2  Wavelength = 2.1223476199999998   Range= [ 1.9783379 : 2.2448517 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13104.395047541406  scatter  0.0012097340872972474
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13104.395047541406  scatter  0.0012097340872972474
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13104.395047541406  scatter  0.0012097340872972474
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 13103.756183260655  scatter  0.001209738516946294
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13149.169157649845  scatter  0.001209722638840114
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13104.394142591946  scatter  0.0012097340433893807
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13104.39437290442  scatter  0.0012097340545671295
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13104.402251615043  scatter  0.001209734109802518
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13104.409762987827  scatter  0.0012097341275816049
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13104.410274065427  scatter  0.0012097341340271423
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13104.392839167042  scatter  0.00120973398067845
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07999427665261122 current chi^2= 12525.313213172107  scatter  0.0012094151562624304
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07999698220392443 current chi^2= 12525.314183691065  scatter  0.001209415177391205
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07999427665261122 current chi^2= 12526.149047384955  scatter  0.001209403049568665
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07999427665261122 current chi^2= 12525.31321136195  scatter  0.001209415156615655
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07999427665261122 current chi^2= 12525.31321175555  scatter  0.00120941515633548
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07999427665261122 current chi^2= 12525.313212349145  scatter  0.0012094151563380577
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07999427665261122 current chi^2= 12525.31321149995  scatter  0.0012094151565229835
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07999427665261122 current chi^2= 12525.313211605444  scatter  0.0012094151564910405
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07999427665261122 current chi^2= 12525.31321031395  scatter  0.0012094151566257238
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07999433269429629 current chi^2= 12525.313083182617  scatter  0.0012094149114785452
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07999433269429629 current chi^2= 12525.313083182617  scatter  0.0012094149114785452
Re-Fitting Bin 2  Wavelength = 2.1223476199999998   Range= [ 1.9783379 : 2.2448517 ]

redchi 1.5304634754621969
chi2 12525.313083182618
nfree 8184
bic 3550.3578733638005
aic 3494.270566585566
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.07999433 +/- 2.6809e-04 (0.34%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        1042975.58 +/- 42.3147414 (0.00%) (init = 1043280)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:      -7.4025e-04 +/- 5.0367e-05 (6.80%) (init = -0.0006767627)
    ysh:      -3.6016e-04 +/- 4.6857e-05 (13.01%) (init = -0.0003522163)
    x2sh:      1.4337e-04 +/- 1.1440e-04 (79.80%) (init = 0.0001534885)
    y2sh:      3.2762e-04 +/- 1.1343e-04 (34.62%) (init = 0.0003162653)
    xysh:     -3.3426e-04 +/- 2.2524e-04 (67.38%) (init = -0.0003427445)
    comm:      7.9760e-04 +/- 4.1747e-05 (5.23%) (init = 0.0007132)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9820
    C(x2sh, xysh) = -0.9755
    C(x2sh, y2sh) = +0.9377
    C(rprs, f0)   = +0.8104
    C(xsh, ysh)   = -0.6329
    C(xsh, comm)  = -0.4874
    C(f0, x2sh)   = -0.3866
    C(f0, y2sh)   = -0.3294
    C(ysh, comm)  = -0.3010
    C(f0, xysh)   = +0.2751
    C(xsh, x2sh)  = +0.2435
    C(xsh, xysh)  = -0.2142
    C(rprs, x2sh) = -0.1935
    C(xysh, comm) = +0.1793
    C(xsh, y2sh)  = +0.1765
    C(x2sh, comm) = -0.1721
    C(rprs, xsh)  = -0.1669
    C(y2sh, comm) = -0.1484
    C(rprs, y2sh) = -0.1393
    C(rprs, ysh)  = +0.1378
    C(f0, xsh)    = -0.1209
    C(rprs, xysh) = +0.1004
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Residual standard deviation  (ppm) :  1209.4149114785453
Photon noise                 (ppm) :  979.1808909743246
Photon noise performance       (%) :  80.9631898599007
White noise                  (ppm) :  1206.4904195091324
Red noise                    (ppm) :  84.21932409380135
Transit depth measured error (ppm) :  42.89097950680253
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.93455573	-0.84286455	0.70782245	-0.25114238
3param 	2.27992215	-3.22427644	1.41261286
Quad 	0.03322151	0.38713163
Linear 	0.36154490

c1 = 0.9345557286567474
c2 = -0.8428645469843066
c3 = 0.7078224534176041
c4 = -0.25114237623350694


Fitting Bin 3  Wavelength = 2.377201606666667   Range= [ 2.2448517 : 2.4898652 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10258.731426442784  scatter  0.0010569486063563343
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10258.731426442784  scatter  0.0010569486063563343
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10258.731426442784  scatter  0.0010569486063563343
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 10258.42059356915  scatter  0.0010569357648987602
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10263.301358211349  scatter  0.0010569360103794298
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10258.732927780395  scatter  0.0010569486835377672
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10258.732064587512  scatter  0.0010569486391571355
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10258.730778259396  scatter  0.0010569485370270006
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10258.730992985515  scatter  0.0010569485545170543
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10258.73021096519  scatter  0.0010569484724446707
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10258.731655048954  scatter  0.0010569486181103397
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08153909476226479 current chi^2= 10199.78292618068  scatter  0.0010540374164880247
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08154180850262222 current chi^2= 10199.78881058993  scatter  0.0010540375874159968
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08153909476226479 current chi^2= 10200.565712006128  scatter  0.001054026841370445
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08153909476226479 current chi^2= 10199.782914677491  scatter  0.0010540374157675149
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08153909476226479 current chi^2= 10199.782922149208  scatter  0.001054037416234278
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08153909476226479 current chi^2= 10199.78291674822  scatter  0.0010540374173052369
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08153909476226479 current chi^2= 10199.782919668865  scatter  0.0010540374171515929
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08153909476226479 current chi^2= 10199.782909578484  scatter  0.0010540374182107601
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08153909476226479 current chi^2= 10199.782921165344  scatter  0.0010540374162197224
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08152560158670974 current chi^2= 10199.771189974404  scatter  0.001054037352706457
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08152831525738463 current chi^2= 10199.771784375473  scatter  0.001054037365331047
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08152560158670974 current chi^2= 10200.684552005187  scatter  0.0010540267534354232
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08152560158670974 current chi^2= 10199.771190208608  scatter  0.0010540373525910135
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08152560158670974 current chi^2= 10199.771189988736  scatter  0.0010540373526614242
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08152560158670974 current chi^2= 10199.771190034566  scatter  0.0010540373527011052
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08152560158670974 current chi^2= 10199.771190015701  scatter  0.0010540373526838434
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08152560158670974 current chi^2= 10199.771190225889  scatter  0.0010540373526735116
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08152560158670974 current chi^2= 10199.771190004456  scatter  0.0010540373526983368
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08152564178758398 current chi^2= 10199.771189928279  scatter  0.0010540373470590827
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08152564178758398 current chi^2= 10199.771189928279  scatter  0.0010540373470590827
Re-Fitting Bin 3  Wavelength = 2.377201606666667   Range= [ 2.2448517 : 2.4898652 ]

redchi 1.2463063526305322
chi2 10199.771189928277
nfree 8184
bic 1867.8328479514118
aic 1811.7455411731776
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.08152564 +/- 2.2958e-04 (0.28%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        1117867.74 +/- 39.5908738 (0.00%) (init = 1117799)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:      -5.0800e-04 +/- 4.3896e-05 (8.64%) (init = -0.0004562807)
    ysh:       1.2772e-04 +/- 4.0840e-05 (31.98%) (init = 0.000158932)
    x2sh:      1.9435e-04 +/- 9.9708e-05 (51.30%) (init = 0.0001891058)
    y2sh:      1.5157e-04 +/- 9.8860e-05 (65.22%) (init = 0.000155217)
    xysh:     -4.0988e-04 +/- 1.9630e-04 (47.89%) (init = -0.0003957601)
    comm:      1.8396e-04 +/- 3.6386e-05 (19.78%) (init = 0.0001085827)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9819
    C(x2sh, xysh) = -0.9755
    C(x2sh, y2sh) = +0.9377
    C(rprs, f0)   = +0.8110
    C(xsh, ysh)   = -0.6329
    C(xsh, comm)  = -0.4873
    C(f0, x2sh)   = -0.3865
    C(f0, y2sh)   = -0.3296
    C(ysh, comm)  = -0.3012
    C(f0, xysh)   = +0.2751
    C(xsh, x2sh)  = +0.2435
    C(xsh, xysh)  = -0.2141
    C(rprs, x2sh) = -0.1937
    C(xysh, comm) = +0.1792
    C(xsh, y2sh)  = +0.1765
    C(x2sh, comm) = -0.1720
    C(rprs, xsh)  = -0.1664
    C(y2sh, comm) = -0.1483
    C(rprs, y2sh) = -0.1399
    C(rprs, ysh)  = +0.1377
    C(f0, xsh)    = -0.1207
    C(rprs, xysh) = +0.1007
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Residual standard deviation  (ppm) :  1054.0373470590828
Photon noise                 (ppm) :  945.8119322072117
Photon noise performance       (%) :  89.73229789685956
White noise                  (ppm) :  1052.820631999811
Red noise                    (ppm) :  50.7292744985023
Transit depth measured error (ppm) :  37.43401452088151
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.87680257	-0.73476891	0.58280583	-0.20005841
3param 	2.19503756	-3.10629940	1.36088100
Quad 	0.03045619	0.37301041
Linear 	0.34680348

c1 = 0.8768025733603605
c2 = -0.734768906336391
c3 = 0.5828058348097763
c4 = -0.20005841429866372


Fitting Bin 4  Wavelength = 2.6120002933333333   Range= [ 2.4898652 : 2.7162005 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9225.17387174622  scatter  0.0010491438215924737
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9225.17387174622  scatter  0.0010491438215924737
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9225.17387174622  scatter  0.0010491438215924737
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 9225.14308138749  scatter  0.0010491381217755337
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9221.8581038215  scatter  0.0010491324566112312
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9225.174194765717  scatter  0.0010491438397639526
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9225.174538932039  scatter  0.0010491438593481898
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9225.17134132969  scatter  0.0010491437584351814
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9225.172464950316  scatter  0.0010491437933077563
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9225.170215337874  scatter  0.0010491437375777088
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9225.174436755597  scatter  0.001049143853480346
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08080002233231443 current chi^2= 9205.710127472466  scatter  0.0010482768167151021
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0808027322082625 current chi^2= 9205.711299922326  scatter  0.0010482768504047986
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08080002233231443 current chi^2= 9206.528764717048  scatter  0.0010482663068997105
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08080002233231443 current chi^2= 9205.710126374266  scatter  0.001048276816461162
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08080002233231443 current chi^2= 9205.710126698023  scatter  0.0010482768165406267
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08080002233231443 current chi^2= 9205.71012593176  scatter  0.0010482768168422587
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08080002233231443 current chi^2= 9205.710126498037  scatter  0.0010482768168209717
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08080002233231443 current chi^2= 9205.71012545712  scatter  0.0010482768169327332
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08080002233231443 current chi^2= 9205.710125758364  scatter  0.0010482768164327685
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08079801660642527 current chi^2= 9205.709935899356  scatter  0.0010482768881885536
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08080072647175329 current chi^2= 9205.710474060215  scatter  0.0010482769001187297
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08079801660642527 current chi^2= 9206.543464385399  scatter  0.001048266375071847
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08079801660642527 current chi^2= 9205.709936104666  scatter  0.0010482768880086615
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08079801660642527 current chi^2= 9205.709935940624  scatter  0.0010482768880604465
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08079801660642527 current chi^2= 9205.709936031508  scatter  0.0010482768881575656
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08079801660642527 current chi^2= 9205.709935973897  scatter  0.0010482768881749345
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08079801660642527 current chi^2= 9205.709936240968  scatter  0.0010482768881393888
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08079801660642527 current chi^2= 9205.709936292758  scatter  0.0010482768880259198
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08079801996770619 current chi^2= 9205.70993589882  scatter  0.0010482768877308722
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08079801996770619 current chi^2= 9205.70993589882  scatter  0.0010482768877308722
Re-Fitting Bin 4  Wavelength = 2.6120002933333333   Range= [ 2.4898652 : 2.7162005 ]

redchi 1.1248423675340689
chi2 9205.70993589882
nfree 8184
bic 1027.8141010686468
aic 971.7267942904125
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.08079802 +/- 2.2966e-04 (0.28%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        1020091.41 +/- 35.9154006 (0.00%) (init = 1020040)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:       4.9600e-04 +/- 4.3663e-05 (8.80%) (init = 0.0004393402)
    ysh:       2.2241e-04 +/- 4.0620e-05 (18.26%) (init = 0.000309657)
    x2sh:     -2.9802e-04 +/- 9.9151e-05 (33.27%) (init = -0.0003434394)
    y2sh:     -2.1077e-04 +/- 9.8311e-05 (46.64%) (init = -0.0002199046)
    xysh:      4.9765e-04 +/- 1.9521e-04 (39.23%) (init = 0.0005561113)
    comm:     -6.8653e-04 +/- 3.6185e-05 (5.27%) (init = -0.0007121339)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9820
    C(x2sh, xysh) = -0.9755
    C(x2sh, y2sh) = +0.9377
    C(rprs, f0)   = +0.8109
    C(xsh, ysh)   = -0.6329
    C(xsh, comm)  = -0.4873
    C(f0, x2sh)   = -0.3866
    C(f0, y2sh)   = -0.3297
    C(ysh, comm)  = -0.3011
    C(f0, xysh)   = +0.2753
    C(xsh, x2sh)  = +0.2441
    C(xsh, xysh)  = -0.2145
    C(rprs, x2sh) = -0.1938
    C(xysh, comm) = +0.1795
    C(xsh, y2sh)  = +0.1769
    C(x2sh, comm) = -0.1724
    C(rprs, xsh)  = -0.1678
    C(y2sh, comm) = -0.1486
    C(rprs, y2sh) = -0.1399
    C(rprs, ysh)  = +0.1386
    C(f0, xsh)    = -0.1220
    C(rprs, xysh) = +0.1009
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Residual standard deviation  (ppm) :  1048.2768877308722
Photon noise                 (ppm) :  990.1031808314427
Photon noise performance       (%) :  94.45053996894333
White noise                  (ppm) :  1047.7390803338287
Red noise                    (ppm) :  33.64009844747019
Transit depth measured error (ppm) :  37.11218594979726
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.86128615	-0.71349059	0.53202051	-0.17329897
3param 	2.16446827	-3.09180012	1.36001713
Quad 	0.02096718	0.36578098
Linear 	0.33118324

c1 = 0.8612861523437699
c2 = -0.7134905887171039
c3 = 0.5320205128963146
c4 = -0.1732989670095287


Fitting Bin 5  Wavelength = 2.82970062   Range= [ 2.7162005 : 2.9267646 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9980.662658163097  scatter  0.0016143078952093309
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9980.662658163097  scatter  0.0016143078952093309
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9980.662658163097  scatter  0.0016143078952093309
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 9980.675325921711  scatter  0.0016143111885384743
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9982.730724323612  scatter  0.0016142922769965355
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9980.662636952584  scatter  0.0016143078935925944
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9980.66225643799  scatter  0.001614307862902091
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9980.662536708638  scatter  0.0016143078854850995
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9980.663652984802  scatter  0.0016143079316548632
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9980.66355517468  scatter  0.001614307925940423
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9980.664208565106  scatter  0.0016143079475451783
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9980.662795658845  scatter  0.0016143079063780754
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07986391552220734 current chi^2= 9962.934337812596  scatter  0.0016130779057800465
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07986662036278491 current chi^2= 9962.935177508934  scatter  0.001613077946835566
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07986391552220734 current chi^2= 9963.30345973941  scatter  0.0016130618425866286
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07986391552220734 current chi^2= 9962.934337852426  scatter  0.0016130779058431577
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07986391552220734 current chi^2= 9962.934336685219  scatter  0.001613077905865581
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07986391552220734 current chi^2= 9962.934337228779  scatter  0.0016130779058318699
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07986391552220734 current chi^2= 9962.934337265997  scatter  0.0016130779058624032
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07986391552220734 current chi^2= 9962.934337364695  scatter  0.0016130779058283475
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07986391552220734 current chi^2= 9962.934337149476  scatter  0.0016130779058799005
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07986391552220734 current chi^2= 9962.934336792507  scatter  0.0016130779057430635
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07985701999121392 current chi^2= 9962.93387101575  scatter  0.0016130786288527878
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07985972479411046 current chi^2= 9962.934114251027  scatter  0.001613078637884746
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07985701999121392 current chi^2= 9963.314953174384  scatter  0.0016130625607874015
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07985701999121392 current chi^2= 9962.933871049976  scatter  0.0016130786289153779
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07985701999121392 current chi^2= 9962.933871152185  scatter  0.0016130786290402526
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07985701999121392 current chi^2= 9962.933871031684  scatter  0.0016130786289529203
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07985701999121392 current chi^2= 9962.933871027406  scatter  0.0016130786288522324
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07985701999121392 current chi^2= 9962.933871026673  scatter  0.0016130786288217052
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07985701999121392 current chi^2= 9962.933871038686  scatter  0.0016130786288316478
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07985701999121392 current chi^2= 9962.933871082561  scatter  0.0016130786289035547
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0798569646368103 current chi^2= 9962.933870990117  scatter  0.0016130786383320465
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0798569646368103 current chi^2= 9962.933870990117  scatter  0.0016130786383320465
Re-Fitting Bin 5  Wavelength = 2.82970062   Range= [ 2.7162005 : 2.9267646 ]

redchi 1.2175160541354164
chi2 9962.933870990113
nfree 8183
bic 1684.3834192516322
aic 1621.2851991261186
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.07985696 +/- 4.4930e-04 (0.56%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        466305.818 +/- 27.4132625 (0.01%) (init = 466320.8)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:   -0.03200603 +/- 0.00907390 (28.35%) (init = -0.03885871)
    xsh:       5.9845e-04 +/- 7.7661e-05 (12.98%) (init = 0.0005208206)
    ysh:       2.0512e-04 +/- 6.4429e-05 (31.41%) (init = 0.0001880271)
    x2sh:      1.3205e-04 +/- 1.5407e-04 (116.67%) (init = 0.0003234828)
    y2sh:      1.2008e-04 +/- 1.5150e-04 (126.17%) (init = 0.0003067711)
    xysh:     -1.9185e-04 +/- 3.0269e-04 (157.77%) (init = -0.0005659834)
    comm:     -4.1856e-04 +/- 6.2462e-05 (14.92%) (init = -0.0002515501)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh)   = -0.9796
    C(x2sh, xysh)   = -0.9758
    C(x2sh, y2sh)   = +0.9346
    C(rprs, f0)     = +0.8292
    C(rprs, Fslope) = -0.6095
    C(Fslope, xsh)  = -0.5011
    C(Fslope, comm) = -0.4531
    C(xsh, ysh)     = -0.4105
    C(f0, Fslope)   = -0.3889
    C(f0, x2sh)     = -0.2996
    C(f0, y2sh)     = -0.2832
    C(xsh, x2sh)    = +0.2785
    C(rprs, comm)   = +0.2590
    C(rprs, ysh)    = +0.2547
    C(xsh, xysh)    = -0.2457
    C(Fslope, ysh)  = -0.2417
    C(f0, xysh)     = +0.2044
    C(rprs, xsh)    = +0.1894
    C(xsh, y2sh)    = +0.1791
    C(ysh, comm)    = -0.1509
    C(xsh, comm)    = -0.1489
    C(f0, ysh)      = +0.1401
    C(Fslope, x2sh) = -0.1377
    C(f0, comm)     = +0.1331
    C(Fslope, xysh) = +0.1223
    C(y2sh, comm)   = -0.1088
    C(xysh, comm)   = +0.1034
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Residual standard deviation  (ppm) :  1613.0786383320465
Photon noise                 (ppm) :  1464.4163972707586
Photon noise performance       (%) :  90.78394335349903
White noise                  (ppm) :  1609.0888643266665
Red noise                    (ppm) :  113.60430361520908
Transit depth measured error (ppm) :  71.75961562573352
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.83139630	-0.69648836	0.51398573	-0.16463305
3param 	2.08159457	-2.98407477	1.31547125
Quad 	0.01845834	0.35019614
Linear 	0.31545702

c1 = 0.8313963026272632
c2 = -0.6964883570847707
c3 = 0.5139857343510604
c4 = -0.16463304826971645


Fitting Bin 6  Wavelength = 3.03297832   Range= [ 2.9267646 : 3.1240093 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9394.765719421894  scatter  0.0016766606718520399
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9394.765719421894  scatter  0.0016766606718520399
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9394.765719421894  scatter  0.0016766606718520399
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 9394.862486213391  scatter  0.001676664198105245
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9391.713551514944  scatter  0.0016766445175143195
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9394.765598568669  scatter  0.0016766606611137629
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9394.765595912946  scatter  0.001676660660862254
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9394.76507543539  scatter  0.001676660614514421
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9394.765459934513  scatter  0.0016766606814799365
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9394.765591911353  scatter  0.001676660674377214
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9394.765295186775  scatter  0.001676660683995172
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9394.7654258439  scatter  0.0016766606457498162
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0799666645874354 current chi^2= 9377.921204237236  scatter  0.0016759316830257983
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07996936998846454 current chi^2= 9377.921754850078  scatter  0.001675931709963812
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0799666645874354 current chi^2= 9378.24676631912  scatter  0.0016759149689662416
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0799666645874354 current chi^2= 9377.921204259776  scatter  0.0016759316830914312
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0799666645874354 current chi^2= 9377.921204125894  scatter  0.0016759316830430653
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0799666645874354 current chi^2= 9377.92120379776  scatter  0.0016759316831016374
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0799666645874354 current chi^2= 9377.921203954975  scatter  0.0016759316831063834
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0799666645874354 current chi^2= 9377.92120405472  scatter  0.00167593168308198
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0799666645874354 current chi^2= 9377.921203842523  scatter  0.001675931683153963
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0799666645874354 current chi^2= 9377.921203805425  scatter  0.0016759316830713934
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07996219785621339 current chi^2= 9377.921033925628  scatter  0.0016759321928877747
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0799649032329185 current chi^2= 9377.921246605589  scatter  0.0016759321997876248
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07996219785621339 current chi^2= 9378.253332526014  scatter  0.0016759154757754417
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07996219785621339 current chi^2= 9377.92103394786  scatter  0.0016759321929533152
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07996219785621339 current chi^2= 9377.921033928576  scatter  0.0016759321929151931
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07996219785621339 current chi^2= 9377.921033951821  scatter  0.0016759321930051182
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07996219785621339 current chi^2= 9377.92103393418  scatter  0.0016759321929214707
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07996219785621339 current chi^2= 9377.921033930437  scatter  0.0016759321929089828
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07996219785621339 current chi^2= 9377.921033948407  scatter  0.0016759321929362982
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07996219785621339 current chi^2= 9377.921033958142  scatter  0.001675932192974712
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07996217765982555 current chi^2= 9377.921033922164  scatter  0.0016759321966110766
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07996217765982555 current chi^2= 9377.921033922164  scatter  0.0016759321966110766
Re-Fitting Bin 6  Wavelength = 3.03297832   Range= [ 2.9267646 : 3.1240093 ]

redchi 1.146024811673245
chi2 9377.921033922164
nfree 8183
bic 1188.6568821138817
aic 1125.5586619883682
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.07996218 +/- 4.6570e-04 (0.58%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        406639.550 +/- 24.8600566 (0.01%) (init = 406639.5)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:   -0.02768365 +/- 0.00943268 (34.07%) (init = -0.0245558)
    xsh:       9.5268e-05 +/- 8.0679e-05 (84.69%) (init = 0.0001198049)
    ysh:      -2.8172e-04 +/- 6.6954e-05 (23.77%) (init = -0.0003972918)
    x2sh:      1.2084e-04 +/- 1.6007e-04 (132.46%) (init = 0.0001082623)
    y2sh:      8.5766e-05 +/- 1.5741e-04 (183.53%) (init = 4.592033e-05)
    xysh:     -2.0445e-04 +/- 3.1449e-04 (153.82%) (init = -0.0001742409)
    comm:      3.1334e-04 +/- 6.4895e-05 (20.71%) (init = 0.0003524477)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh)   = -0.9796
    C(x2sh, xysh)   = -0.9758
    C(x2sh, y2sh)   = +0.9347
    C(rprs, f0)     = +0.8296
    C(rprs, Fslope) = -0.6101
    C(Fslope, xsh)  = -0.5009
    C(Fslope, comm) = -0.4532
    C(xsh, ysh)     = -0.4102
    C(f0, Fslope)   = -0.3898
    C(f0, x2sh)     = -0.2995
    C(f0, y2sh)     = -0.2834
    C(xsh, x2sh)    = +0.2783
    C(rprs, comm)   = +0.2591
    C(rprs, ysh)    = +0.2558
    C(xsh, xysh)    = -0.2456
    C(Fslope, ysh)  = -0.2424
    C(f0, xysh)     = +0.2044
    C(rprs, xsh)    = +0.1896
    C(xsh, y2sh)    = +0.1790
    C(ysh, comm)    = -0.1505
    C(xsh, comm)    = -0.1488
    C(f0, ysh)      = +0.1414
    C(Fslope, x2sh) = -0.1374
    C(f0, comm)     = +0.1332
    C(Fslope, xysh) = +0.1221
    C(y2sh, comm)   = -0.1088
    C(xysh, comm)   = +0.1033
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Residual standard deviation  (ppm) :  1675.9321966110765
Photon noise                 (ppm) :  1568.177404249897
Photon noise performance       (%) :  93.57045633593819
White noise                  (ppm) :  1673.2041442494558
Red noise                    (ppm) :  95.77217353297817
Transit depth measured error (ppm) :  74.47713465118841
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.81389262	-0.73763603	0.57400243	-0.18855682
3param 	1.98195894	-2.85041216	1.26038632
Quad 	0.01890991	0.33067253
Linear 	0.29935077

c1 = 0.8138926211068966
c2 = -0.7376360250433283
c3 = 0.5740024332978596
c4 = -0.18855681985617853


Fitting Bin 7  Wavelength = 3.2240248533333333   Range= [ 3.1240093 : 3.3099063 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9118.94838118647  scatter  0.0015727991289659882
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9118.94838118647  scatter  0.0015727991289659882
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9118.94838118647  scatter  0.0015727991289659882
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 9118.669236969848  scatter  0.0015727908471485435
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9130.186019815776  scatter  0.0015727820843942713
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9118.948738077812  scatter  0.001572799159999762
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9118.948601445982  scatter  0.0015727991480873255
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9118.94954302204  scatter  0.0015727992297427335
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9118.94917669428  scatter  0.001572799108190757
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9118.94913215298  scatter  0.0015727991065729323
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9118.950249494108  scatter  0.001572799073753105
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9118.949786388184  scatter  0.0015727992509382137
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173729572987781 current chi^2= 9016.101999039553  scatter  0.0015710012507004485
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08174001049009455 current chi^2= 9016.104699709642  scatter  0.0015710013748341531
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173729572987781 current chi^2= 9016.393869809805  scatter  0.0015709855413068732
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173729572987781 current chi^2= 9016.101999127539  scatter  0.0015710012506564644
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173729572987781 current chi^2= 9016.101996424273  scatter  0.0015710012504533892
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173729572987781 current chi^2= 9016.10198799985  scatter  0.0015710012496673324
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173729572987781 current chi^2= 9016.101993267872  scatter  0.001571001251599806
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173729572987781 current chi^2= 9016.101994582586  scatter  0.0015710012516059874
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173729572987781 current chi^2= 9016.101989300576  scatter  0.001571001252624866
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173729572987781 current chi^2= 9016.101985451873  scatter  0.001571001249381999
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173195054583848 current chi^2= 9016.095308437054  scatter  0.0015709991635639799
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173466527864204 current chi^2= 9016.095553547439  scatter  0.001570999181407478
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173195054583848 current chi^2= 9016.458723620926  scatter  0.0015709834378504913
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173195054583848 current chi^2= 9016.09530850673  scatter  0.001570999163518713
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173195054583848 current chi^2= 9016.095308452781  scatter  0.0015709991635460586
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173195054583848 current chi^2= 9016.095308588838  scatter  0.0015709991635057116
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173195054583848 current chi^2= 9016.095308467651  scatter  0.0015709991636096191
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173195054583848 current chi^2= 9016.095308463731  scatter  0.0015709991636655588
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173195054583848 current chi^2= 9016.095308553615  scatter  0.001570999163735389
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173195054583848 current chi^2= 9016.095308748032  scatter  0.0015709991634559124
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173193061524725 current chi^2= 9016.095308433509  scatter  0.0015709991669657496
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08173193061524725 current chi^2= 9016.095308433509  scatter  0.0015709991669657496
Re-Fitting Bin 7  Wavelength = 3.2240248533333333   Range= [ 3.1240093 : 3.3099063 ]

redchi 1.101808054311806
chi2 9016.095308433509
nfree 8183
bic 866.3282851132485
aic 803.2300649877349
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.08173193 +/- 4.2849e-04 (0.52%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        444771.966 +/- 25.5781982 (0.01%) (init = 444786.4)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:   -0.04678146 +/- 0.00886101 (18.94%) (init = -0.04274347)
    xsh:      -2.0829e-04 +/- 7.5679e-05 (36.33%) (init = -0.0001220049)
    ysh:      -6.4652e-04 +/- 6.2784e-05 (9.71%) (init = -0.000715279)
    x2sh:     -2.1765e-04 +/- 1.5007e-04 (68.95%) (init = -9.505015e-05)
    y2sh:     -1.9149e-04 +/- 1.4759e-04 (77.07%) (init = -9.269764e-05)
    xysh:      4.4090e-04 +/- 2.9486e-04 (66.88%) (init = 0.0002427406)
    comm:      9.2486e-04 +/- 6.0847e-05 (6.58%) (init = 0.0008865038)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh)   = -0.9796
    C(x2sh, xysh)   = -0.9759
    C(x2sh, y2sh)   = +0.9346
    C(rprs, f0)     = +0.8308
    C(rprs, Fslope) = -0.6122
    C(Fslope, xsh)  = -0.5019
    C(Fslope, comm) = -0.4531
    C(xsh, ysh)     = -0.4091
    C(f0, Fslope)   = -0.3929
    C(f0, x2sh)     = -0.2986
    C(f0, y2sh)     = -0.2833
    C(xsh, x2sh)    = +0.2779
    C(rprs, comm)   = +0.2589
    C(rprs, ysh)    = +0.2566
    C(xsh, xysh)    = -0.2455
    C(Fslope, ysh)  = -0.2432
    C(f0, xysh)     = +0.2037
    C(rprs, xsh)    = +0.1922
    C(xsh, y2sh)    = +0.1785
    C(ysh, comm)    = -0.1502
    C(xsh, comm)    = -0.1481
    C(f0, ysh)      = +0.1427
    C(Fslope, x2sh) = -0.1371
    C(f0, comm)     = +0.1336
    C(Fslope, xysh) = +0.1219
    C(y2sh, comm)   = -0.1088
    C(xysh, comm)   = +0.1032
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Residual standard deviation  (ppm) :  1570.9991669657495
Photon noise                 (ppm) :  1499.447612014838
Photon noise performance       (%) :  95.44547467271371
White noise                  (ppm) :  1570.9991669657495
Red noise                    (ppm) :  0.0
Transit depth measured error (ppm) :  70.04274824193523
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:138: RuntimeWarning: invalid value encountered in sqrt
  sigrednoise = np.sqrt(sig_binned**2-sig0**2/binmeasure)
/tmp/ipykernel_2145/3968974178.py:142: RuntimeWarning: invalid value encountered in sqrt
  sigrednoise = np.sqrt(sig_binned**2-sigwhite**2/binmeasure)
/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.77921351	-0.73484018	0.59158997	-0.19763140
3param 	1.86887569	-2.68691391	1.18957379
Quad 	0.02139142	0.31022271
Linear 	0.28448893

c1 = 0.7792135088653476
c2 = -0.7348401806767696
c3 = 0.5915899664015227
c4 = -0.1976314018765263


Fitting Bin 8  Wavelength = 3.4045925866666678   Range= [ 3.3099063 : 3.4860291 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9301.946522130798  scatter  0.0014960559999932601
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9301.946522130798  scatter  0.0014960559999932601
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9301.946522130798  scatter  0.0014960559999932601
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 9301.503885410715  scatter  0.0014960362519322176
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9314.080775052356  scatter  0.001496038169234892
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9301.94617515353  scatter  0.0014960559717204604
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9301.946525759186  scatter  0.0014960560002632134
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9301.947374323347  scatter  0.001496056068574905
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9301.947769832444  scatter  0.0014960557798413864
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9301.947279834327  scatter  0.0014960558340999382
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9301.948156237331  scatter  0.001496055633105834
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9301.947784688773  scatter  0.0014960561019672415
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08229457949321867 current chi^2= 9103.442309030796  scatter  0.0014868760518742478
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0822972970839736 current chi^2= 9103.459024965065  scatter  0.001486876745868521
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08229457949321867 current chi^2= 9103.385656539953  scatter  0.0014868613473574075
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08229457949321867 current chi^2= 9103.442309017999  scatter  0.0014868760517185212
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08229457949321867 current chi^2= 9103.442303438995  scatter  0.0014868760513965192
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08229457949321867 current chi^2= 9103.44222972637  scatter  0.0014868760451017533
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08229457949321867 current chi^2= 9103.442252352772  scatter  0.0014868760582140647
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08229457949321867 current chi^2= 9103.442276160127  scatter  0.0014868760565605666
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08229457949321867 current chi^2= 9103.44222637493  scatter  0.0014868760631796959
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08229457949321867 current chi^2= 9103.442267819055  scatter  0.001486876048260546
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08224586691398683 current chi^2= 9103.230958817752  scatter  0.00148685900669468
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08224858425949089 current chi^2= 9103.220564125417  scatter  0.0014868585835531051
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08224586691398683 current chi^2= 9103.944398490874  scatter  0.0014868441254063621
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08224586691398683 current chi^2= 9103.23095885069  scatter  0.0014868590065418082
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08224586691398683 current chi^2= 9103.230962469195  scatter  0.0014868590069702873
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08224586691398683 current chi^2= 9103.231010731248  scatter  0.0014868590106306464
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08224586691398683 current chi^2= 9103.230998296594  scatter  0.001486859002993727
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08224586691398683 current chi^2= 9103.230981734803  scatter  0.0014868590040167013
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08224586691398683 current chi^2= 9103.231016647447  scatter  0.0014868590002071762
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08224586691398683 current chi^2= 9103.230985111426  scatter  0.0014868590085873896
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0822802747530681 current chi^2= 9103.297617585666  scatter  0.0014868676983143992
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0822802747530681 current chi^2= 9103.297617585666  scatter  0.0014868676983143992
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08226770031033487 current chi^2= 9103.144816333583  scatter  0.001486857945202089
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227041776581367 current chi^2= 9103.140765668657  scatter  0.0014868577383800314
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08226770031033487 current chi^2= 9103.646074152946  scatter  0.001486843098975958
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08226770031033487 current chi^2= 9103.144810535136  scatter  0.0014868579445723147
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08226770031033487 current chi^2= 9103.144816948463  scatter  0.001486857945229958
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08226770031033487 current chi^2= 9103.144832190983  scatter  0.0014868579461958043
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08226770031033487 current chi^2= 9103.14481891453  scatter  0.0014868579434117448
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08226770031033487 current chi^2= 9103.144815532425  scatter  0.0014868579438809804
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08226770031033487 current chi^2= 9103.144816248896  scatter  0.0014868579420367666
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08226770031033487 current chi^2= 9103.14482172361  scatter  0.0014868579453889068
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08228043408023189 current chi^2= 9103.297664662887  scatter  0.0014868676753072706
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227215815974537 current chi^2= 9103.13684079148  scatter  0.0014868578663033267
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227487563766817 current chi^2= 9103.254968700381  scatter  0.001486864287260597
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227215815974537 current chi^2= 9103.603760702448  scatter  0.0014868430279308766
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227215815974537 current chi^2= 9103.13683457553  scatter  0.0014868578656393246
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227215815974537 current chi^2= 9103.136840959349  scatter  0.0014868578662947207
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227215815974537 current chi^2= 9103.136850689994  scatter  0.0014868578668106975
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227215815974537 current chi^2= 9103.13683919649  scatter  0.0014868578649696734
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227215815974537 current chi^2= 9103.136837438746  scatter  0.001486857865307308
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227215815974537 current chi^2= 9103.13683448903  scatter  0.0014868578639341355
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227215815974537 current chi^2= 9103.136842824111  scatter  0.0014868578662161473
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227206299803652 current chi^2= 9103.131860077723  scatter  0.0014868587482834267
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0822747804754802 current chi^2= 9103.270826539534  scatter  0.001486865938418488
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227206299803652 current chi^2= 9103.569539873772  scatter  0.0014868439158806173
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227206299803652 current chi^2= 9103.13185406765  scatter  0.0014868587476361465
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227206299803652 current chi^2= 9103.13186004623  scatter  0.0014868587482585068
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227206299803652 current chi^2= 9103.131865883617  scatter  0.0014868587484559324
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227206299803652 current chi^2= 9103.131856509317  scatter  0.001486858747468335
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227206299803652 current chi^2= 9103.131856060574  scatter  0.0014868587476877793
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227206299803652 current chi^2= 9103.131851777503  scatter  0.0014868587468620169
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227206299803652 current chi^2= 9103.131860125355  scatter  0.0014868587480339848
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227161715800624 current chi^2= 9103.128323218218  scatter  0.00148686042045861
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227433463320538 current chi^2= 9103.128118870252  scatter  0.0014868603645499614
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227161715800624 current chi^2= 9103.514953405578  scatter  0.0014868455980808068
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227161715800624 current chi^2= 9103.128317767743  scatter  0.001486860419857147
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227161715800624 current chi^2= 9103.128322823315  scatter  0.001486860420404016
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227161715800624 current chi^2= 9103.1283216967  scatter  0.001486860420031871
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227161715800624 current chi^2= 9103.12831540592  scatter  0.0014868604204825073
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227161715800624 current chi^2= 9103.128317309787  scatter  0.0014868604205001993
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227161715800624 current chi^2= 9103.128309783799  scatter  0.0014868604205587716
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227161715800624 current chi^2= 9103.128319957816  scatter  0.0014868604199389818
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227189081578512 current chi^2= 9103.126453126693  scatter  0.0014868598464356506
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227460829236194 current chi^2= 9103.126337395935  scatter  0.0014868598296541146
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227189081578512 current chi^2= 9103.535657228847  scatter  0.001486845029726022
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227189081578512 current chi^2= 9103.126452559585  scatter  0.0014868598462347525
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227189081578512 current chi^2= 9103.126453196277  scatter  0.001486859846419374
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227189081578512 current chi^2= 9103.126453833585  scatter  0.0014868598461916255
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227189081578512 current chi^2= 9103.126453323583  scatter  0.0014868598465920784
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227189081578512 current chi^2= 9103.126453033925  scatter  0.0014868598466039205
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227189081578512 current chi^2= 9103.126453326868  scatter  0.0014868598467951844
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227189081578512 current chi^2= 9103.126453317944  scatter  0.001486859846199188
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227389311363387 current chi^2= 9103.126168511139  scatter  0.0014868593896490794
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227661060029068 current chi^2= 9103.305568942924  scatter  0.0014868689792155241
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227389311363387 current chi^2= 9103.535712925168  scatter  0.0014868445748800014
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227389311363387 current chi^2= 9103.12616853733  scatter  0.0014868593894969897
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227389311363387 current chi^2= 9103.126168515235  scatter  0.001486859389627597
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227389311363387 current chi^2= 9103.126168711191  scatter  0.0014868593893642276
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227389311363387 current chi^2= 9103.126168577772  scatter  0.0014868593897872091
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227389311363387 current chi^2= 9103.12616853926  scatter  0.0014868593898220814
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227389311363387 current chi^2= 9103.126168678487  scatter  0.0014868593899932778
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227389311363387 current chi^2= 9103.126168593695  scatter  0.0014868593894041533
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227152702138635 current chi^2= 9103.187585239662  scatter  0.001486869089111949
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0822731855168346 current chi^2= 9103.12839692665  scatter  0.0014868608761486569
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227353809723692 current chi^2= 9103.12644248979  scatter  0.001486859791440332
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227371431519986 current chi^2= 9103.126210088147  scatter  0.0014868594942469542
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227380360119202 current chi^2= 9103.12617879038  scatter  0.0014868594168656066
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0822738454331639 current chi^2= 9103.126173026616  scatter  0.0014868593976689064
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227387084995241 current chi^2= 9103.126170536078  scatter  0.0014868593914915949
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227388182559764 current chi^2= 9103.126169532296  scatter  0.0014868593901558314
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08227389311363387 current chi^2= 9103.126168511139  scatter  0.0014868593896490794
Re-Fitting Bin 8  Wavelength = 3.4045925866666678   Range= [ 3.3099063 : 3.4860291 ]

redchi 1.1124436231835682
chi2 9103.126168511139
nfree 8183
bic 945.0250756600124
aic 881.9268555344988
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.08227389 +/- 2.1027e-05 (0.03%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        501292.720 +/- 28.8379510 (0.01%) (init = 501326.9)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:   -0.03068044 +/- 0.00892025 (29.07%) (init = -0.03123646)
    xsh:       7.1510e-05 +/- 7.2557e-05 (101.46%) (init = -4.314611e-05)
    ysh:      -7.0105e-04 +/- 6.1147e-05 (8.72%) (init = -0.0007549212)
    x2sh:     -2.8390e-04 +/- 1.4177e-04 (49.94%) (init = -0.0003371664)
    y2sh:     -1.8896e-04 +/- 1.3982e-04 (73.99%) (init = -0.000238624)
    xysh:      4.8981e-04 +/- 2.7908e-04 (56.98%) (init = 0.0005530067)
    comm:      4.4283e-04 +/- 5.7141e-05 (12.90%) (init = 0.0005872099)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh)   = -0.9776
    C(x2sh, xysh)   = -0.9771
    C(x2sh, y2sh)   = +0.9328
    C(rprs, f0)     = +0.8501
    C(rprs, Fslope) = -0.6688
    C(Fslope, xsh)  = -0.5224
    C(f0, Fslope)   = -0.4657
    C(Fslope, comm) = -0.4321
    C(xsh, ysh)     = -0.3548
    C(rprs, ysh)    = +0.3432
    C(Fslope, ysh)  = -0.3082
    C(f0, y2sh)     = -0.2821
    C(xsh, x2sh)    = +0.2806
    C(f0, x2sh)     = -0.2547
    C(rprs, xsh)    = +0.2477
    C(xsh, xysh)    = -0.2451
    C(rprs, comm)   = +0.2288
    C(f0, ysh)      = +0.2269
    C(f0, xysh)     = +0.1828
    C(xsh, y2sh)    = +0.1689
    C(f0, xsh)      = +0.1547
    C(Fslope, x2sh) = -0.1485
    C(xsh, comm)    = -0.1402
    C(ysh, comm)    = -0.1337
    C(Fslope, xysh) = +0.1222
    C(f0, comm)     = +0.1168
    C(y2sh, comm)   = -0.1096
    C(xysh, comm)   = +0.1012
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Residual standard deviation  (ppm) :  1486.8593896490793
Photon noise                 (ppm) :  1412.3889172626766
Photon noise performance       (%) :  94.99142468313842
White noise                  (ppm) :  1485.1870114266674
Red noise                    (ppm) :  70.63852522673794
Transit depth measured error (ppm) :  3.4599399989257096
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.74674565	-0.70346330	0.56972673	-0.19098920
3param 	1.79176229	-2.57217015	1.13841465
Quad 	0.02245664	0.29733354
Linear 	0.27462295

c1 = 0.746745645309293
c2 = -0.7034632992442458
c3 = 0.5697267291945697
c4 = -0.19098919786573013


Fitting Bin 9  Wavelength = 3.576083346666666   Range= [ 3.4860291 : 3.6536426 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13549.266227079112  scatter  0.0013236568003038133
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13549.266227079112  scatter  0.0013236568003038133
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13549.266227079112  scatter  0.0013236568003038133
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 13547.403815833888  scatter  0.0013236381434177122
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13644.00203296933  scatter  0.0013236405145455612
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13549.26681080149  scatter  0.001323656841031188
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13549.26777932024  scatter  0.001323656908716771
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13549.30130849549  scatter  0.0013236566043018112
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13549.295525527565  scatter  0.001323656592008983
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13549.291673876882  scatter  0.0013236566316400448
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 13549.267761468765  scatter  0.0013236569076258275
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08260056331046745 current chi^2= 9277.122428392371  scatter  0.0013166694297717862
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08260328243229403 current chi^2= 9277.146434304788  scatter  0.0013166702909414897
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08260056331046745 current chi^2= 9277.00550734682  scatter  0.0013166564664741664
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08260056331046745 current chi^2= 9277.12241229037  scatter  0.0013166694285929445
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08260056331046745 current chi^2= 9277.122391810346  scatter  0.0013166694272034858
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08260056331046745 current chi^2= 9277.122349509618  scatter  0.0013166694373000789
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08260056331046745 current chi^2= 9277.122357968175  scatter  0.0013166694383658804
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08260056331046745 current chi^2= 9277.122382837946  scatter  0.0013166694350966834
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08260056331046745 current chi^2= 9277.122415171689  scatter  0.0013166694287711058
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08252623050268587 current chi^2= 9276.732531964826  scatter  0.0013166537309750317
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08252894925406529 current chi^2= 9276.732920674074  scatter  0.0013166537259716505
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08252623050268587 current chi^2= 9277.265279367168  scatter  0.0013166406193190264
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08252623050268587 current chi^2= 9276.732531975591  scatter  0.0013166537309383718
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08252623050268587 current chi^2= 9276.732531986363  scatter  0.0013166537310020578
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08252623050268587 current chi^2= 9276.732532100981  scatter  0.0013166537306552623
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08252623050268587 current chi^2= 9276.732532082813  scatter  0.0013166537308106768
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08252623050268587 current chi^2= 9276.732532027188  scatter  0.0013166537308155913
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08252623050268587 current chi^2= 9276.732531964712  scatter  0.0013166537309119983
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08252602317974522 current chi^2= 9276.732531273952  scatter  0.0013166537622230764
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08252602317974522 current chi^2= 9276.732531273952  scatter  0.0013166537622230764
Re-Fitting Bin 9  Wavelength = 3.576083346666666   Range= [ 3.4860291 : 3.6536426 ]

redchi 1.1335205927754095
chi2 9276.732531273952
nfree 8184
bic 1090.773308559904
aic 1034.6860017816698
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.08252602 +/- 2.8079e-04 (0.34%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        651858.992 +/- 28.9193771 (0.00%) (init = 652312.5)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:      -1.4617e-04 +/- 5.4854e-05 (37.53%) (init = -0.0001409193)
    ysh:      -2.3084e-04 +/- 5.1041e-05 (22.11%) (init = -0.0003514006)
    x2sh:      2.9062e-04 +/- 1.2460e-04 (42.87%) (init = 0.0004020877)
    y2sh:      2.9660e-04 +/- 1.2354e-04 (41.65%) (init = 0.0003425623)
    xysh:     -1.9799e-04 +/- 2.4527e-04 (123.88%) (init = -0.0003119663)
    comm:      1.0111e-04 +/- 4.5457e-05 (44.96%) (init = 0.0002516143)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9819
    C(x2sh, xysh) = -0.9756
    C(x2sh, y2sh) = +0.9377
    C(rprs, f0)   = +0.8122
    C(xsh, ysh)   = -0.6332
    C(xsh, comm)  = -0.4869
    C(f0, x2sh)   = -0.3871
    C(f0, y2sh)   = -0.3306
    C(ysh, comm)  = -0.3013
    C(f0, xysh)   = +0.2759
    C(xsh, x2sh)  = +0.2441
    C(xsh, xysh)  = -0.2147
    C(rprs, x2sh) = -0.1950
    C(xysh, comm) = +0.1792
    C(xsh, y2sh)  = +0.1772
    C(x2sh, comm) = -0.1718
    C(rprs, xsh)  = -0.1683
    C(y2sh, comm) = -0.1482
    C(rprs, y2sh) = -0.1417
    C(rprs, ysh)  = +0.1408
    C(f0, xsh)    = -0.1225
    C(rprs, xysh) = +0.1022
Residual standard deviation  (ppm) :  1316.6537622230765
Photon noise                 (ppm) :  1238.5774523443201
Photon noise performance       (%) :  94.07009556203067
White noise                  (ppm) :  1306.3149426835967
Red noise                    (ppm) :  164.99797376972492
Transit depth measured error (ppm) :  46.34441018120959
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.72352168	-0.69353441	0.56713531	-0.19083060
3param 	1.72408909	-2.47704785	1.09722848
Quad 	0.02204260	0.28542381
Linear 	0.26410836

c1 = 0.7235216845256908
c2 = -0.6935344092472682
c3 = 0.5671353111493522
c4 = -0.19083059856627801


Fitting Bin 10  Wavelength = 3.739628686666667   Range= [ 3.6536426 : 3.8137721 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9890.01069130508  scatter  0.0011474627857043394
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9890.01069130508  scatter  0.0011474627857043394
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9890.01069130508  scatter  0.0011474627857043394
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 9889.074945075361  scatter  0.0011474598991569444
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9943.163575738648  scatter  0.0011474508817561292
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9890.01144890082  scatter  0.0011474628344311376
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9890.011042490925  scatter  0.0011474628082801367
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9890.020279026226  scatter  0.0011474627827440461
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9890.016387173318  scatter  0.0011474627810924944
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9890.01566459496  scatter  0.0011474627832961243
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9890.01194782825  scatter  0.001147462866412553
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.080965519096868 current chi^2= 8850.13546193075  scatter  0.001147068344455808
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0809682298466145 current chi^2= 8850.136602415094  scatter  0.0011470683790566537
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.080965519096868 current chi^2= 8850.78391425333  scatter  0.0011470569482685978
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.080965519096868 current chi^2= 8850.135461465137  scatter  0.0011470683443284102
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.080965519096868 current chi^2= 8850.135461563219  scatter  0.0011470683443933097
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.080965519096868 current chi^2= 8850.135460834732  scatter  0.0011470683445978763
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.080965519096868 current chi^2= 8850.135461287871  scatter  0.0011470683445471256
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.080965519096868 current chi^2= 8850.135461151654  scatter  0.0011470683445714413
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.080965519096868 current chi^2= 8850.135460567375  scatter  0.0011470683440863141
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08096455122481244 current chi^2= 8850.135154801184  scatter  0.001147068098002135
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08096726196946297 current chi^2= 8850.135599966983  scatter  0.0011470681108527946
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08096455122481244 current chi^2= 8850.804543663633  scatter  0.0011470566982679788
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08096455122481244 current chi^2= 8850.135154816868  scatter  0.0011470680979059947
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08096455122481244 current chi^2= 8850.135154805164  scatter  0.001147068097963754
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08096455122481244 current chi^2= 8850.135154839467  scatter  0.0011470680979739798
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08096455122481244 current chi^2= 8850.135154823665  scatter  0.0011470680979606867
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08096455122481244 current chi^2= 8850.135154830317  scatter  0.0011470680979607584
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08096455122481244 current chi^2= 8850.13515489508  scatter  0.001147068097727111
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08096454865997155 current chi^2= 8850.135154800635  scatter  0.001147068098356905
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08096454865997155 current chi^2= 8850.135154800635  scatter  0.001147068098356905
Re-Fitting Bin 10  Wavelength = 3.739628686666667   Range= [ 3.6536426 : 3.8137721 ]

redchi 1.0813948136364413
chi2 8850.135154800635
nfree 8184
bic 705.1213406262252
aic 649.0340338479909
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.08096455 +/- 2.4849e-04 (0.31%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        819096.202 +/- 31.6234031 (0.00%) (init = 819352.4)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:       1.5290e-04 +/- 4.7801e-05 (31.26%) (init = 0.0002021917)
    ysh:      -7.7256e-05 +/- 4.4471e-05 (57.56%) (init = -0.0001052952)
    x2sh:      1.7909e-04 +/- 1.0855e-04 (60.61%) (init = 0.0001836095)
    y2sh:      1.2922e-04 +/- 1.0762e-04 (83.29%) (init = 0.0001099149)
    xysh:     -1.6232e-04 +/- 2.1368e-04 (131.64%) (init = -0.0001007594)
    comm:     -3.7415e-04 +/- 3.9600e-05 (10.58%) (init = -0.0003567791)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9820
    C(x2sh, xysh) = -0.9756
    C(x2sh, y2sh) = +0.9377
    C(rprs, f0)   = +0.8117
    C(xsh, ysh)   = -0.6333
    C(xsh, comm)  = -0.4870
    C(f0, x2sh)   = -0.3874
    C(f0, y2sh)   = -0.3306
    C(ysh, comm)  = -0.3011
    C(f0, xysh)   = +0.2762
    C(xsh, x2sh)  = +0.2445
    C(xsh, xysh)  = -0.2149
    C(rprs, x2sh) = -0.1952
    C(xysh, comm) = +0.1794
    C(xsh, y2sh)  = +0.1774
    C(x2sh, comm) = -0.1722
    C(rprs, xsh)  = -0.1700
    C(y2sh, comm) = -0.1485
    C(rprs, ysh)  = +0.1418
    C(rprs, y2sh) = -0.1416
    C(f0, xsh)    = -0.1239
    C(rprs, xysh) = +0.1024
Residual standard deviation  (ppm) :  1147.068098356905
Photon noise                 (ppm) :  1104.9243487258443
Photon noise performance       (%) :  96.32595922670775
White noise                  (ppm) :  1143.7617519951718
Red noise                    (ppm) :  87.2001373872919
Transit depth measured error (ppm) :  40.23820340269349
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.70158234	-0.68497970	0.56261906	-0.18898861
3param 	1.65933420	-2.38925534	1.06001265
Quad 	0.02095747	0.27363513
Linear 	0.25302534

c1 = 0.7015823350980582
c2 = -0.6849797011491343
c3 = 0.5626190554259509
c4 = -0.18898861198108566


Fitting Bin 11  Wavelength = 3.896151973333334   Range= [ 3.8137721 : 3.9672586 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9221.673992589886  scatter  0.001218197901879113
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9221.673992589886  scatter  0.001218197901879113
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9221.673992589886  scatter  0.001218197901879113
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 9221.60994793739  scatter  0.0012181995951996494
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9227.583138384514  scatter  0.001218185966498664
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9221.673955428889  scatter  0.00121819789941297
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9221.673921084357  scatter  0.0012181978971498753
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9221.67441931595  scatter  0.0012181979074394663
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9221.674685355523  scatter  0.0012181979071498824
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9221.675112816021  scatter  0.0012181979137499657
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9221.67434993599  scatter  0.0012181979253555466
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08035906230970713 current chi^2= 9206.088731790662  scatter  0.0012179574983201375
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08036176983344268 current chi^2= 9206.089143130805  scatter  0.0012179575067425565
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08035906230970713 current chi^2= 9206.70641508053  scatter  0.001217945337039808
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08035906230970713 current chi^2= 9206.088731885451  scatter  0.001217957498336443
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08035906230970713 current chi^2= 9206.088731812071  scatter  0.0012179574983325282
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08035906230970713 current chi^2= 9206.088731830716  scatter  0.001217957498313026
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08035906230970713 current chi^2= 9206.088731830776  scatter  0.00121795749834806
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08035906230970713 current chi^2= 9206.088731883392  scatter  0.001217957498334584
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08035906230970713 current chi^2= 9206.088732132048  scatter  0.0012179574982143816
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08035896914373286 current chi^2= 9206.088731566251  scatter  0.0012179575139209873
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08035896914373286 current chi^2= 9206.088731566251  scatter  0.0012179575139209873
Re-Fitting Bin 11  Wavelength = 3.896151973333334   Range= [ 3.8137721 : 3.9672586 ]

redchi 1.124888652439669
chi2 9206.088731566251
nfree 8184
bic 1028.151177762139
aic 972.0638709839046
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.08035897 +/- 2.6526e-04 (0.33%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        755663.729 +/- 30.9654609 (0.00%) (init = 755688.6)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:       3.6211e-04 +/- 5.0760e-05 (14.02%) (init = 0.0003654635)
    ysh:       1.8443e-04 +/- 4.7221e-05 (25.60%) (init = 0.0001264471)
    x2sh:     -8.4928e-05 +/- 1.1525e-04 (135.70%) (init = -6.479008e-05)
    y2sh:     -1.0979e-04 +/- 1.1426e-04 (104.07%) (init = -0.0001160302)
    xysh:      1.8924e-04 +/- 2.2687e-04 (119.88%) (init = 0.0001877641)
    comm:     -7.9893e-04 +/- 4.2044e-05 (5.26%) (init = -0.0007396911)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9820
    C(x2sh, xysh) = -0.9756
    C(x2sh, y2sh) = +0.9377
    C(rprs, f0)   = +0.8116
    C(xsh, ysh)   = -0.6333
    C(xsh, comm)  = -0.4870
    C(f0, x2sh)   = -0.3875
    C(f0, y2sh)   = -0.3307
    C(ysh, comm)  = -0.3010
    C(f0, xysh)   = +0.2764
    C(xsh, x2sh)  = +0.2447
    C(xsh, xysh)  = -0.2150
    C(rprs, x2sh) = -0.1953
    C(xysh, comm) = +0.1796
    C(xsh, y2sh)  = +0.1775
    C(x2sh, comm) = -0.1724
    C(rprs, xsh)  = -0.1709
    C(y2sh, comm) = -0.1487
    C(rprs, ysh)  = +0.1423
    C(rprs, y2sh) = -0.1415
    C(f0, xsh)    = -0.1246
    C(rprs, xysh) = +0.1026
Residual standard deviation  (ppm) :  1217.9575139209874
Photon noise                 (ppm) :  1150.3651366415527
Photon noise performance       (%) :  94.4503501553323
White noise                  (ppm) :  1217.9575139209874
Red noise                    (ppm) :  0.0
Transit depth measured error (ppm) :  42.63216657555651
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
/tmp/ipykernel_2145/3968974178.py:138: RuntimeWarning: invalid value encountered in sqrt
  sigrednoise = np.sqrt(sig_binned**2-sig0**2/binmeasure)
/tmp/ipykernel_2145/3968974178.py:142: RuntimeWarning: invalid value encountered in sqrt
  sigrednoise = np.sqrt(sig_binned**2-sigwhite**2/binmeasure)
/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.70601672	-0.70030870	0.58051893	-0.19676954
3param 	1.65882256	-2.39001294	1.06012610
Quad 	0.01948099	0.27394456
Linear 	0.25181128

c1 = 0.7060167225621758
c2 = -0.700308701061446
c3 = 0.5805189281311213
c4 = -0.19676953780611214


Fitting Bin 12  Wavelength = 4.046415566666666   Range= [ 3.9672586 : 4.1148019 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9434.733539680423  scatter  0.0013250148478865921
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9434.733539680423  scatter  0.0013250148478865921
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9434.733539680423  scatter  0.0013250148478865921
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 9434.793473894668  scatter  0.0013250146153704105
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9431.555462526801  scatter  0.0013250015383946582
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9434.733975269348  scatter  0.001325014878431283
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9434.733897154652  scatter  0.0013250148729599676
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9434.73333284196  scatter  0.0013250148466042852
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9434.733230990976  scatter  0.0013250148486325679
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9434.733202607524  scatter  0.0013250148473399363
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 9434.734567898264  scatter  0.0013250149198165246
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08041997480830754 current chi^2= 9426.689197467433  scatter  0.0013248496163093427
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08042268265905389 current chi^2= 9426.689543934808  scatter  0.0013248496346017335
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08041997480830754 current chi^2= 9427.223423655912  scatter  0.0013248363686799984
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08041997480830754 current chi^2= 9426.689197539308  scatter  0.0013248496161814155
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08041997480830754 current chi^2= 9426.689197486427  scatter  0.0013248496162320972
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08041997480830754 current chi^2= 9426.689197467418  scatter  0.0013248496163096534
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08041997480830754 current chi^2= 9426.689197468919  scatter  0.0013248496163030016
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08041997480830754 current chi^2= 9426.689197467285  scatter  0.001324849616309865
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08041997480830754 current chi^2= 9426.689197831513  scatter  0.0013248496158491348
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08042005311098488 current chi^2= 9426.689197393083  scatter  0.001324849602322571
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08042005311098488 current chi^2= 9426.689197393083  scatter  0.001324849602322571
Re-Fitting Bin 12  Wavelength = 4.046415566666666   Range= [ 3.9672586 : 4.1148019 ]

redchi 1.15184374357198
chi2 9426.689197393083
nfree 8184
bic 1222.1365799428488
aic 1166.0492731646145
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.08042005 +/- 2.8830e-04 (0.36%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        653878.860 +/- 29.1478543 (0.00%) (init = 653852)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:       4.1610e-04 +/- 5.5217e-05 (13.27%) (init = 0.0003917553)
    ysh:       2.5082e-04 +/- 5.1367e-05 (20.48%) (init = 0.0002782358)
    x2sh:      9.1282e-07 +/- 1.2537e-04 (13733.89%) (init = -5.076081e-05)
    y2sh:     -5.9636e-05 +/- 1.2429e-04 (208.42%) (init = -8.608243e-05)
    xysh:      5.8866e-06 +/- 2.4679e-04 (4192.33%) (init = 9.359886e-05)
    comm:     -8.7773e-04 +/- 4.5735e-05 (5.21%) (init = -0.0008647874)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9820
    C(x2sh, xysh) = -0.9756
    C(x2sh, y2sh) = +0.9377
    C(rprs, f0)   = +0.8116
    C(xsh, ysh)   = -0.6333
    C(xsh, comm)  = -0.4870
    C(f0, x2sh)   = -0.3876
    C(f0, y2sh)   = -0.3307
    C(ysh, comm)  = -0.3010
    C(f0, xysh)   = +0.2764
    C(xsh, x2sh)  = +0.2446
    C(xsh, xysh)  = -0.2149
    C(rprs, x2sh) = -0.1953
    C(xysh, comm) = +0.1795
    C(xsh, y2sh)  = +0.1775
    C(x2sh, comm) = -0.1724
    C(rprs, xsh)  = -0.1709
    C(y2sh, comm) = -0.1487
    C(rprs, ysh)  = +0.1423
    C(rprs, y2sh) = -0.1416
    C(f0, xsh)    = -0.1246
    C(rprs, xysh) = +0.1026
Residual standard deviation  (ppm) :  1324.8496023225712
Photon noise                 (ppm) :  1236.6629557961392
Photon noise performance       (%) :  93.3436484887165
White noise                  (ppm) :  1324.8496023225712
Red noise                    (ppm) :  0.0
Transit depth measured error (ppm) :  46.36948792661516
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
/tmp/ipykernel_2145/3968974178.py:138: RuntimeWarning: invalid value encountered in sqrt
  sigrednoise = np.sqrt(sig_binned**2-sig0**2/binmeasure)
/tmp/ipykernel_2145/3968974178.py:142: RuntimeWarning: invalid value encountered in sqrt
  sigrednoise = np.sqrt(sig_binned**2-sigwhite**2/binmeasure)
/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.70935340	-0.72091023	0.59985938	-0.20291390
3param 	1.64937041	-2.38471138	1.05992189
Quad 	0.01796000	0.27118952
Linear 	0.24795376

c1 = 0.7093533957894628
c2 = -0.720910232137951
c3 = 0.5998593798157863
c4 = -0.20291390383580635


Fitting Bin 13  Wavelength = 4.191056326666667   Range= [ 4.1148019 : 4.2569868 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10270.67808754911  scatter  0.0019241228462199263
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10270.67808754911  scatter  0.0019241228462199263
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10270.67808754911  scatter  0.0019241228462199263
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 10270.462383695463  scatter  0.00192411899378773
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10281.224417761341  scatter  0.0019241028770267475
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10270.677020400442  scatter  0.0019241227459342236
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10270.678070523256  scatter  0.0019241228446517237
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10270.680339582332  scatter  0.0019241228106100469
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10270.679291597147  scatter  0.00192412282301284
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10270.681117343076  scatter  0.0019241227894078255
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10270.678651874648  scatter  0.001924122899526156
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08076815295987966 current chi^2= 10166.766870806741  scatter  0.001923789708731022
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0807708626669989 current chi^2= 10166.767167675967  scatter  0.001923789713248373
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08076815295987966 current chi^2= 10167.036033342643  scatter  0.0019237704840095458
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08076815295987966 current chi^2= 10166.76687043278  scatter  0.0019237897090096027
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08076815295987966 current chi^2= 10166.766870635352  scatter  0.0019237897087574195
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08076815295987966 current chi^2= 10166.766870376901  scatter  0.0019237897087292827
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08076815295987966 current chi^2= 10166.766870598873  scatter  0.0019237897087314036
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08076815295987966 current chi^2= 10166.76687032602  scatter  0.0019237897087241152
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08076815295987966 current chi^2= 10166.76687040647  scatter  0.001923789709107902
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08076799995261236 current chi^2= 10166.766846977764  scatter  0.0019237894692717898
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08076799995261236 current chi^2= 10166.766846977764  scatter  0.0019237894692717898
Re-Fitting Bin 13  Wavelength = 4.191056326666667   Range= [ 4.1148019 : 4.2569868 ]

redchi 1.2422735639024638
chi2 10166.766846977764
nfree 8184
bic 1841.2822566203379
aic 1785.1949498421036
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.08076800 +/- 4.1673e-04 (0.52%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        334548.499 +/- 21.6569457 (0.01%) (init = 334610.8)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:       0.00255080 +/- 8.0179e-05 (3.14%) (init = 0.002471999)
    ysh:      -1.7229e-04 +/- 7.4585e-05 (43.29%) (init = -0.0001798177)
    x2sh:      2.3572e-04 +/- 1.8204e-04 (77.22%) (init = 0.000255704)
    y2sh:      1.2318e-04 +/- 1.8048e-04 (146.52%) (init = 0.0001410066)
    xysh:     -3.1019e-04 +/- 3.5834e-04 (115.52%) (init = -0.0003726413)
    comm:     -0.00237086 +/- 6.6405e-05 (2.80%) (init = -0.002301265)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9820
    C(x2sh, xysh) = -0.9756
    C(x2sh, y2sh) = +0.9377
    C(rprs, f0)   = +0.8117
    C(xsh, ysh)   = -0.6332
    C(xsh, comm)  = -0.4870
    C(f0, x2sh)   = -0.3876
    C(f0, y2sh)   = -0.3309
    C(ysh, comm)  = -0.3011
    C(f0, xysh)   = +0.2765
    C(xsh, x2sh)  = +0.2455
    C(xsh, xysh)  = -0.2157
    C(rprs, x2sh) = -0.1954
    C(xysh, comm) = +0.1799
    C(xsh, y2sh)  = +0.1783
    C(x2sh, comm) = -0.1729
    C(rprs, xsh)  = -0.1715
    C(y2sh, comm) = -0.1491
    C(rprs, ysh)  = +0.1425
    C(rprs, y2sh) = -0.1419
    C(f0, xsh)    = -0.1256
    C(rprs, xysh) = +0.1028
Residual standard deviation  (ppm) :  1923.7894692717898
Photon noise                 (ppm) :  1728.90231940466
Photon noise performance       (%) :  89.86962175539404
White noise                  (ppm) :  1923.7894692717898
Red noise                    (ppm) :  0.0
Transit depth measured error (ppm) :  67.31755160280684
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
/tmp/ipykernel_2145/3968974178.py:138: RuntimeWarning: invalid value encountered in sqrt
  sigrednoise = np.sqrt(sig_binned**2-sig0**2/binmeasure)
/tmp/ipykernel_2145/3968974178.py:142: RuntimeWarning: invalid value encountered in sqrt
  sigrednoise = np.sqrt(sig_binned**2-sigwhite**2/binmeasure)
/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.66323556	-0.66364614	0.56071223	-0.19136825
3param 	1.55253331	-2.22981994	0.98936566
Quad 	0.02366138	0.25528759
Linear 	0.24016884

c1 = 0.6632355644596191
c2 = -0.6636461355917854
c3 = 0.5607122304796917
c4 = -0.1913682538498809


Fitting Bin 14  Wavelength = 4.33061144   Range= [ 4.2569868 : 4.3943119 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10289.913781761701  scatter  0.0016644962142304248
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10289.913781761701  scatter  0.0016644962142304248
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10289.913781761701  scatter  0.0016644962142304248
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 10289.901933702604  scatter  0.0016644892700912793
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10285.939005640274  scatter  0.0016644785829898314
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10289.913936203402  scatter  0.001664496226733103
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10289.913792382551  scatter  0.0016644962150953921
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10289.913735520771  scatter  0.001664496212766558
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10289.913417261308  scatter  0.0016644962008620287
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10289.913415316345  scatter  0.001664496201429189
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 10289.914172366349  scatter  0.0016644962458649158
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114871454647471 current chi^2= 10258.193218546112  scatter  0.0016628199563086179
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08115142625775895 current chi^2= 10258.1941742969  scatter  0.001662819986023979
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114871454647471 current chi^2= 10258.538596881124  scatter  0.0016628033521907623
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114871454647471 current chi^2= 10258.193216267047  scatter  0.001662819956048995
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114871454647471 current chi^2= 10258.193218256016  scatter  0.0016628199562864813
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114871454647471 current chi^2= 10258.193218302273  scatter  0.0016628199563365014
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114871454647471 current chi^2= 10258.193218331666  scatter  0.0016628199563393814
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114871454647471 current chi^2= 10258.193217509495  scatter  0.0016628199564533276
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114871454647471 current chi^2= 10258.193217120883  scatter  0.0016628199561650211
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114761167500006 current chi^2= 10258.192606347107  scatter  0.001662819116938555
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08115032338051353 current chi^2= 10258.192854556697  scatter  0.0016628191224128802
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114761167500006 current chi^2= 10258.56163214563  scatter  0.0016628025091784278
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114761167500006 current chi^2= 10258.192606464518  scatter  0.0016628191168734717
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114761167500006 current chi^2= 10258.192606348091  scatter  0.001662819116940044
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114761167500006 current chi^2= 10258.192606347584  scatter  0.0016628191169345682
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114761167500006 current chi^2= 10258.19260634767  scatter  0.0016628191169338314
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114761167500006 current chi^2= 10258.192606358803  scatter  0.001662819116915546
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08114761167500006 current chi^2= 10258.192606378565  scatter  0.0016628191169131912
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0811476094199487 current chi^2= 10258.19260634697  scatter  0.0016628191172742125
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0811476094199487 current chi^2= 10258.19260634697  scatter  0.0016628191172742125
Re-Fitting Bin 14  Wavelength = 4.33061144   Range= [ 4.2569868 : 4.3943119 ]

redchi 1.2534448443727968
chi2 10258.19260634697
nfree 8184
bic 1914.62045096242
aic 1858.5331441841856
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.08114761 +/- 3.5865e-04 (0.44%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        451670.955 +/- 25.2930093 (0.01%) (init = 451633.6)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:      -5.6351e-04 +/- 6.9301e-05 (12.30%) (init = -0.0005649959)
    ysh:       5.0939e-05 +/- 6.4477e-05 (126.57%) (init = -4.022727e-05)
    x2sh:      2.6615e-05 +/- 1.5736e-04 (591.25%) (init = -6.50098e-06)
    y2sh:      2.7290e-05 +/- 1.5601e-04 (571.68%) (init = -4.604367e-05)
    xysh:     -1.3847e-04 +/- 3.0976e-04 (223.71%) (init = -5.075544e-05)
    comm:      2.9164e-04 +/- 5.7406e-05 (19.68%) (init = 0.0003705078)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9820
    C(x2sh, xysh) = -0.9756
    C(x2sh, y2sh) = +0.9377
    C(rprs, f0)   = +0.8119
    C(xsh, ysh)   = -0.6334
    C(xsh, comm)  = -0.4869
    C(f0, x2sh)   = -0.3876
    C(f0, y2sh)   = -0.3309
    C(ysh, comm)  = -0.3011
    C(f0, xysh)   = +0.2764
    C(xsh, x2sh)  = +0.2443
    C(xsh, xysh)  = -0.2147
    C(rprs, x2sh) = -0.1954
    C(xysh, comm) = +0.1791
    C(xsh, y2sh)  = +0.1772
    C(x2sh, comm) = -0.1718
    C(rprs, xsh)  = -0.1703
    C(y2sh, comm) = -0.1482
    C(rprs, ysh)  = +0.1424
    C(rprs, y2sh) = -0.1420
    C(f0, xsh)    = -0.1240
    C(rprs, xysh) = +0.1028
Residual standard deviation  (ppm) :  1662.8191172742124
Photon noise                 (ppm) :  1487.951987810557
Photon noise performance       (%) :  89.48369503050293
White noise                  (ppm) :  1661.4245920344893
Red noise                    (ppm) :  68.2191331068876
Transit depth measured error (ppm) :  58.20780043345502
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.60983205	-0.61629224	0.53858454	-0.18657650
3param 	1.42144117	-2.02725490	0.89908510
Quad 	0.03065170	0.23249927
Linear 	0.22783256

c1 = 0.6098320544306087
c2 = -0.6162922411291898
c3 = 0.5385845432063413
c4 = -0.1865765041164378


Fitting Bin 15  Wavelength = 4.465538639999999   Range= [ 4.3943119 : 4.5272022 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11278.203376713487  scatter  0.0018681940468607075
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11278.203376713487  scatter  0.0018681940468607075
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11278.203376713487  scatter  0.0018681940468607075
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 11277.83214318902  scatter  0.0018681926675595134
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11299.318445842939  scatter  0.0018681751941440623
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11278.203837402609  scatter  0.0018681940859539847
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11278.203923921548  scatter  0.0018681940927477733
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11278.212341135357  scatter  0.0018681940400044215
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11278.21280269462  scatter  0.0018681940283029528
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11278.219144802773  scatter  0.001868194025994198
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11278.20359857683  scatter  0.0018681940656683177
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08074040553924494 current chi^2= 10929.456469146928  scatter  0.0018686199938311842
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0807431150992231 current chi^2= 10929.45686323399  scatter  0.0018686200131210542
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08074040553924494 current chi^2= 10929.764481993305  scatter  0.0018686013379057688
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08074040553924494 current chi^2= 10929.456468878514  scatter  0.0018686199938014291
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08074040553924494 current chi^2= 10929.456468507708  scatter  0.0018686199937214907
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08074040553924494 current chi^2= 10929.456468796496  scatter  0.001868619993805434
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08074040553924494 current chi^2= 10929.456468854944  scatter  0.00186861999388548
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08074040553924494 current chi^2= 10929.456468797136  scatter  0.001868619993862141
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08074040553924494 current chi^2= 10929.45646887397  scatter  0.0018686199937963438
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0807384484639111 current chi^2= 10929.456421399464  scatter  0.001868620231965985
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0807384484639111 current chi^2= 10929.456421399464  scatter  0.001868620231965985
Re-Fitting Bin 15  Wavelength = 4.465538639999999   Range= [ 4.3943119 : 4.5272022 ]

redchi 1.335466327150472
chi2 10929.456421399464
nfree 8184
bic 2433.8695782641184
aic 2377.782271485884
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.08073845 +/- 4.0441e-04 (0.50%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        381159.922 +/- 23.9803751 (0.01%) (init = 381273.9)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:       8.1010e-04 +/- 7.7894e-05 (9.62%) (init = 0.0008546914)
    ysh:      -0.00148161 +/- 7.2466e-05 (4.89%) (init = -0.001520144)
    x2sh:      4.3154e-04 +/- 1.7687e-04 (40.99%) (init = 0.0004347958)
    y2sh:      4.8933e-04 +/- 1.7536e-04 (35.84%) (init = 0.0004636312)
    xysh:     -8.5004e-04 +/- 3.4817e-04 (40.96%) (init = -0.0008122209)
    comm:      4.8510e-04 +/- 6.4511e-05 (13.30%) (init = 0.0004869507)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9820
    C(x2sh, xysh) = -0.9756
    C(x2sh, y2sh) = +0.9378
    C(rprs, f0)   = +0.8119
    C(xsh, ysh)   = -0.6335
    C(xsh, comm)  = -0.4867
    C(f0, x2sh)   = -0.3877
    C(f0, y2sh)   = -0.3311
    C(ysh, comm)  = -0.3011
    C(f0, xysh)   = +0.2767
    C(xsh, x2sh)  = +0.2452
    C(xsh, xysh)  = -0.2155
    C(rprs, x2sh) = -0.1957
    C(xysh, comm) = +0.1791
    C(xsh, y2sh)  = +0.1781
    C(x2sh, comm) = -0.1718
    C(rprs, xsh)  = -0.1715
    C(y2sh, comm) = -0.1482
    C(rprs, ysh)  = +0.1437
    C(rprs, y2sh) = -0.1422
    C(f0, xsh)    = -0.1253
    C(rprs, xysh) = +0.1031
Residual standard deviation  (ppm) :  1868.6202319659849
Photon noise                 (ppm) :  1619.7440194755472
Photon noise performance       (%) :  86.68128449895923
White noise                  (ppm) :  1868.6202319659849
Red noise                    (ppm) :  0.0
Transit depth measured error (ppm) :  65.30327715894207
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
/tmp/ipykernel_2145/3968974178.py:138: RuntimeWarning: invalid value encountered in sqrt
  sigrednoise = np.sqrt(sig_binned**2-sig0**2/binmeasure)
/tmp/ipykernel_2145/3968974178.py:142: RuntimeWarning: invalid value encountered in sqrt
  sigrednoise = np.sqrt(sig_binned**2-sigwhite**2/binmeasure)
/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.60997931	-0.64472811	0.57190221	-0.19852225
3param 	1.39349735	-1.99455682	0.88740152
Quad 	0.03077621	0.22593126
Linear 	0.22238679

c1 = 0.6099793129613253
c2 = -0.6447281124231364
c3 = 0.5719022054225794
c4 = -0.19852224914413683


Fitting Bin 16  Wavelength = 4.59623168   Range= [ 4.5272022 : 4.6560258 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11842.295811917822  scatter  0.0022415153795745427
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11842.295811917822  scatter  0.0022415153795745427
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11842.295811917822  scatter  0.0022415153795745427
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 11842.238691004195  scatter  0.00224151671214725
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11846.702093213657  scatter  0.002241493157458794
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11842.296047601812  scatter  0.0022415154023594053
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11842.295868807094  scatter  0.002241515385064797
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11842.296630878918  scatter  0.002241515389237793
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11842.296721583949  scatter  0.0022415153838940727
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11842.297428854086  scatter  0.0022415153940350385
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 11842.29657270735  scatter  0.0022415154517483635
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08025447130036717 current chi^2= 11816.076610734537  scatter  0.002240984420773288
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08025717826103779 current chi^2= 11816.076811086168  scatter  0.0022409844333708445
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08025447130036717 current chi^2= 11816.310276051317  scatter  0.002240962061743243
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08025447130036717 current chi^2= 11816.076610941302  scatter  0.0022409844211252446
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08025447130036717 current chi^2= 11816.07661072522  scatter  0.002240984420828462
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08025447130036717 current chi^2= 11816.076610754297  scatter  0.0022409844207316814
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08025447130036717 current chi^2= 11816.076610756501  scatter  0.002240984420788597
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08025447130036717 current chi^2= 11816.076610852493  scatter  0.0022409844207188926
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08025447130036717 current chi^2= 11816.076610900334  scatter  0.0022409844207355355
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08025350773846146 current chi^2= 11816.07660441786  scatter  0.0022409846382483688
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08025350773846146 current chi^2= 11816.07660441786  scatter  0.0022409846382483688
Re-Fitting Bin 16  Wavelength = 4.59623168   Range= [ 4.5272022 : 4.6560258 ]

redchi 1.4438021266395233
chi2 11816.07660441786
nfree 8184
bic 3072.841155262677
aic 3016.7538484844426
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.08025351 +/- 4.8728e-04 (0.61%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        286515.192 +/- 21.6081512 (0.01%) (init = 286539.3)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:       0.00105521 +/- 9.3415e-05 (8.85%) (init = 0.0009579191)
    ysh:      -1.9211e-04 +/- 8.6901e-05 (45.23%) (init = -0.0002364105)
    x2sh:      2.6687e-04 +/- 2.1207e-04 (79.47%) (init = 0.000171836)
    y2sh:      3.2514e-04 +/- 2.1025e-04 (64.67%) (init = 0.000207163)
    xysh:     -6.0995e-04 +/- 4.1745e-04 (68.44%) (init = -0.0003703153)
    comm:     -9.2834e-04 +/- 7.7357e-05 (8.33%) (init = -0.0007643483)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9820
    C(x2sh, xysh) = -0.9756
    C(x2sh, y2sh) = +0.9377
    C(rprs, f0)   = +0.8117
    C(xsh, ysh)   = -0.6335
    C(xsh, comm)  = -0.4869
    C(f0, x2sh)   = -0.3879
    C(f0, y2sh)   = -0.3311
    C(ysh, comm)  = -0.3010
    C(f0, xysh)   = +0.2768
    C(xsh, x2sh)  = +0.2451
    C(xsh, xysh)  = -0.2153
    C(rprs, x2sh) = -0.1957
    C(xysh, comm) = +0.1795
    C(xsh, y2sh)  = +0.1779
    C(x2sh, comm) = -0.1724
    C(rprs, xsh)  = -0.1721
    C(y2sh, comm) = -0.1486
    C(rprs, ysh)  = +0.1435
    C(rprs, y2sh) = -0.1421
    C(f0, xsh)    = -0.1258
    C(rprs, xysh) = +0.1031
Residual standard deviation  (ppm) :  2240.984638248369
Photon noise                 (ppm) :  1868.2120666846674
Photon noise performance       (%) :  83.36567930001192
White noise                  (ppm) :  2239.910337696162
Red noise                    (ppm) :  69.51713430841835
Transit depth measured error (ppm) :  78.21205318033911
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
You are using the 3D limb darkening models.
Current Directories Entered:
  ./notebookrun2/
  ./notebookrun2/3DGrid
Filename: mmu_t45g45m00v05.flx

Closest values to your inputs:
Teff  :  4500
M_H   :  0.0
log(g):  4.5
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Limb darkening parameters:
4param 	0.60350301	-0.62606848	0.54814194	-0.18913144
3param 	1.39051665	-1.99106836	0.88526280
Quad 	0.02900557	0.22612276
Linear 	0.22077857

c1 = 0.6035030137054289
c2 = -0.6260684823911632
c3 = 0.548141942354202
c4 = -0.18913144420604025


Fitting Bin 17  Wavelength = 4.7230313   Range= [ 4.6560258 : 4.7811009 ]
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 16304.51005115074  scatter  0.0033369741949000062
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 16304.51005115074  scatter  0.0033369741949000062
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 16304.51005115074  scatter  0.0033369741949000062
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040270774358477 current chi^2= 16304.51956414733  scatter  0.003336977843933747
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 16306.199172131446  scatter  0.003336941500147955
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 16304.512441902225  scatter  0.0033369744387172847
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 16304.510070289802  scatter  0.0033369741968494794
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 16304.510355762088  scatter  0.0033369742082390713
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 16304.510889284422  scatter  0.0033369742372033784
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 16304.511128985454  scatter  0.0033369742487761424
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.08040000000000003 current chi^2= 16304.511399530194  scatter  0.0033369743319906745
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07994040368236249 current chi^2= 16280.793167076485  scatter  0.003335098141408348
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.0799431089403328 current chi^2= 16280.793401695651  scatter  0.0033350981494893496
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07994040368236249 current chi^2= 16280.935441154012  scatter  0.003335064806661224
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07994040368236249 current chi^2= 16280.793166625608  scatter  0.0033350981402473184
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07994040368236249 current chi^2= 16280.793167036642  scatter  0.003335098141366638
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07994040368236249 current chi^2= 16280.793166674985  scatter  0.0033350981414868664
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07994040368236249 current chi^2= 16280.793166625206  scatter  0.003335098141588248
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07994040368236249 current chi^2= 16280.793166395082  scatter  0.003335098141650197
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07994040368236249 current chi^2= 16280.793166424512  scatter  0.003335098140127679
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07993813059244648 current chi^2= 16280.793115368819  scatter  0.003335098304293087
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rprs:  0.07993813059244648 current chi^2= 16280.793115368819  scatter  0.003335098304293087
Re-Fitting Bin 17  Wavelength = 4.7230313   Range= [ 4.6560258 : 4.7811009 ]

redchi 1.989344222308018
chi2 16280.793115368819
nfree 8184
bic 5698.582350369171
aic 5642.495043590937
L-M FIT Variable
[[Variables]]
    cosinc:    0.05481076 (fixed)
    rho_star:  8.320569 (fixed)
    a_Rs:      14.54 (fixed)
    rprs:      0.07993813 +/- 7.2749e-04 (0.91%) (init = 0.0804)
    t0:        2454865 (fixed)
    f0:        178202.655 +/- 19.9965859 (0.01%) (init = 178209.5)
    ecc:       0 (fixed)
    omega:     0 (fixed)
    Fslope:    0 (fixed)
    xsh:       0.00131928 +/- 1.3905e-04 (10.54%) (init = 0.001501862)
    ysh:       5.1327e-05 +/- 1.2935e-04 (252.00%) (init = -1.888577e-05)
    x2sh:      3.9976e-04 +/- 3.1563e-04 (78.95%) (init = 0.0001132571)
    y2sh:      5.5004e-04 +/- 3.1294e-04 (56.89%) (init = 0.0002763527)
    xysh:     -0.00101505 +/- 6.2132e-04 (61.21%) (init = -0.000378254)
    comm:     -0.00132254 +/- 1.1513e-04 (8.71%) (init = -0.001357975)
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(y2sh, xysh) = -0.9820
    C(x2sh, xysh) = -0.9756
    C(x2sh, y2sh) = +0.9377
    C(rprs, f0)   = +0.8116
    C(xsh, ysh)   = -0.6335
    C(xsh, comm)  = -0.4869
    C(f0, x2sh)   = -0.3879
    C(f0, y2sh)   = -0.3311
    C(ysh, comm)  = -0.3010
    C(f0, xysh)   = +0.2769
    C(xsh, x2sh)  = +0.2453
    C(xsh, xysh)  = -0.2154
    C(rprs, x2sh) = -0.1957
    C(xysh, comm) = +0.1796
    C(xsh, y2sh)  = +0.1780
    C(x2sh, comm) = -0.1725
    C(rprs, xsh)  = -0.1725
    C(y2sh, comm) = -0.1488
    C(rprs, ysh)  = +0.1437
    C(rprs, y2sh) = -0.1420
    C(f0, xsh)    = -0.1262
    C(rprs, xysh) = +0.1032
Residual standard deviation  (ppm) :  3335.098304293087
Photon noise                 (ppm) :  2368.8791998574584
Photon noise performance       (%) :  71.02876688246735
White noise                  (ppm) :  3332.5485776080777
Red noise                    (ppm) :  130.64105815647974
Transit depth measured error (ppm) :  116.30896139174529
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/hostedtoolcache/Python/3.11.12/x64/lib/python3.11/site-packages/uncertainties/core.py:1024: UserWarning: Using UFloat objects with std_dev==0 may give unexpected results.
  warn(&quot;Using UFloat objects with std_dev==0 may give unexpected results.&quot;)
/tmp/ipykernel_2145/3968974178.py:175: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax1.scatter(x, y/p[&#39;f0&#39;].value, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
/tmp/ipykernel_2145/3968974178.py:190: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  ax2.scatter(x, residppm, s=msize*0.75, linewidth=1, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;, zorder=0)  # overplot Transit model at data
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>** Can Now View Output PDFs in  ./notebookrun2/
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2145/3968974178.py:216: UserWarning: You passed a edgecolor/edgecolors (&#39;blue&#39;) for an unfilled marker (&#39;+&#39;).  Matplotlib is ignoring the edgecolor in favor of the facecolor.  This behavior may change in the future.
  plt.scatter(x, light_curve+resid, s=msize*0.75, linewidth=1, zorder=0, alpha=0.5, marker=&#39;+&#39;, edgecolors=&#39;blue&#39;)
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="plot-measured-exoplanet-transmission-spectrum-vs-injected">
<h1>Plot Measured Exoplanet Transmission Spectrum vs Injected<a class="headerlink" href="#plot-measured-exoplanet-transmission-spectrum-vs-injected" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># --------------------------------------------------------------------------</span>
<span class="c1"># Load Injected Transmission spectra to compare with recovered value</span>

<span class="c1"># Download Injected Spectra</span>
<span class="n">fn_tm</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/transit_spectroscopy_notebook/trans-iso_GJ-0436_0669.0_+0.0_0.56_0001_0.00_model.NIRSpec_PRISM.txt&#39;</span><span class="p">)</span>
<span class="n">destld</span> <span class="o">=</span> <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">fn_tm</span><span class="p">,</span> <span class="n">save_directory</span><span class="o">+</span><span class="s1">&#39;trans-iso_GJ-0436_0669.0_+0.0_0.56_0001_0.00_model.NIRSpec_PRISM.txt&#39;</span><span class="p">)</span>        

<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">save_directory</span><span class="o">+</span><span class="s1">&#39;trans-iso_GJ-0436_0669.0_+0.0_0.56_0001_0.00_model.NIRSpec_PRISM.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">genfromtxt</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;   &#39;</span><span class="p">)</span>
<span class="n">model_ws</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">model_spec</span> <span class="o">=</span> <span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># Read fit transit depths</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">ascii</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">save_directory</span><span class="o">+</span><span class="s1">&#39;JWST_NIRSpec_Prism_fit_transmission_spectra.csv&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;csv&#39;</span><span class="p">)</span>
<span class="n">wsd</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Wavelength Center (um)&#39;</span><span class="p">]</span>
<span class="n">werr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Wavelength half-width (um)&#39;</span><span class="p">]</span>
<span class="n">rprs</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Rp/Rs&#39;</span><span class="p">]</span>
<span class="n">rerr</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Rp/Rs 1-sigma error&#39;</span><span class="p">]</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Beta Rednoise Inflation factor&#39;</span><span class="p">]</span>

<span class="c1"># plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_ws</span><span class="p">,</span> <span class="n">model_spec</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mf">1E6</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Injected Spectra&#39;</span><span class="p">)</span>  <span class="c1"># overplot Transit model at data</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">wsd</span><span class="p">,</span> <span class="n">rprs</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mf">1E6</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">werr</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">rerr</span><span class="o">*</span><span class="n">rprs</span><span class="o">*</span><span class="mf">1E6</span><span class="o">*</span><span class="n">beta</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Recovered Spectra with $\sigma_r$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">errorbar</span><span class="p">(</span><span class="n">wsd</span><span class="p">,</span> <span class="n">rprs</span><span class="o">**</span><span class="mi">2</span><span class="o">*</span><span class="mf">1E6</span><span class="p">,</span> <span class="n">xerr</span><span class="o">=</span><span class="n">werr</span><span class="p">,</span> <span class="n">yerr</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">rerr</span><span class="o">*</span><span class="n">rprs</span><span class="o">*</span><span class="mf">1E6</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Recovered Spectra&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wavelength ($\mu$m)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Transit Depth ($R_p/R_s$)$^2$ (ppm)&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">200</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.5</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_minor_locator</span><span class="p">(</span><span class="n">ticker</span><span class="o">.</span><span class="n">MultipleLocator</span><span class="p">(</span><span class="mf">0.1</span><span class="p">))</span>
<span class="n">axs</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">3.3</span><span class="p">,</span> <span class="mi">6850</span><span class="p">,</span> <span class="s1">&#39;CH$_4$&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">4.25</span><span class="p">,</span> <span class="mi">6700</span><span class="p">,</span> <span class="s1">&#39;CO&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.3</span><span class="p">,</span> <span class="mi">6750</span><span class="p">,</span> <span class="s1">&#39;CH$_4$&#39;</span><span class="p">)</span>
<span class="n">axs</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">2.75</span><span class="p">,</span> <span class="mi">6550</span><span class="p">,</span> <span class="s1">&#39;H$_2$O&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">5700</span><span class="p">,</span> <span class="mi">7000</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">5.25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>    
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/44c36cacccccfcf52cf73fd627fb6c4843542a21b7f4486aa99df9c5b45674b8.png" src="../../../_images/44c36cacccccfcf52cf73fd627fb6c4843542a21b7f4486aa99df9c5b45674b8.png" />
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 2000x1400 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
<p>By and large, the injected transit depths are well recovered across the spectra, with features such as H<span class="math notranslate nohighlight">\(_2\)</span>O and CH<span class="math notranslate nohighlight">\(_4\)</span> easily detected. There is a bit of an offset in data-points long-ward of 3.5 <span class="math notranslate nohighlight">\(\mu\)</span>m that could perhaps be due to changes in CO<span class="math notranslate nohighlight">\(_2\)</span> or H<span class="math notranslate nohighlight">\(_2\)</span>O absorption features from ice built up on the cryogenic window during the CV3 test. These wavelengths show some increases in time correlated noise (<span class="math notranslate nohighlight">\(\sigma_r\)</span>), which has been measured here, and the errors in the plot also show the transit depths with this error included.</p>
<p>The precisions from the ground-based test are very encouraging, with the best measured bin (which occurs in a clean part of the spectrum with high count rates) achieving near-photon limited transit depths measured to about 30 ppm in only 2 hours of data, and with minimal time correlated noise (<span class="math notranslate nohighlight">\(\sigma_r\)</span>).</p>
<p>For more robust error estimates, in practice the least-squares minimization performed here would be replaced by an MCMC routine.  In addition, with actual transit data, the transit fit parameters (e.g. <span class="math notranslate nohighlight">\(i\)</span>, <span class="math notranslate nohighlight">\(a/R_{star}\)</span>, T<span class="math notranslate nohighlight">\(_0\)</span>) would also have to be first fit as well, as they can/will differ from literature estimates in high precision transit light curves as JWST will provide.</p>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/NIRSpec/transit_spectroscopy_notebook"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../mos_slits_to_sky/NIRSpec_MOS_slits_to_sky.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">NIRSpec MOS Slits to Sky</p>
      </div>
    </a>
    <a class="right-next"
       href="../galaxy_redshift/redshift_fitting.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Redshift and Template Fitting</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">BOTS Time Series Observations</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#load-packages">Load packages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-parameters">Setup Parameters</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#download-and-load-nirspec-data">Download and Load NIRSpec data</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-2d-spectral-data">Visualizing the 2D spectral data</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-1d-spectra-from-2d-array-of-images">Extract 1D spectra from 2D array of images</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualizing-the-1d-spectral-data">Visualizing the 1D spectral data</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculate-orbital-phase-and-a-separate-fine-grid-model-used-for-plotting-purposes">Calculate Orbital Phase and a separate fine grid model used for plotting purposes</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-systematic-drift-on-the-detector">Dealing with Systematic Drift On the Detector</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-arrays-of-the-vectors-used-for-detrending">Create arrays of the vectors used for detrending.</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#transit-and-limb-darkening-model-functions">Transit and Limb-Darkening Model Functions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#now-define-the-transit-model-function">Now define the transit model function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#now-define-the-function-to-generate-the-transit-light-curve-and-compare-it-to-the-data">Now define the function to generate the transit light curve and compare it to the data</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-transit-light-curves">FIT Transit Light Curves</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup-wavelengths-to-fit-over">Setup Wavelengths to fit over</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loop-over-wavelength-bins-fitting-each-lightcurve">Loop Over Wavelength Bins Fitting Each Lightcurve</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#note-this-step-takes-considerable-time-to-complete-20-min-few-minutes-bin">Note this step takes considerable time to complete (~20 min, few minutes/bin)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-measured-exoplanet-transmission-spectrum-vs-injected">Plot Measured Exoplanet Transmission Spectrum vs Injected</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      Â© Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>