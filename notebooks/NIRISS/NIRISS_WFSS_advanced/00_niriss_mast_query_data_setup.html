

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Download Wide Field Slittless Spectroscopy (WFSS) Data &#8212; STScI JDAT Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" href="../../../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-D46G4HKJY3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/NIRISS/NIRISS_WFSS_advanced/00_niriss_mast_query_data_setup';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Run Image Pipeline and Create Source Catalog" href="01_niriss_wfss_image2_image3.html" />
    <link rel="prev" title="Advanced: NIRISS Imaging Tutorial Notebook" href="../niriss_imaging/niriss-imaging-tutorial.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="STScI JDAT Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="STScI JDAT Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">General</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebook_development_workflow.html">Notebook Development Workflow</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/submitting_notebooks.html">Submitting Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/requirements.html">Requirements file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebooks.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/data_files.html">Data Files</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">GitHub Guidelines</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_setup.html">GitHub Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_workflow.html">GitHub Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_pr.html">GitHub PR</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Cross-Instrument</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/asdf_example/asdf_example.html">ASDF Example</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/background_estimation_imaging/Imaging_Sky_Background_Estimation.html">Complex 2D Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/composite_model_fitting/specfit_demo_3.html">Composite Model Spectral Fitting</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">MAST Query</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/rgb_imviz/imviz_rgb_carina.html">RGB images with Imviz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">Specviz Simple Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/update_pure_parallel_wcs/NIRISS_correct_pure_parallel_WCS.html">Improving Accuracy of WCS of Pure Parallel Dataset</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MIRI</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">MRS Mstar - Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">IFU of YSOs in LMC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/MIRI_LRS_spectral_extraction/miri_lrs_advanced_extraction_part1.html">LRS Optimal Spectral Extraction</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRCam</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/aperture_photometry/NIRCam_Aperture_Photometry_Example.html">Point Source Aperture Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_photometry/NIRCam_multiband_photometry.html">Extended Aperture Photometry</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">Cross-Filter PSF Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/psf_photometry/NIRCam_PSF_Photometry_Example.html">PSF Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_wisp_subtraction/nircam_wisp_subtraction.html">NIRCam Wisp Removal</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRISS</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../NIRISS_WFSS_postpipeline/00_Optimal_extraction.html">WFSS Spectra - Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NIRISS_WFSS_postpipeline/01_Combine_and_normalize_1D_spectra.html">WFSS Spectra - Combine and Normalize 1D Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NIRISS_WFSS_postpipeline/02_Cross_correlation_template.html">WFSS Spectra - Cross-Correlation Template</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map.html">WFSS Spectra - Emission Line Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../niriss_imaging/niriss-imaging-tutorial.html">NIRISS Imaging Tutorial</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">NIRISS MAST</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_niriss_wfss_image2_image3.html">Direct imaging for WFSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_niriss_wfss_spec2.html">Spec2 pipeline for WFSS</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRSpec</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html">IFU Cube Fitting</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/cube_fitting/cube_fitting.html">IFU Cube Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/ifu_optimal/ifu_optimal.html">IFU Optimal Spectral Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/optimal_extraction/Spectral_Extraction-static.html">MOS Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/mos_spectroscopy_advanced/MOSspec_advanced.html">MOS Spectroscopy of Extragalactic Field</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">BOTS Time Series Observations</a></li>








<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/galaxy_redshift/redshift_fitting.html">Redshift and Template Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/FS_NSClean_example.html">FS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/IFU_NSClean_example.html">IFU Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/MOS_NSClean_example.html">MOS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/BOTS_NSClean_example.html">BOTS Products with NSClean</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/NIRISS/NIRISS_WFSS_advanced/00_niriss_mast_query_data_setup.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/NIRISS/NIRISS_WFSS_advanced/00_niriss_mast_query_data_setup.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Download Wide Field Slittless Spectroscopy (WFSS) Data</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#querying-for-observations">Querying for Observations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search-with-proposal-id">Search with Proposal ID</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search-with-observation-id">Search with Observation ID</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-and-download-products">Filter and Download Products</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-data-before-downloading">Filtering Data Before Downloading</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-data">Downloading Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-downloaded-data">Inspect Downloaded Data</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="download-wide-field-slittless-spectroscopy-wfss-data">
<h1>Download Wide Field Slittless Spectroscopy (WFSS) Data<a class="headerlink" href="#download-wide-field-slittless-spectroscopy-wfss-data" title="Permalink to this heading">#</a></h1>
<p>This notebook uses the python <a class="reference external" href="https://astroquery.readthedocs.io/en/latest/mast/mast_obsquery.html">astroquery.mast Observations</a> class of the <a class="reference external" href="https://mast.stsci.edu/api/v0/">MAST API</a> to query specific data products of a specific program. We are looking for NIRISS imaging and WFSS files of the <a class="reference external" href="https://www.stsci.edu/jwst/phase2-public/2079.pdf">NGDEEP program</a> (ID 2079). The observations are in three <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-near-infrared-imager-and-slitless-spectrograph/niriss-instrumentation/niriss-pupil-and-filter-wheels">NIRISS filters</a>: F115W, F150W, and F200W using both GR150R and GR150C <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-near-infrared-imager-and-slitless-spectrograph/niriss-instrumentation/niriss-gr150-grisms">grisms</a>. A <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-near-infrared-imager-and-slitless-spectrograph/niriss-observing-strategies/niriss-wfss-recommended-strategies">WFSS observation sequence</a> typically consists of a direct image followed by a grism observation in the same blocking filter to help identify the sources in the field. In program 2079, the exposure sequence follows the pattern: direct image -&gt; GR150R -&gt; direct image -&gt; GR150C -&gt; direct image.</p>
<p><strong>Use case</strong>: use MAST to download data products.<br>
<strong>Data</strong>: JWST/NIRISS images and spectra from program 2079 observation 004.<br>
<strong>Tools</strong>: astropy, astroquery, glob, matplotlib, numpy, os, pandas, (yaml)<br>
<strong>Cross-instrument</strong>: all<br></p>
<p><strong>Content</strong></p>
<ul class="simple">
<li><p><span class="xref myst">Imports</span></p></li>
<li><p><span class="xref myst">Querying for Observations</span></p>
<ul>
<li><p><span class="xref myst">Search with Proposal ID</span></p></li>
<li><p><span class="xref myst">Search with Observation ID</span></p></li>
</ul>
</li>
<li><p><span class="xref myst">Filter and Download Products</span></p>
<ul>
<li><p><span class="xref myst">Filtering Data Before Downloading</span></p></li>
<li><p><span class="xref myst">Downloading Data</span></p></li>
</ul>
</li>
<li><p><span class="xref myst">Inspect Downloaded Data</span></p></li>
</ul>
<p><strong>Author</strong>: Camilla Pacifici (cpacifici&#64;stsci.edu) &amp; Rachel Plesha (rplesha&#64;stsci.edu) &amp; Jo Taylor (jotaylor&#64;stsci.edu)<br>
<strong>First Published</strong>: May 2024</p>
<p>This notebook was inspired by the <a class="reference external" href="https://github.com/spacetelescope/jwebbinar_prep/blob/main/mast_session/Crowded_Field/Crowded_Field.ipynb">JWebbinar session about MAST</a>.</p>
<p><a id='imports'></a></p>
<section id="imports">
<h2>Imports<a class="headerlink" href="#imports" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">from</span> <span class="nn">astroquery.mast</span> <span class="kn">import</span> <span class="n">Observations</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<p><a id='setup'></a></p>
</section>
<section id="querying-for-observations">
<h2>Querying for Observations<a class="headerlink" href="#querying-for-observations" title="Permalink to this heading">#</a></h2>
<p>The observations class in <code class="docutils literal notranslate"><span class="pre">astroquery.mast</span></code> is used to download JWST data. Use the metadata function to see the available search options and their descriptions.</p>
<p>Note that for JWST, the instrument names have a specific format. More information about that can be found at: https://outerspace.stsci.edu/display/MASTDOCS/JWST+Instrument+Names</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Observations</span><span class="o">.</span><span class="n">get_metadata</span><span class="p">(</span><span class="s2">&quot;observations&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The two most common ways to download specific datasets are by using the <a class="reference external" href="https://www.stsci.edu/jwst/science-execution/program-information">proposal ID</a> or by using the <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/jwst/data_products/file_naming.html">observation ID</a>.</p>
<p><a id='propid'></a></p>
<section id="search-with-proposal-id">
<h3>Search with Proposal ID<a class="headerlink" href="#search-with-proposal-id" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Select the proposal ID, instrument, and some useful keywords (filters in this case).</span>
<span class="n">obs_table</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">obs_collection</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;JWST&quot;</span><span class="p">],</span> 
                                        <span class="n">instrument_name</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NIRISS/IMAGE&quot;</span><span class="p">,</span> <span class="s2">&quot;NIRISS/WFSS&quot;</span><span class="p">],</span>
                                        <span class="n">provenance_name</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CALJWST&quot;</span><span class="p">],</span> <span class="c1"># Executed observations</span>
                                        <span class="n">filters</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;F115W&#39;</span><span class="p">,</span> <span class="s1">&#39;F150W&#39;</span><span class="p">,</span> <span class="s1">&#39;F200W&#39;</span><span class="p">],</span>
                                        <span class="n">proposal_id</span><span class="o">=</span><span class="p">[</span><span class="mi">2079</span><span class="p">],</span>
                                        <span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_table</span><span class="p">),</span> <span class="s1">&#39;files found&#39;</span><span class="p">)</span>
<span class="c1"># look at what was obtained in this query for a select number of column names of interest</span>
<span class="n">obs_table</span><span class="p">[[</span><span class="s1">&#39;obs_collection&#39;</span><span class="p">,</span> <span class="s1">&#39;instrument_name&#39;</span><span class="p">,</span> <span class="s1">&#39;filters&#39;</span><span class="p">,</span> <span class="s1">&#39;target_name&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_id&#39;</span><span class="p">,</span> <span class="s1">&#39;s_ra&#39;</span><span class="p">,</span> <span class="s1">&#39;s_dec&#39;</span><span class="p">,</span> <span class="s1">&#39;t_exptime&#39;</span><span class="p">,</span> <span class="s1">&#39;proposal_id&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
<p><a id='obsid'></a></p>
</section>
<section id="search-with-observation-id">
<h3>Search with Observation ID<a class="headerlink" href="#search-with-observation-id" title="Permalink to this heading">#</a></h3>
<p>The observation ID (obs_id) allows for flexibility of searching by the proposal ID and the observation ID because of how the JWST filenames are structured. More information about the JWST file naming conventions can be found at: https://jwst-pipeline.readthedocs.io/en/latest/jwst/data_products/file_naming.html. For the purposes of this notebook series, we will use only one of the two observations (004) in program 2079.</p>
<p>Additionally, there is flexibility using wildcards inside of the search criteria. For example, instead of specifying both “NIRISS/IMAGE” and “NIRISS/WFSS”, we can specify “NIRISS*”, which picks up both file modes. The wildcard also works within the obs_id, so we do not have to list all of the different IDs.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Obtain a list to download from a specific list of observation IDs instead</span>
<span class="n">obs_id_table</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">query_criteria</span><span class="p">(</span><span class="n">instrument_name</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;NIRISS*&quot;</span><span class="p">],</span>
                                           <span class="n">provenance_name</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;CALJWST&quot;</span><span class="p">],</span> <span class="c1"># Executed observations</span>
                                           <span class="n">obs_id</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;jw02079-o004*&#39;</span><span class="p">],</span> <span class="c1"># Searching for PID 2079 observation 004</span>
                                           <span class="p">)</span> 

<span class="c1"># this number will change with JWST pipeline and reference file updates</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_id_table</span><span class="p">),</span> <span class="s1">&#39;files found&#39;</span><span class="p">)</span> <span class="c1"># ~613 files</span>
</pre></div>
</div>
</div>
</div>
<p><a id='filter'></a></p>
</section>
</section>
<section id="filter-and-download-products">
<h2>Filter and Download Products<a class="headerlink" href="#filter-and-download-products" title="Permalink to this heading">#</a></h2>
<p>If there are too many files to download, the API will time out. Instead, it is better to divide the observations in batches to download one at a time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">batch_size</span> <span class="o">=</span> <span class="mi">5</span> <span class="c1"># 5 files at a time maximizes the download speed.</span>

<span class="c1"># Let&#39;s split up our list of files, ``obs_id_table``, into batches according to our batch size.</span>
<span class="n">obs_batches</span> <span class="o">=</span> <span class="p">[</span><span class="n">obs_id_table</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_id_table</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">)]</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;How many batches?&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">obs_batches</span><span class="p">))</span>

<span class="n">single_group</span> <span class="o">=</span> <span class="n">obs_batches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Useful to inspect the files obtained from one group</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Inspect the first batch to ensure that it matches expectations of what you want downloaded:&quot;</span><span class="p">)</span> 
<span class="n">single_group</span><span class="p">[</span><span class="s1">&#39;obs_collection&#39;</span><span class="p">,</span> <span class="s1">&#39;instrument_name&#39;</span><span class="p">,</span> <span class="s1">&#39;filters&#39;</span><span class="p">,</span> <span class="s1">&#39;target_name&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_id&#39;</span><span class="p">,</span> <span class="s1">&#39;s_ra&#39;</span><span class="p">,</span> <span class="s1">&#39;s_dec&#39;</span><span class="p">,</span> <span class="s1">&#39;t_exptime&#39;</span><span class="p">,</span> <span class="s1">&#39;proposal_id&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Select the type of products needed. The various levels are:</p>
<ul class="simple">
<li><p>uncalibrated files</p>
<ul>
<li><p>productType=[“SCIENCE”]</p></li>
<li><p>productSubGroupDescription=[‘UNCAL’]</p></li>
<li><p>calib_level=[1]</p></li>
</ul>
</li>
<li><p>rate images</p>
<ul>
<li><p>productType=[“SCIENCE”]</p></li>
<li><p>productSubGroupDescription=[‘RATE’]</p></li>
<li><p>calib_level=[2]</p></li>
</ul>
</li>
<li><p>level 2 associations for both spectroscopy and imaging</p>
<ul>
<li><p>productType=[“INFO”]</p></li>
<li><p>productSubGroupDescription=[‘ASN’]</p></li>
<li><p>calib_level=[2]</p></li>
</ul>
</li>
<li><p>level 3 associations for imaging</p>
<ul>
<li><p>productType=[“INFO”]</p></li>
<li><p>productSubGroupDescription=[‘ASN’]</p></li>
<li><p>dataproduct_type=[“image”]</p></li>
<li><p>calib_level=[3]</p></li>
</ul>
</li>
</ul>
<p><a id='filter_data'></a></p>
<section id="filtering-data-before-downloading">
<h3>Filtering Data Before Downloading<a class="headerlink" href="#filtering-data-before-downloading" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># creating a dictionary of the above information to use for inspection of the filtering function</span>
<span class="n">file_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;uncal&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;product_type&#39;</span><span class="p">:</span> <span class="s1">&#39;SCIENCE&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;productSubGroupDescription&#39;</span><span class="p">:</span> <span class="s1">&#39;UNCAL&#39;</span><span class="p">,</span>
                       <span class="s1">&#39;calib_level&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">]},</span>
             <span class="s1">&#39;rate&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;product_type&#39;</span><span class="p">:</span> <span class="s1">&#39;SCIENCE&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;productSubGroupDescription&#39;</span><span class="p">:</span> <span class="s1">&#39;RATE&#39;</span><span class="p">,</span>
                      <span class="s1">&#39;calib_level&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">]},</span>
             <span class="s1">&#39;level2_association&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;product_type&#39;</span><span class="p">:</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;productSubGroupDescription&#39;</span><span class="p">:</span> <span class="s1">&#39;ASN&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;calib_level&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">]},</span>
             <span class="s1">&#39;level3_association&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;product_type&#39;</span><span class="p">:</span> <span class="s1">&#39;INFO&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;productSubGroupDescription&#39;</span><span class="p">:</span> <span class="s1">&#39;ASN&#39;</span><span class="p">,</span>
                                    <span class="s1">&#39;calib_level&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">]},</span>
             <span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Look at the files existing for each of these different levels</span>
<span class="n">files_to_download</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">batch_exposure</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">single_group</span><span class="p">):</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Exposure #</span><span class="si">{</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">batch_exposure</span><span class="p">[</span><span class="s1">&#39;obs_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="c1"># pull out the product names from the list to filter</span>
    <span class="n">products</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">batch_exposure</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">filetype</span><span class="p">,</span> <span class="n">query_dict</span> <span class="ow">in</span> <span class="n">file_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;File type:&#39;</span><span class="p">,</span> <span class="n">filetype</span><span class="p">)</span>
        <span class="n">filtered_products</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span><span class="n">products</span><span class="p">,</span>
                                                         <span class="n">productType</span><span class="o">=</span><span class="n">query_dict</span><span class="p">[</span><span class="s1">&#39;product_type&#39;</span><span class="p">],</span>
                                                         <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="n">query_dict</span><span class="p">[</span><span class="s1">&#39;productSubGroupDescription&#39;</span><span class="p">],</span>
                                                         <span class="n">calib_level</span><span class="o">=</span><span class="n">query_dict</span><span class="p">[</span><span class="s1">&#39;calib_level&#39;</span><span class="p">],</span>
                                                         <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">filtered_products</span><span class="p">[</span><span class="s1">&#39;productFilename&#39;</span><span class="p">])</span>
        <span class="n">files_to_download</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">filtered_products</span><span class="p">[</span><span class="s1">&#39;productFilename&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="o">*</span><span class="mi">50</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>From above, we can see that for each exposure name in the observation list (<code class="docutils literal notranslate"><span class="pre">obs_id_table</span></code>), there are many associated files in the background that need to be downloaded as well. This is why we need to work in batches to download.</p>
<p><a id='downloading'></a></p>
</section>
<section id="downloading-data">
<h3>Downloading Data<a class="headerlink" href="#downloading-data" title="Permalink to this heading">#</a></h3>
<p>To actually download the products, provide <code class="docutils literal notranslate"><span class="pre">Observations.download_products()</span></code> with a list of the filtered products.</p>
<p>Typically, adjustments aren’t needed to the <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/jwst/pipeline/calwebb_detector1.html">detector1 pipeline</a>, so we can start with the outputs from detector1, the rate files, rather than the uncal files. Because of this, we only need to download the rate and association files. If you need to rerun the detector1 pipeline, <code class="docutils literal notranslate"><span class="pre">productSubGroupDescription</span></code> and <code class="docutils literal notranslate"><span class="pre">calib_level</span></code> will need to be adjusted in the <code class="docutils literal notranslate"><span class="pre">Observations.filter_products</span></code> call to download the uncal files instead.</p>
<p>If the data are proprietary, you may also need to set up your API token. <strong>NEVER</strong> commit your token to a public repository. An alternative is to create a separate configuration file (config_file.yaml) that is readable only to you and has a key: ‘mast_token’ : <em>API token</em></p>
<p>To make create a new API token visit to following link:
https://auth.mast.stsci.edu/token?suggested_name=Astroquery&amp;suggested_scope=mast:exclusive_access</p>
<p><em>Note that a version of astroquery &gt;= 0.4.7 is required to have the call <code class="docutils literal notranslate"><span class="pre">flat=True</span></code> when downloading the data. If you prefer to use an earlier version, remove that line from the call, download the data, and move all of the files in all downloaded subfolders into the single directory as defined by the <code class="docutils literal notranslate"><span class="pre">download_dir</span></code> variable.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check that the version is above 0.4.7. See above note for more information</span>
<span class="kn">import</span> <span class="nn">astroquery</span>
<span class="n">astroquery</span><span class="o">.</span><span class="n">__version__</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download_dir</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>

<span class="c1"># make sure the download directory exists; if not, write a new directory</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">download_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">download_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Now let&#39;s get the products for each batch of observations, and filter down to only the products of interest.</span>
<span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">batch</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">obs_batches</span><span class="p">):</span>
    
    <span class="c1"># Progress indicator...</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="sa">f</span><span class="s1">&#39;Batch #</span><span class="si">{</span><span class="n">index</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1"> / </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">obs_batches</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    
    <span class="c1"># Make a list of the `obsid` identifiers from our Astropy table of observations to get products for.</span>
    <span class="n">obsids</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;obsid&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Working with the following obsids:&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">number</span><span class="p">,</span> <span class="n">obs_text</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">obsids</span><span class="p">,</span> <span class="n">batch</span><span class="p">[</span><span class="s1">&#39;obs_id&#39;</span><span class="p">]):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">number</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">obs_text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="c1"># Get list of products </span>
    <span class="n">products</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">get_product_list</span><span class="p">(</span><span class="n">obsids</span><span class="p">)</span>
    
    <span class="c1"># Filter the products to only get only the products of interest</span>
    <span class="n">filtered_products</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">filter_products</span><span class="p">(</span><span class="n">products</span><span class="p">,</span> 
                                                     <span class="n">productType</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;SCIENCE&quot;</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">],</span>
                                                     <span class="n">productSubGroupDescription</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RATE&quot;</span><span class="p">,</span> <span class="s2">&quot;ASN&quot;</span><span class="p">],</span> <span class="c1"># Not using &quot;UNCAL&quot; here since we can start with the rate files</span>
                                                     <span class="n">calib_level</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="c1"># not using 1 here since not getting the UNCAL files</span>
                                                     <span class="p">)</span>
    
    <span class="c1"># Download products for these records.</span>
    <span class="c1"># The `flat=True` option stores all files in a single directory specified by `download_dir`.</span>
    <span class="n">manifest</span> <span class="o">=</span> <span class="n">Observations</span><span class="o">.</span><span class="n">download_products</span><span class="p">(</span><span class="n">filtered_products</span><span class="p">,</span>
                                              <span class="n">download_dir</span><span class="o">=</span><span class="n">download_dir</span><span class="p">,</span>
                                              <span class="n">flat</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># astroquery v0.4.7 or later only</span>
                                              <span class="p">)</span> 
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Products downloaded:</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">filtered_products</span><span class="p">[</span><span class="s1">&#39;productFilename&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>If continuing on with the WFSS notebooks, let’s double check that we’ve downloaded all of the files that we need for the remaining notebooks. There should be 149 files downloaded.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">downloaded_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="s1">&#39;*.fits&#39;</span><span class="p">))</span> <span class="o">+</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="s1">&#39;*.json&#39;</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">downloaded_files</span><span class="p">),</span> <span class="s1">&#39;files downloaded to:&#39;</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><a id='inspect'></a></p>
</section>
</section>
<section id="inspect-downloaded-data">
<h2>Inspect Downloaded Data<a class="headerlink" href="#inspect-downloaded-data" title="Permalink to this heading">#</a></h2>
<p>The purpose of this function is to have a better idea of what data are available to you. Additionally, you will be able to use this dataframe to select specific files that match the mode you would like to take a closer look at.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratefile_datadir</span> <span class="o">=</span> <span class="s1">&#39;data/&#39;</span>

<span class="c1"># first look for all of the rate files you have downloaded</span>
<span class="n">rate_files</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ratefile_datadir</span><span class="p">,</span> <span class="s2">&quot;*rate.fits&quot;</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">file_num</span><span class="p">,</span> <span class="n">ratefile</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rate_files</span><span class="p">):</span>

    <span class="n">rate_hdr</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">getheader</span><span class="p">(</span><span class="n">ratefile</span><span class="p">)</span> <span class="c1"># Primary header for each rate file</span>

    <span class="c1"># information we want to store that might be useful to us later for evaluating the data</span>
    <span class="n">temp_hdr_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;FILENAME&quot;</span><span class="p">:</span> <span class="n">ratefile</span><span class="p">,</span>
                     <span class="s2">&quot;TARG_RA&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rate_hdr</span><span class="p">[</span><span class="s2">&quot;TARG_RA&quot;</span><span class="p">]],</span>
                     <span class="s2">&quot;TARG_DEC&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rate_hdr</span><span class="p">[</span><span class="s2">&quot;TARG_DEC&quot;</span><span class="p">]],</span>
                     <span class="s2">&quot;FILTER&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rate_hdr</span><span class="p">[</span><span class="s2">&quot;FILTER&quot;</span><span class="p">]],</span> <span class="c1"># Grism; GR150R/GR150C</span>
                     <span class="s2">&quot;PUPIL&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rate_hdr</span><span class="p">[</span><span class="s2">&quot;PUPIL&quot;</span><span class="p">]],</span> <span class="c1"># Filter used; F090W, F115W, F140M, F150W F158M, F200W</span>
                     <span class="s2">&quot;EXPSTART&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rate_hdr</span><span class="p">[</span><span class="s1">&#39;EXPSTART&#39;</span><span class="p">]],</span> <span class="c1"># Exposure start time (MJD)</span>
                     <span class="s2">&quot;PATT_NUM&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rate_hdr</span><span class="p">[</span><span class="s2">&quot;PATT_NUM&quot;</span><span class="p">]],</span> <span class="c1"># Position number within dither pattern for WFSS</span>
                     <span class="s2">&quot;NUMDTHPT&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rate_hdr</span><span class="p">[</span><span class="s2">&quot;NUMDTHPT&quot;</span><span class="p">]],</span> <span class="c1"># Total number of points in entire dither pattern</span>
                     <span class="s2">&quot;XOFFSET&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rate_hdr</span><span class="p">[</span><span class="s2">&quot;XOFFSET&quot;</span><span class="p">]],</span> <span class="c1"># X offset from pattern starting position for NIRISS (arcsec)</span>
                     <span class="s2">&quot;YOFFSET&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">rate_hdr</span><span class="p">[</span><span class="s2">&quot;YOFFSET&quot;</span><span class="p">]],</span> <span class="c1"># Y offset from pattern starting position for NIRISS (arcsec)</span>
                     <span class="p">}</span>

    <span class="c1"># Turn the dictionary into a pandas dataframe</span>
    <span class="k">if</span> <span class="n">file_num</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># if this is the first file, make an initial dataframe</span>
        <span class="n">rate_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">temp_hdr_dict</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># otherwise, append to the dataframe for each file</span>
        <span class="n">new_data_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">temp_hdr_dict</span><span class="p">)</span>

        <span class="c1"># merge the two dataframes together to create a dataframe with all </span>
        <span class="n">rate_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">rate_df</span><span class="p">,</span> <span class="n">new_data_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">rate_dfsort</span> <span class="o">=</span> <span class="n">rate_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;EXPSTART&#39;</span><span class="p">,</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Save the dataframe to a file to read in later, if desired</span>
<span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;./list_ngdeep_rate.csv&#39;</span>
<span class="n">rate_dfsort</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s1">&#39;,&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Saved:&#39;</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

<span class="c1"># Look at the resulting dataframe</span>
<span class="n">rate_dfsort</span>
</pre></div>
</div>
</div>
</div>
<p>In particular, let’s look at the observation sequence these rate files follow. We have sorted the files above by exposure time, so they should already be in time order in the dataframe.</p>
<p><code class="docutils literal notranslate"><span class="pre">FILTER</span> <span class="pre">=</span> <span class="pre">CLEAR</span></code> indicates a direct image while <code class="docutils literal notranslate"><span class="pre">FILTER=GR150R</span></code> or <code class="docutils literal notranslate"><span class="pre">FILTER=GR150C</span></code> indicates a dispersed image. PUPIL is the blocking filter used. The first 14 exposures make up the first sequence set of direct image -&gt; grism -&gt; direct image -&gt; grism. There are also multiple dither positions for the dispersed images and the direct images. The multiple direct image dithers will be combined in image3, while the multiple dispersed images can be combined in spec3.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rate_df</span><span class="p">[[</span><span class="s1">&#39;EXPSTART&#39;</span><span class="p">,</span> <span class="s1">&#39;FILTER&#39;</span><span class="p">,</span> <span class="s1">&#39;PUPIL&#39;</span><span class="p">,</span> <span class="s1">&#39;PATT_NUM&#39;</span><span class="p">,</span> <span class="s1">&#39;XOFFSET&#39;</span><span class="p">,</span> <span class="s1">&#39;YOFFSET&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Shown below are the first 14 rate files to give an idea of the above sequence visually. Grid lines are shown as a visual guide for any dithers that are made.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot set up</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">35</span><span class="p">))</span>
<span class="n">cols</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="mi">14</span> <span class="o">/</span> <span class="n">cols</span><span class="p">))</span>

<span class="c1"># loop over the first 14 rate files and plot them</span>
<span class="k">for</span> <span class="n">plt_num</span><span class="p">,</span> <span class="n">rf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rate_dfsort</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">14</span><span class="p">][</span><span class="s1">&#39;FILENAME&#39;</span><span class="p">]):</span>

    <span class="c1"># determine where the subplot should be</span>
    <span class="n">xpos</span> <span class="o">=</span> <span class="p">(</span><span class="n">plt_num</span> <span class="o">%</span> <span class="mi">40</span><span class="p">)</span> <span class="o">%</span> <span class="n">cols</span>
    <span class="n">ypos</span> <span class="o">=</span> <span class="p">((</span><span class="n">plt_num</span> <span class="o">%</span> <span class="mi">40</span><span class="p">)</span> <span class="o">//</span> <span class="n">cols</span><span class="p">)</span> <span class="c1"># // to make it an int.</span>

    <span class="c1"># make the subplot</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplot2grid</span><span class="p">((</span><span class="n">rows</span><span class="p">,</span> <span class="n">cols</span><span class="p">),</span> <span class="p">(</span><span class="n">ypos</span><span class="p">,</span> <span class="n">xpos</span><span class="p">))</span>

    <span class="c1"># open the data and plot it</span>
    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">rf</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdu</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
        <span class="n">data</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># filling in nan data with 0s to help with the matplotlib color scale.</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">1.5</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">)</span>

        <span class="c1"># adding in grid lines as a visual aid</span>
        <span class="k">for</span> <span class="n">gridline</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">1500</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">gridline</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">gridline</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;#</span><span class="si">{</span><span class="n">plt_num</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">hdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;FILTER&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">hdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;PUPIL&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> Dither</span><span class="si">{</span><span class="n">hdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">&#39;PATT_NUM&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<a class="reference internal image-reference" href="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png"><img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></a>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/jdat_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/NIRISS/NIRISS_WFSS_advanced"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../niriss_imaging/niriss-imaging-tutorial.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Advanced: NIRISS Imaging Tutorial Notebook</p>
      </div>
    </a>
    <a class="right-next"
       href="01_niriss_wfss_image2_image3.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Run Image Pipeline and Create Source Catalog</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#imports">Imports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#querying-for-observations">Querying for Observations</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search-with-proposal-id">Search with Proposal ID</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#search-with-observation-id">Search with Observation ID</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#filter-and-download-products">Filter and Download Products</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#filtering-data-before-downloading">Filtering Data Before Downloading</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#downloading-data">Downloading Data</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#inspect-downloaded-data">Inspect Downloaded Data</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>