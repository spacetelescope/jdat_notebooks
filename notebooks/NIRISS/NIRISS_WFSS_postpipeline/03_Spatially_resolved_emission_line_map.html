
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>WFSS Spectra Part 3: Emission Line Map &#8212; STScI JDAT Notebooks</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=9c3e77be" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link rel="stylesheet" type="text/css" href="../../../_static/main.css?v=b44a18d9" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=1ae7504c"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-D46G4HKJY3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-D46G4HKJY3');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/NIRISS/NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map';</script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Download Wide Field Slittless Spectroscopy (WFSS) Data" href="../NIRISS_WFSS_advanced/00_niriss_mast_query_data_setup.html" />
    <link rel="prev" title="WFSS Spectra - Part 2: Cross Correlation to Determine Redshift" href="02_Cross_correlation_template.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/stsci_logo2.png" class="logo__image only-light" alt="STScI JDAT Notebooks - Home"/>
    <script>document.write(`<img src="../../../_static/stsci_logo2.png" class="logo__image only-dark" alt="STScI JDAT Notebooks - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">General</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebook_development_workflow.html">Notebook Development Workflow</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Development</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/submitting_notebooks.html">Submitting Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/requirements.html">Requirements file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/notebooks.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/data_files.html">Data Files</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">GitHub Guidelines</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_setup.html">GitHub Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_workflow.html">GitHub Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../docs/github_pr.html">GitHub PR</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">JDAViz Demo Notebooks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../jdaviz_demo/notebooks/Cubeviz.html">Cubeviz with NIRSpec data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jdaviz_demo/notebooks/Imviz.html">Jdaviz Imviz Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jdaviz_demo/notebooks/Specviz_Specviz2d.html">Specviz and Specviz2D Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../jdaviz_demo/notebooks/specreduce_extraction.html">Specreduce Demo</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Cross-Instrument</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/asdf_example/asdf_example.html">ASDF Example</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/background_estimation_imaging/Imaging_Sky_Background_Estimation.html">Complex 2D Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/composite_model_fitting/specfit_demo_3.html">Composite Model Spectral Fitting</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/rgb_imviz/imviz_rgb_carina.html">RGB images with Imviz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">Specviz Simple Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/update_pure_parallel_wcs/NIRISS_correct_pure_parallel_WCS.html">Improving Accuracy of WCS of Pure Parallel Dataset</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/photometry_extragalactic/imviz.html">Photometry with JWST - Imviz</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/photometry_extragalactic/photutils_example.html">Photometry of a JWST/NIRCam extragalactic field with Photutils</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../cross_instrument/stpsf_examples/stpsf_examples.html">JWST PSFs Using Wavefronts Measured On Orbit</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">MIRI</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">MRS Mstar - Data Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">IFU of YSOs in LMC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/MIRI_LRS_spectral_extraction/miri_lrs_advanced_extraction.html">LRS Optimal Spectral Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/psf_photometry/miri_1028.html">MIRI PSF Photometry With Space_Phot</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../MIRI/psf_photometry/miri_1028_photutils.html">MIRI PSF Photometry with Photutils</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../MIRI/psf_photometry/miri_photutils.html">MIRI PSF Photometry with Photutils</a></li>





<li class="toctree-l1"><a class="reference internal" href="../../MIRI/psf_photometry/miri_spacephot.html">MIRI PSF Photometry With Space_Phot</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRCam</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/aperture_photometry/NIRCam_Aperture_Photometry_Example.html">Point Source Aperture Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_photometry/NIRCam_multiband_photometry.html">Extended Aperture Photometry</a></li>


<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">Cross-Filter PSF Matching</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/psf_photometry/NIRCam_PSF_Photometry_Example.html">PSF Photometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_wisp_subtraction/nircam_wisp_subtraction.html">NIRCam Wisp Removal</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_claw_detection/nircam_claw_detection.html">NIRCam Claw Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_WFSS_Box_extraction/BoxExtraction_using_Grismconf_CRDS.html">WFSS Box Extraction Example</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/NIRCam_WFSS_simulating_spectra/Simulating_WFSS_spectra_CRDS.html">WFSS Spectra Simulation for Contamination Correction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/psf_photometry_basics/psf_photometry_basics.html">PSF Photometry Basics with Photutils</a></li>









<li class="toctree-l1"><a class="reference internal" href="../../NIRCam/psf_photometry_with_space_phot/nircam_spacephot.html">NIRCam PSF Photometry With Space_Phot</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRISS</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="00_Optimal_extraction.html">WFSS Spectra - Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="01_Combine_and_normalize_1D_spectra.html">WFSS Spectra - Combine and Normalize 1D Spectra</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_Cross_correlation_template.html">WFSS Spectra - Cross-Correlation Template</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">WFSS Spectra - Emission Line Map</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NIRISS_WFSS_advanced/00_niriss_mast_query_data_setup.html">NIRISS MAST</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NIRISS_WFSS_advanced/01_niriss_wfss_image2_image3.html">Direct imaging for WFSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NIRISS_WFSS_advanced/02_niriss_wfss_spec2.html">Spec2 pipeline for WFSS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../NIRISS_WFSS_advanced/extra_niriss_individual_steps.html">Running Individual Pipline Steps</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NIRSpec</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html">IFU Cube Fitting</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/cube_fitting/cube_fitting.html">IFU Cube Modeling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/ifu_optimal/ifu_optimal.html">IFU Optimal Spectral Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/optimal_extraction/Spectral_Extraction-static.html">MOS Optimal Extraction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/mos_spectroscopy_advanced/MOSspec_advanced.html">MOS Spectroscopy of Extragalactic Field</a></li>

<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/mos_master_background/Master_Background_MOS_Demo.html">Master Background Subtraction for Multi-Object Spectroscopy (MOS)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/msa_metafile/NIRSpec_MOS_MSA_metafile.html">NIRSpec MOS MSA Metafile</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/mos_slits_to_sky/NIRSpec_MOS_slits_to_sky.html">NIRSpec MOS Slits to Sky</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">BOTS Time Series Observations</a></li>








<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/galaxy_redshift/redshift_fitting.html">Redshift and Template Fitting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/FS_NSClean_example.html">FS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/IFU_NSClean_example.html">IFU Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/MOS_NSClean_example.html">MOS Products with NSClean</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../NIRSpec/NIRSpec_NSClean/BOTS_NSClean_example.html">BOTS Products with NSClean</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/spacetelescope/jdat_notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/NIRISS/NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/NIRISS/NIRISS_WFSS_postpipeline/03_Spatially_resolved_emission_line_map.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>WFSS Spectra Part 3: Emission Line Map</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-notebook-01-products">0. Download notebook 01 products</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-halpha-emission-line-map">1.Get Halpha emission line map;</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subtract-continuum-at-each-y-position">Subtract continuum at each y-position:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-halpha-emission-from-a-continuum-subtracted-spectrum">Extract Halpha emission from a continuum-subtracted spectrum;</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-hbeta-and-oiii-maps">2.Get Hbeta and OIII maps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-the-plot-above-you-can-see-oiii-doublet-and-hbeta">In the plot above, you can see Oiii doublet, and Hbeta.</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-get-continuum">2a. Get continuum;</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#b-fit-emissionn-with-multi-conponent-gaussian">2b. Fit emissionn, with multi-conponent gaussian;</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-to-the-central-array-looks-good-repeat-this-along-y-axis-and-get-emission-line-maps-as-a-same-way-as-for-halpha">Fit to the central array looks good. Repeat this along y-axis and get emission line maps, as a same way as for Halpha</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary;</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="wfss-spectra-part-3-emission-line-map">
<h1>WFSS Spectra Part 3: Emission Line Map<a class="headerlink" href="#wfss-spectra-part-3-emission-line-map" title="Link to this heading">#</a></h1>
<p><strong>Use case:</strong> optimal extraction of grism spectra; redshift measurement; emission-line maps.  Simplified version of <a class="reference external" href="https://jwst-docs.stsci.edu/near-infrared-imager-and-slitless-spectrograph/niriss-example-science-programs/niriss-wfss-with-nircam-parallel-imaging-of-galaxies-in-lensing-clusters">JDox Science Use Case # 33</a>.<br>
<strong>Data:</strong> JWST simulated NIRISS images from <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-other-tools/mirage-data-simulator">MIRAGE</a>, run through the <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/">JWST calibration pipeline</a>; galaxy cluster.<br>
<strong>Tools:</strong>  specutils, astropy, pandas, emcee, lmfit, corner, h5py.<br>
<strong>Cross-intrument:</strong> NIRSpec <br>
<strong>Documentation:</strong> This notebook is part of a STScI’s larger <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-post-pipeline-data-analysis">post-pipeline Data Analysis Tools Ecosystem</a>.<br></p>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>This notebook is 4 of 4 in a set focusing on NIRISS WFSS data:
1. 1D optimal extraction since the JWST pipeline only provides a box extraction.  Optimal extraction improves S/N of spectra for faint sources.
2. Combine and normalize 1D spectra.
3. Cross correlate galaxy with template to get redshift.
4. Spatially resolved emission line map.</p>
<p>This notebook obtains an emission line map from the 2D-cutout of NIRISS WFSS spectra. This notebook will require the 2D-cutout of NIRISS WFSS spectrum (e.g., l3_nis_f150w_G150C_s00004_cal.fits; Pipeline spec3 product).</p>
<p><strong>Note:</strong> For this example, the notebook uses only a 2D rectified spectra at one dither position, directly obtained from the current versionn of the  pipeline (Build 7.5), but one could start with spectra stacked with all dither positions too, to improve S/Ns.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fits</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">astropy.units</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">u</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.modeling</span><span class="w"> </span><span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">astropy.modeling.polynomial</span><span class="w"> </span><span class="kn">import</span> <span class="n">Chebyshev1D</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">specutils</span><span class="w"> </span><span class="kn">import</span> <span class="n">Spectrum</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">specutils.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="n">fit_lines</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">specutils.fitting</span><span class="w"> </span><span class="kn">import</span> <span class="n">continuum</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">astropy</span><span class="w"> </span><span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">astropy_version</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;astropy&#39;</span><span class="p">,</span> <span class="n">astropy_version</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>astropy 7.2.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">mpl</span>

<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;savefig.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span>
<span class="n">mpl</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">80</span>
</pre></div>
</div>
</div>
</div>
<section id="download-notebook-01-products">
<h3>0. Download notebook 01 products<a class="headerlink" href="#download-notebook-01-products" title="Link to this heading">#</a></h3>
<p>These can be also obtained by running the notebooks.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./output&#39;</span><span class="p">):</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">urllib.request</span>
    <span class="n">boxlink</span> <span class="o">=</span> <span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/NIRISS_lensing_cluster/output.zip&#39;</span>
    <span class="n">boxfile</span> <span class="o">=</span> <span class="s1">&#39;./output.zip&#39;</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">boxlink</span><span class="p">,</span> <span class="n">boxfile</span><span class="p">)</span>
    <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">boxfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">list_names</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_names</span><span class="p">:</span>
        <span class="n">zf</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">member</span><span class="o">=</span><span class="n">item</span><span class="p">)</span> <span class="c1"># Using extract instead of extractall because it is safer when files have absolute (/) or relative (..) pathselse:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Already exists&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Download files, if not exists yet.</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;./pipeline_products&#39;</span><span class="p">):</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">zipfile</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">urllib.request</span>
    <span class="n">boxlink</span> <span class="o">=</span> <span class="s1">&#39;https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/NIRISS_lensing_cluster/pipeline_products.zip&#39;</span>
    <span class="n">boxfile</span> <span class="o">=</span> <span class="s1">&#39;./pipeline_products.zip&#39;</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">boxlink</span><span class="p">,</span> <span class="n">boxfile</span><span class="p">)</span>
    <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">boxfile</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">list_names</span> <span class="o">=</span> <span class="n">zf</span><span class="o">.</span><span class="n">namelist</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">list_names</span><span class="p">:</span>
        <span class="n">zf</span><span class="o">.</span><span class="n">extract</span><span class="p">(</span><span class="n">member</span><span class="o">=</span><span class="n">item</span><span class="p">)</span> <span class="c1"># Using extract instead of extractall because it is safer when files have absolute (/) or relative (..) paths</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Which target?</span>
<span class="n">DIR_OUT</span> <span class="o">=</span> <span class="s1">&#39;./output/&#39;</span>
<span class="n">filt</span> <span class="o">=</span> <span class="s1">&#39;f200w&#39;</span>

<span class="n">grism</span> <span class="o">=</span> <span class="s1">&#39;G150C&#39;</span>
<span class="c1"># grism = &#39;G150R&#39;</span>

<span class="nb">id</span> <span class="o">=</span> <span class="s1">&#39;00004&#39;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="get-halpha-emission-line-map">
<h3>1.Get Halpha emission line map;<a class="headerlink" href="#get-halpha-emission-line-map" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Open two-dimensional file;</span>
<span class="c1"># can be downloaded in No.01a.</span>
<span class="n">DIR_DATA</span> <span class="o">=</span> <span class="s1">&#39;./pipeline_products/&#39;</span>

<span class="c1"># Zero-indexed number for dither --- the test data has two dither positions.</span>
<span class="n">ndither</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># File</span>
<span class="n">file_2d</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DIR_DATA</span><span class="si">}</span><span class="s1">l3_nis_</span><span class="si">{</span><span class="n">filt</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">grism</span><span class="si">}</span><span class="s1">_s</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1">_cal.fits&#39;</span>
<span class="n">hdu_2d</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_2d</span><span class="p">)</span>

<span class="c1"># Align grism direction</span>
<span class="c1">#   - x-direction = Dispersion (wavelength) direction.</span>
<span class="c1">#   - y-direction = Cross-dispersion.</span>
<span class="c1"># in this notebook.</span>
    
<span class="k">if</span> <span class="n">grism</span> <span class="o">==</span> <span class="s1">&#39;G150C&#39;</span><span class="p">:</span>
    <span class="c1"># If spectrum is horizontal;</span>
    <span class="n">data_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">err_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">wave_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">data_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">dq_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">err_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">wave_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,</span> <span class="p">:])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f957fce5310&gt;
</pre></div>
</div>
<img alt="../../../_images/dcd5fbdecbbe4f018e00e31a9ca1622ea425a27113272f513902453f293828f6.png" src="../../../_images/dcd5fbdecbbe4f018e00e31a9ca1622ea425a27113272f513902453f293828f6.png" />
</div>
</div>
</section>
<section id="subtract-continuum-at-each-y-position">
<h3>Subtract continuum at each y-position:<a class="headerlink" href="#subtract-continuum-at-each-y-position" title="Link to this heading">#</a></h3>
<p>There are two options, depending on the brightness of the source;</p>
<ul class="simple">
<li><p>1.Subtract continuum estimated at each position of cross-dispersion column. This works for a bright source.</p></li>
<li><p>2.Subtract a single continuum (“master continuum”), assuming the shape is same across cross-dispersion direction as the one from a 1d extraction. This is required for a faint source.</p></li>
</ul>
<p>Since we clearly see continuum across the source, here we demonstrate the option 1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># At which y position do we want to see spectrum?</span>
<span class="c1"># as an example;</span>
<span class="n">yy</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">spec_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span>

<span class="n">mask_line</span> <span class="o">=</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mf">1.75</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="mf">1.97</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mf">2.08</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="mf">2.23</span><span class="p">))</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">data_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">)</span>
<span class="n">cont</span> <span class="o">=</span> <span class="n">continuum</span><span class="o">.</span><span class="n">fit_generic_continuum</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">Chebyshev1D</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:],</span> <span class="n">data_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Observed at y=</span><span class="si">{</span><span class="n">yy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">cont</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fitted continuum&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.6</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>WARNING: Model is linear in parameters; consider using linear fitting methods. [astropy.modeling.fitting]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1.6, 2.3)
</pre></div>
</div>
<img alt="../../../_images/4dd2853a2bd496718966f5b0f1dba03236e323f34d9dd589da679510b6d30d16.png" src="../../../_images/4dd2853a2bd496718966f5b0f1dba03236e323f34d9dd589da679510b6d30d16.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cont</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([250.33499768, 251.34182402, 252.33980903, 253.3135893 ,
       254.24965781, 255.13652408, 255.9644126 , 256.72501844,
       257.41163677, 258.01890013, 258.54258648, 258.97972128,
       259.32826045, 259.58715883, 259.75619391, 259.83587056,
       259.82739234, 259.73253807, 259.55362517, 259.29340801,
       258.95501602, 258.54195979, 258.05794767, 257.50700316,
       256.89324957, 256.22092927, 255.49447909, 254.71828794,
       253.89675444, 253.03439292, 252.13555562, 251.20452225,
       227.29355851, 226.56783289, 225.86937019, 225.19823182,
       224.55436882, 223.93755788, 223.34749755, 222.78373709,
       222.24570644, 221.73264882, 221.24370143, 220.77783704,
       220.33381891, 219.91026154, 219.50556055, 219.1178987 ,
       218.7451829 , 218.38508016, 218.03495809, 217.69182801,
       217.35236713, 217.01284391, 216.6690942 , 216.31644487,
       215.94971597, 215.56314632, 215.15030605, 214.70409375,
       214.216638  , 213.67925039, 213.08229613, 212.41519952,
       211.666311  , 210.82284996, 209.87072971, 208.79458636,
       207.5776262 , 206.20141056, 204.64592713, 202.88935068,
       200.90800238, 198.67600811, 196.16546518, 193.3461791 ,
       190.1852653 , 186.64742294, 182.6944949 ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Repeat this along y-axis;</span>
<span class="n">flux_cont2d</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">*</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])):</span>

    <span class="n">mask_line</span> <span class="o">=</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mf">1.75</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="mf">1.97</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mf">2.08</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="mf">2.23</span><span class="p">))</span>

    <span class="n">obs</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">data_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">)</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="n">continuum</span><span class="o">.</span><span class="n">fit_generic_continuum</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">Chebyshev1D</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>

    <span class="n">flux_cont2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">cont</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">flux_cont2d</span><span class="p">[:,</span> <span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Fitted continuum&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Fitted continuum&#39;)
</pre></div>
</div>
<img alt="../../../_images/7079ea8a2971dc1cc5f68f180c3bfe198481a96b67a58caaa4e96002560000e6.png" src="../../../_images/7079ea8a2971dc1cc5f68f180c3bfe198481a96b67a58caaa4e96002560000e6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">flux_cont2d</span><span class="p">[:,</span> <span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Continuum subtracted spectrum&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Continuum subtracted spectrum&#39;)
</pre></div>
</div>
<img alt="../../../_images/d0251a50fe8effad5531b1620747723d09d290bbd0ffd707d99662009d49a6a3.png" src="../../../_images/d0251a50fe8effad5531b1620747723d09d290bbd0ffd707d99662009d49a6a3.png" />
</div>
</div>
</section>
<section id="extract-halpha-emission-from-a-continuum-subtracted-spectrum">
<h3>Extract Halpha emission from a continuum-subtracted spectrum;<a class="headerlink" href="#extract-halpha-emission-from-a-continuum-subtracted-spectrum" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cutout Ha line map;</span>
<span class="n">rsq</span> <span class="o">=</span> <span class="n">data_2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cut_ha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rsq</span><span class="p">,</span> <span class="n">rsq</span><span class="p">),</span> <span class="s1">&#39;float32&#39;</span><span class="p">)</span>

<span class="n">zin</span> <span class="o">=</span> <span class="mf">2.1</span> <span class="c1"># From Notebook No.3, cross-correlation;</span>
<span class="n">lamcen</span> <span class="o">=</span> <span class="mf">0.6564</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">zin</span><span class="p">)</span>

<span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])):</span>
    <span class="c1"># This has to be done at each y pixel, as wavelength array can be tilted.</span>
    <span class="n">index_lamcen</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lamcen</span> <span class="o">-</span> <span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]))</span>
    <span class="n">cut_ha</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_2d</span> <span class="o">-</span> <span class="n">flux_cont2d</span><span class="p">)[</span><span class="n">yy</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen</span><span class="o">-</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen</span><span class="o">+</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">)]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cut_ha</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;H$</span><span class="se">\\</span><span class="s1">alpha$ map&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;H$\\alpha$ map&#39;)
</pre></div>
</div>
<img alt="../../../_images/df516a4bcfa008a4bdba080b24d00c44685acc85d12b891e801cd2d44028ab54.png" src="../../../_images/df516a4bcfa008a4bdba080b24d00c44685acc85d12b891e801cd2d44028ab54.png" />
</div>
</div>
</section>
<section id="get-hbeta-and-oiii-maps">
<h3>2.Get Hbeta and OIII maps<a class="headerlink" href="#get-hbeta-and-oiii-maps" title="Link to this heading">#</a></h3>
<p>This is more challenging, as these lines locate close to each other. Ideally, iteration process will be preferred, but here we use Specutils’ double gaussian component fitting, in a similar way for Ha.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filt</span> <span class="o">=</span> <span class="s1">&#39;f150w&#39;</span>

<span class="n">file_2d</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">DIR_DATA</span><span class="si">}</span><span class="s1">l3_nis_</span><span class="si">{</span><span class="n">filt</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">grism</span><span class="si">}</span><span class="s1">_s</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1">_cal.fits&#39;</span>
<span class="n">hdu_2d</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">file_2d</span><span class="p">)</span>

<span class="c1"># Align grism direction</span>
<span class="c1">#   - x-direction = Dispersion (wavelength) direction.</span>
<span class="c1">#   - y-direction = Cross-dispersion.</span>
<span class="c1"># in this notebook.</span>
    
<span class="k">if</span> <span class="n">grism</span> <span class="o">==</span> <span class="s1">&#39;G150C&#39;</span><span class="p">:</span>
    <span class="c1"># If spectrum is horizontal;</span>
    <span class="n">data_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">dq_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">err_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">wave_2d</span> <span class="o">=</span> <span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">data_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">dq_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">err_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    <span class="n">wave_2d</span> <span class="o">=</span> <span class="n">rotate</span><span class="p">(</span><span class="n">hdu_2d</span><span class="p">[</span><span class="n">ndither</span><span class="o">*</span><span class="mi">7</span><span class="o">+</span><span class="mi">4</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="mi">90</span><span class="p">)</span>
    
<span class="c1"># !! Note that the extracted spectra has flipped wavelength direction !!</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">filt</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;f150w&#39;)
</pre></div>
</div>
<img alt="../../../_images/633259121476abaf8bb540ef2ad227432634943981f5ab6c5cf91c18ccae47cb.png" src="../../../_images/633259121476abaf8bb540ef2ad227432634943981f5ab6c5cf91c18ccae47cb.png" />
</div>
</div>
</section>
<section id="in-the-plot-above-you-can-see-oiii-doublet-and-hbeta">
<h3>In the plot above, you can see Oiii doublet, and Hbeta.<a class="headerlink" href="#in-the-plot-above-you-can-see-oiii-doublet-and-hbeta" title="Link to this heading">#</a></h3>
<section id="a-get-continuum">
<h4>2a. Get continuum;<a class="headerlink" href="#a-get-continuum" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yy</span> <span class="o">=</span> <span class="mi">10</span> <span class="c1"># as an example;</span>

<span class="n">spec_unit</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">dimensionless_unscaled</span>

<span class="n">mask_line</span> <span class="o">=</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mf">1.35</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="mf">1.48</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mf">1.6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="mf">1.65</span><span class="p">))</span>

<span class="n">obs</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">data_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">)</span>
<span class="n">cont</span> <span class="o">=</span> <span class="n">continuum</span><span class="o">.</span><span class="n">fit_generic_continuum</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">Chebyshev1D</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:],</span> <span class="n">data_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Observed at y=</span><span class="si">{</span><span class="n">yy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">cont</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fitted continuum&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">1.8</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1.2, 1.8)
</pre></div>
</div>
<img alt="../../../_images/f84efd39d5a38794dd5b36e20a06ffb5ee5ea2abdcf169831706d5f9b1bc6da2.png" src="../../../_images/f84efd39d5a38794dd5b36e20a06ffb5ee5ea2abdcf169831706d5f9b1bc6da2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Repeat this along y-axis;</span>
<span class="n">flux_cont2d_150</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">*</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])):</span>

    <span class="n">mask_line</span> <span class="o">=</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mf">1.35</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="mf">1.48</span><span class="p">))</span> <span class="o">|</span> <span class="p">((</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&gt;</span> <span class="mf">1.6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="mf">1.65</span><span class="p">))</span>

    <span class="n">obs</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">spectral_axis</span><span class="o">=</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="n">data_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">mask_line</span><span class="p">]</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">)</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="n">continuum</span><span class="o">.</span><span class="n">fit_generic_continuum</span><span class="p">(</span><span class="n">obs</span><span class="p">,</span> <span class="n">model</span><span class="o">=</span><span class="n">Chebyshev1D</span><span class="p">(</span><span class="mi">7</span><span class="p">))</span>

    <span class="n">flux_cont2d_150</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">cont</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span><span class="o">.</span><span class="n">value</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">flux_cont2d_150</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f957d995c50&gt;
</pre></div>
</div>
<img alt="../../../_images/4d41a73a876d79e7da1645da0e4c274160adc90190d6f85f7bcf048ed90356b2.png" src="../../../_images/4d41a73a876d79e7da1645da0e4c274160adc90190d6f85f7bcf048ed90356b2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">line_2d</span> <span class="o">=</span> <span class="n">data_2d</span><span class="p">[:,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">flux_cont2d_150</span><span class="p">[:,</span> <span class="p">:]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">line_2d</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.image.AxesImage at 0x7f957d93d890&gt;
</pre></div>
</div>
<img alt="../../../_images/bc81575cde95ffa711db287ee5bc4bccc72ecc81bf7d0c6f6319b57097b53dda.png" src="../../../_images/bc81575cde95ffa711db287ee5bc4bccc72ecc81bf7d0c6f6319b57097b53dda.png" />
</div>
</div>
</section>
<section id="b-fit-emissionn-with-multi-conponent-gaussian">
<h4>2b. Fit emissionn, with multi-conponent gaussian;<a class="headerlink" href="#b-fit-emissionn-with-multi-conponent-gaussian" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yy</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># Fit the spectrum</span>
<span class="n">con</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.4</span> <span class="o">&lt;</span> <span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="mf">1.65</span><span class="p">)</span>

<span class="n">spectrum_cut</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">flux</span><span class="o">=</span><span class="n">line_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">con</span><span class="p">]</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span>
                        <span class="n">spectral_axis</span><span class="o">=</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">con</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

<span class="c1"># !!! Some tweaks may be needed for initial value, to successfully run the fit;</span>

<span class="c1"># For Hb</span>
<span class="n">g1_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.51</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.009</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

<span class="c1"># For O3 blue</span>
<span class="n">g2_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mf">80.</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.53</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.006</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

<span class="c1"># For O3 red</span>
<span class="n">g3_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mf">200.</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.55</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.006</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

<span class="n">g123_fit</span> <span class="o">=</span> <span class="n">fit_lines</span><span class="p">(</span><span class="n">spectrum_cut</span><span class="p">,</span> <span class="n">g1_init</span><span class="o">+</span><span class="n">g2_init</span><span class="o">+</span><span class="n">g3_init</span><span class="p">)</span>
<span class="n">y_fit</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">g123_fit</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: CompoundModel
Inputs: (&#39;x&#39;,)
Outputs: (&#39;y&#39;,)
Model set size: 1
Expression: [0] + [1] + [2]
Components: 
    [0]: &lt;Gaussian1D(amplitude=105.66859514, mean=1.5077448 um, stddev=0.00935798 um)&gt;

    [1]: &lt;Gaussian1D(amplitude=81.52163616, mean=1.53394167 um, stddev=0.00642788 um)&gt;

    [2]: &lt;Gaussian1D(amplitude=186.63301187, mean=1.54934898 um, stddev=0.01111533 um)&gt;
Parameters:
       amplitude_0           mean_0      ...       mean_2             stddev_2      
                               um        ...         um                  um         
    ------------------ ----------------- ... ------------------ --------------------
    105.66859514133516 1.507744802125851 ... 1.5493489837582815 0.011115330628071731
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot separately?</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:],</span> <span class="n">line_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:],</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Observed at y=</span><span class="si">{</span><span class="n">yy</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:],</span> <span class="n">y_fit</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Fit&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="n">y_fit1</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:],</span> <span class="n">y_fit1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;1&#39;</span><span class="p">)</span>

<span class="n">y_fit1</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:],</span> <span class="n">y_fit1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;2&#39;</span><span class="p">)</span>

<span class="n">y_fit1</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">[</span><span class="mi">2</span><span class="p">](</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:],</span> <span class="n">y_fit1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;3&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mf">1.4</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Single fit peak&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f957d9f13d0&gt;
</pre></div>
</div>
<img alt="../../../_images/baf565dc2f3ac8695000395b8d126664b6a3af23b4699704425233b18439dcd2.png" src="../../../_images/baf565dc2f3ac8695000395b8d126664b6a3af23b4699704425233b18439dcd2.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">g123_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">g123_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">g123_fit</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: Gaussian1D
Inputs: (&#39;x&#39;,)
Outputs: (&#39;y&#39;,)
Model set size: 1
Parameters:
        amplitude             mean              stddev       
                               um                 um         
    ------------------ ----------------- --------------------
    105.66859514133516 1.507744802125851 0.009357979058630145
Model: Gaussian1D
Inputs: (&#39;x&#39;,)
Outputs: (&#39;y&#39;,)
Model set size: 1
Parameters:
        amplitude            mean              stddev      
                              um                 um        
    ----------------- ------------------ ------------------
    81.52163616301453 1.5339416733295235 0.0064278791407759
Model: Gaussian1D
Inputs: (&#39;x&#39;,)
Outputs: (&#39;y&#39;,)
Model set size: 1
Parameters:
        amplitude            mean               stddev       
                              um                  um         
    ----------------- ------------------ --------------------
    186.6330118707438 1.5493489837582815 0.011115330628071731
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="fit-to-the-central-array-looks-good-repeat-this-along-y-axis-and-get-emission-line-maps-as-a-same-way-as-for-halpha">
<h3>Fit to the central array looks good. Repeat this along y-axis and get emission line maps, as a same way as for Halpha<a class="headerlink" href="#fit-to-the-central-array-looks-good-repeat-this-along-y-axis-and-get-emission-line-maps-as-a-same-way-as-for-halpha" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Cutout Hb, Oiii line maps;</span>
<span class="n">rsq</span> <span class="o">=</span> <span class="n">data_2d</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">cut_hb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rsq</span><span class="p">,</span> <span class="n">rsq</span><span class="p">),</span> <span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">cut_o3b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rsq</span><span class="p">,</span> <span class="n">rsq</span><span class="p">),</span> <span class="s1">&#39;float32&#39;</span><span class="p">)</span>
<span class="n">cut_o3r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">rsq</span><span class="p">,</span> <span class="n">rsq</span><span class="p">),</span> <span class="s1">&#39;float32&#39;</span><span class="p">)</span>

<span class="n">zin</span> <span class="o">=</span> <span class="mf">2.1</span> <span class="c1"># Redshift estimate from Notebook No.2, cross-correlation;</span>
<span class="n">lamcen_hb</span> <span class="o">=</span> <span class="mf">0.4862680</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">zin</span><span class="p">)</span>
<span class="n">lamcen_o3b</span> <span class="o">=</span> <span class="mf">0.4960295</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">zin</span><span class="p">)</span>
<span class="n">lamcen_o3r</span> <span class="o">=</span> <span class="mf">0.5008240</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span> <span class="o">+</span> <span class="n">zin</span><span class="p">)</span>

<span class="k">for</span> <span class="n">yy</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_2d</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])):</span>
    <span class="c1"># Fit the spectrum</span>
    <span class="n">con</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.4</span> <span class="o">&lt;</span> <span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">&lt;</span> <span class="mf">1.65</span><span class="p">)</span>
    <span class="n">spectrum_cut</span> <span class="o">=</span> <span class="n">Spectrum</span><span class="p">(</span><span class="n">flux</span><span class="o">=</span><span class="n">line_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">con</span><span class="p">]</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> 
                            <span class="n">spectral_axis</span><span class="o">=</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:][</span><span class="n">con</span><span class="p">]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

    <span class="c1"># !!! Some tweaks may be needed for initial value, to successfuully run the fit;</span>

    <span class="c1"># For Hb</span>
    <span class="n">g1_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mi">100</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.51</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.009</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>
    <span class="c1"># For O3 blue</span>
    <span class="n">g2_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mf">80.</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.53</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.006</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>
    <span class="c1"># For O3 red</span>
    <span class="n">g3_init</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">Gaussian1D</span><span class="p">(</span><span class="n">amplitude</span><span class="o">=</span><span class="mf">200.</span><span class="o">*</span><span class="n">spec_unit</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="mf">1.55</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">,</span> <span class="n">stddev</span><span class="o">=</span><span class="mf">0.006</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>
    <span class="n">g123_fit</span> <span class="o">=</span> <span class="n">fit_lines</span><span class="p">(</span><span class="n">spectrum_cut</span><span class="p">,</span> <span class="n">g1_init</span><span class="o">+</span><span class="n">g2_init</span><span class="o">+</span><span class="n">g3_init</span><span class="p">)</span>
    <span class="n">y_fit</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">(</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)</span>

    <span class="c1"># This has to be done at each y pixel, as wavelength array can be tilted.</span>
    <span class="n">index_lamcen_hb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lamcen_hb</span> <span class="o">-</span> <span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]))</span>
    <span class="n">cut_hb</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen_hb</span><span class="o">-</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen_hb</span><span class="o">+</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">)]</span>

    <span class="n">index_lamcen_o3b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lamcen_o3b</span> <span class="o">-</span> <span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]))</span>
    <span class="n">cut_o3b</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen_o3b</span><span class="o">-</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen_o3b</span><span class="o">+</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">)]</span>

    <span class="n">index_lamcen_o3r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lamcen_o3r</span> <span class="o">-</span> <span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]))</span>
    <span class="n">cut_o3r</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">g123_fit</span><span class="p">[</span><span class="mi">2</span><span class="p">](</span><span class="n">wave_2d</span><span class="p">[</span><span class="n">yy</span><span class="p">,</span> <span class="p">:]</span><span class="o">*</span><span class="n">u</span><span class="o">.</span><span class="n">um</span><span class="p">)[</span><span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen_o3r</span><span class="o">-</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">):</span><span class="nb">int</span><span class="p">(</span><span class="n">index_lamcen_o3r</span><span class="o">+</span><span class="n">rsq</span><span class="o">/</span><span class="mf">2.</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cut_hb</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;H$</span><span class="se">\\</span><span class="s1">beta$ map&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;H$\\beta$ map&#39;)
</pre></div>
</div>
<img alt="../../../_images/6e0debbb590c05d712f31896abc73ba3915470280f0df926280d2dc22479d0b5.png" src="../../../_images/6e0debbb590c05d712f31896abc73ba3915470280f0df926280d2dc22479d0b5.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cut_o3b</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Oiii 4960&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Oiii 4960&#39;)
</pre></div>
</div>
<img alt="../../../_images/9726758d6278ac87618513589c7950b927a91a53618587b5d8fbf936790c9999.png" src="../../../_images/9726758d6278ac87618513589c7950b927a91a53618587b5d8fbf936790c9999.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">cut_o3r</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Oiii 5008&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Oiii 5008&#39;)
</pre></div>
</div>
<img alt="../../../_images/ebe67bd870c3e02fa7af6ebecec888a328e32e8a90db1050a8abb6b067601b18.png" src="../../../_images/ebe67bd870c3e02fa7af6ebecec888a328e32e8a90db1050a8abb6b067601b18.png" />
</div>
</div>
</section>
</section>
<section id="summary">
<h2>Summary;<a class="headerlink" href="#summary" title="Link to this heading">#</a></h2>
<p>As seen above, regions except for the very center <font color='red'>do not look right.</font> This is due to failure of multi-component fit, especially for Oiii doublet.
To improve the fit, one can either;</p>
<ul class="simple">
<li><p>fit and inspect the fit repeatedly at each y-axis until it converges,</p></li>
<li><p>use MCMC for more intensive fitting, which also enables to fix the ratio of two Oiii lines by setting up a prior.</p></li>
<li><p>or reduce the number of components, especially for Oiii doublet at the edge of the source position, where the lines are blended.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/NIRISS/NIRISS_WFSS_postpipeline"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="02_Cross_correlation_template.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">WFSS Spectra - Part 2: Cross Correlation to Determine Redshift</p>
      </div>
    </a>
    <a class="right-next"
       href="../NIRISS_WFSS_advanced/00_niriss_mast_query_data_setup.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Download Wide Field Slittless Spectroscopy (WFSS) Data</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#download-notebook-01-products">0. Download notebook 01 products</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-halpha-emission-line-map">1.Get Halpha emission line map;</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#subtract-continuum-at-each-y-position">Subtract continuum at each y-position:</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-halpha-emission-from-a-continuum-subtracted-spectrum">Extract Halpha emission from a continuum-subtracted spectrum;</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-hbeta-and-oiii-maps">2.Get Hbeta and OIII maps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#in-the-plot-above-you-can-see-oiii-doublet-and-hbeta">In the plot above, you can see Oiii doublet, and Hbeta.</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#a-get-continuum">2a. Get continuum;</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#b-fit-emissionn-with-multi-conponent-gaussian">2b. Fit emissionn, with multi-conponent gaussian;</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-to-the-central-array-looks-good-repeat-this-along-y-axis-and-get-emission-line-maps-as-a-same-way-as-for-halpha">Fit to the central array looks good. Repeat this along y-axis and get emission line maps, as a same way as for Halpha</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary;</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By STScI
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022-2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>