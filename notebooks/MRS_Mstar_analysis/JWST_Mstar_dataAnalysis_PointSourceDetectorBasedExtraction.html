<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <meta content="Docutils 0.17.1: http://docutils.sourceforge.net/" name="generator"/>
  <title>
   MRS Detector Based Extraction — STScI JDAT Notebooks
  </title>
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
  <link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet"/>
  <link href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
  <link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" rel="stylesheet" type="text/css"/>
  <link href="../../_static/togglebutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/copybutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/mystnb.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/sphinx-thebe.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/main.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" rel="stylesheet" type="text/css"/>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf" rel="preload"/>
  <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js">
  </script>
  <script src="../../_static/jquery.js">
  </script>
  <script src="../../_static/underscore.js">
  </script>
  <script src="../../_static/doctools.js">
  </script>
  <script src="../../_static/clipboard.min.js">
  </script>
  <script src="../../_static/copybutton.js">
  </script>
  <script src="../../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456">
  </script>
  <script>
   let toggleHintShow = 'Click to show';
  </script>
  <script>
   let toggleHintHide = 'Click to hide';
  </script>
  <script>
   let toggleOpenOnPrint = 'true';
  </script>
  <script src="../../_static/togglebutton.js">
  </script>
  <script>
   var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';
  </script>
  <script src="../../_static/design-tabs.js">
  </script>
  <script>
   const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
  </script>
  <script async="async" src="../../_static/sphinx-thebe.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js">
  </script>
  <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js">
  </script>
  <script>
   window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}
  </script>
  <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
  </script>
  <link href="../../genindex.html" rel="index" title="Index"/>
  <link href="../../search.html" rel="search" title="Search"/>
  <link href="JWST_Mstar_dataAnalysis_analysis.html" rel="next" title="MRS Cube Analysis"/>
  <link href="JWST_Mstar_dataAnalysis_runpipeline.html" rel="prev" title="MRS Pipeline"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <meta content="None" name="docsearch:language"/>
  <!-- Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3">
  </script>
  <script>
   window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-D46G4HKJY3');
  </script>
 </head>
 <body data-offset="60" data-spy="scroll" data-target="#bd-toc-nav">
  <!-- Checkboxes to toggle the left sidebar -->
  <input aria-label="Toggle navigation sidebar" class="sidebar-toggle" id="__navigation" name="__navigation" type="checkbox"/>
  <label class="overlay overlay-navbar" for="__navigation">
   <div class="visually-hidden">
    Toggle navigation sidebar
   </div>
  </label>
  <!-- Checkboxes to toggle the in-page toc -->
  <input aria-label="Toggle in-page Table of Contents" class="sidebar-toggle" id="__page-toc" name="__page-toc" type="checkbox"/>
  <label class="overlay overlay-pagetoc" for="__page-toc">
   <div class="visually-hidden">
    Toggle in-page Table of Contents
   </div>
  </label>
  <!-- Headers at the top -->
  <div class="announcement header-item noprint">
  </div>
  <div class="header header-item noprint">
  </div>
  <div class="container-fluid" id="banner">
  </div>
  <div class="container-xl">
   <div class="row">
    <!-- Sidebar -->
    <div class="bd-sidebar noprint" id="site-navigation">
     <div class="bd-sidebar__content">
      <div class="bd-sidebar__top">
       <div class="navbar-brand-box">
        <a class="navbar-brand text-wrap" href="../../index.html">
         <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
         <img alt="logo" class="logo" src="../../_static/stsci_logo2.png"/>
         <h1 class="site-logo" id="site-title">
          STScI JDAT Notebooks
         </h1>
        </a>
       </div>
       <form action="../../search.html" class="bd-search d-flex align-items-center" method="get">
        <i class="icon fas fa-search">
        </i>
        <input aria-label="Search this book..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." type="search"/>
       </form>
       <nav aria-label="Main" class="bd-links" id="bd-docs-nav">
        <div class="bd-toc-item active">
         <ul class="nav bd-sidenav bd-sidenav__home-link">
          <li class="toctree-l1">
           <a class="reference internal" href="../../intro.html">
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           General
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../../index.html">
            Home
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../../install.html">
            Installation
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           Cross-Instrument
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../asdf_example/asdf_example.html">
            ASDF Example
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../background_estimation_imaging/Imaging%20Sky%20Background%20Estimation.html">
            Complex 2D Background
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../composite_model_fitting/specfit_demo_3.html">
            Composite Model Spectral Fitting
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">
            MAST Query
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">
            Specviz Simple Demo
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           MIRI
          </span>
         </p>
         <ul class="current nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="JWST_Mstar_dataAnalysis_runpipeline.html">
            MRS Mstar - Run Pipeline
           </a>
          </li>
          <li class="toctree-l1 current active">
           <a class="current reference internal" href="#">
            MRS Detector Based Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="JWST_Mstar_dataAnalysis_analysis.html">
            MRS Mstar - Data Analysis
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">
            IFU of YSOs in LMC
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../MIRI_LRS_spectral_extraction/miri_lrs_spectral_extraction.html">
            LRS Optimal Spectral Extraction
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           NIRCam
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../aperture_photometry/NIRCam_Aperture_Photometry_Example.html">
            Point Source Aperture Photometry
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRCam_photometry/NIRCam%20multiband%20photometry.html">
            Extended Aperture Photometry
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">
            Cross-Filter PSF Matching
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../psf_photometry/NIRCam_PSF_Photometry_Example.html">
            PSF Photometry
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           NIRISS
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRISS_WFSS_postpipeline/00.%20Optimal%20extraction.html">
            WFSS Spectra - Optimal Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRISS_WFSS_postpipeline/01.%20Combine%20and%20normalize%201D%20spectra.html">
            WFSS Spectra - Combine and Normalize 1D Spectra
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRISS_WFSS_postpipeline/02.%20Cross%20correlation%20template.html">
            WFSS Spectra - Cross-Correlation Template
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../NIRISS_WFSS_postpipeline/03.%20Spatially%20resolved%20emission%20line%20map.html">
            WFSS Spectra - Emission Line Map
           </a>
          </li>
         </ul>
         <p aria-level="2" class="caption" role="heading">
          <span class="caption-text">
           NIRSpec
          </span>
         </p>
         <ul class="nav bd-sidenav">
          <li class="toctree-l1">
           <a class="reference internal" href="../IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html">
            IFU Cube Fitting
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../ifu_optimal/ifu_optimal.html">
            IFU Optimal Spectral Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../optimal_extraction/Spectral%20Extraction-static.html">
            MOS Optimal Extraction
           </a>
          </li>
          <li class="toctree-l1">
           <a class="reference internal" href="../mos-spectroscopy/MOSspec_sv06_revised.html">
            MOS Spectroscopy of Extragalactic Field
           </a>
          </li>
         </ul>
        </div>
       </nav>
      </div>
      <div class="bd-sidebar__bottom">
       <!-- To handle the deprecated key -->
       <div class="navbar_extra_footer">
        Powered by
        <a href="https://jupyterbook.org">
         Jupyter Book
        </a>
       </div>
      </div>
     </div>
     <div id="rtd-footer-container">
     </div>
    </div>
    <!-- A tiny helper pixel to detect if we've scrolled -->
    <div class="sbt-scroll-pixel-helper">
    </div>
    <!-- Main content -->
    <div class="col py-0 content-container">
     <div class="header-article row sticky-top noprint">
      <div class="col py-1 d-flex header-article-main">
       <div class="header-article__left">
        <label class="headerbtn" data-placement="right" data-toggle="tooltip" for="__navigation" title="Toggle navigation">
         <span class="headerbtn__icon-container">
          <i class="fas fa-bars">
          </i>
         </span>
        </label>
       </div>
       <div class="header-article__right">
        <div class="menu-dropdown menu-dropdown-launch-buttons">
         <button aria-label="Launch interactive content" class="headerbtn menu-dropdown__trigger">
          <i class="fas fa-rocket">
          </i>
         </button>
         <div class="menu-dropdown__content">
          <ul>
           <li>
            <button class="headerbtn headerbtn-launch-thebe" data-placement="left" data-toggle="tooltip" onclick="initThebeSBT()" title="Launch Thebe">
             <span class="headerbtn__icon-container">
              <i class="fas fa-play">
              </i>
             </span>
             <span class="headerbtn__text-container">
              Live Code
             </span>
            </button>
           </li>
          </ul>
         </div>
        </div>
        <button class="headerbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode">
         <span class="headerbtn__icon-container">
          <i class="fas fa-expand">
          </i>
         </span>
        </button>
        <div class="menu-dropdown menu-dropdown-repository-buttons">
         <button aria-label="Source repositories" class="headerbtn menu-dropdown__trigger">
          <i class="fab fa-github">
          </i>
         </button>
         <div class="menu-dropdown__content">
          <ul>
           <li>
            <a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/spacetelescope/jdat_notebooks/" title="Source repository">
             <span class="headerbtn__icon-container">
              <i class="fab fa-github">
              </i>
             </span>
             <span class="headerbtn__text-container">
              repository
             </span>
            </a>
           </li>
           <li>
            <a class="headerbtn" data-placement="left" data-toggle="tooltip" href="https://github.com/spacetelescope/jdat_notebooks//issues/new?title=Issue%20on%20page%20%2Fnotebooks/MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_PointSourceDetectorBasedExtraction.html&amp;body=Your%20issue%20content%20here." title="Open an issue">
             <span class="headerbtn__icon-container">
              <i class="fas fa-lightbulb">
              </i>
             </span>
             <span class="headerbtn__text-container">
              open issue
             </span>
            </a>
           </li>
          </ul>
         </div>
        </div>
        <div class="menu-dropdown menu-dropdown-download-buttons">
         <button aria-label="Download this page" class="headerbtn menu-dropdown__trigger">
          <i class="fas fa-download">
          </i>
         </button>
         <div class="menu-dropdown__content">
          <ul>
           <li>
            <a class="headerbtn" data-placement="left" data-toggle="tooltip" href="../../_sources/notebooks/MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_PointSourceDetectorBasedExtraction.ipynb" title="Download source file">
             <span class="headerbtn__icon-container">
              <i class="fas fa-file">
              </i>
             </span>
             <span class="headerbtn__text-container">
              .ipynb
             </span>
            </a>
           </li>
           <li>
            <button class="headerbtn" data-placement="left" data-toggle="tooltip" onclick="printPdf(this)" title="Print to PDF">
             <span class="headerbtn__icon-container">
              <i class="fas fa-file-pdf">
              </i>
             </span>
             <span class="headerbtn__text-container">
              .pdf
             </span>
            </button>
           </li>
          </ul>
         </div>
        </div>
        <label class="headerbtn headerbtn-page-toc" for="__page-toc">
         <span class="headerbtn__icon-container">
          <i class="fas fa-list">
          </i>
         </span>
        </label>
       </div>
      </div>
      <!-- Table of contents -->
      <div class="col-md-3 bd-toc show noprint">
       <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list">
        </i>
        Contents
       </div>
       <nav aria-label="Page" id="bd-toc-nav">
        <ul class="visible nav section-nav flex-column">
         <li class="toc-h1 nav-item toc-entry">
          <a class="reference internal nav-link" href="#">
           MRS Detector Based Extraction
          </a>
          <ul class="visible nav section-nav flex-column">
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#introduction">
             Introduction
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#motivation-to-the-detector-based-extraction-technique">
             Motivation to the Detector Based Extraction Technique
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#implementation-of-the-algorithm">
             Implementation of the Algorithm
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#import-packages">
             Import Packages
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#set-paths-to-the-data-and-outputs">
             Set paths to the Data and Outputs
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#run-pipeline">
             Run Pipeline
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#now-to-detect-the-point-source-in-the-detector-image-plane-and-extract-and-plot-the-spectra-for-each-source">
             Now to detect the point source in the detector image plane and extract and plot the spectra for each source
            </a>
           </li>
          </ul>
         </li>
         <li class="toc-h1 nav-item toc-entry">
          <a class="reference internal nav-link" href="#determine-transmission-factor-corresponding-to-source-across-slice-position-beta-the-signal-should-be-multiplied-by-this-factor">
           Determine transmission factor corresponding to source across-slice position
           <span class="math notranslate nohighlight">
            \(\beta\)
           </span>
           , the signal should be multiplied by this factor
          </a>
         </li>
         <li class="toc-h1 nav-item toc-entry">
          <a class="reference internal nav-link" href="#determine-wavelength-correction-due-to-source-across-slice-position-beta">
           Determine wavelength correction due to source across-slice position
           <span class="math notranslate nohighlight">
            \(\beta\)
           </span>
          </a>
         </li>
         <li class="toc-h1 nav-item toc-entry">
          <a class="reference internal nav-link" href="#load-mrs-psf-model-in-the-3d-spectral-cube-and-project-it-on-the-2d-detector">
           Load MRS PSF model in the 3D spectral cube and project it on the 2D detector
          </a>
          <ul class="visible nav section-nav flex-column">
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#correct-for-spectral-leak-if-mrs-band-is-set-to-3a">
             Correct for spectral leak if MRS band is set to 3A
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#caution-in-order-for-the-following-cell-to-work-the-user-must-have-run-this-notebook-already-once-for-band-1b">
             CAUTION: In order for the following cell to work, the user must have run this notebook already once for band 1B.
            </a>
           </li>
          </ul>
         </li>
         <li class="toc-h1 nav-item toc-entry">
          <a class="reference internal nav-link" href="#the-end">
           THE END
          </a>
          <ul class="visible nav section-nav flex-column">
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#still-to-do">
             Still to do:
            </a>
           </li>
           <li class="toc-h2 nav-item toc-entry">
            <a class="reference internal nav-link" href="#about-this-notebook">
             About this notebook
            </a>
           </li>
          </ul>
         </li>
        </ul>
       </nav>
      </div>
     </div>
     <div class="article row">
      <div class="col pl-md-3 pl-lg-5 content-container">
       <!-- Table of contents that is only displayed when printing the page -->
       <div class="onlyprint" id="jb-print-docs-body">
        <h1>
         MRS Detector Based Extraction
        </h1>
        <!-- Table of contents -->
        <div id="print-main-content">
         <div id="jb-print-toc">
          <div>
           <h2>
            Contents
           </h2>
          </div>
          <nav aria-label="Page">
           <ul class="visible nav section-nav flex-column">
            <li class="toc-h1 nav-item toc-entry">
             <a class="reference internal nav-link" href="#">
              MRS Detector Based Extraction
             </a>
             <ul class="visible nav section-nav flex-column">
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#introduction">
                Introduction
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#motivation-to-the-detector-based-extraction-technique">
                Motivation to the Detector Based Extraction Technique
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#implementation-of-the-algorithm">
                Implementation of the Algorithm
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#import-packages">
                Import Packages
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#set-paths-to-the-data-and-outputs">
                Set paths to the Data and Outputs
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#run-pipeline">
                Run Pipeline
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#now-to-detect-the-point-source-in-the-detector-image-plane-and-extract-and-plot-the-spectra-for-each-source">
                Now to detect the point source in the detector image plane and extract and plot the spectra for each source
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h1 nav-item toc-entry">
             <a class="reference internal nav-link" href="#determine-transmission-factor-corresponding-to-source-across-slice-position-beta-the-signal-should-be-multiplied-by-this-factor">
              Determine transmission factor corresponding to source across-slice position
              <span class="math notranslate nohighlight">
               \(\beta\)
              </span>
              , the signal should be multiplied by this factor
             </a>
            </li>
            <li class="toc-h1 nav-item toc-entry">
             <a class="reference internal nav-link" href="#determine-wavelength-correction-due-to-source-across-slice-position-beta">
              Determine wavelength correction due to source across-slice position
              <span class="math notranslate nohighlight">
               \(\beta\)
              </span>
             </a>
            </li>
            <li class="toc-h1 nav-item toc-entry">
             <a class="reference internal nav-link" href="#load-mrs-psf-model-in-the-3d-spectral-cube-and-project-it-on-the-2d-detector">
              Load MRS PSF model in the 3D spectral cube and project it on the 2D detector
             </a>
             <ul class="visible nav section-nav flex-column">
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#correct-for-spectral-leak-if-mrs-band-is-set-to-3a">
                Correct for spectral leak if MRS band is set to 3A
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#caution-in-order-for-the-following-cell-to-work-the-user-must-have-run-this-notebook-already-once-for-band-1b">
                CAUTION: In order for the following cell to work, the user must have run this notebook already once for band 1B.
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h1 nav-item toc-entry">
             <a class="reference internal nav-link" href="#the-end">
              THE END
             </a>
             <ul class="visible nav section-nav flex-column">
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#still-to-do">
                Still to do:
               </a>
              </li>
              <li class="toc-h2 nav-item toc-entry">
               <a class="reference internal nav-link" href="#about-this-notebook">
                About this notebook
               </a>
              </li>
             </ul>
            </li>
           </ul>
          </nav>
         </div>
        </div>
       </div>
       <main id="main-content" role="main">
        <div>
         <section class="tex2jax_ignore mathjax_ignore" id="mrs-detector-based-extraction">
          <h1>
           MRS Detector Based Extraction
           <a class="headerlink" href="#mrs-detector-based-extraction" title="Permalink to this headline">
            #
           </a>
          </h1>
          <p>
           <strong>
            Use case:
           </strong>
           This notebook illustrates a spectral extraction technique from detector image plane using a PSF model and the pixel variance. This extraction is considered more advanced than what is currently implemented in the JWST pipeline and is expected to be fully integrated into the pipeline in the future.
           <br/>
           <strong>
            Data:
           </strong>
           Simulated
           <a class="reference external" href="https://jwst-docs.stsci.edu/mid-infrared-instrument/miri-observing-modes/miri-medium-resolution-spectroscopy">
            MIRI MRS
           </a>
           spectrum of AGB star.
           <br/>
           <strong>
            Tools:
           </strong>
           jwst, astropy, numpy, scipy.
           <br/>
           <strong>
            Cross-intrument:
           </strong>
           No.
           <br/>
           <strong>
            Documentation:
           </strong>
           This notebook is part of a STScI’s larger
           <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-post-pipeline-data-analysis">
            post-pipeline Data Analysis Tools Ecosystem
           </a>
           and can be
           <a class="reference external" href="https://github.com/spacetelescope/dat_pyinthesky/tree/main/jdat_notebooks/MRS_Mstar_analysis">
            downloaded
           </a>
           directly from the
           <a class="reference external" href="https://github.com/spacetelescope/jdat_notebooks">
            JDAT Notebook Github directory
           </a>
           .
           <br/>
           <strong>
            Source of Simulations:
           </strong>
           <a class="reference external" href="https://www.stsci.edu/jwst/science-planning/proposal-planning-toolbox/mirisim">
            MIRISim
           </a>
           <br/>
           <strong>
            Pipeline Version:
           </strong>
           <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-data-reduction-pipeline">
            JWST Pipeline
           </a>
           <br/>
          </p>
          <p>
           <strong>
            Note
           </strong>
           : This notebook includes MIRI simulated data cubes obtained using MIRISim (
           <a class="reference external" href="https://wiki.miricle.org//bin/view/Public/MIRISim_Public">
            https://wiki.miricle.org//bin/view/Public/MIRISim_Public
           </a>
           ) and run through the JWST pipeline (
           <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/">
            https://jwst-pipeline.readthedocs.io/en/latest/
           </a>
           ) of point sources with spectra representative of late M type stars.
          </p>
          <section id="introduction">
           <h2>
            Introduction
            <a class="headerlink" href="#introduction" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            This notebook analyzes one star represented by a dusty SED corresponding to the ISO SWS spectrum of W Per from Kraemer et al. (2002) and Sloan et al. (2003) to cover the MRS spectral range 5-28 microns.  Analysis of JWST spectral cubes requires extracting spatial-spectral features of interest and measuring their attributes.
           </p>
           <p>
            This is the first notebook, which will process the data and automatically detect and extract spectra for the point source.  The workflow automatically detects sources on the detector image plane to extract the spectrum of the point source. Then it will read in the spectra generated at Stage 3 of the JWST pipeline.
           </p>
          </section>
          <section id="motivation-to-the-detector-based-extraction-technique">
           <h2>
            Motivation to the Detector Based Extraction Technique
            <a class="headerlink" href="#motivation-to-the-detector-based-extraction-technique" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            At present, one-dimensional spectra produced by the JWST pipeline are
constructed exclusively from the combined and rectified 3-dimensional
data cubes.  These data cubes are treated as a collection of images at
various wavelength planes, and simple aperture-based (or effective
PSF-weighted) techniques are used to recover the source intensity as a
function of wavelength in a manner akin to standard imaging PSF
photometry.  However, this method of extracting point source spectra
from data cubes is not ideal; fundamentally, a source with no spatial
structure should not undergo spatial reprocessing prior to extraction of
spectral information.  Indeed, large-scale IFU surveys targeting point
sources rather than extended sources (e.g., SDSS IV/MaStar, R. Yan et
al. 2019) have relied on detector-based spectral extraction rather than
the construction of 3d data cubes.
           </p>
           <p>
            For the MIRI MRS in particular, such detector-based extraction offers
the opportunity to correct for the following effects which would be
difficult or impossible to handle once the observational data has been
rectified into 3-dimensional cubes:
           </p>
           <ol class="simple">
            <li>
             <p>
              Given the significant undersampling of the MRS, offsets in spaxel
sampling locations as a function of wavelength can alias spatial
structure from the point spread function into spectral artifacts that
bias extracted 1D spectra.  3D cube building is designed in a manner to
mitigate these artifacts, but the act of resampling ensures that 1D
spectra of unresolved sources extracted from 3D cubes can never be as
reliable as 1D spectra extracted directly from detector-level data
without the intermediate resampling step.
             </p>
            </li>
            <li>
             <p>
              Resampled pixels in the data cubes have significant covariance with
adjacent/nearby pixels.  Treating this covariance properly in the
construction of extracted 1D spectra with flux and variance information
is challenging, and not handled at present by the cube-based spectral
extraction.
             </p>
            </li>
            <li>
             <p>
              Pipeline calibrations of the instrument throughput and wavelength
calibration are based on sources that fill a given IFU slice, whereas
point sources produce a non-uniform response depending upon the location
of the source centroid within a given IFU slice.  For instance, given
the degeneracy on the detector between the spatial across-slice and
spectral dispersion directions, the wavelength solution for point
sources will differ slightly than for extended sources in a manner that
depends on the source location within the slice.  This effect cannot be
recovered once a 3D cube has been constructed that combines data from
many slices (and indeed, multiple dithered exposures).
             </p>
            </li>
            <li>
             <p>
              The MRS has a spectral leak in which 2nd order light from 6 microns
(Ch1B) is visible at a few percent transmission in the 12 micron
observations (Ch3A).  This effect is not possible to correct in general,
since the Ch3A field of view is larger than that of Ch1B.  However, for
the specific case of a point source within the common field of view of
all channels it is possible to use the Ch1B spectrum to predict and
subtract the second-order signal from the Ch3A data.
             </p>
            </li>
           </ol>
          </section>
          <section id="implementation-of-the-algorithm">
           <h2>
            Implementation of the Algorithm
            <a class="headerlink" href="#implementation-of-the-algorithm" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            In this notebook, we implement a method for achieving MIRI MRS
detector-based point source extraction. The formalism behind the method
follows the optimal spectral extraction formalism by Keith Horne 1986.
Extracting a 1d integrated spectrum directly from the MRS detectors
depends on (a) a detailed knowledge of the detector PSF, and (b) the
pixel variance. The MRS detector PSF differs considerably from the
telescope PSF due to the scattering of the photons inside the detector
substrate. How well the detector PSF is understood/modeled/measured is
key in this instance and should not be understated. For the pixel
variance, the slope-fitting uncertainty from the pixel integration
ramp(s) is used. The combination of the detector PSF and pixel variance
is used as a weighing function to weigh the signal in each detector pixel.
           </p>
           <p>
            In its most basic form, the notebook code assumes that there is only one
point source in the MRS field of view. Using a Gaussian-fitting routine
at detector-level, the centroid of the point source is determined with a
sub-pixel accuracy. The centroid is used to project the known detector
PSF model directly onto the point source signal. The centroid is also
used to derive the throughput and wavelength correction due to the
location of the point source with respect to the imaging slicer of the
MRS. The throughput and wavelength correction are applied before the
spectral extraction step.
           </p>
           <p>
            The spectral extraction step integrates the point source flux in a
pre-defined list of wavelength bins. All detector pixels contributing to
a wavelength bin are weighed by the projected PSF model -and- the pixel
variance. In case the extracted spectral band is MRS band 3A (around 12
microns) then the following steps are taken:
           </p>
           <ul class="simple">
            <li>
             <p>
              The band 1B (~6 micron) detector image is multiplied by a spectral
leak transmission curve.
             </p>
            </li>
            <li>
             <p>
              A 1d “spectral leak” integrated point source spectrum is extracted
from band 1B.
             </p>
            </li>
            <li>
             <p>
              The spectral leak spectrum is subtracted from the band 3A integrated
point source spectrum.
             </p>
            </li>
           </ul>
           <p>
            Future improvements to the code will allow users to input MRS point
source centroid locations to address the case of crowded fields, barely
resolved blended point sources, and point sources located within a
semi-extended environment with spatial structure. In addition, the fine
centroiding, currently performed using a Gaussian distribution, can be
improved by striving for residual minimisation with a master
detector-based PSF model. Such a master PSF model will be derived and
refined throughout commissioning and Cycle 1 calibration.
           </p>
          </section>
          <section id="import-packages">
           <h2>
            Import Packages
            <a class="headerlink" href="#import-packages" title="Permalink to this headline">
             #
            </a>
           </h2>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># Import useful python packages</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>

<span class="c1"># Import packages to display images in the notebook</span>
<span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>    
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="c1"># Set general plotting options</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'legend.fontsize'</span><span class="p">:</span> <span class="s1">'18'</span><span class="p">,</span> <span class="s1">'axes.labelsize'</span><span class="p">:</span> <span class="s1">'18'</span><span class="p">,</span> 
          <span class="s1">'axes.titlesize'</span><span class="p">:</span> <span class="s1">'18'</span><span class="p">,</span> <span class="s1">'xtick.labelsize'</span><span class="p">:</span> <span class="s1">'18'</span><span class="p">,</span> 
          <span class="s1">'ytick.labelsize'</span><span class="p">:</span> <span class="s1">'18'</span><span class="p">,</span> <span class="s1">'lines.linewidth'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'axes.linewidth'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'animation.html'</span><span class="p">:</span> <span class="s1">'html5'</span><span class="p">}</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s1">'figure.max_open_warning'</span><span class="p">:</span> <span class="mi">0</span><span class="p">})</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
<span class="n">display</span><span class="p">(</span><span class="n">HTML</span><span class="p">(</span><span class="s2">"&lt;style&gt;.container { width:100% !important; }&lt;/style&gt;"</span><span class="p">))</span>
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output text_html">
              <style>
               .container { width:100% !important; }
              </style>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">'ignore'</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># Import astropy packages </span>
<span class="kn">from</span> <span class="nn">astropy</span> <span class="kn">import</span> <span class="n">units</span> <span class="k">as</span> <span class="n">u</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">ascii</span>
<span class="kn">from</span> <span class="nn">astropy.wcs</span> <span class="kn">import</span> <span class="n">WCS</span>
<span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">Table</span><span class="p">,</span> <span class="n">vstack</span>
<span class="kn">from</span> <span class="nn">astropy.stats</span> <span class="kn">import</span> <span class="n">sigma_clipped_stats</span>
<span class="kn">from</span> <span class="nn">astropy.nddata</span> <span class="kn">import</span> <span class="n">StdDevUncertainty</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span> <span class="c1"># added by BAS on 8 April 2021</span>
<span class="kn">from</span> <span class="nn">astropy.utils.data</span> <span class="kn">import</span> <span class="n">get_pkg_data_filename</span>
<span class="kn">from</span> <span class="nn">astropy.utils.data</span> <span class="kn">import</span> <span class="n">download_file</span>

<span class="c1"># To find stars in the MRS spectralcubes and do aperture photometry</span>
<span class="kn">from</span> <span class="nn">photutils</span> <span class="kn">import</span> <span class="n">DAOStarFinder</span><span class="p">,</span> <span class="n">CircularAperture</span>

<span class="c1"># To deal with 1D spectrum</span>
<span class="kn">from</span> <span class="nn">specutils</span> <span class="kn">import</span> <span class="n">Spectrum1D</span>
<span class="kn">from</span> <span class="nn">specutils.fitting</span> <span class="kn">import</span> <span class="n">fit_generic_continuum</span>
<span class="kn">from</span> <span class="nn">specutils.manipulation</span> <span class="kn">import</span> <span class="n">box_smooth</span><span class="p">,</span> <span class="n">extract_region</span><span class="p">,</span> <span class="n">SplineInterpolatedResampler</span>
<span class="kn">from</span> <span class="nn">specutils.analysis</span> <span class="kn">import</span> <span class="n">line_flux</span><span class="p">,</span> <span class="n">centroid</span><span class="p">,</span> <span class="n">equivalent_width</span>
<span class="kn">from</span> <span class="nn">specutils.spectra</span> <span class="kn">import</span> <span class="n">SpectralRegion</span>
<span class="kn">from</span> <span class="nn">specutils</span> <span class="kn">import</span> <span class="n">SpectrumList</span>

<span class="c1"># To make nice plots with WCS axis</span>
<span class="c1"># import aplpy</span>

<span class="c1"># To fit a curve to the data</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">curve_fit</span>

<span class="c1"># To download data</span>
<span class="kn">import</span> <span class="nn">tarfile</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># import necessary functions from PointSourceDetectorBasedExtractionFuncs and create_distortionMaps</span>
<span class="kn">from</span> <span class="nn">PointSourceDetectorBasedExtractionFuncs</span> <span class="kn">import</span> <span class="n">mrs_aux</span><span class="p">,</span> <span class="n">point_source_centroiding</span><span class="p">,</span> <span class="n">evaluate_psf_cdp</span>

<span class="c1"># evaluate distortion maps on the 2D detector image plane</span>
<span class="kn">from</span> <span class="nn">create_distortionMaps</span> <span class="kn">import</span> <span class="n">d2cMapping</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="set-paths-to-the-data-and-outputs">
           <h2>
            Set paths to the Data and Outputs
            <a class="headerlink" href="#set-paths-to-the-data-and-outputs" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            Use MIRISim JWST pipeline processed data in future iterations.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'CRDS_PATH'</span><span class="p">]</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'HOME'</span><span class="p">]</span><span class="o">+</span><span class="s1">'/crds_cache'</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'CRDS_SERVER_URL'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'https://jwst-crds.stsci.edu'</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># Set JWST pipeline paths</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'CRDS_PATH'</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'HOME'</span><span class="p">])</span> <span class="o">/</span> <span class="s1">'crds_cache'</span><span class="p">)</span>
<span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'CRDS_SERVER_URL'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'https://jwst-crds.stsci.edu'</span>

<span class="c1"># import JWST pipeline</span>
<span class="kn">from</span> <span class="nn">jdaviz.app</span> <span class="kn">import</span> <span class="n">Application</span>
<span class="kn">from</span> <span class="nn">jwst.pipeline</span> <span class="kn">import</span> <span class="n">Detector1Pipeline</span>
<span class="kn">from</span> <span class="nn">jwst.pipeline</span> <span class="kn">import</span> <span class="n">Spec2Pipeline</span>
<span class="kn">from</span> <span class="nn">jwst.pipeline</span> <span class="kn">import</span> <span class="n">Spec3Pipeline</span>
<span class="kn">from</span> <span class="nn">jwst.extract_1d</span> <span class="kn">import</span> <span class="n">Extract1dStep</span>
<span class="kn">from</span> <span class="nn">jwst.associations.lib.rules_level3_base</span> <span class="kn">import</span> <span class="n">DMS_Level3_Base</span>
<span class="kn">from</span> <span class="nn">jwst.associations</span> <span class="kn">import</span> <span class="n">asn_from_list</span>
<span class="kn">from</span> <span class="nn">photutils</span> <span class="kn">import</span> <span class="n">aperture_photometry</span>

<span class="kn">import</span> <span class="nn">asdf</span>
<span class="kn">import</span> <span class="nn">crds</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">glob</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">tar_location</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">'./'</span><span class="p">)</span>
<span class="n">tar_files</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'20210413_120546_mirisim.tar.gz'</span><span class="p">,</span> 
    <span class="s1">'20210413_123047_mirisim.tar.gz'</span><span class="p">,</span>
    <span class="s1">'20210413_125354_mirisim.tar.gz'</span>
<span class="p">]</span>
<span class="n">tar_paths_full</span> <span class="o">=</span> <span class="p">[</span><span class="n">tar_location</span> <span class="o">/</span> <span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">tar_files</span><span class="p">]</span>

<span class="n">tar_urls</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/20210413_120546_mirisim.tar.gz'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/20210413_123047_mirisim.tar.gz'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/20210413_125354_mirisim.tar.gz'</span>
<span class="p">]</span>


<span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">tar_paths_full</span><span class="p">,</span> <span class="n">tar_urls</span><span class="p">):</span>
    <span class="c1"># check for un-tarred version of file</span>
    <span class="n">tmp</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">p</span><span class="o">.</span><span class="n">stem</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">tmp</span><span class="o">.</span><span class="n">stem</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> Directory Exists."</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># check for tarred version of file and un-tar</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
            <span class="c1"># download file if absent</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Downloading </span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>           
            <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        
        <span class="n">tar</span> <span class="o">=</span> <span class="n">tarfile</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="s2">"r:gz"</span><span class="p">)</span>
        <span class="n">tar</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>
        <span class="n">tar</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading 20210413_120546_mirisim.tar.gz...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading 20210413_123047_mirisim.tar.gz...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading 20210413_125354_mirisim.tar.gz...
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># Create Directories If They Don't Exist</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="s2">"./miri_devel/cdp_data/DISTORTION"</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"MIRI Reference File Directory Exists."</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">"./miri_devel/cdp_data/DISTORTION"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Made Directory ./miri_devel/cdp_data/DISTORTION"</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Made Directory ./miri_devel/cdp_data/DISTORTION
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">'./'</span><span class="p">)</span>
<span class="n">data_paths</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'spectral_leak_transmission.npy'</span><span class="p">,</span>
    <span class="s1">'W_Per_spectrum_sws.fit'</span><span class="p">,</span>
    <span class="s1">'jwst_miri_photom_0064.fits'</span><span class="p">,</span>
    <span class="s1">'jwst_miri_photom_0060.fits'</span><span class="p">,</span>
    <span class="s1">'jwst_miri_photom_0052.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_2SHORT_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_2MEDIUM_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_2LONG_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_1SHORT_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_1MEDIUM_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_1LONG_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/MIRI_FM_MIRIFULONG_3SHORT_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/MIRI_FM_MIRIFULONG_3MEDIUM_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/MIRI_FM_MIRIFULONG_3LONG_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/MIRI_FM_MIRIFULONG_4SHORT_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/MIRI_FM_MIRIFULONG_4MEDIUM_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/MIRI_FM_MIRIFULONG_4LONG_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34LONG_DISTORTION_8B.05.03.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34LONG_DISTORTION_8B.05.02.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34MEDIUM_DISTORTION_8B.05.02.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34MEDIUM_DISTORTION_8B.05.03.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34SHORT_DISTORTION_8B.05.02.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34SHORT_DISTORTION_8B.05.03.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFUSHORT_12LONG_DISTORTION_8B.05.02.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFUSHORT_12MEDIUM_DISTORTION_8B.05.02.fits'</span><span class="p">,</span>
    <span class="s1">'miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFUSHORT_12SHORT_DISTORTION_8B.05.02.fits'</span>
<span class="p">]</span>

<span class="n">data_paths_full</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_dir</span> <span class="o">/</span> <span class="n">p</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">data_paths</span><span class="p">]</span>
<span class="n">data_urls</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/spectral_leak_transmission.npy'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/W_Per_spectrum_sws.fit'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/jwst_miri_photom_0064.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/jwst_miri_photom_0060.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/jwst_miri_photom_0052.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_2SHORT_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_2MEDIUM_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_2LONG_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_1SHORT_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_1MEDIUM_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFUSHORT_1LONG_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFULONG_3SHORT_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFULONG_3MEDIUM_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFULONG_3LONG_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFULONG_4SHORT_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFULONG_4MEDIUM_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/MIRI_FM_MIRIFULONG_4LONG_PSF_07.02.00.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34LONG_DISTORTION_8B.05.03.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34LONG_DISTORTION_8B.05.02.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34MEDIUM_DISTORTION_8B.05.02.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34MEDIUM_DISTORTION_8B.05.03.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34SHORT_DISTORTION_8B.05.02.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFULONG_34SHORT_DISTORTION_8B.05.03.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFUSHORT_12LONG_DISTORTION_8B.05.02.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFUSHORT_12MEDIUM_DISTORTION_8B.05.02.fits'</span><span class="p">,</span>
    <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri_devel/cdp_data/DISTORTION/MIRI_FM_MIRIFUSHORT_12SHORT_DISTORTION_8B.05.02.fits'</span>
<span class="p">]</span> 

<span class="k">for</span> <span class="n">p</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">data_paths_full</span><span class="p">,</span> <span class="n">data_urls</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">p</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2"> exists."</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Downloading </span><span class="si">{</span><span class="n">p</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">..."</span><span class="p">)</span>
        <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading spectral_leak_transmission.npy...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading W_Per_spectrum_sws.fit...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading jwst_miri_photom_0064.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading jwst_miri_photom_0060.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading jwst_miri_photom_0052.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_2SHORT_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_2MEDIUM_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_2LONG_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_1SHORT_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_1MEDIUM_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_1LONG_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_3SHORT_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_3MEDIUM_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_3LONG_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_4SHORT_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_4MEDIUM_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_4LONG_PSF_07.02.00.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_34LONG_DISTORTION_8B.05.03.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_34LONG_DISTORTION_8B.05.02.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_34MEDIUM_DISTORTION_8B.05.02.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_34MEDIUM_DISTORTION_8B.05.03.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_34SHORT_DISTORTION_8B.05.02.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFULONG_34SHORT_DISTORTION_8B.05.03.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_12LONG_DISTORTION_8B.05.02.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_12MEDIUM_DISTORTION_8B.05.02.fits...
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading MIRI_FM_MIRIFUSHORT_12SHORT_DISTORTION_8B.05.02.fits...
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="run-pipeline">
           <h2>
            Run Pipeline
            <a class="headerlink" href="#run-pipeline" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            The various
            <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/jwst/pipeline/main.html#pipelines">
             stages of the pipeline
            </a>
            can be
            <a class="reference external" href="https://jwst-pipeline.readthedocs.io/en/latest/jwst/introduction.html#running-from-within-python">
             run within Python
            </a>
            .  For a more in depth tutorial on running the pipelines, check out the
            <a class="reference external" href="https://www.stsci.edu/jwst/science-execution/jwebbinars">
             JWebbinars
            </a>
            .
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># Execute calwebb_detector1 pipeline on raw simulation output.  This will overwrite previous reductions.</span>

<span class="n">allshortfiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">'20210413_*_mirisim/det_images/*MIRIFUSHORT*fits'</span><span class="p">)</span>
<span class="n">alllongfiles</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">'20210413_*_mirisim/det_images/*MIRIFULONG*fits'</span><span class="p">)</span>
      
<span class="n">pipe1short</span> <span class="o">=</span> <span class="n">Detector1Pipeline</span><span class="p">()</span>

<span class="c1"># run calwebb_detector1 on the MIRIFUSHORT data separate from MIRIFULONG data, as it saves time this way</span>
<span class="k">for</span> <span class="n">shortfile</span> <span class="ow">in</span> <span class="n">allshortfiles</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">shortfile</span><span class="p">)</span>
    <span class="n">baseshort</span><span class="p">,</span> <span class="n">remaindershort</span> <span class="o">=</span> <span class="n">shortfile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
    
    <span class="c1"># If you run your own simulations, you will need to update these hardcoded files.</span>
    <span class="n">beforestuffshort</span><span class="p">,</span> <span class="n">dateafterstuffshort</span> <span class="o">=</span> <span class="n">shortfile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'20210413_'</span><span class="p">)</span>    
    <span class="n">datestringshort</span><span class="p">,</span> <span class="n">afterstuffshort</span> <span class="o">=</span> <span class="n">dateafterstuffshort</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'_mirisim'</span><span class="p">)</span>
    
    <span class="n">pipe1short</span><span class="o">.</span><span class="n">refpix</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe1short</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="n">baseshort</span> <span class="o">+</span> <span class="n">datestringshort</span>
    
    <span class="n">pipe1short</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">shortfile</span><span class="p">)</span>

<span class="n">pipe1long</span> <span class="o">=</span> <span class="n">Detector1Pipeline</span><span class="p">()</span>

<span class="k">for</span> <span class="n">longfile</span> <span class="ow">in</span> <span class="n">alllongfiles</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">longfile</span><span class="p">)</span>
    <span class="n">baselong</span><span class="p">,</span> <span class="n">remainderlong</span> <span class="o">=</span> <span class="n">longfile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
    
    <span class="c1"># If you run your own simulations, you will need to update these hardcoded files.</span>
    <span class="n">beforestufflong</span><span class="p">,</span> <span class="n">dateafterstufflong</span> <span class="o">=</span> <span class="n">longfile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'20210413_'</span><span class="p">)</span>
    <span class="n">datestringlong</span><span class="p">,</span> <span class="n">afterstufflong</span> <span class="o">=</span> <span class="n">dateafterstufflong</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'_mirisim'</span><span class="p">)</span>
    
    <span class="n">pipe1long</span><span class="o">.</span><span class="n">refpix</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe1long</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="n">baselong</span> <span class="o">+</span> <span class="n">datestringlong</span>
    
    <span class="n">pipe1long</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">longfile</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq1_MIRIFUSHORT_12MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:32,375 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_system_datalvl_0002.rmap      694 bytes  (1 / 180 files) (0 / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:32,537 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_system_calver_0028.rmap    3.4 K bytes  (2 / 180 files) (694 / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:32,690 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_system_0027.imap      385 bytes  (3 / 180 files) (4.1 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:32,841 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_wavelengthrange_0019.rmap    1.4 K bytes  (4 / 180 files) (4.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:32,996 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_wavecorr_0005.rmap      884 bytes  (5 / 180 files) (5.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:33,135 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_superbias_0044.rmap   20.8 K bytes  (6 / 180 files) (6.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:33,312 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_sflat_0015.rmap   17.2 K bytes  (7 / 180 files) (27.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:33,500 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_saturation_0017.rmap    2.0 K bytes  (8 / 180 files) (44.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:33,639 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_refpix_0015.rmap    1.6 K bytes  (9 / 180 files) (46.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:33,781 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_readnoise_0020.rmap    2.3 K bytes  (10 / 180 files) (48.2 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:33,944 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_photom_0013.rmap      958 bytes  (11 / 180 files) (50.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:34,081 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_pathloss_0004.rmap      983 bytes  (12 / 180 files) (51.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:34,239 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_pars-whitelightstep_0001.rmap      777 bytes  (13 / 180 files) (52.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:34,430 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_pars-spec2pipeline_0013.rmap    2.1 K bytes  (14 / 180 files) (53.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:34,582 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_pars-image2pipeline_0008.rmap    1.0 K bytes  (15 / 180 files) (55.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:34,728 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_pars-detector1pipeline_0003.rmap    1.1 K bytes  (16 / 180 files) (56.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:34,912 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_pars-darkpipeline_0003.rmap      872 bytes  (17 / 180 files) (57.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:35,070 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_ote_0022.rmap    1.3 K bytes  (18 / 180 files) (58.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:35,221 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_msaoper_0006.rmap    1.0 K bytes  (19 / 180 files) (59.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:35,367 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_msa_0020.rmap    1.3 K bytes  (20 / 180 files) (60.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:35,510 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_mask_0023.rmap    2.0 K bytes  (21 / 180 files) (62.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:35,702 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_linearity_0017.rmap    1.6 K bytes  (22 / 180 files) (64.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:35,845 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_ipc_0006.rmap      876 bytes  (23 / 180 files) (65.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:35,987 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_ifuslicer_0011.rmap    1.4 K bytes  (24 / 180 files) (66.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:36,126 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_ifupost_0013.rmap    1.4 K bytes  (25 / 180 files) (67.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:36,283 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_ifufore_0011.rmap    1.4 K bytes  (26 / 180 files) (69.2 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:36,424 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_gain_0019.rmap    1.8 K bytes  (27 / 180 files) (70.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:36,578 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_fpa_0021.rmap    1.3 K bytes  (28 / 180 files) (72.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:36,725 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_fore_0019.rmap    5.1 K bytes  (29 / 180 files) (73.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:36,864 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_flat_0015.rmap    3.8 K bytes  (30 / 180 files) (78.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:37,008 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_fflat_0010.rmap    3.4 K bytes  (31 / 180 files) (82.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:37,161 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_extract1d_0014.rmap    2.2 K bytes  (32 / 180 files) (86.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:37,301 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_disperser_0021.rmap    6.0 K bytes  (33 / 180 files) (88.2 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:37,471 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_dflat_0007.rmap    1.1 K bytes  (34 / 180 files) (94.2 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:37,613 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_dark_0040.rmap   21.4 K bytes  (35 / 180 files) (95.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:37,784 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_cubepar_0011.rmap      966 bytes  (36 / 180 files) (116.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:37,925 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_collimator_0019.rmap    1.4 K bytes  (37 / 180 files) (117.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:38,083 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_camera_0019.rmap    1.3 K bytes  (38 / 180 files) (119.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:38,222 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_barshadow_0004.rmap      928 bytes  (39 / 180 files) (120.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:38,364 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_area_0016.rmap    4.6 K bytes  (40 / 180 files) (121.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:38,504 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_apcorr_0009.rmap    5.6 K bytes  (41 / 180 files) (125.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:38,646 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nirspec_0260.imap    5.1 K bytes  (42 / 180 files) (131.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:38,807 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_wfssbkg_0006.rmap    2.3 K bytes  (43 / 180 files) (136.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:38,952 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_wavemap_0007.rmap    1.8 K bytes  (44 / 180 files) (138.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:39,091 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_wavelengthrange_0006.rmap      862 bytes  (45 / 180 files) (140.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:39,249 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_trappars_0004.rmap      753 bytes  (46 / 180 files) (141.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:39,387 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_trapdensity_0004.rmap      774 bytes  (47 / 180 files) (142.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:39,540 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_throughput_0004.rmap      979 bytes  (48 / 180 files) (143.1 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:39,683 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_superbias_0025.rmap    7.2 K bytes  (49 / 180 files) (144.1 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:39,834 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_specwcs_0007.rmap    2.4 K bytes  (50 / 180 files) (151.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:39,973 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_spectrace_0007.rmap    1.9 K bytes  (51 / 180 files) (153.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:40,111 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_specprofile_0007.rmap    2.0 K bytes  (52 / 180 files) (155.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:40,250 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_speckernel_0006.rmap    1.0 K bytes  (53 / 180 files) (157.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:40,408 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_saturation_0014.rmap      761 bytes  (54 / 180 files) (158.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:40,546 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_readnoise_0009.rmap    1.0 K bytes  (55 / 180 files) (159.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:40,686 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_photom_0027.rmap    1.2 K bytes  (56 / 180 files) (160.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:40,824 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_persat_0005.rmap      738 bytes  (57 / 180 files) (161.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:40,960 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pathloss_0003.rmap      758 bytes  (58 / 180 files) (162.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:41,100 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-tweakregstep_0004.rmap    3.1 K bytes  (59 / 180 files) (163.1 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:41,242 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-spec2pipeline_0006.rmap      985 bytes  (60 / 180 files) (166.2 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:41,383 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-sourcecatalogstep_0001.rmap      668 bytes  (61 / 180 files) (167.2 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:41,530 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-outlierdetectionstep_0004.rmap    2.7 K bytes  (62 / 180 files) (167.9 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:41,688 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-jumpstep_0002.rmap    4.1 K bytes  (63 / 180 files) (170.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:41,827 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-image2pipeline_0005.rmap    1.0 K bytes  (64 / 180 files) (174.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:41,966 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-detector1pipeline_0002.rmap    1.0 K bytes  (65 / 180 files) (175.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:42,106 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_pars-darkpipeline_0002.rmap      868 bytes  (66 / 180 files) (176.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:42,244 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_mask_0019.rmap      797 bytes  (67 / 180 files) (177.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:42,471 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_linearity_0021.rmap      894 bytes  (68 / 180 files) (178.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:42,631 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_ipc_0006.rmap      590 bytes  (69 / 180 files) (179.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:42,782 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_gain_0010.rmap      838 bytes  (70 / 180 files) (179.9 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:42,918 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_flat_0023.rmap    5.9 K bytes  (71 / 180 files) (180.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:43,060 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_filteroffset_0007.rmap      844 bytes  (72 / 180 files) (186.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:43,200 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_extract1d_0007.rmap      905 bytes  (73 / 180 files) (187.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:43,342 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_drizpars_0004.rmap      519 bytes  (74 / 180 files) (188.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:43,490 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_distortion_0022.rmap    3.4 K bytes  (75 / 180 files) (188.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:43,631 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_dark_0031.rmap    6.8 K bytes  (76 / 180 files) (192.2 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:43,778 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_area_0014.rmap    2.7 K bytes  (77 / 180 files) (199.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:43,915 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_apcorr_0006.rmap    4.3 K bytes  (78 / 180 files) (201.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:44,058 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_abvegaoffset_0002.rmap    1.3 K bytes  (79 / 180 files) (206.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:44,200 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_niriss_0184.imap    5.1 K bytes  (80 / 180 files) (207.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:44,338 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_wfssbkg_0004.rmap    7.2 K bytes  (81 / 180 files) (212.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:44,480 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_wavelengthrange_0010.rmap      996 bytes  (82 / 180 files) (219.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:44,632 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_tsophot_0003.rmap      896 bytes  (83 / 180 files) (220.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:44,769 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_trappars_0003.rmap    1.6 K bytes  (84 / 180 files) (221.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:44,930 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_trapdensity_0003.rmap    1.6 K bytes  (85 / 180 files) (223.1 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:45,090 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_superbias_0008.rmap    8.9 K bytes  (86 / 180 files) (224.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:45,232 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_specwcs_0018.rmap    7.1 K bytes  (87 / 180 files) (233.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:45,369 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_saturation_0009.rmap    2.2 K bytes  (88 / 180 files) (240.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:45,506 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_readnoise_0014.rmap   17.2 K bytes  (89 / 180 files) (242.9 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:45,682 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_psfmask_0007.rmap   11.0 K bytes  (90 / 180 files) (260.1 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:45,838 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_photom_0012.rmap    4.3 K bytes  (91 / 180 files) (271.1 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:45,974 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_persat_0005.rmap    1.6 K bytes  (92 / 180 files) (275.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:46,116 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-whitelightstep_0003.rmap    1.5 K bytes  (93 / 180 files) (277.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:46,262 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-tweakregstep_0003.rmap    4.5 K bytes  (94 / 180 files) (278.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:46,404 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-spec2pipeline_0006.rmap      985 bytes  (95 / 180 files) (283.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:46,547 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-sourcecatalogstep_0001.rmap      668 bytes  (96 / 180 files) (284.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:46,689 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-outlierdetectionstep_0003.rmap      940 bytes  (97 / 180 files) (284.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:46,829 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-image2pipeline_0003.rmap    1.0 K bytes  (98 / 180 files) (285.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:46,984 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-detector1pipeline_0002.rmap    1.0 K bytes  (99 / 180 files) (286.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:47,122 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_pars-darkpipeline_0002.rmap      868 bytes  (100 / 180 files) (287.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:47,259 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_mask_0010.rmap    2.9 K bytes  (101 / 180 files) (288.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:47,404 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_linearity_0011.rmap    2.4 K bytes  (102 / 180 files) (291.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:47,543 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_ipc_0003.rmap    2.0 K bytes  (103 / 180 files) (293.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:47,689 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_gain_0013.rmap    3.3 K bytes  (104 / 180 files) (295.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:47,831 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_flat_0018.rmap   30.0 K bytes  (105 / 180 files) (299.1 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:48,033 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_filteroffset_0004.rmap    1.4 K bytes  (106 / 180 files) (329.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:48,189 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_extract1d_0004.rmap      842 bytes  (107 / 180 files) (330.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:48,325 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_drizpars_0001.rmap      519 bytes  (108 / 180 files) (331.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:48,464 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_distortion_0028.rmap   22.6 K bytes  (109 / 180 files) (331.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:48,635 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_dark_0040.rmap   22.9 K bytes  (110 / 180 files) (354.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:48,829 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_area_0007.rmap    4.6 K bytes  (111 / 180 files) (377.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:48,968 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_apcorr_0008.rmap    4.3 K bytes  (112 / 180 files) (381.9 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:49,109 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_abvegaoffset_0002.rmap    1.3 K bytes  (113 / 180 files) (386.2 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:49,248 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_nircam_0214.imap    5.0 K bytes  (114 / 180 files) (387.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:49,397 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_wavelengthrange_0025.rmap      929 bytes  (115 / 180 files) (392.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:49,543 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_tsophot_0004.rmap      882 bytes  (116 / 180 files) (393.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:49,685 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_straymask_0009.rmap      987 bytes  (117 / 180 files) (394.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:49,829 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_specwcs_0030.rmap    5.5 K bytes  (118 / 180 files) (395.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:49,984 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_saturation_0013.rmap    1.2 K bytes  (119 / 180 files) (400.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:50,177 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_rscd_0008.rmap    1.0 K bytes  (120 / 180 files) (402.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:50,338 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_resol_0006.rmap      790 bytes  (121 / 180 files) (403.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:50,488 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_reset_0022.rmap    4.2 K bytes  (122 / 180 files) (403.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:50,625 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_regions_0030.rmap    5.2 K bytes  (123 / 180 files) (408.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:50,767 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_readnoise_0018.rmap    1.6 K bytes  (124 / 180 files) (413.2 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:50,906 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_psfmask_0008.rmap    1.6 K bytes  (125 / 180 files) (414.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:51,047 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_photom_0035.rmap    3.7 K bytes  (126 / 180 files) (416.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:51,200 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pathloss_0004.rmap      802 bytes  (127 / 180 files) (420.1 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:51,338 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-whitelightstep_0002.rmap      887 bytes  (128 / 180 files) (420.9 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:51,482 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-tweakregstep_0003.rmap    1.8 K bytes  (129 / 180 files) (421.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:51,626 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-spec3pipeline_0003.rmap      816 bytes  (130 / 180 files) (423.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:51,767 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-spec2pipeline_0007.rmap    1.1 K bytes  (131 / 180 files) (424.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:51,908 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-sourcecatalogstep_0003.rmap    1.9 K bytes  (132 / 180 files) (425.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:52,050 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-outlierdetectionstep_0012.rmap    3.4 K bytes  (133 / 180 files) (427.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:52,187 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-image2pipeline_0006.rmap      979 bytes  (134 / 180 files) (430.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:52,342 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-detector1pipeline_0003.rmap    1.1 K bytes  (135 / 180 files) (431.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:52,479 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_pars-darkpipeline_0002.rmap      860 bytes  (136 / 180 files) (432.9 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:52,624 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_mrsxartcorr_0002.rmap    2.2 K bytes  (137 / 180 files) (433.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:52,776 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_mrsptcorr_0002.rmap    1.9 K bytes  (138 / 180 files) (435.9 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:52,918 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_mask_0018.rmap    1.1 K bytes  (139 / 180 files) (437.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:53,058 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_linearity_0016.rmap    2.4 K bytes  (140 / 180 files) (438.9 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:53,200 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_ipc_0005.rmap      721 bytes  (141 / 180 files) (441.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:53,362 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_gain_0007.rmap      893 bytes  (142 / 180 files) (442.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:53,516 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_fringefreq_0003.rmap    1.4 K bytes  (143 / 180 files) (442.9 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:53,657 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_fringe_0018.rmap    3.7 K bytes  (144 / 180 files) (444.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:53,793 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_flat_0059.rmap   15.4 K bytes  (145 / 180 files) (448.1 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:53,967 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_filteroffset_0023.rmap    1.5 K bytes  (146 / 180 files) (463.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:54,118 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_extract1d_0017.rmap    1.3 K bytes  (147 / 180 files) (464.9 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:54,255 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_drizpars_0002.rmap      511 bytes  (148 / 180 files) (466.2 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:54,400 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_distortion_0037.rmap    4.9 K bytes  (149 / 180 files) (466.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:54,538 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_dark_0026.rmap    5.1 K bytes  (150 / 180 files) (471.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:54,679 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_cubepar_0012.rmap      800 bytes  (151 / 180 files) (476.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:54,821 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_area_0013.rmap      806 bytes  (152 / 180 files) (477.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:54,963 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_apcorr_0009.rmap    4.3 K bytes  (153 / 180 files) (478.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:55,105 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_abvegaoffset_0002.rmap    1.3 K bytes  (154 / 180 files) (482.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:55,258 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_miri_0298.imap    5.2 K bytes  (155 / 180 files) (483.9 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:55,408 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_trappars_0004.rmap      903 bytes  (156 / 180 files) (489.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:55,546 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_trapdensity_0006.rmap      930 bytes  (157 / 180 files) (490.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:55,703 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_superbias_0017.rmap    3.8 K bytes  (158 / 180 files) (490.9 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:55,856 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_saturation_0009.rmap      779 bytes  (159 / 180 files) (494.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:55,995 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_readnoise_0011.rmap    1.3 K bytes  (160 / 180 files) (495.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:56,130 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_photom_0014.rmap    1.1 K bytes  (161 / 180 files) (496.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:56,269 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_persat_0006.rmap      884 bytes  (162 / 180 files) (497.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:56,406 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_pars-tweakregstep_0002.rmap      850 bytes  (163 / 180 files) (498.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:56,561 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_pars-sourcecatalogstep_0001.rmap      636 bytes  (164 / 180 files) (499.6 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:56,699 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_pars-outlierdetectionstep_0001.rmap      654 bytes  (165 / 180 files) (500.2 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:56,840 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_pars-image2pipeline_0005.rmap      974 bytes  (166 / 180 files) (500.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:56,980 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_pars-detector1pipeline_0002.rmap    1.0 K bytes  (167 / 180 files) (501.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:57,120 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_pars-darkpipeline_0002.rmap      856 bytes  (168 / 180 files) (502.9 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:57,262 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_mask_0023.rmap    1.1 K bytes  (169 / 180 files) (503.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:57,403 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_linearity_0015.rmap      925 bytes  (170 / 180 files) (504.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:57,542 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_ipc_0003.rmap      614 bytes  (171 / 180 files) (505.7 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:57,700 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_gain_0010.rmap      890 bytes  (172 / 180 files) (506.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:57,844 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_flat_0009.rmap    1.1 K bytes  (173 / 180 files) (507.2 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:57,994 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_distortion_0009.rmap    1.2 K bytes  (174 / 180 files) (508.3 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:58,134 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_dark_0017.rmap    4.3 K bytes  (175 / 180 files) (509.5 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:58,272 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_area_0010.rmap    1.2 K bytes  (176 / 180 files) (513.8 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:58,419 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_apcorr_0002.rmap    4.1 K bytes  (177 / 180 files) (515.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:58,562 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_abvegaoffset_0002.rmap    1.3 K bytes  (178 / 180 files) (519.1 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:58,715 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_fgs_0102.imap    4.6 K bytes  (179 / 180 files) (520.4 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:58,875 - CRDS - INFO -  Fetching  /home/runner/crds_cache/mappings/jwst/jwst_0916.pmap         580 bytes  (180 / 180 files) (525.0 K / 525.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:22:59,294 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_dark_0044.fits  773.6 M bytes  (1 / 8 files) (0 / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:23:11,639 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_gain_0007.fits    4.2 M bytes  (2 / 8 files) (773.6 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:23:12,128 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_ipc_0008.fits   14.4 K bytes  (3 / 8 files) (777.8 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:23:12,297 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_linearity_0023.fits   46.5 M bytes  (4 / 8 files) (777.8 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:23:13,502 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_mask_0027.fits    4.3 M bytes  (5 / 8 files) (824.4 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:23:13,967 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_readnoise_0050.fits    4.2 M bytes  (6 / 8 files) (828.6 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:23:14,407 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_rscd_0013.fits   37.4 K bytes  (7 / 8 files) (832.9 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:23:14,586 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_saturation_0025.fits    9.5 M bytes  (8 / 8 files) (832.9 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq3_MIRIFUSHORT_12MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq2_MIRIFUSHORT_12MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq4_MIRIFUSHORT_12MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq3_MIRIFUSHORT_12SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq1_MIRIFUSHORT_12SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq2_MIRIFUSHORT_12SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq4_MIRIFUSHORT_12SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq3_MIRIFUSHORT_12LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq1_MIRIFUSHORT_12LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq4_MIRIFUSHORT_12LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq2_MIRIFUSHORT_12LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq3_MIRIFULONG_34MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:33:21,792 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_dark_0057.fits  773.6 M bytes  (1 / 8 files) (0 / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:33:35,366 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_gain_0006.fits    4.2 M bytes  (2 / 8 files) (773.6 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:33:35,875 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_ipc_0007.fits   14.4 K bytes  (3 / 8 files) (777.8 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:33:36,046 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_linearity_0027.fits   46.5 M bytes  (4 / 8 files) (777.8 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:33:37,262 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_mask_0029.fits    4.3 M bytes  (5 / 8 files) (824.4 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:33:37,767 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_readnoise_0064.fits    4.2 M bytes  (6 / 8 files) (828.6 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:33:38,226 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_rscd_0015.fits   37.4 K bytes  (7 / 8 files) (832.9 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:33:38,414 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_saturation_0024.fits    9.5 M bytes  (8 / 8 files) (832.9 M / 842.4 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq1_MIRIFULONG_34MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq4_MIRIFULONG_34MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_123047_mirisim/det_images/det_image_seq2_MIRIFULONG_34MEDIUMexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq4_MIRIFULONG_34SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:37:18,653 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_linearity_0026.fits   46.5 M bytes  (1 / 1 files) (0 / 46.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq3_MIRIFULONG_34SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq2_MIRIFULONG_34SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_120546_mirisim/det_images/det_image_seq1_MIRIFULONG_34SHORTexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq2_MIRIFULONG_34LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:41:00,330 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_linearity_0022.fits   46.5 M bytes  (1 / 1 files) (0 / 46.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq3_MIRIFULONG_34LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq1_MIRIFULONG_34LONGexp1.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>20210413_125354_mirisim/det_images/det_image_seq4_MIRIFULONG_34LONGexp1.fits
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># Execute calwebb_spec2 pipeline. This will overwrite previous reductions.</span>

<span class="c1"># All the local calwebb_detector1 files</span>
<span class="n">allshortfiles2</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">'det_image_*_MIRIFUSHORT_*_rate.fits'</span><span class="p">)</span>
<span class="n">alllongfiles2</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">'det_image_*_MIRIFULONG_*_rate.fits'</span><span class="p">)</span>

<span class="k">for</span> <span class="n">short2file</span> <span class="ow">in</span> <span class="n">allshortfiles2</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">short2file</span><span class="p">)</span>
    <span class="n">pipe2short</span> <span class="o">=</span> <span class="n">Spec2Pipeline</span><span class="p">()</span>
    <span class="n">base2short</span><span class="p">,</span> <span class="n">remainder2short</span> <span class="o">=</span> <span class="n">short2file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
    
    <span class="n">pipe2short</span><span class="o">.</span><span class="n">straylight</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
    
    <span class="c1"># If you run your own simulations, you will need to update these hardcoded files.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">short2file</span> <span class="o">==</span> <span class="s1">'det_image_seq1_MIRIFUSHORT_12LONGexp1125354_rate.fits'</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'this one will have the level 2b cube built'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pipe2short</span><span class="o">.</span><span class="n">cube_build</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2short</span><span class="o">.</span><span class="n">extract_1d</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2short</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="n">base2short</span>
        
    <span class="n">pipe2short</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">short2file</span><span class="p">)</span>

<span class="k">for</span> <span class="n">long2file</span> <span class="ow">in</span> <span class="n">alllongfiles2</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">long2file</span><span class="p">)</span>
    <span class="n">pipe2long</span> <span class="o">=</span> <span class="n">Spec2Pipeline</span><span class="p">()</span>
    <span class="n">base2long</span><span class="p">,</span> <span class="n">remainder2long</span> <span class="o">=</span> <span class="n">long2file</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
    
    <span class="n">pipe2long</span><span class="o">.</span><span class="n">straylight</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="c1"># If you run your own simulations, you will need to update these hardcoded files.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">long2file</span> <span class="o">==</span> <span class="s1">'det_image_seq1_MIRIFULONG_34SHORTexp1120546_rate.fits'</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">'this one will have the level 2b cube built'</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pipe2long</span><span class="o">.</span><span class="n">cube_build</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2long</span><span class="o">.</span><span class="n">extract_1d</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pipe2long</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="n">base2long</span>
    
    <span class="n">pipe2long</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">long2file</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq1_MIRIFUSHORT_12SHORTexp1120546_rate.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:44:41,315 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_distortion_0031.asdf  131.0 K bytes  (1 / 8 files) (0 / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:44:41,615 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_drizpars_0001.fits    8.6 K bytes  (2 / 8 files) (131.0 K / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:44:41,799 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_flat_0749.fits   12.7 M bytes  (3 / 8 files) (139.7 K / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:44:42,409 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_fringe_0046.fits   12.7 M bytes  (4 / 8 files) (12.8 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:44:43,011 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_photom_0052.fits   33.8 M bytes  (5 / 8 files) (25.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:44:43,939 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_regions_0027.asdf   76.1 M bytes  (6 / 8 files) (59.4 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:44:45,938 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_specwcs_0024.asdf   42.1 K bytes  (7 / 8 files) (135.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:44:46,152 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_wavelengthrange_0005.asdf    2.4 K bytes  (8 / 8 files) (135.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq2_MIRIFUSHORT_12MEDIUMexp1123047_rate.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:45:01,767 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_distortion_0030.asdf  131.0 K bytes  (1 / 6 files) (0 / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:45:02,021 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_flat_0763.fits   12.7 M bytes  (2 / 6 files) (131.0 K / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:45:02,732 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_fringe_0034.fits   12.7 M bytes  (3 / 6 files) (12.8 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:45:03,344 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_photom_0064.fits   33.8 M bytes  (4 / 6 files) (25.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:45:04,378 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_regions_0026.asdf   76.1 M bytes  (5 / 6 files) (59.4 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:45:05,996 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_specwcs_0021.asdf   42.1 K bytes  (6 / 6 files) (135.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq3_MIRIFUSHORT_12SHORTexp1120546_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq3_MIRIFUSHORT_12LONGexp1125354_rate.fits
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:45:37,438 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_distortion_0029.asdf  131.1 K bytes  (1 / 6 files) (0 / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:45:37,716 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_flat_0753.fits   12.7 M bytes  (2 / 6 files) (131.1 K / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:45:38,306 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_fringe_0049.fits   12.7 M bytes  (3 / 6 files) (12.8 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:45:38,948 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_photom_0060.fits   33.8 M bytes  (4 / 6 files) (25.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:45:40,032 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_regions_0028.asdf   76.1 M bytes  (5 / 6 files) (59.4 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:45:41,655 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_specwcs_0022.asdf   42.1 K bytes  (6 / 6 files) (135.5 M / 135.5 M bytes)
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq4_MIRIFUSHORT_12SHORTexp1120546_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq3_MIRIFUSHORT_12MEDIUMexp1123047_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq2_MIRIFUSHORT_12LONGexp1125354_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq2_MIRIFUSHORT_12SHORTexp1120546_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq4_MIRIFUSHORT_12MEDIUMexp1123047_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq4_MIRIFUSHORT_12LONGexp1125354_rate.fits
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>det_image_seq1_MIRIFUSHORT_12LONGexp1125354_rate.fits
this one will have the level 2b cube built
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-07-11 14:47:30,605 - CRDS - INFO -  Fetching  /home/runner/crds_cache/references/jwst/miri/jwst_miri_cubepar_0006.fits  489.6 K bytes  (1 / 1 files) (0 / 489.6 K bytes)
</pre>
              </div>
             </div>
             <div class="output stderr highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Traceback (most recent call last):
  File "/usr/share/miniconda/lib/python3.9/site-packages/jwst/pipeline/calwebb_spec2.py", line 117, in process
    result = self.process_exposure_product(
  File "/usr/share/miniconda/lib/python3.9/site-packages/jwst/pipeline/calwebb_spec2.py", line 307, in process_exposure_product
    x1d = self.extract_1d(resampled)
  File "/usr/share/miniconda/lib/python3.9/site-packages/stpipe/step.py", line 470, in run
    args[0][f"meta.cal_step.{self.class_alias}"] = 'SKIPPED'
  File "/usr/share/miniconda/lib/python3.9/site-packages/jwst/datamodels/container.py", line 145, in __setitem__
    self._models[index] = model
TypeError: list indices must be integers or slices, not str
</pre>
              </div>
             </div>
             <div class="output traceback highlight-ipythontb notranslate">
              <div class="highlight">
               <pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">RuntimeError</span><span class="g g-Whitespace">                              </span>Traceback (most recent call last)
<span class="nn">Input In [11],</span> in <span class="ni">&lt;cell line: 7&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="n">pipe2short</span><span class="o">.</span><span class="n">extract_1d</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="n">pipe2short</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="n">base2short</span>
<span class="ne">---&gt; </span><span class="mi">22</span>     <span class="n">pipe2short</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">short2file</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="k">for</span> <span class="n">long2file</span> <span class="ow">in</span> <span class="n">alllongfiles2</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span>     <span class="nb">print</span><span class="p">(</span><span class="n">long2file</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/stpipe/step.py:478,</span> in <span class="ni">Step.run</span><span class="nt">(self, *args)</span>
<span class="g g-Whitespace">    </span><span class="mi">476</span>     <span class="bp">self</span><span class="o">.</span><span class="n">prefetch</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">477</span> <span class="k">try</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">478</span>     <span class="n">step_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">479</span> <span class="k">except</span> <span class="ne">TypeError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span>     <span class="k">if</span> <span class="s2">"process() takes exactly"</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/jwst/pipeline/calwebb_spec2.py:135,</span> in <span class="ni">Spec2Pipeline.process</span><span class="nt">(self, data)</span>
<span class="g g-Whitespace">    </span><span class="mi">132</span>             <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">134</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failures</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fail_on_exception</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">135</span>     <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s1">'</span><span class="se">\n</span><span class="s1">'</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">failures</span><span class="p">))</span>
<span class="g g-Whitespace">    </span><span class="mi">137</span> <span class="c1"># We're done</span>
<span class="g g-Whitespace">    </span><span class="mi">138</span> <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">'Ending calwebb_spec2'</span><span class="p">)</span>

<span class="ne">RuntimeError</span>: Traceback (most recent call last):
  <span class="n">File</span> <span class="s2">"/usr/share/miniconda/lib/python3.9/site-packages/jwst/pipeline/calwebb_spec2.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">117</span><span class="p">,</span> <span class="ow">in</span> <span class="n">process</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_exposure_product</span><span class="p">(</span>
  <span class="n">File</span> <span class="s2">"/usr/share/miniconda/lib/python3.9/site-packages/jwst/pipeline/calwebb_spec2.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">307</span><span class="p">,</span> <span class="ow">in</span> <span class="n">process_exposure_product</span>
    <span class="n">x1d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">extract_1d</span><span class="p">(</span><span class="n">resampled</span><span class="p">)</span>
  <span class="n">File</span> <span class="s2">"/usr/share/miniconda/lib/python3.9/site-packages/stpipe/step.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">470</span><span class="p">,</span> <span class="ow">in</span> <span class="n">run</span>
    <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="sa">f</span><span class="s2">"meta.cal_step.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">class_alias</span><span class="si">}</span><span class="s2">"</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'SKIPPED'</span>
  <span class="n">File</span> <span class="s2">"/usr/share/miniconda/lib/python3.9/site-packages/jwst/datamodels/container.py"</span><span class="p">,</span> <span class="n">line</span> <span class="mi">145</span><span class="p">,</span> <span class="ow">in</span> <span class="fm">__setitem__</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_models</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">model</span>
<span class="ne">TypeError</span>: list indices must be integers or slices, not str
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># If you run your own simulations, you will need to update these hardcoded files.</span>
<span class="n">l_cube_file</span> <span class="o">=</span> <span class="s1">'det_image_seq1_MIRIFULONG_34SHORTexp1120546_s3d.fits'</span>
<span class="n">s_cube_file</span> <span class="o">=</span> <span class="s1">'det_image_seq1_MIRIFUSHORT_12LONGexp1125354_s3d.fits'</span>

<span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">s_cube_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">hdu_s_cube</span><span class="p">:</span>
    <span class="n">s_cube</span> <span class="o">=</span> <span class="n">hdu_s_cube</span><span class="p">[</span><span class="s1">'SCI'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="n">s_med_cube</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">s_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">s_cube</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
            <span class="n">s_med_cube</span><span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">s_cube</span><span class="p">[:,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">])</span>

<span class="n">mean</span><span class="p">,</span> <span class="n">median</span><span class="p">,</span> <span class="n">std</span> <span class="o">=</span> <span class="n">sigma_clipped_stats</span><span class="p">(</span><span class="n">s_med_cube</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>

<span class="c1"># Get a list of sources using a dedicated source detection algorithm</span>
<span class="c1"># Find sources at least 3* background (typically)</span>

<span class="n">daofind</span> <span class="o">=</span> <span class="n">DAOStarFinder</span><span class="p">(</span><span class="n">fwhm</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">3.</span><span class="o">*</span><span class="n">std</span><span class="p">)</span>
<span class="n">sources</span> <span class="o">=</span> <span class="n">daofind</span><span class="p">(</span><span class="n">s_med_cube</span><span class="o">-</span><span class="n">median</span><span class="p">)</span> 
<span class="nb">print</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2"> Number of sources in field: "</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sources</span><span class="p">))</span>

<span class="c1"># Positions in pixels</span>
<span class="n">positions</span> <span class="o">=</span> <span class="n">Table</span><span class="p">([</span><span class="n">sources</span><span class="p">[</span><span class="s1">'xcentroid'</span><span class="p">],</span> <span class="n">sources</span><span class="p">[</span><span class="s1">'ycentroid'</span><span class="p">]])</span>

<span class="c1"># Convert to RA &amp; Dec (ICRS)</span>
<span class="n">peakpixval</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sources</span><span class="p">[</span><span class="s1">'xcentroid'</span><span class="p">]))</span>
<span class="k">for</span> <span class="n">count_s</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sources</span><span class="p">):</span>
    <span class="n">peakpixval</span><span class="p">[</span><span class="n">count_s</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_med_cube</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">sources</span><span class="p">[</span><span class="s1">'xcentroid'</span><span class="p">][</span><span class="n">count_s</span><span class="p">])),</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">sources</span><span class="p">[</span><span class="s1">'ycentroid'</span><span class="p">][</span><span class="n">count_s</span><span class="p">]))]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'peak pixel x ='</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sources</span><span class="p">[</span><span class="s1">'xcentroid'</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">peakpixval</span><span class="p">)])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'peak pixel y ='</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sources</span><span class="p">[</span><span class="s1">'ycentroid'</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">peakpixval</span><span class="p">)])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">s_med_cube</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sources</span><span class="p">[</span><span class="s1">'xcentroid'</span><span class="p">],</span> <span class="n">sources</span><span class="p">[</span><span class="s1">'ycentroid'</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s2">"red"</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">"+"</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">sources</span><span class="p">[</span><span class="s1">'xcentroid'</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">peakpixval</span><span class="p">)],</span> <span class="n">sources</span><span class="p">[</span><span class="s1">'ycentroid'</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">peakpixval</span><span class="p">)],</span> <span class="n">c</span><span class="o">=</span><span class="s1">'black'</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">'+'</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">f0</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">s_cube_file</span><span class="p">)</span>
<span class="n">w0</span> <span class="o">=</span> <span class="n">WCS</span><span class="p">(</span><span class="n">f0</span><span class="p">[(</span><span class="s1">'sci'</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span><span class="o">.</span><span class="n">header</span><span class="p">,</span> <span class="n">f0</span><span class="p">)</span>
<span class="n">f0</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="n">radec</span> <span class="o">=</span> <span class="n">w0</span><span class="o">.</span><span class="n">all_pix2world</span><span class="p">([</span><span class="n">sources</span><span class="p">[</span><span class="s1">'xcentroid'</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">peakpixval</span><span class="p">)]],</span> <span class="p">[</span><span class="n">sources</span><span class="p">[</span><span class="s1">'ycentroid'</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">peakpixval</span><span class="p">)]],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Take the brightest source flux and take that to be your primary point source for extraction</span>
<span class="n">ra_ptsrc</span> <span class="o">=</span> <span class="n">radec</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">dec_ptsrc</span> <span class="o">=</span> <span class="n">radec</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># Due to the way the pipeline currently extracts Level3 data, you must update the headers to be centered on the point source of your choosing from the step above.</span>
<span class="n">all_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">'det_image_*_cal.fits'</span><span class="p">)</span>
<span class="n">targra</span> <span class="o">=</span> <span class="n">ra_ptsrc</span>
<span class="n">targdec</span> <span class="o">=</span> <span class="n">dec_ptsrc</span>
<span class="k">for</span> <span class="n">thisfile</span> <span class="ow">in</span> <span class="n">all_files</span><span class="p">:</span>
    <span class="n">base</span><span class="p">,</span> <span class="n">remainder</span> <span class="o">=</span> <span class="n">thisfile</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
    <span class="n">outfilename</span> <span class="o">=</span> <span class="n">base</span> <span class="o">+</span> <span class="s1">'_fix.'</span> <span class="o">+</span> <span class="n">remainder</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">outfilename</span><span class="p">)</span>
    
    <span class="k">with</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">thisfile</span><span class="p">)</span> <span class="k">as</span> <span class="n">hduthis</span><span class="p">:</span>
        <span class="n">hduthis</span><span class="p">[</span><span class="s1">'SCI'</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">'SRCTYPE'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'POINT'</span>
        <span class="n">hduthis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">'TARG_RA'</span><span class="p">]</span> <span class="o">=</span> <span class="n">targra</span> 
        <span class="n">hduthis</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">header</span><span class="p">[</span><span class="s1">'TARG_DEC'</span><span class="p">]</span> <span class="o">=</span> <span class="n">targdec</span>
        <span class="n">hduthis</span><span class="o">.</span><span class="n">writeto</span><span class="p">(</span><span class="n">outfilename</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># set up needed reference file(s) for spec3</span>

<span class="n">file_all_list</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">'det_image_*_cal.fits'</span><span class="p">)</span>

<span class="n">asnall</span> <span class="o">=</span> <span class="n">asn_from_list</span><span class="o">.</span><span class="n">asn_from_list</span><span class="p">(</span><span class="n">file_all_list</span><span class="p">,</span> <span class="n">rule</span><span class="o">=</span><span class="n">DMS_Level3_Base</span><span class="p">,</span> <span class="n">product_name</span><span class="o">=</span><span class="s1">'combine_dithers_all_exposures'</span><span class="p">)</span>

<span class="n">asnallfile</span> <span class="o">=</span> <span class="s1">'for_spec3_all.json'</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">asnallfile</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fpall</span><span class="p">:</span>
    <span class="n">fpall</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">asnall</span><span class="o">.</span><span class="n">dump</span><span class="p">()[</span><span class="mi">1</span><span class="p">])</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># Execute calwebb_spec3 pipeline.  This will overwrite previous reductions.</span>

<span class="n">pipe3ss</span> <span class="o">=</span> <span class="n">Spec3Pipeline</span><span class="p">()</span>
<span class="n">pipe3ss</span><span class="o">.</span><span class="n">master_background</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3ss</span><span class="o">.</span><span class="n">mrs_imatch</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3ss</span><span class="o">.</span><span class="n">outlier_detection</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3ss</span><span class="o">.</span><span class="n">resample_spec</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3ss</span><span class="o">.</span><span class="n">combine_1d</span><span class="o">.</span><span class="n">skip</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">pipe3ss</span><span class="o">.</span><span class="n">use_source_posn</span> <span class="o">=</span> <span class="s1">'True'</span>
<span class="n">pipe3ss</span><span class="o">.</span><span class="n">subtract_background</span> <span class="o">=</span> <span class="s1">'True'</span>
<span class="n">pipe3ss</span><span class="o">.</span><span class="n">output_file</span> <span class="o">=</span> <span class="s1">'allspec3'</span>
<span class="n">pipe3ss</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">asnallfile</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
          <section id="now-to-detect-the-point-source-in-the-detector-image-plane-and-extract-and-plot-the-spectra-for-each-source">
           <h2>
            Now to detect the point source in the detector image plane and extract and plot the spectra for each source
            <a class="headerlink" href="#now-to-detect-the-point-source-in-the-detector-image-plane-and-extract-and-plot-the-spectra-for-each-source" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            Steps involved:
           </p>
           <ol class="simple">
            <li>
             <p>
              Convert MJy/sr to Jy
             </p>
            </li>
            <li>
             <p>
              Determine PSF centroid on the detector plane, if this one is not provided
             </p>
            </li>
            <li>
             <p>
              Based on the across-slice position of the point source, determine the transmission and wavelength correction factors and apply correction
             </p>
            </li>
            <li>
             <p>
              Project MRS PSF model from 3D spectral cube to 2D detector image plane
             </p>
            </li>
            <li>
             <p>
              Determine pixel weights based on PSF and pixel variance information
             </p>
            </li>
            <li>
             <p>
              Perform detector-based spectral extraction
             </p>
            </li>
            <li>
             <p>
              If MRS spectral band is 3A (~12.2 micron), determine diffraction grating second order spectral leak contribution (from ~6.1 microns) and apply correction.
             </p>
            </li>
           </ol>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># centroid placeholders in local MRS coordinates</span>
<span class="n">alpha_centers2D_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">beta_centers2D_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="c1"># spectrum placeholder</span>
<span class="n">isolambda_spec_optimal</span> <span class="o">=</span> <span class="p">{}</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># define spectral band</span>
<span class="n">band</span> <span class="o">=</span> <span class="s1">'1B'</span>
<span class="n">ch</span> <span class="o">=</span> <span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">if</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'1'</span><span class="p">,</span> <span class="s1">'2'</span><span class="p">]:</span>
    <span class="n">det_id</span> <span class="o">=</span> <span class="s1">'MIRIFUSHORT'</span>
    <span class="n">band_combo</span> <span class="o">=</span> <span class="s1">'12'</span>
<span class="k">elif</span> <span class="n">ch</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'3'</span><span class="p">,</span> <span class="s1">'4'</span><span class="p">]:</span>
    <span class="n">det_id</span> <span class="o">=</span> <span class="s1">'MIRIFULONG'</span>
    <span class="n">band_combo</span> <span class="o">=</span> <span class="s1">'34'</span>
    
<span class="k">if</span> <span class="n">band</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'A'</span><span class="p">:</span>
    <span class="n">band_id</span> <span class="o">=</span> <span class="s1">'short'</span>
    <span class="n">band_id_nr</span> <span class="o">=</span> <span class="mi">1</span>
<span class="k">elif</span> <span class="n">band</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'B'</span><span class="p">:</span>
    <span class="n">band_id</span> <span class="o">=</span> <span class="s1">'medium'</span>
    <span class="n">band_id_nr</span> <span class="o">=</span> <span class="mi">2</span>
<span class="k">elif</span> <span class="n">band</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s1">'C'</span><span class="p">:</span>
    <span class="n">band_id</span> <span class="o">=</span> <span class="s1">'long'</span>
    <span class="n">band_id_nr</span> <span class="o">=</span> <span class="mi">3</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># load data file SCI and ERR extensions</span>
<span class="k">if</span> <span class="n">band</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'1A'</span><span class="p">,</span> <span class="s1">'2A'</span><span class="p">]:</span>
    <span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'det_image_seq1_MIRIFUSHORT_12SHORTexp1120546_cal.fits'</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/jwst_miri_photom_0052.fits'</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">hdu_photom</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>  
<span class="k">elif</span> <span class="n">band</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'1B'</span><span class="p">,</span> <span class="s1">'2B'</span><span class="p">]:</span>
    <span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'det_image_seq1_MIRIFUSHORT_12MEDIUMexp1123047_cal.fits'</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/jwst_miri_photom_0064.fits'</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">hdu_photom</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">band</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'1C'</span><span class="p">,</span> <span class="s1">'2C'</span><span class="p">]:</span>
    <span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'det_image_seq1_MIRIFUSHORT_12LONGexp1125354_cal.fits'</span><span class="p">)</span>
    <span class="n">fn</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/jwst_miri_photom_0060.fits'</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">hdu_photom</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">sci_img</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="s1">'SCI'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">err_img</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="s1">'ERR'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># load photom PIXSIZ extension to convert MJy/sr to Jansky</span>
<span class="n">pixsiz_img</span> <span class="o">=</span> <span class="n">hdu_photom</span><span class="p">[</span><span class="s1">'PIXSIZ'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>

<span class="c1"># convert MJy/sr to Jansky for both the SCI and ERR extensions</span>
<span class="n">sci_img</span> <span class="o">=</span> <span class="n">sci_img</span><span class="o">*</span><span class="n">pixsiz_img</span> <span class="c1"># MJy/sr --&gt; MJy</span>
<span class="n">err_img</span> <span class="o">=</span> <span class="n">err_img</span><span class="o">*</span><span class="n">pixsiz_img</span> <span class="c1"># MJy/sr --&gt; MJy</span>

<span class="n">sci_img</span> <span class="o">=</span> <span class="n">sci_img</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span> <span class="c1"># MJy --&gt; Jy</span>
<span class="n">err_img</span> <span class="o">=</span> <span class="n">err_img</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="mi">6</span> <span class="c1"># MJy --&gt; Jy</span>

<span class="c1"># close opened fits files</span>
<span class="n">hdu</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="n">hdu_photom</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Point source corrections CDP values</span>
<span class="c1"># Transmission vs across-slice correction</span>
<span class="n">fn</span> <span class="o">=</span> <span class="n">download_file</span><span class="p">(</span><span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/MRS_Mstar_analysis/miri-ifuptcor-59645.fits'</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
<span class="n">list_channels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'CH1'</span><span class="p">,</span> <span class="s1">'CH2'</span><span class="p">,</span> <span class="s1">'CH3'</span><span class="p">,</span> <span class="s1">'CH4'</span><span class="p">]</span>
<span class="n">lamb_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s1">'TRACOR'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'WAVE_MIN'</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">lamb_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s1">'TRACOR'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'WAVE_MAX'</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Tcen_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s1">'TRACOR'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'T_WMIN_CENTRE'</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Tcen_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s1">'TRACOR'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'T_WMAX_CENTRE'</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Tedg_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s1">'TRACOR'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'T_WMIN_EDGE'</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">Tedg_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s1">'TRACOR'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'T_WMAX_EDGE'</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>

<span class="c1"># Wavelength offset vs across-slice correction</span>
<span class="n">bands</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="s1">'WAVCORR_OPTICAL'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'SUB_BAND'</span><span class="p">]</span>
<span class="n">x_slice_min_LT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s1">'WAVCORR_XSLICE'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'XSLICE_MIN'</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># micron * arcsec^-1</span>
<span class="n">x_slice_max_LT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s1">'WAVCORR_XSLICE'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'XSLICE_MAX'</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">8</span><span class="p">)</span> <span class="c1"># micron * arcsec^-1</span>

<span class="n">beta_slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s1">'WAVCORR_OPTICAL'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'BETA_SLICE'</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>

<span class="n">wave_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s1">'WAVCORR_OPTICAL'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'WAVE_MIN'</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">wave_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s1">'WAVCORR_OPTICAL'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'WAVE_MAX'</span><span class="p">],</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">srp_min</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="s1">'WAVCORR_OPTICAL'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'SRP_MIN'</span><span class="p">]</span>
<span class="n">srp_max</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="s1">'WAVCORR_OPTICAL'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'SRP_MAX'</span><span class="p">]</span>

<span class="n">beta_off</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">hdu</span><span class="p">[</span><span class="s1">'WAVCORR_SHIFT'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'BETA_OFF'</span><span class="p">],</span> <span class="mi">3</span><span class="p">)</span>
<span class="n">Delta_s_min_LT</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="s1">'WAVCORR_SHIFT'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'DS_MIN'</span><span class="p">]</span>
<span class="n">Delta_s_max_LT</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="s1">'WAVCORR_SHIFT'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'DS_MAX'</span><span class="p">]</span>

<span class="c1"># Spectral leak (second order spectral response in form of an optical system transmission)</span>
<span class="n">sys_transm_img</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="s1">'SCI'</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
<span class="n">hdu</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># define path to distortion (D2C) files (and create folder if it doesn't exist)</span>
<span class="n">workDir</span> <span class="o">=</span> <span class="s1">'./miri_devel/'</span>
<span class="n">cdpDir</span> <span class="o">=</span> <span class="n">workDir</span><span class="o">+</span><span class="s1">'cdp_data/'</span>
<span class="n">d2cDir</span> <span class="o">=</span> <span class="n">cdpDir</span><span class="o">+</span><span class="s1">'DISTORTION/'</span>

<span class="c1"># Evaluate largest distortion solution on the 2D detector (lowest slice transmission)</span>
<span class="n">d2cMaps</span> <span class="o">=</span> <span class="n">d2cMapping</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">d2cDir</span><span class="p">,</span> <span class="n">slice_transmission</span><span class="o">=</span><span class="s1">'10pc'</span><span class="p">,</span> <span class="n">fileversion</span><span class="o">=</span><span class="s2">"8B.05.02"</span><span class="p">)</span>
<span class="n">sliceMap</span> <span class="o">=</span> <span class="n">d2cMaps</span><span class="p">[</span><span class="s1">'sliceMap'</span><span class="p">]</span>
<span class="n">lambdaMap</span> <span class="o">=</span> <span class="n">d2cMaps</span><span class="p">[</span><span class="s1">'lambdaMap'</span><span class="p">]</span>
<span class="n">alphaMap</span> <span class="o">=</span> <span class="n">d2cMaps</span><span class="p">[</span><span class="s1">'alphaMap'</span><span class="p">]</span>
<span class="n">betaMap</span> <span class="o">=</span> <span class="n">d2cMaps</span><span class="p">[</span><span class="s1">'betaMap'</span><span class="p">]</span>
<span class="n">nslices</span> <span class="o">=</span> <span class="n">d2cMaps</span><span class="p">[</span><span class="s1">'nslices'</span><span class="p">]</span>

<span class="c1"># some auxiliary data</span>
<span class="n">det_dims</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1032</span><span class="p">)</span>
<span class="n">bandlims</span> <span class="o">=</span> <span class="p">[</span><span class="n">lambdaMap</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">lambdaMap</span><span class="p">)]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">lambdaMap</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">lambdaMap</span><span class="p">)]</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>

<span class="c1"># spectral grid based on which the point source centroid is determined</span>
<span class="n">lambmin</span> <span class="o">=</span> <span class="n">mrs_aux</span><span class="p">(</span><span class="n">band</span><span class="p">)[</span><span class="mi">3</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lambmax</span> <span class="o">=</span> <span class="n">mrs_aux</span><span class="p">(</span><span class="n">band</span><span class="p">)[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
<span class="n">lambcens</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lambmin</span><span class="p">,</span> <span class="n">lambmax</span><span class="p">,</span> <span class="p">(</span><span class="n">lambmax</span><span class="o">-</span><span class="n">lambmin</span><span class="p">)</span><span class="o">/</span><span class="mf">1024.</span><span class="p">)</span>
<span class="n">lambfwhms</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lambcens</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="p">(</span><span class="n">lambmax</span><span class="o">-</span><span class="n">lambmin</span><span class="p">)</span><span class="o">/</span><span class="mf">1024.</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># Determine point source centroid</span>
<span class="n">sign_amp2D</span><span class="p">,</span> <span class="n">alpha_centers2D</span><span class="p">,</span> <span class="n">beta_centers2D</span><span class="p">,</span> <span class="n">sigma_alpha2D</span><span class="p">,</span> <span class="n">sigma_beta2D</span><span class="p">,</span> <span class="n">bkg_amp2D</span> <span class="o">=</span> <span class="n">point_source_centroiding</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">sci_img</span><span class="p">,</span> <span class="n">d2cMaps</span><span class="p">,</span> <span class="n">spec_grid</span><span class="o">=</span><span class="p">[</span><span class="n">lambcens</span><span class="p">,</span> <span class="n">lambfwhms</span><span class="p">],</span> <span class="n">fit</span><span class="o">=</span><span class="s1">'2D'</span><span class="p">)</span>

<span class="n">alpha_centers2D_dict</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">alpha_centers2D</span>
<span class="n">beta_centers2D_dict</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">beta_centers2D</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># Diagnostic plot for the point source centroid: We care about the mean value of alpha, beta. These will be used for the PSF projection on the detector plane.</span>
<span class="c1"># Conceivably a PSF residual algorithm could be coded, to determine the alpha,beta centroid more accurately still.</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lambcens</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">],</span> <span class="n">alpha_centers2D_dict</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lambcens</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lambcens</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">alpha_centers2D_dict</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">]),</span> <span class="s1">'k--'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lambcens</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">],</span> <span class="n">beta_centers2D_dict</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">])</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lambcens</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lambcens</span><span class="p">[</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">]))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">beta_centers2D_dict</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">]),</span> <span class="s1">'k--'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Along-slice position $\alpha$ [arcsec]'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">'MRS Band </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band</span><span class="p">))</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Wavelength [$\mu m$]'</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Across-slice position $\beta$ [arcsec]'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
         </section>
         <section class="tex2jax_ignore mathjax_ignore" id="determine-transmission-factor-corresponding-to-source-across-slice-position-beta-the-signal-should-be-multiplied-by-this-factor">
          <h1>
           Determine transmission factor corresponding to source across-slice position
           <span class="math notranslate nohighlight">
            \(\beta\)
           </span>
           , the signal should be multiplied by this factor
           <a class="headerlink" href="#determine-transmission-factor-corresponding-to-source-across-slice-position-beta-the-signal-should-be-multiplied-by-this-factor" title="Permalink to this headline">
            #
           </a>
          </h1>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">beta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">beta_centers2D_dict</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">])</span>
<span class="n">wav_array</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">Tb_min</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">Tb_max</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">Tdiff_point</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">Tdiff_extended</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">'CH1'</span><span class="p">,</span> <span class="s1">'CH2'</span><span class="p">,</span> <span class="s1">'CH3'</span><span class="p">,</span> <span class="s1">'CH4'</span><span class="p">]):</span>
    <span class="n">wav_array</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lamb_min</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lamb_max</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mf">0.01</span><span class="p">)</span> <span class="c1"># micron</span>
    <span class="n">Tb_min</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tcen_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tedg_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">Tcen_min</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">Tb_max</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tcen_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">abs</span><span class="p">(</span><span class="n">beta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tedg_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">Tcen_max</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    
    <span class="n">Tdiff_point</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">Tb_min</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">+</span> <span class="p">((</span><span class="n">wav_array</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">-</span><span class="n">lamb_min</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">lamb_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">lamb_min</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">*</span> <span class="p">(</span><span class="n">Tb_max</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">-</span><span class="n">Tb_min</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="n">Tdiff_extended</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">Tcen_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">Tedg_max</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="mf">2.</span> <span class="o">+</span> <span class="p">((</span><span class="n">wav_array</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">-</span><span class="n">lamb_min</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">lamb_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">lamb_min</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">*</span> <span class="p">((</span><span class="n">Tcen_max</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">Tedg_max</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">Tcen_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="n">Tedg_min</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">/</span> <span class="mf">2.</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'CH1'</span><span class="p">,</span> <span class="s1">'CH2'</span><span class="p">,</span> <span class="s1">'CH3'</span><span class="p">,</span> <span class="s1">'CH4'</span><span class="p">]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav_array</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">Tdiff_point</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s1">'k'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'dashed'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav_array</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">Tdiff_extended</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s1">'k'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Wavelength [$\mu m$]'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Transmission correction [%]'</span><span class="p">)</span>
<span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'dashed'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'Point source correction ($\beta$ = </span><span class="si">{}</span><span class="s1"> arcsec)'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="mi">2</span><span class="p">))),</span>
                   <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'solid'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Extended source correction'</span><span class="p">)]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_elements</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'CH1'</span><span class="p">,</span> <span class="s1">'CH2'</span><span class="p">,</span> <span class="s1">'CH3'</span><span class="p">,</span> <span class="s1">'CH4'</span><span class="p">]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav_array</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">Tdiff_point</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">/</span><span class="n">Tdiff_extended</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="s1">'k'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'dotted'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Wavelength [$\mu m$]'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\zeta$ = Tdiff_point / Tdiff_extended'</span><span class="p">)</span>
<span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">'k'</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">'dotted'</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">'$\beta$ = </span><span class="si">{}</span><span class="s1"> arcsec'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">beta</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_elements</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">key</span> <span class="o">=</span> <span class="s1">'CH'</span> <span class="o">+</span> <span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">ip_zeta</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">wav_array</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">Tdiff_point</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">/</span><span class="n">Tdiff_extended</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">kind</span><span class="o">=</span><span class="s1">'linear'</span><span class="p">)</span>

<span class="n">zetaMap</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">lambdaMap</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">sel</span> <span class="o">=</span> <span class="p">(</span><span class="n">sliceMap</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sliceMap</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">zetaMap</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span> <span class="o">=</span> <span class="n">ip_zeta</span><span class="p">(</span><span class="n">lambdaMap</span><span class="p">[</span><span class="n">sel</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">zetaMap</span><span class="p">,</span> <span class="n">vmin</span><span class="o">=</span><span class="n">zetaMap</span><span class="p">[</span><span class="n">zetaMap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">vmax</span><span class="o">=</span><span class="n">zetaMap</span><span class="p">[</span><span class="n">zetaMap</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">r</span><span class="s1">'$\zeta$'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X-pixel'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Y-pixel'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># Apply correction to science and error signal</span>
<span class="n">sci_img</span> <span class="o">*=</span> <span class="n">zetaMap</span>
<span class="n">err_img</span> <span class="o">*=</span> <span class="n">zetaMap</span>
</pre>
             </div>
            </div>
           </div>
          </div>
         </section>
         <section class="tex2jax_ignore mathjax_ignore" id="determine-wavelength-correction-due-to-source-across-slice-position-beta">
          <h1>
           Determine wavelength correction due to source across-slice position
           <span class="math notranslate nohighlight">
            \(\beta\)
           </span>
           <a class="headerlink" href="#determine-wavelength-correction-due-to-source-across-slice-position-beta" title="Permalink to this headline">
            #
           </a>
          </h1>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">beta_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">beta_centers2D_dict</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">])</span>

<span class="c1"># determine unique beta values for each slice</span>
<span class="n">sel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">sliceMap</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sliceMap</span> <span class="o">&lt;</span> <span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
<span class="n">unique_betas</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">betaMap</span><span class="p">[</span><span class="n">sel</span><span class="p">])</span>

<span class="c1"># find index of value nearest to beta center in the unique_betas array</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">unique_betas</span><span class="o">-</span><span class="n">beta_center</span><span class="p">)</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span> 
<span class="n">source_center_slice</span> <span class="o">=</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span>

<span class="c1"># find index of value nearest to beta center in the unique_betas array</span>
<span class="n">beta_brightest_slice</span> <span class="o">=</span> <span class="n">unique_betas</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>

<span class="c1"># Point source offset from slice centre (-0.5 &lt; tgtOffset &lt; +0.5)</span>
<span class="n">betaOffsetSlice0</span> <span class="o">=</span> <span class="p">(</span><span class="n">beta_center</span><span class="o">-</span><span class="n">beta_brightest_slice</span><span class="p">)</span><span class="o">/</span><span class="n">d2cMaps</span><span class="p">[</span><span class="s1">'bdel'</span><span class="p">]</span> 

<span class="c1"># Define input data characteristics.</span>
<span class="n">nSubBands</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">optIndex</span> <span class="o">=</span> <span class="n">nSubBands</span> <span class="o">*</span> <span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">band_id_nr</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">betaSlice</span> <span class="o">=</span> <span class="n">beta_slice</span><span class="p">[</span><span class="n">optIndex</span><span class="p">]</span>

<span class="c1"># Compute wavelength correction map (based on MIRI-DD-00006-ATC issue 4)</span>
<span class="c1"># The correction is valid only for the two slices nearest to the brightest slice</span>
<span class="n">wavcorr_across_slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1032</span><span class="p">))</span>
<span class="k">for</span> <span class="n">islice</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">):</span>
    <span class="n">sel</span> <span class="o">=</span> <span class="p">(</span><span class="n">sliceMap</span> <span class="o">==</span> <span class="mi">100</span><span class="o">*</span><span class="nb">int</span><span class="p">(</span><span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="n">source_center_slice</span><span class="o">+</span><span class="n">islice</span><span class="p">)</span>
    <span class="n">tgtWave</span> <span class="o">=</span> <span class="n">lambdaMap</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span>
    
    <span class="c1"># Step 1. Find target offset from slice centre in beta direction'</span>
    <span class="n">betaOff</span> <span class="o">=</span> <span class="n">betaOffsetSlice0</span> <span class="o">-</span> <span class="n">islice</span>

    <span class="c1"># Step 2. Calculate Xslice</span>
    <span class="n">xSlice</span> <span class="o">=</span> <span class="n">betaSlice</span> <span class="o">/</span> <span class="n">tgtWave</span>
    <span class="n">xSliceref</span> <span class="o">=</span> <span class="n">betaSlice</span> <span class="o">/</span> <span class="p">((</span><span class="n">lambmin</span><span class="o">+</span><span class="n">lambmax</span><span class="p">)</span><span class="o">/</span><span class="mf">2.</span><span class="p">)</span> <span class="c1"># We define a reference xslice for the entire band to avoid jumps between beta_off values as a function of wavelength in Step 4.</span>

    <span class="c1"># Step 3. Derive scaled offset</span>
    <span class="n">betaOff_scaled</span> <span class="o">=</span> <span class="n">betaOff</span> <span class="o">*</span> <span class="n">xSlice</span>
    <span class="n">betaOff_scaled_ref</span> <span class="o">=</span> <span class="n">betaOff</span> <span class="o">*</span> <span class="n">xSliceref</span>  <span class="c1"># We define a reference betaOff_scaled_ref for the entire band to avoid jumps between beta_off values as a function of wavelength in Step 4.</span>

    <span class="c1"># Step 4. Find look-up table betaOff_LT values which bracket betaOFF_scaled</span>
    <span class="n">nShiftValues</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">beta_off</span><span class="p">)</span>
    <span class="n">betaSign</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">betaOff</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">):</span>
        <span class="n">betaSign</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">betaOff_scaled</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">betaOff_scaled</span>
    <span class="n">indexA</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># Index in look up table_WCORR_SHIFT </span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nShiftValues</span><span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">betaOff_scaled_ref</span> <span class="o">&lt;</span> <span class="n">beta_off</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">indexA</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">indexA</span> <span class="o">=</span> <span class="n">j</span><span class="o">-</span><span class="mi">1</span>
    <span class="n">indexB</span> <span class="o">=</span> <span class="n">indexA</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">betaOff_LT_A</span> <span class="o">=</span> <span class="n">beta_off</span><span class="p">[</span><span class="n">indexA</span><span class="p">]</span>
    <span class="n">betaOff_LT_B</span> <span class="o">=</span> <span class="n">beta_off</span><span class="p">[</span><span class="n">indexB</span><span class="p">]</span>

    <span class="c1"># Step 5. Find ds_min and ds_max</span>
    <span class="n">betaFactor</span> <span class="o">=</span> <span class="p">(</span><span class="n">betaOff_scaled</span> <span class="o">-</span> <span class="n">betaOff_LT_A</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">betaOff_LT_B</span> <span class="o">-</span> <span class="n">betaOff_LT_A</span><span class="p">)</span> 

    <span class="n">ds_minA</span> <span class="o">=</span> <span class="n">Delta_s_min_LT</span><span class="p">[</span><span class="n">indexA</span><span class="p">]</span>
    <span class="n">ds_minB</span> <span class="o">=</span> <span class="n">Delta_s_min_LT</span><span class="p">[</span><span class="n">indexB</span><span class="p">]</span>
    <span class="n">ds_min</span> <span class="o">=</span> <span class="n">ds_minA</span> <span class="o">+</span> <span class="n">betaFactor</span> <span class="o">*</span> <span class="p">(</span><span class="n">ds_minB</span> <span class="o">-</span> <span class="n">ds_minA</span><span class="p">)</span>
    <span class="n">ds_min</span> <span class="o">=</span> <span class="n">betaSign</span> <span class="o">*</span> <span class="n">ds_min</span>

    <span class="n">ds_maxA</span> <span class="o">=</span> <span class="n">Delta_s_max_LT</span><span class="p">[</span><span class="n">indexA</span><span class="p">]</span>
    <span class="n">ds_maxB</span> <span class="o">=</span> <span class="n">Delta_s_max_LT</span><span class="p">[</span><span class="n">indexA</span><span class="p">]</span>
    <span class="n">ds_max</span> <span class="o">=</span> <span class="n">ds_maxA</span> <span class="o">+</span> <span class="n">betaFactor</span> <span class="o">*</span> <span class="p">(</span><span class="n">ds_maxB</span> <span class="o">-</span> <span class="n">ds_maxA</span><span class="p">)</span>
    <span class="n">ds_max</span> <span class="o">=</span> <span class="n">betaSign</span> <span class="o">*</span> <span class="n">ds_max</span>

    <span class="c1"># Step 6. Find ds by interpolation between ds_min and ds_max</span>
    <span class="n">xSlice_min</span> <span class="o">=</span> <span class="n">x_slice_min_LT</span>
    <span class="n">xSlice_max</span> <span class="o">=</span> <span class="n">x_slice_max_LT</span>
    <span class="n">xFactor</span> <span class="o">=</span> <span class="p">(</span><span class="n">xSlice</span> <span class="o">-</span> <span class="n">xSlice_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">xSlice_max</span> <span class="o">-</span> <span class="n">xSlice_min</span><span class="p">)</span>

    <span class="n">ds</span> <span class="o">=</span> <span class="n">ds_min</span> <span class="o">+</span> <span class="n">xFactor</span> <span class="o">*</span> <span class="p">(</span><span class="n">ds_max</span> <span class="o">-</span> <span class="n">ds_min</span><span class="p">)</span>

    <span class="c1"># Step 7. Convert ds to wavelength shift by intepolstion between SRP values</span>
    <span class="n">w_min</span> <span class="o">=</span> <span class="n">wave_min</span><span class="p">[</span><span class="n">optIndex</span><span class="p">]</span>
    <span class="n">w_max</span> <span class="o">=</span> <span class="n">wave_max</span><span class="p">[</span><span class="n">optIndex</span><span class="p">]</span>
    <span class="n">wFactor</span> <span class="o">=</span> <span class="p">(</span><span class="n">tgtWave</span> <span class="o">-</span> <span class="n">w_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">w_max</span> <span class="o">-</span> <span class="n">w_min</span><span class="p">)</span>

    <span class="n">srp</span> <span class="o">=</span> <span class="n">srp_min</span><span class="p">[</span><span class="n">optIndex</span><span class="p">]</span> <span class="o">+</span> <span class="n">wFactor</span> <span class="o">*</span> <span class="p">(</span><span class="n">srp_max</span><span class="p">[</span><span class="n">optIndex</span><span class="p">]</span> <span class="o">-</span> <span class="n">srp_min</span><span class="p">[</span><span class="n">optIndex</span><span class="p">])</span>

    <span class="n">wavcorr_across_slice</span><span class="p">[</span><span class="n">sel</span><span class="p">]</span> <span class="o">=</span> <span class="n">ds</span> <span class="o">*</span> <span class="n">tgtWave</span> <span class="o">/</span> <span class="n">srp</span>

<span class="c1"># Plot wavelength correction map</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">wavcorr_across_slice</span><span class="p">)</span>
<span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'Wavelength correction [$</span><span class="se">\u03bc</span><span class="s1"> m$]'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X-pixel'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Y-pixel'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'MRS spectral band </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># Apply correction to wavelength map</span>
<span class="n">lambdaMap</span> <span class="o">+=</span> <span class="n">wavcorr_across_slice</span>
</pre>
             </div>
            </div>
           </div>
          </div>
         </section>
         <section class="tex2jax_ignore mathjax_ignore" id="load-mrs-psf-model-in-the-3d-spectral-cube-and-project-it-on-the-2d-detector">
          <h1>
           Load MRS PSF model in the 3D spectral cube and project it on the 2D detector
           <a class="headerlink" href="#load-mrs-psf-model-in-the-3d-spectral-cube-and-project-it-on-the-2d-detector" title="Permalink to this headline">
            #
           </a>
          </h1>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="n">psf_fits_file</span> <span class="o">=</span> <span class="n">cdpDir</span><span class="o">+</span><span class="s2">"MIRI_FM_</span><span class="si">{}</span><span class="s2">_</span><span class="si">{}{}</span><span class="s2">_PSF_07.02.00.fits"</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">det_id</span><span class="p">,</span> <span class="n">ch</span><span class="p">,</span> <span class="n">band_id</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
<span class="n">psffits</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">psf_fits_file</span><span class="p">)</span>

<span class="c1"># normalize and project PSF on 2D detector (normalization ensures that each cube slice of the model has a signal sum of 1)</span>
<span class="n">psf_img</span> <span class="o">=</span> <span class="n">evaluate_psf_cdp</span><span class="p">(</span><span class="n">psffits</span><span class="p">,</span> <span class="n">d2cMaps</span><span class="p">,</span> <span class="n">source_center</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">alpha_centers2D_dict</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">beta_centers2D_dict</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="mi">20</span><span class="p">:</span><span class="o">-</span><span class="mi">20</span><span class="p">])],</span> <span class="n">norm</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># close fits file</span>
<span class="n">psffits</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># Diagnostic plot to show how well the projected PSF matches the data</span>
<span class="c1"># For low SNR observations this will likely not be very useful</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">'all'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">if</span> <span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'1'</span><span class="p">,</span> <span class="s1">'4'</span><span class="p">]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sci_img</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">516</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'MIRISim signal'</span><span class="p">)</span>
    <span class="n">scale_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">sci_img</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">516</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sci_img</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">516</span><span class="p">])]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="n">psf_img</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">516</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">psf_img</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">10</span><span class="p">:</span><span class="mi">516</span><span class="p">]</span><span class="o">*</span><span class="n">scale_factor</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'PSF model (scaled)'</span><span class="p">)</span>
<span class="k">elif</span> <span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'2'</span><span class="p">,</span> <span class="s1">'3'</span><span class="p">]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sci_img</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">516</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'MIRISim signal'</span><span class="p">)</span>
    <span class="n">scale_factor</span> <span class="o">=</span> <span class="p">(</span><span class="n">sci_img</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">516</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">][</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sci_img</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">516</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">])]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span><span class="o">/</span><span class="n">psf_img</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">516</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">psf_img</span><span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">516</span><span class="p">:</span><span class="o">-</span><span class="mi">10</span><span class="p">]</span><span class="o">*</span><span class="n">scale_factor</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'PSF model (scaled)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X-pixel'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Signal [DN/sec]'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'MRS spectral band </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># Determine optimal pixel weights for detector-based spectral extraction</span>
<span class="n">weight_map</span> <span class="o">=</span> <span class="n">psf_img</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">err_img</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># Wavelength array used for the detector-based spectral extraction</span>
<span class="c1"># The grid step is approximately half the smallest spectral size in each band (due to the MRS distortion and slice curvature, different pixels contribute to each bin)</span>
<span class="n">wav_array</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'1A'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">4.9</span><span class="p">,</span> <span class="mf">5.74</span><span class="p">,</span> <span class="mf">0.0005</span><span class="p">),</span> <span class="s1">'1B'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">5.67</span><span class="p">,</span> <span class="mf">6.6</span><span class="p">,</span> <span class="mf">0.0008</span><span class="p">),</span> <span class="s1">'1C'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">6.45</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">),</span>
             <span class="s1">'2A'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">7.477</span><span class="p">,</span> <span class="mf">8.765</span><span class="p">,</span> <span class="mf">0.0014</span><span class="p">),</span> <span class="s1">'2B'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">8.711</span><span class="p">,</span> <span class="mf">10.228</span><span class="p">,</span> <span class="mf">0.0017</span><span class="p">),</span> <span class="s1">'2C'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">10.017</span><span class="p">,</span> <span class="mf">11.753</span><span class="p">,</span> <span class="mf">0.002</span><span class="p">),</span>
             <span class="s1">'3A'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">11.481</span><span class="p">,</span> <span class="mf">13.441</span><span class="p">,</span> <span class="mf">0.0023</span><span class="p">),</span> <span class="s1">'3B'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">13.319</span><span class="p">,</span> <span class="mf">15.592</span><span class="p">,</span> <span class="mf">0.0026</span><span class="p">),</span> <span class="s1">'3C'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">15.4</span><span class="p">,</span> <span class="mf">18.072</span><span class="p">,</span> <span class="mf">0.0030</span><span class="p">),</span>
             <span class="s1">'4A'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">17.651</span><span class="p">,</span> <span class="mf">20.938</span><span class="p">,</span> <span class="mf">0.0036</span><span class="p">),</span> <span class="s1">'4B'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">20.417</span><span class="p">,</span> <span class="mf">24.22</span><span class="p">,</span> <span class="mf">0.0042</span><span class="p">),</span> <span class="s1">'4C'</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">23.884</span><span class="p">,</span> <span class="mf">28.329</span><span class="p">,</span> <span class="mf">0.0048</span><span class="p">)}</span>
<span class="n">nwavs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">wav_array</span><span class="p">[</span><span class="n">band</span><span class="p">])</span>

<span class="c1"># Evaluate smallest distortion solution on the 2D detector (largest slice transmission of 90%)</span>
<span class="n">slice_transmission</span> <span class="o">=</span> <span class="s1">'90pc'</span>
<span class="n">d2cMaps</span> <span class="o">=</span> <span class="n">d2cMapping</span><span class="p">(</span><span class="n">band</span><span class="p">,</span> <span class="n">d2cDir</span><span class="p">,</span> <span class="n">slice_transmission</span><span class="o">=</span><span class="n">slice_transmission</span><span class="p">,</span> <span class="n">fileversion</span><span class="o">=</span><span class="s2">"8B.05.02"</span><span class="p">)</span>
<span class="n">lambdaMap</span> <span class="o">=</span> <span class="n">d2cMaps</span><span class="p">[</span><span class="s1">'lambdaMap'</span><span class="p">]</span>
<span class="n">lambdas</span> <span class="o">=</span> <span class="n">lambdaMap</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">lambdaMap</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="c1"># Need approximate number of pixels contributing to each spectral bin</span>
<span class="c1"># This is because only one pixel is used for each detector column --&gt; we want to avoid sampling issues</span>
<span class="k">if</span> <span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'1'</span><span class="p">,</span> <span class="s1">'2'</span><span class="p">]:</span>
    <span class="k">if</span> <span class="n">slice_transmission</span> <span class="o">==</span> <span class="s1">'90pc'</span><span class="p">:</span>
        <span class="n">npix</span> <span class="o">=</span> <span class="mi">380</span>
    <span class="k">elif</span> <span class="n">slice_transmission</span> <span class="o">==</span> <span class="s1">'10pc'</span><span class="p">:</span>
        <span class="n">npix</span> <span class="o">=</span> <span class="mi">500</span>
<span class="k">elif</span> <span class="n">band</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'3'</span><span class="p">,</span> <span class="s1">'4'</span><span class="p">]:</span>
    <span class="n">npix</span> <span class="o">=</span> <span class="mi">380</span>
<span class="n">k</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npix</span><span class="p">)</span>

<span class="c1"># Define pixel grid</span>
<span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1032</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1024</span><span class="p">))</span>
<span class="n">X_flat</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">lambdaMap</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">Y_flat</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">lambdaMap</span><span class="p">)]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># Omit NaNs from analysis</span>
<span class="n">nan_idx</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">sci_img</span><span class="p">)</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># Diffraction grating second order spectral leak contribution</span>
<span class="k">if</span> <span class="n">band</span> <span class="o">==</span> <span class="s1">'1B'</span><span class="p">:</span>
    
    <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">'spectral_leak_transmission.npy'</span><span class="p">,</span> <span class="n">sys_transm_img</span><span class="p">)</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">'all'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">sys_transm_img</span><span class="o">*</span><span class="mf">100.</span><span class="p">)</span>
    <span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'Dichroic transmission [%]'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X-pixel'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Y-pixel'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="c1"># Compute spectral leak signal from band 1B and update the error map</span>
    <span class="n">spectral_leak_sci_img</span> <span class="o">=</span> <span class="n">sci_img</span><span class="o">*</span><span class="n">sys_transm_img</span>
    <span class="n">spectral_leak_err_img</span> <span class="o">=</span> <span class="n">err_img</span><span class="o">*</span><span class="n">sys_transm_img</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">spectral_leak_sci_img</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span>
    <span class="n">clb</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
    <span class="n">clb</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">'Spectral leak signal [mJy]'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X-pixel'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Y-pixel'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    
    <span class="c1"># Redetermine optimal pixel weights for detector-based spectral extraction</span>
    <span class="n">spectral_leak_weight_map</span> <span class="o">=</span> <span class="n">psf_img</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">spectral_leak_err_img</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="c1"># Initialize placeholder</span>
    <span class="n">spectral_leak_spectrum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nwavs</span><span class="p">)</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># Perform detector-based spectral extraction</span>
<span class="n">isolambda_spec_optimal</span><span class="p">[</span><span class="n">band</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">nwavs</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nwavs</span><span class="p">):</span>
    <span class="c1"># determine pixels contributing to spectral bin</span>
    <span class="n">test_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1032</span><span class="p">))</span>
    <span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lambdas</span><span class="o">-</span><span class="n">wav_array</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">i</span><span class="p">]))[</span><span class="n">k</span><span class="p">]</span>
    <span class="n">test_img</span><span class="p">[</span><span class="n">Y_flat</span><span class="p">[</span><span class="n">idxs</span><span class="p">],</span> <span class="n">X_flat</span><span class="p">[</span><span class="n">idxs</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
    
    <span class="c1"># ascertain that only one pixel is selected per detector column</span>
    <span class="n">outliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">test_img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">outliers</span><span class="p">:</span>
        <span class="n">Y_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lambdaMap</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span> <span class="o">-</span> <span class="n">wav_array</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">i</span><span class="p">]))[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">test_img</span><span class="p">[</span><span class="n">Y_</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1"># plot meant for debugging !!!ONLY USE AT A SINGLE WAVELENGTH!!!</span>
    <span class="c1"># plt.figure()</span>
    <span class="c1"># plt.imshow(test_img,aspect=0.5)</span>
    <span class="c1"># plt.tight_layout()</span>

    <span class="c1"># spectral extraction</span>
    <span class="n">sel_valid</span> <span class="o">=</span> <span class="p">(</span><span class="n">test_img</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">nan_idx</span>
    <span class="n">isolambda_spec_optimal</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weight_map</span><span class="p">[</span><span class="n">sel_valid</span><span class="p">]</span> <span class="o">*</span> <span class="n">sci_img</span><span class="p">[</span><span class="n">sel_valid</span><span class="p">]</span> <span class="o">/</span> <span class="n">psf_img</span><span class="p">[</span><span class="n">sel_valid</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">weight_map</span><span class="p">[</span><span class="n">sel_valid</span><span class="p">])</span>
    
    <span class="k">if</span> <span class="n">band</span> <span class="o">==</span> <span class="s1">'1B'</span><span class="p">:</span>
        <span class="c1"># Estimate diffraction grating second order spectral leak contribution</span>
        <span class="n">spectral_leak_spectrum</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">spectral_leak_weight_map</span><span class="p">[</span><span class="n">sel_valid</span><span class="p">]</span> <span class="o">*</span> <span class="n">spectral_leak_sci_img</span><span class="p">[</span><span class="n">sel_valid</span><span class="p">]</span> <span class="o">/</span> <span class="n">psf_img</span><span class="p">[</span><span class="n">sel_valid</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">spectral_leak_weight_map</span><span class="p">[</span><span class="n">sel_valid</span><span class="p">])</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># debugging spectral bins</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">200</span>
<span class="c1"># determine pixels contributing to spectral bin</span>
<span class="n">test_img</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1024</span><span class="p">,</span> <span class="mi">1032</span><span class="p">))</span>
<span class="n">idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lambdas</span><span class="o">-</span><span class="n">wav_array</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">i</span><span class="p">]))[</span><span class="n">k</span><span class="p">]</span>
<span class="n">test_img</span><span class="p">[</span><span class="n">Y_flat</span><span class="p">[</span><span class="n">idxs</span><span class="p">],</span> <span class="n">X_flat</span><span class="p">[</span><span class="n">idxs</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># ascertain that only one pixel is selected per detector column</span>
<span class="n">outliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">test_img</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">outliers</span><span class="p">:</span>
    <span class="n">Y_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lambdaMap</span><span class="p">[:,</span> <span class="n">col</span><span class="p">]</span><span class="o">-</span><span class="n">wav_array</span><span class="p">[</span><span class="n">band</span><span class="p">][</span><span class="n">i</span><span class="p">]))[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">test_img</span><span class="p">[</span><span class="n">Y_</span><span class="p">,</span> <span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">test_img</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">d2cMaps</span><span class="p">[</span><span class="s1">'sliceMap'</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'X-pixel'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Y-pixel'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'MRS spectral band </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="c1"># Compare resulting extracted spectrum to result from JWST-pipeline-reconstructed spectrum and original ISO spectrum</span>
<span class="c1"># Disclaimer: Due to flux conservation issues in MIRISim, the  MIRISim MRS PSF is broader than the MRS PSF CDP model. </span>
<span class="c1"># This results on the detector-based spectrum having a significantly higher spectral baseline.</span>

<span class="c1"># JWST pipeline result</span>
<span class="n">hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'combine_dithers_all_exposures_ch</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">_x1d.fits'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ch</span><span class="p">,</span> <span class="n">band_id</span><span class="p">))</span>
<span class="n">wav</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'WAVELENGTH'</span><span class="p">]</span>
<span class="n">flux</span> <span class="o">=</span> <span class="n">hdu</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">'FLUX'</span><span class="p">]</span>
<span class="n">hdu</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Original ISO spectrum</span>
<span class="n">W_Per_hdu</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="s1">'W_Per_spectrum_sws.fit'</span><span class="p">)</span>
<span class="n">wav_WPer</span> <span class="o">=</span> <span class="n">W_Per_hdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">flux_WPer</span> <span class="o">=</span> <span class="n">W_Per_hdu</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">sel_WPer</span> <span class="o">=</span> <span class="p">(</span><span class="n">wav_WPer</span> <span class="o">&gt;</span> <span class="n">lambmin</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">wav_WPer</span> <span class="o">&lt;</span> <span class="n">lambmax</span><span class="p">)</span>
<span class="n">W_Per_hdu</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Plot</span>
<span class="k">if</span> <span class="n">band</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'1A'</span><span class="p">,</span> <span class="s1">'1B'</span><span class="p">,</span> <span class="s1">'1C'</span><span class="p">]:</span>
    <span class="n">fudge_factor</span> <span class="o">=</span> <span class="mf">28.5</span>
<span class="k">elif</span> <span class="n">band</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">'2A'</span><span class="p">,</span> <span class="s1">'2B'</span><span class="p">,</span> <span class="s1">'2C'</span><span class="p">]:</span>
    <span class="n">fudge_factor</span> <span class="o">=</span> <span class="mi">45</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">'all'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav</span><span class="p">,</span> <span class="n">flux</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'combine_dithers_all_exposures'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav_array</span><span class="p">[</span><span class="n">band</span><span class="p">],</span> <span class="n">isolambda_spec_optimal</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">/</span><span class="n">fudge_factor</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Single dither detector-based extraction (scaled)'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav_WPer</span><span class="p">[</span><span class="n">sel_WPer</span><span class="p">],</span> <span class="n">flux_WPer</span><span class="p">[</span><span class="n">sel_WPer</span><span class="p">]</span><span class="o">/</span><span class="mf">1000.</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'ISO SWS spectrum of W Per'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Wavelength'</span> <span class="sa">u</span><span class="s1">'[$</span><span class="se">\u03bc</span><span class="s1"> m$]'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">'Signal [Jy]'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'MRS spectral band </span><span class="si">{}</span><span class="s1">'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">band</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="k">if</span> <span class="n">band</span> <span class="o">==</span> <span class="s1">'1B'</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav_array</span><span class="p">[</span><span class="n">band</span><span class="p">],</span> <span class="n">isolambda_spec_optimal</span><span class="p">[</span><span class="n">band</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Original signal band 1B'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">wav_array</span><span class="p">[</span><span class="n">band</span><span class="p">],</span> <span class="n">spectral_leak_spectrum</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">'Estimated spectral leak'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">'Wavelength [$</span><span class="se">\u03bc</span><span class="s1"> m$]'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">'Spectral flux density [Jy]'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">'MRS spectral band 1B'</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <section id="correct-for-spectral-leak-if-mrs-band-is-set-to-3a">
           <h2>
            Correct for spectral leak if MRS band is set to 3A
            <a class="headerlink" href="#correct-for-spectral-leak-if-mrs-band-is-set-to-3a" title="Permalink to this headline">
             #
            </a>
           </h2>
          </section>
          <section id="caution-in-order-for-the-following-cell-to-work-the-user-must-have-run-this-notebook-already-once-for-band-1b">
           <h2>
            CAUTION: In order for the following cell to work, the user must have run this notebook already once for band 1B.
            <a class="headerlink" href="#caution-in-order-for-the-following-cell-to-work-the-user-must-have-run-this-notebook-already-once-for-band-1b" title="Permalink to this headline">
             #
            </a>
           </h2>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="k">if</span> <span class="n">band</span> <span class="o">==</span> <span class="s1">'3A'</span><span class="p">:</span>
    <span class="n">spectral_leak_corr_band3A</span> <span class="o">=</span> <span class="n">isolambda_spec_optimal</span><span class="p">[</span><span class="n">band</span><span class="p">]</span><span class="o">-</span><span class="n">spectral_leak_spectrum</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </section>
         </section>
         <section class="tex2jax_ignore mathjax_ignore" id="the-end">
          <h1>
           THE END
           <a class="headerlink" href="#the-end" title="Permalink to this headline">
            #
           </a>
          </h1>
          <section id="still-to-do">
           <h2>
            Still to do:
            <a class="headerlink" href="#still-to-do" title="Permalink to this headline">
             #
            </a>
           </h2>
           <ul class="simple">
            <li>
             <p>
              Loop the notebook over all dither positions and average the resulting spectra. The reason why we may not want to use all four dithers in one go (i.e. to run the detector based extraction only once) is because we will likely find variations in the PSF as a function of which slice gets illuminated on the detector (think incoming cone angle and detector-scattered light).
             </p>
            </li>
            <li>
             <p>
              Consider updating current centroiding algorithm to use the cross-correlation method of the SDSS MANGA pipeline.
             </p>
            </li>
           </ul>
          </section>
          <section id="about-this-notebook">
           <h2>
            About this notebook
            <a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">
             #
            </a>
           </h2>
           <p>
            <strong>
             Author:
            </strong>
            Ioannis (Yannis) Argyriou, Post-Doctoral Researcher, Institute of Astronomy, KU Leuven, Belgium
            <br/>
            <strong>
             Date:
            </strong>
            2022-01-08
           </p>
           <hr class="docutils"/>
           <p>
            <a class="reference external" href="#top">
             Top of Page
            </a>
           </p>
          </section>
         </section>
         <script type="text/x-thebe-config">
          {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/jdat_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/MRS_Mstar_analysis"
        },
        predefinedOutput: true
    }
         </script>
         <script>
          kernelName = 'python3'
         </script>
        </div>
       </main>
       <footer class="footer-article noprint">
        <!-- Previous / next buttons -->
        <div class="prev-next-area">
         <a class="left-prev" href="JWST_Mstar_dataAnalysis_runpipeline.html" id="prev-link" title="previous page">
          <i class="fas fa-angle-left">
          </i>
          <div class="prev-next-info">
           <p class="prev-next-subtitle">
            previous
           </p>
           <p class="prev-next-title">
            MRS Pipeline
           </p>
          </div>
         </a>
         <a class="right-next" href="JWST_Mstar_dataAnalysis_analysis.html" id="next-link" title="next page">
          <div class="prev-next-info">
           <p class="prev-next-subtitle">
            next
           </p>
           <p class="prev-next-title">
            MRS Cube Analysis
           </p>
          </div>
          <i class="fas fa-angle-right">
          </i>
         </a>
        </div>
       </footer>
      </div>
     </div>
     <div class="footer-content row">
      <footer class="col footer">
       <p>
        By STScI
        <br/>
        © Copyright 2022.
        <br/>
       </p>
      </footer>
     </div>
    </div>
   </div>
  </div>
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  </script>
 </body>
</html>