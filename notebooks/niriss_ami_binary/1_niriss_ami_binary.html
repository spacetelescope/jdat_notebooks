<!DOCTYPE html>
<html>
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   NIRISS AMI: MIRAGE Simulations — STScI JDAT Notebooks
  </title>
  <link href="../../_static/css/theme.css" rel="stylesheet"/>
  <link href="../../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet"/>
  <link href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css" rel="stylesheet"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2" rel="preload" type="font/woff2"/>
  <link as="font" crossorigin="" href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2" rel="preload" type="font/woff2"/>
  <link href="../../_static/pygments.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" rel="stylesheet" type="text/css"/>
  <link href="../../_static/togglebutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/copybutton.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/mystnb.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/sphinx-thebe.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/main.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" rel="stylesheet" type="text/css"/>
  <link href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" rel="stylesheet" type="text/css"/>
  <link as="script" href="../../_static/js/index.be7d3bbb2ef33a8344ce.js" rel="preload"/>
  <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js">
  </script>
  <script src="../../_static/jquery.js">
  </script>
  <script src="../../_static/underscore.js">
  </script>
  <script src="../../_static/doctools.js">
  </script>
  <script src="../../_static/clipboard.min.js">
  </script>
  <script src="../../_static/copybutton.js">
  </script>
  <script>
   let toggleHintShow = 'Click to show';
  </script>
  <script>
   let toggleHintHide = 'Click to hide';
  </script>
  <script>
   let toggleOpenOnPrint = 'true';
  </script>
  <script src="../../_static/togglebutton.js">
  </script>
  <script>
   var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';
  </script>
  <script src="../../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js">
  </script>
  <script>
   const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
  </script>
  <script async="async" src="../../_static/sphinx-thebe.js">
  </script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js">
  </script>
  <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js">
  </script>
  <link href="../../genindex.html" rel="index" title="Index"/>
  <link href="../../search.html" rel="search" title="Search"/>
  <link href="2_niriss_ami_binary.html" rel="next" title="NIRISS AMI: Pipeline"/>
  <link href="../NIRISS_WFSS_postpipeline/03.%20Spatially%20resolved%20emission%20line%20map.html" rel="prev" title="WFSS Spectra - Emission Line Map"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <meta content="None" name="docsearch:language"/>
  <!-- Google Analytics -->
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-D46G4HKJY3">
  </script>
  <script>
   window.dataLayer = window.dataLayer || [];
                    function gtag(){ dataLayer.push(arguments); }
                    gtag('js', new Date());
                    gtag('config', 'G-D46G4HKJY3');
  </script>
 </head>
 <body data-offset="80" data-spy="scroll" data-target="#bd-toc-nav">
  <div class="container-fluid" id="banner">
  </div>
  <div class="container-xl">
   <div class="row">
    <div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
     <div class="navbar-brand-box">
      <a class="navbar-brand text-wrap" href="../../index.html">
       <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
       <img alt="logo" class="logo" src="../../_static/stsci_logo2.png"/>
       <h1 class="site-logo" id="site-title">
        STScI JDAT Notebooks
       </h1>
      </a>
     </div>
     <form action="../../search.html" class="bd-search d-flex align-items-center" method="get">
      <i class="icon fas fa-search">
      </i>
      <input aria-label="Search this book..." autocomplete="off" class="form-control" id="search-input" name="q" placeholder="Search this book..." type="search"/>
     </form>
     <nav aria-label="Main" class="bd-links" id="bd-docs-nav">
      <div class="bd-toc-item active">
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../../intro.html">
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         Cross-Instrument
        </span>
       </p>
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../asdf_example/asdf_example.html">
          ASDF Example
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../background_estimation_imaging/Imaging%20Sky%20Background%20Estimation.html">
          Complex 2D Background
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../composite_model_fitting/specfit_demo_3.html">
          Composite Model Spectral Fitting
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRSpec_MAST_Query/NIRSpec_MAST_Query.html">
          MAST Query
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../specviz_notebookGUI_interaction/specviz_notebook_gui_interaction_redshift.html">
          Specviz Simple Demo
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         MIRI
        </span>
       </p>
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_runpipeline.html">
          MRS Mstar Analysis - Run Pipeline
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../MRS_Mstar_analysis/JWST_Mstar_dataAnalysis_analysis.html">
          Data Analysis
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../MIRI_IFU_YSOs_in_the_LMC/isha_nayak_ysos_in_the_lmc.html">
          IFU of YSOs in LMC
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../MIRI_LRS_spectral_extraction/miri_lrs_spectral_extraction.html">
          LRS Extraction
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         NIRCam
        </span>
       </p>
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../aperture_photometry/NIRCam_Aperture_Photometry_Example.html">
          Point Source Aperture Photometry
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRCam_photometry/NIRCam%20multiband%20photometry.html">
          Extended Aperture Photometry
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../psf_photometry/NIRCam_PSF_Photometry_Example.html">
          PSF Photometry
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRCam_PSF-matched_photometry/NIRCam_PSF_matched_multiband_photometry.html">
          Cross-Filter PSF Matching
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../preimaging/preimaging_02_calwebb.html">
          Preimaging - Calwebb
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../preimaging/preimaging_03_association.html">
          NIRCam Preimaging: Pipeline Stage 3
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         NIRISS
        </span>
       </p>
       <ul class="current nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRISS_WFSS_postpipeline/00.%20Optimal%20extraction.html">
          WFSS Spectra - Optimal Extraction
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRISS_WFSS_postpipeline/01.%20Combine%20and%20normalize%201D%20spectra.html">
          WFSS Spectra - Combine and Normalize 1D Spectra
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRISS_WFSS_postpipeline/02.%20Cross%20correlation%20template.html">
          Part 2: Cross Correlation to Determine Redshift of NIRISS WFSS Spectra
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../NIRISS_WFSS_postpipeline/03.%20Spatially%20resolved%20emission%20line%20map.html">
          WFSS Spectra - Emission Line Map
         </a>
        </li>
        <li class="toctree-l1 current active">
         <a class="current reference internal" href="#">
          AMI Binary Star 1
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="2_niriss_ami_binary.html">
          AMI Binary Star Notebook 2
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../soss-transit-spectroscopy/HAT-P-1b-PART3-data-analysis.html">
          SOSS Transient Spectroscopy
         </a>
        </li>
       </ul>
       <p aria-level="2" class="caption" role="heading">
        <span class="caption-text">
         NIRSpec
        </span>
       </p>
       <ul class="nav bd-sidenav">
        <li class="toctree-l1">
         <a class="reference internal" href="../IFU_cube_continuum_fit/NGC4151_FeII_ContinuumFit.html">
          IFU Cube Fitting
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../ifu_optimal/ifu_optimal.html">
          MOS Optimal Extraction
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../mos-spectroscopy/MOSspec_sv06_revised.html">
          MOS Spectroscopy of Extragalactic Field
         </a>
        </li>
        <li class="toctree-l1">
         <a class="reference internal" href="../transit_spectroscopy_notebook/Exoplanet_Transmission_Spectra_JWST.html">
          BOTS Time Series Observations
         </a>
        </li>
       </ul>
      </div>
     </nav>
     <!-- To handle the deprecated key -->
     <div class="navbar_extra_footer">
      Powered by
      <a href="https://jupyterbook.org">
       Jupyter Book
      </a>
     </div>
    </div>
    <main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
     <div class="topbar container-xl fixed-top">
      <div class="topbar-contents row">
       <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
       </div>
       <div class="col pl-md-4 topbar-main">
        <button aria-controls="navbar-menu" aria-expanded="true" aria-label="Toggle navigation" class="navbar-toggler ml-0" data-placement="bottom" data-target=".site-navigation" data-toggle="collapse" id="navbar-toggler" title="Toggle navigation" type="button">
         <i class="fas fa-bars">
         </i>
         <i class="fas fa-arrow-left">
         </i>
         <i class="fas fa-arrow-up">
         </i>
        </button>
        <div class="dropdown-buttons-trigger">
         <button aria-label="Download this page" class="btn btn-secondary topbarbtn" id="dropdown-buttons-trigger">
          <i class="fas fa-download">
          </i>
         </button>
         <div class="dropdown-buttons">
          <!-- ipynb file if we had a myst markdown file -->
          <!-- Download raw file -->
          <a class="dropdown-buttons" href="../../_sources/notebooks/niriss_ami_binary/1_niriss_ami_binary.ipynb">
           <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" title="Download source file" type="button">
            .ipynb
           </button>
          </a>
          <!-- Download PDF via print -->
          <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" id="download-print" onclick="printPdf(this)" title="Print to PDF" type="button">
           .pdf
          </button>
         </div>
        </div>
        <!-- Source interaction buttons -->
        <div class="dropdown-buttons-trigger">
         <button aria-label="Connect with source repository" class="btn btn-secondary topbarbtn" id="dropdown-buttons-trigger">
          <i class="fab fa-github">
          </i>
         </button>
         <div class="dropdown-buttons sourcebuttons">
          <a class="repository-button" href="https://github.com/spacetelescope/jdat_notebooks/">
           <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" title="Source repository" type="button">
            <i class="fab fa-github">
            </i>
            repository
           </button>
          </a>
          <a class="issues-button" href="https://github.com/spacetelescope/jdat_notebooks//issues/new?title=Issue%20on%20page%20%2Fnotebooks/niriss_ami_binary/1_niriss_ami_binary.html&amp;body=Your%20issue%20content%20here.">
           <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" title="Open an issue" type="button">
            <i class="fas fa-lightbulb">
            </i>
            open issue
           </button>
          </a>
         </div>
        </div>
        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button">
         <button aria-label="Fullscreen mode" class="btn btn-secondary topbarbtn" data-placement="bottom" data-toggle="tooltip" onclick="toggleFullScreen()" title="Fullscreen mode" type="button">
          <i class="fas fa-expand">
          </i>
         </button>
        </a>
        <!-- Launch buttons -->
        <div class="dropdown-buttons-trigger">
         <button aria-label="Launch interactive content" class="btn btn-secondary topbarbtn" id="dropdown-buttons-trigger">
          <i class="fas fa-rocket">
          </i>
         </button>
         <div class="dropdown-buttons">
          <button class="btn btn-secondary topbarbtn" data-placement="left" data-toggle="tooltip" onclick="initThebeSBT()" title="Launch Thebe" type="button">
           <i class="fas fa-play">
           </i>
           <span style="margin-left: .4em;">
            Live Code
           </span>
          </button>
         </div>
        </div>
       </div>
       <!-- Table of contents -->
       <div class="d-none d-md-block col-md-2 bd-toc show noprint">
        <div class="tocsection onthispage pt-5 pb-3">
         <i class="fas fa-list">
         </i>
         Contents
        </div>
        <nav aria-label="Page" id="bd-toc-nav">
         <ul class="visible nav section-nav flex-column">
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#introduction">
            Introduction
           </a>
           <ul class="nav section-nav flex-column">
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#description-of-reference-files-used-for-simulations">
              Description of reference files used for simulations
             </a>
            </li>
           </ul>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#imports">
            Imports
           </a>
           <ul class="nav section-nav flex-column">
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#loading-input-files-and-reference-files">
              Loading input files and reference files
             </a>
            </li>
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#create-output-directory-to-store-simulated-data">
              Create output directory to store simulated data
             </a>
            </li>
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#generating-input-yaml-files">
              Generating input yaml files
             </a>
            </li>
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#set-the-telescope-roll-angle-pav3-for-each-observation-another-way-to-get-pav3-is-from-the-apt-file-reports">
              Set the telescope roll angle PAV3 for each observation. Another way to get PAV3 is from the APT file Reports.
             </a>
            </li>
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#run-the-yaml-generator">
              Run the yaml generator
             </a>
            </li>
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#update-the-contents-of-yaml-files-and-generate-raw-data">
              Update the contents of yaml files and generate raw data
             </a>
            </li>
           </ul>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#useful-output-products-generated-by-mirage">
            Useful output products generated by Mirage
           </a>
           <ul class="nav section-nav flex-column">
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#examine-the-seed-images">
              Examine the seed images
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h4 nav-item toc-entry">
               <a class="reference internal nav-link" href="#compare-peak-pixel-count-rate-for-ab-dor-seed-image-with-peak-count-rate-in-equivalent-jwst-etc-calculation">
                Compare peak pixel count rate for AB-Dor seed image with peak count rate in equivalent JWST ETC calculation
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#examine-output-point-source-list-file-jw01093001001-01101-00001-nis-uncal-pointsources-list">
              Examine output point source list file ‘jw01093001001_01101_00001_nis_uncal_pointsources.list’
             </a>
            </li>
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#compare-total-count-rate-in-the-seed-image-with-total-count-rate-in-the-output-pointsource-list-file">
              Compare total count rate in the seed image with total count rate in the output pointsource list file.
             </a>
            </li>
            <li class="toc-h3 nav-item toc-entry">
             <a class="reference internal nav-link" href="#examine-the-raw-data">
              Examine the raw data
             </a>
            </li>
           </ul>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#calibrate-raw-data-uncal-fits-files-with-the-jwst-pipiline">
            Calibrate raw data (_uncal.fits files) with the JWST pipiline
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#aditional-resources">
            Aditional Resources
           </a>
          </li>
          <li class="toc-h2 nav-item toc-entry">
           <a class="reference internal nav-link" href="#about-this-notebook">
            About this notebook
           </a>
          </li>
         </ul>
        </nav>
       </div>
      </div>
     </div>
     <div class="row" id="main-content">
      <div class="col-12 col-md-9 pl-md-3 pr-md-0">
       <!-- Table of contents that is only displayed when printing the page -->
       <div class="onlyprint" id="jb-print-docs-body">
        <h1>
         NIRISS AMI: MIRAGE Simulations
        </h1>
        <!-- Table of contents -->
        <div id="print-main-content">
         <div id="jb-print-toc">
          <div>
           <h2>
            Contents
           </h2>
          </div>
          <nav aria-label="Page">
           <ul class="visible nav section-nav flex-column">
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#introduction">
              Introduction
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#description-of-reference-files-used-for-simulations">
                Description of reference files used for simulations
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#imports">
              Imports
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#loading-input-files-and-reference-files">
                Loading input files and reference files
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#create-output-directory-to-store-simulated-data">
                Create output directory to store simulated data
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#generating-input-yaml-files">
                Generating input yaml files
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#set-the-telescope-roll-angle-pav3-for-each-observation-another-way-to-get-pav3-is-from-the-apt-file-reports">
                Set the telescope roll angle PAV3 for each observation. Another way to get PAV3 is from the APT file Reports.
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#run-the-yaml-generator">
                Run the yaml generator
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#update-the-contents-of-yaml-files-and-generate-raw-data">
                Update the contents of yaml files and generate raw data
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#useful-output-products-generated-by-mirage">
              Useful output products generated by Mirage
             </a>
             <ul class="nav section-nav flex-column">
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#examine-the-seed-images">
                Examine the seed images
               </a>
               <ul class="nav section-nav flex-column">
                <li class="toc-h4 nav-item toc-entry">
                 <a class="reference internal nav-link" href="#compare-peak-pixel-count-rate-for-ab-dor-seed-image-with-peak-count-rate-in-equivalent-jwst-etc-calculation">
                  Compare peak pixel count rate for AB-Dor seed image with peak count rate in equivalent JWST ETC calculation
                 </a>
                </li>
               </ul>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#examine-output-point-source-list-file-jw01093001001-01101-00001-nis-uncal-pointsources-list">
                Examine output point source list file ‘jw01093001001_01101_00001_nis_uncal_pointsources.list’
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#compare-total-count-rate-in-the-seed-image-with-total-count-rate-in-the-output-pointsource-list-file">
                Compare total count rate in the seed image with total count rate in the output pointsource list file.
               </a>
              </li>
              <li class="toc-h3 nav-item toc-entry">
               <a class="reference internal nav-link" href="#examine-the-raw-data">
                Examine the raw data
               </a>
              </li>
             </ul>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#calibrate-raw-data-uncal-fits-files-with-the-jwst-pipiline">
              Calibrate raw data (_uncal.fits files) with the JWST pipiline
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#aditional-resources">
              Aditional Resources
             </a>
            </li>
            <li class="toc-h2 nav-item toc-entry">
             <a class="reference internal nav-link" href="#about-this-notebook">
              About this notebook
             </a>
            </li>
           </ul>
          </nav>
         </div>
        </div>
       </div>
       <div>
        <div class="tex2jax_ignore mathjax_ignore section" id="niriss-ami-mirage-simulations">
         <h1>
          NIRISS AMI: MIRAGE Simulations
          <a class="headerlink" href="#niriss-ami-mirage-simulations" title="Permalink to this headline">
           ¶
          </a>
         </h1>
         <p>
          <strong>
           Use case:
          </strong>
          Simulation of NIRISS AMI data.
          <br/>
          <strong>
           Data:
          </strong>
          JWST simulated NIRISS data from MIRAGE.
          <br/>
          <strong>
           Tools:
          </strong>
          mirage, jwst, astropy.
          <br/>
          <strong>
           Cross-intrument:
          </strong>
          NIRCam.
          <br/>
          <strong>
           Documentation:
          </strong>
          This notebook is part of a STScI’s larger
          <a class="reference external" href="https://jwst-docs.stsci.edu/jwst-post-pipeline-data-analysis">
           post-pipeline Data Analysis Tools Ecosystem
          </a>
          .
          <br/>
         </p>
         <div class="section" id="introduction">
          <h2>
           Introduction
           <a class="headerlink" href="#introduction" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           This notebook creates MIRAGE simulations for binary point source AB Dor and calibrator HD37093 using the Aperture Masking Interferometry (AMI) mode on JWST NIRISS. The sources are observed with the Non-redundant mask (NRM) in the pupil wheel and filter F480M in the filter wheel at POS1 dither position near the center of SUB80 array. The goal of the program is to find the binary parameters of AB Dor.
          </p>
          <p>
           The current analysis tools are work in progress and do not give correct results if the data has bad pixels. The simulations are therefore created using dark ramps without bad pixels.
          </p>
          <div class="section" id="description-of-reference-files-used-for-simulations">
           <h3>
            Description of reference files used for simulations
            <a class="headerlink" href="#description-of-reference-files-used-for-simulations" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            We are using the following non-default reference files to generate the simulation.
           </p>
           <ul class="simple">
            <li>
             <p>
              dark000001_uncal.fits has ngroups = 5 and is used for AB Dor observation that also has ngroups = 5.
             </p>
            </li>
            <li>
             <p>
              dark000005_uncal.fits has ngroups = 12 and is used for HD37093 observation that also has ngroups = 12.
             </p>
            </li>
            <li>
             <p>
              jwst_niriss_gain_general.fits is the gain file with one value for all pixels
             </p>
            </li>
            <li>
             <p>
              jwst_niriss_flat_general.fits is the flat field reference file with no structure
             </p>
            </li>
            <li>
             <p>
              jwst_niriss_superbias_sim.fits bias reference file to match the simulation
             </p>
            </li>
           </ul>
           <p>
            We are temporarily using a local niriss_gridded_psf_library that was created using a new version of non redundant mask. When Mirage gridded psf library gets updated with WebbPSF PSFs that use new version of NRM we can switch back to the default library.
           </p>
           <p>
            <em>
             Developer Note:
            </em>
            Create the conda environment needed to run this notebook by issuing the following command:
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">conda</span> <span class="n">create</span> <span class="o">-</span><span class="n">n</span> <span class="o">&lt;</span><span class="n">myenv</span><span class="o">&gt;</span> <span class="n">python</span><span class="o">=</span><span class="mf">3.6</span>
</pre>
            </div>
           </div>
           <p>
            Activate the environment and then open the notebook.
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">conda</span> <span class="n">activate</span> <span class="o">&lt;</span><span class="n">myenv</span><span class="o">&gt;</span>
<span class="n">jupyter</span> <span class="n">notebook</span>
</pre>
            </div>
           </div>
          </div>
         </div>
         <hr class="docutils"/>
         <div class="section" id="imports">
          <h2>
           Imports
           <a class="headerlink" href="#imports" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <ul class="simple">
           <li>
            <p>
             <em>
              numpy
             </em>
             to handle array functions
            </p>
           </li>
           <li>
            <p>
             <em>
              <a class="reference external" href="http://astropy.io">
               astropy.io
              </a>
              fits
             </em>
             for accessing FITS files
            </p>
           </li>
           <li>
            <p>
             <em>
              matplotlib.pyplot
             </em>
             for plotting data
            </p>
           </li>
           <li>
            <p>
             <em>
              zipfile
             </em>
             for accessing zip files
            </p>
           </li>
           <li>
            <p>
             <em>
              urllib.request
             </em>
             to access URL
            </p>
           </li>
           <li>
            <p>
             <em>
              yaml
             </em>
             to create yaml files
            </p>
           </li>
           <li>
            <p>
             <em>
              mirage
             </em>
             to simulate JWST data
            </p>
           </li>
           <li>
            <p>
             <em>
              IPython.display Image
             </em>
             to display png files
            </p>
           </li>
          </ul>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">astropy.io</span> <span class="kn">import</span> <span class="n">fits</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">import</span> <span class="nn">urllib.request</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>

<span class="kn">from</span> <span class="nn">mirage</span> <span class="kn">import</span> <span class="n">imaging_simulator</span>
<span class="kn">from</span> <span class="nn">mirage.yaml</span> <span class="kn">import</span> <span class="n">yaml_generator</span>

<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="alert alert-info">
           <p>
            <strong>
             Note:
            </strong>
            DO NOT UPGRADE PYSIAF AS INSTRUCTED BY THE ABOVE WARNING.
Pysiaf 0.10.0 uses PRD release PRDOPSSOC-031. APT 2020.4.1 that was used to create the xml and pointing files used in this notebook uses PRDOPSSOC-030. The mismatch bewtween these two PRD versions causes incorrect placement of PSF. The version of Mirage used in this notebook comes with pysiaf 0.10.0. It was downgraded to 0.9.0 using the file requirements.txt to resolve the placement issue. Using Pysiaf 0.10.0 will cause incorrect placement of the PSF.
           </p>
          </div>
          <p>
           Mirage is accompanied by a set of reference files that are used to construct simulated data. They are specified by MIRAGE_DATA environment variable. These files include dark current ramps, cosmic ray and PSF libraries.
          </p>
          <p>
           <em>
            Developer Note:
           </em>
           If you are outside STScI install the mirage data by following instructions on
           <a class="reference external" href="https://mirage-data-simulator.readthedocs.io/en/latest/reference_files.html">
            https://mirage-data-simulator.readthedocs.io/en/latest/reference_files.html
           </a>
           and create MIRAGE_DATA location.
          </p>
          <div class="cell docutils container">
           <div class="cell_input docutils container">
            <div class="highlight-ipython3 notranslate">
             <div class="highlight">
              <pre><span></span><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'MIRAGE_DATA'</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">'MIRAGE_DATA'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'/path/to/mirage_data/'</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">'MIRAGE_DATA'</span><span class="p">))</span>
</pre>
             </div>
            </div>
           </div>
           <div class="cell_output docutils container">
            <div class="output stream highlight-myst-ansi notranslate">
             <div class="highlight">
              <pre><span></span>/path/to/mirage_data/
</pre>
             </div>
            </div>
           </div>
          </div>
          <div class="section" id="loading-input-files-and-reference-files">
           <h3>
            Loading input files and reference files
            <a class="headerlink" href="#loading-input-files-and-reference-files" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">boxlink</span> <span class="o">=</span> <span class="s1">'https://data.science.stsci.edu/redirect/JWST/jwst-data_analysis_tools/niriss_ami_binary/niriss_ami_binary1.zip'</span>
<span class="n">boxfile</span> <span class="o">=</span> <span class="s1">'./niriss_ami_binary1.zip'</span>

<span class="c1"># Download zip file</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">boxfile</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Downloading input files needed to run the notebook. This may take some time"</span><span class="p">)</span>
    <span class="n">urllib</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">urlretrieve</span><span class="p">(</span><span class="n">boxlink</span><span class="p">,</span> <span class="n">boxfile</span><span class="p">)</span>

    <span class="n">zf</span> <span class="o">=</span> <span class="n">zipfile</span><span class="o">.</span><span class="n">ZipFile</span><span class="p">(</span><span class="n">boxfile</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span>
    <span class="n">zf</span><span class="o">.</span><span class="n">extractall</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"Input files exist. You may want to check if there is an updated version."</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>Downloading input files needed to run the notebook. This may take some time
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
          <div class="section" id="create-output-directory-to-store-simulated-data">
           <h3>
            Create output directory to store simulated data
            <a class="headerlink" href="#create-output-directory-to-store-simulated-data" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">odir</span> <span class="o">=</span> <span class="s1">'./mirage_sim_data'</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">odir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">odir</span><span class="p">)</span>
<span class="n">simdata_output_directory</span> <span class="o">=</span> <span class="n">odir</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
          <div class="section" id="generating-input-yaml-files">
           <h3>
            Generating input yaml files
            <a class="headerlink" href="#generating-input-yaml-files" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            Begin working on the simulation starting with the APT file. The xml and pointings files must be exported from APT by using ‘File —&gt; Export’ option in APT. These files are then used as input to the yaml_generator, that generates yaml input files for each exposure.
           </p>
           <p>
            We are including the xml and pointing files along with other file included in the zip file.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># Write down the name of the APT file in comments for quick reference and also store it in the same folder as xml and </span>
<span class="c1"># pointing files for easy access and to remember which APT file was used for simulations.</span>
<span class="c1"># APT file used niriss_ami_binary_2022.25coords.aptx </span>
<span class="n">xml_name</span> <span class="o">=</span> <span class="s1">'./mirage_input_files/niriss_ami_binary_2022.25coords.xml'</span>
<span class="n">pointing_name</span> <span class="o">=</span> <span class="s1">'./mirage_input_files/niriss_ami_binary_2022.25coords.pointing'</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <p>
            We will generate NIRISS AMI simulations of a binary point source using the catalogue “stars_field19_20_combined_allfilters_new.list”. This catalogue contains the coordinates and magnitudes of AB Dor and HD37093 along with other fainter sources in the field.
           </p>
           <hr class="docutils"/>
           <p>
            <span style="color:darkblue">
             NOTE: Mirage currently does not apply the proper motion that is entered in the APT fie. It is therefore important to enter coordinates at the epoch of observation in the APT file. AB Dor is a high proper motion star so we are using 2022.25 coordinates in the APT file and the input source list file.
            </span>
            .
           </p>
           <hr class="docutils"/>
           <p>
            The first line in this file is for AB-Dor primary star and the second line is the faint companion that we are trying to detect. Several lines below is the reference star or calibrator star HD37093.
           </p>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1"># </span>
<span class="c1"># vegamag</span>
<span class="c1"># </span>
<span class="c1"># </span>
<span class="n">x_or_RA</span> <span class="n">y_or_Dec</span> <span class="n">niriss_f090w_magnitude</span> <span class="n">niriss_f115w_magnitude</span> <span class="n">niriss_f140m_magnitude</span> <span class="n">niriss_f150w_magnitude</span> <span class="n">niriss_f158m_magnitude</span> <span class="n">niriss_f200w_magnitude</span> <span class="n">niriss_f277w_magnitude</span> <span class="n">niriss_f356w_magnitude</span> <span class="n">niriss_f380m_magnitude</span> <span class="n">niriss_f430m_magnitude</span> <span class="n">niriss_f444w_magnitude</span> <span class="n">niriss_f480m_magnitude</span>
  <span class="mf">82.18740518</span>  <span class="o">-</span><span class="mf">65.44767541</span>   <span class="mf">5.88850</span>   <span class="mf">5.49770</span>   <span class="mf">5.07560</span>   <span class="mf">4.95800</span>   <span class="mf">4.83650</span>   <span class="mf">4.72940</span>   <span class="mf">4.72220</span>   <span class="mf">4.61000</span>   <span class="mf">4.61000</span>   <span class="mf">4.61000</span>   <span class="mf">4.61000</span>   <span class="mf">4.61000</span>
  <span class="mf">82.18717120</span>  <span class="o">-</span><span class="mf">65.44764863</span>  <span class="mf">12.06621</span>  <span class="mf">10.73581</span>  <span class="mf">10.47740</span>  <span class="mf">10.15193</span>   <span class="mf">9.84442</span>   <span class="mf">9.76398</span>   <span class="mf">9.75940</span>   <span class="mf">8.99121</span>   <span class="mf">8.69367</span>   <span class="mf">8.76689</span>   <span class="mf">8.81310</span>   <span class="mf">8.81310</span>
  <span class="mf">82.18534722</span>  <span class="o">-</span><span class="mf">65.44612065</span>   <span class="mf">8.88930</span>   <span class="mf">8.38010</span>   <span class="mf">7.86780</span>   <span class="mf">7.70440</span>   <span class="mf">7.54010</span>   <span class="mf">7.38740</span>   <span class="mf">7.38650</span>   <span class="mf">7.29090</span>   <span class="mf">7.28470</span>   <span class="mf">7.33890</span>   <span class="mf">7.38820</span>   <span class="mf">7.49960</span>
  <span class="mf">82.19501500</span>  <span class="o">-</span><span class="mf">65.44532800</span>  <span class="mf">12.13360</span>  <span class="mf">12.89690</span>  <span class="mf">12.47030</span>  <span class="mf">12.40400</span>  <span class="mf">12.28660</span>  <span class="mf">13.19490</span>  <span class="mf">14.01950</span>  <span class="mf">14.60890</span>  <span class="mf">14.67080</span>  <span class="mf">15.09080</span>  <span class="mf">15.20730</span>  <span class="mf">15.56880</span>
  <span class="mf">82.19343600</span>  <span class="o">-</span><span class="mf">65.45299500</span>  <span class="mf">13.54130</span>  <span class="mf">13.63920</span>  <span class="mf">13.68400</span>  <span class="mf">13.69520</span>  <span class="mf">13.70530</span>  <span class="mf">13.74310</span>  <span class="mf">13.76640</span>  <span class="mf">13.78850</span>  <span class="mf">13.78900</span>  <span class="mf">13.79520</span>  <span class="mf">13.79330</span>  <span class="mf">13.79180</span>
  
<span class="o">...</span><span class="n">more</span> <span class="n">sources</span><span class="o">...</span>

<span class="c1"># </span>
<span class="c1"># vegamag</span>
<span class="c1"># </span>
<span class="c1"># </span>
<span class="c1">#x_or_RA y_or_Dec niriss_f090w_magnitude niriss_f115w_magnitude niriss_f140m_magnitude niriss_f150w_magnitude niriss_f158m_magnitude niriss_f200w_magnitude niriss_f277w_magnitude niriss_f356w_magnitude niriss_f380m_magnitude niriss_f430m_magnitude niriss_f444w_magnitude niriss_f480m_magnitude</span>
  	
  <span class="mf">82.78450088</span>  <span class="o">-</span><span class="mf">65.12833088</span>   <span class="mf">7.33570</span>   <span class="mf">6.74320</span>   <span class="mf">6.18410</span>   <span class="mf">5.99130</span>   <span class="mf">5.80110</span>   <span class="mf">5.61850</span>   <span class="mf">5.62170</span>   <span class="mf">5.49700</span>   <span class="mf">5.49700</span>   <span class="mf">5.53100</span>   <span class="mf">5.53100</span>   <span class="mf">5.53100</span>

</pre>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">catalogues</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'AB-DOR'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'point_source'</span><span class="p">:</span>  <span class="s1">'./mirage_input_files/stars_field19_20_combined_allfilters_new.list'</span>
                        <span class="p">},</span>
              <span class="s1">'HD-37093'</span><span class="p">:</span> <span class="p">{</span><span class="s1">'point_source'</span><span class="p">:</span> <span class="s1">'./mirage_input_files/stars_field19_20_combined_allfilters_new.list'</span>
                          <span class="p">}</span>
             <span class="p">}</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
          <div class="section" id="set-the-telescope-roll-angle-pav3-for-each-observation-another-way-to-get-pav3-is-from-the-apt-file-reports">
           <h3>
            Set the telescope roll angle PAV3 for each observation. Another way to get PAV3 is from the APT file Reports.
            <a class="headerlink" href="#set-the-telescope-roll-angle-pav3-for-each-observation-another-way-to-get-pav3-is-from-the-apt-file-reports" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">obs1</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">pav3_obs1</span> <span class="o">=</span> <span class="n">yaml_generator</span><span class="o">.</span><span class="n">default_obs_v3pa_on_date</span><span class="p">(</span><span class="n">pointing_name</span><span class="p">,</span> <span class="n">obs1</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="s1">'2022-04-01'</span><span class="p">)</span>
<span class="n">obs2</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">pav3_obs2</span> <span class="o">=</span> <span class="n">yaml_generator</span><span class="o">.</span><span class="n">default_obs_v3pa_on_date</span><span class="p">(</span><span class="n">pointing_name</span><span class="p">,</span> <span class="n">obs2</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="s1">'2022-04-01'</span><span class="p">)</span>

<span class="n">roll_angle</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'001'</span><span class="p">:</span> <span class="n">pav3_obs1</span><span class="p">,</span> <span class="s1">'002'</span><span class="p">:</span> <span class="n">pav3_obs2</span><span class="p">}</span>

<span class="n">dates</span> <span class="o">=</span> <span class="s1">'2022-04-01'</span>
<span class="n">reffile_defaults</span> <span class="o">=</span> <span class="s1">'crds'</span>
<span class="n">datatype</span> <span class="o">=</span> <span class="s1">'raw'</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"PAV3 for observation 1"</span><span class="p">,</span> <span class="n">pav3_obs1</span><span class="p">,</span> <span class="s2">"PAV3 for observation 2"</span><span class="p">,</span> <span class="n">pav3_obs2</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-05-24 19:51:14,634 - mirage.apt.apt_inputs - WARNING - 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
The pointing file from APT was created using PRD version: PRDOPSSOC-037,
while the current installation of pysiaf uses PRD version: PRDOPSSOC-045-003.
This inconsistency may lead to errors in source locations or
the WCS of simulated data if the apertures being simulated are
shifted between the two versions. We highly recommend using a
consistent version of the PRD between APT and pysiaf.
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-05-24 19:51:15,446 - mirage.apt.apt_inputs - WARNING - 
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
The pointing file from APT was created using PRD version: PRDOPSSOC-037,
while the current installation of pysiaf uses PRD version: PRDOPSSOC-045-003.
This inconsistency may lead to errors in source locations or
the WCS of simulated data if the apertures being simulated are
shifted between the two versions. We highly recommend using a
consistent version of the PRD between APT and pysiaf.
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>PAV3 for observation 1 108.11841865714554 PAV3 for observation 2 107.55504751272476
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
          <div class="section" id="run-the-yaml-generator">
           <h3>
            Run the yaml generator
            <a class="headerlink" href="#run-the-yaml-generator" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            This will create two yaml files that will be used as inputs when creating the simulated data. There will be one yaml file for each exposure in an observation. In our case we have one F480M exposure per observation.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="c1"># Delete yaml files created in an earlier run</span>
<span class="n">old_yaml_files</span> <span class="o">=</span> <span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">odir</span><span class="p">,</span> <span class="s1">'jw*.yaml'</span><span class="p">))</span>
<span class="k">for</span> <span class="n">oldf</span> <span class="ow">in</span> <span class="n">old_yaml_files</span><span class="p">:</span>
    <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">oldf</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">yam</span> <span class="o">=</span> <span class="n">yaml_generator</span><span class="o">.</span><span class="n">SimInput</span><span class="p">(</span><span class="n">input_xml</span><span class="o">=</span><span class="n">xml_name</span><span class="p">,</span> <span class="n">pointing_file</span><span class="o">=</span><span class="n">pointing_name</span><span class="p">,</span>
                              <span class="n">catalogs</span><span class="o">=</span><span class="n">catalogues</span><span class="p">,</span> <span class="n">roll_angle</span><span class="o">=</span><span class="n">roll_angle</span><span class="p">,</span>
                              <span class="n">dates</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">reffile_defaults</span><span class="o">=</span><span class="n">reffile_defaults</span><span class="p">,</span>
                              <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">odir</span><span class="p">,</span>
                              <span class="n">simdata_output_dir</span><span class="o">=</span><span class="n">simdata_output_directory</span><span class="p">,</span>
                              <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>

<span class="n">yam</span><span class="o">.</span><span class="n">create_inputs</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Created yaml files"</span><span class="p">)</span>

<span class="c1"># Create yaml files for all observations.</span>
<span class="n">yaml_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">odir</span><span class="p">,</span> <span class="s1">'jw*.yaml'</span><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">yaml_files</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
            <div class="cell_output docutils container">
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-05-24 19:51:15,994 - mirage.yaml.yaml_generator - INFO - Running yaml_generator....
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-05-24 19:51:15,996 - mirage.yaml.yaml_generator - INFO - using APT xml file: ./mirage_input_files/niriss_ami_binary_2022.25coords.xml
</pre>
              </div>
             </div>
             <div class="output stream highlight-myst-ansi notranslate">
              <div class="highlight">
               <pre><span></span>2022-05-24 19:51:15,997 - mirage.yaml.yaml_generator - INFO - Original log file name: ./mirage_latest.log
</pre>
              </div>
             </div>
             <div class="output traceback highlight-ipythontb notranslate">
              <div class="highlight">
               <pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="nn">Input In [9],</span> in <span class="ni">&lt;cell line: 1&gt;</span><span class="nt">()</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">yam</span> <span class="o">=</span> <span class="n">yaml_generator</span><span class="o">.</span><span class="n">SimInput</span><span class="p">(</span><span class="n">input_xml</span><span class="o">=</span><span class="n">xml_name</span><span class="p">,</span> <span class="n">pointing_file</span><span class="o">=</span><span class="n">pointing_name</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span>                               <span class="n">catalogs</span><span class="o">=</span><span class="n">catalogues</span><span class="p">,</span> <span class="n">roll_angle</span><span class="o">=</span><span class="n">roll_angle</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span>                               <span class="n">dates</span><span class="o">=</span><span class="n">dates</span><span class="p">,</span> <span class="n">reffile_defaults</span><span class="o">=</span><span class="n">reffile_defaults</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span>                               <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">output_dir</span><span class="o">=</span><span class="n">odir</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>                               <span class="n">simdata_output_dir</span><span class="o">=</span><span class="n">simdata_output_directory</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>                               <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">yam</span><span class="o">.</span><span class="n">create_inputs</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="nb">print</span><span class="p">(</span><span class="s2">"Created yaml files"</span><span class="p">)</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/mirage/yaml/yaml_generator.py:329,</span> in <span class="ni">SimInput.__init__</span><span class="nt">(self, input_xml, pointing_file, datatype, reffile_defaults, reffile_overrides, use_JWST_pipeline, catalogs, cosmic_rays, background, roll_angle, dates, observation_list_file, verbose, output_dir, simdata_output_dir, dateobs_for_background, segmap_flux_limit, segmap_flux_limit_units, add_ghosts, convolve_ghosts_with_psf, convolve_extended_with_psf, offline)</span>
<span class="g g-Whitespace">    </span><span class="mi">326</span>     <span class="bp">self</span><span class="o">.</span><span class="n">segmentation_threshold_units</span> <span class="o">=</span> <span class="n">segmap_flux_limit_units</span>
<span class="g g-Whitespace">    </span><span class="mi">328</span> <span class="c1"># Expand the MIRAGE_DATA environment variable</span>
<span class="ne">--&gt; </span><span class="mi">329</span> <span class="bp">self</span><span class="o">.</span><span class="n">datadir</span> <span class="o">=</span> <span class="n">expand_environment_variable</span><span class="p">(</span><span class="n">ENV_VAR</span><span class="p">,</span> <span class="n">offline</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">offline</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">331</span> <span class="c1"># Check that CRDS-related environment variables are set correctly</span>
<span class="g g-Whitespace">    </span><span class="mi">332</span> <span class="bp">self</span><span class="o">.</span><span class="n">crds_datadir</span> <span class="o">=</span> <span class="n">crds_tools</span><span class="o">.</span><span class="n">env_variables</span><span class="p">()</span>

<span class="nn">File /usr/share/miniconda/lib/python3.9/site-packages/mirage/utils/utils.py:421,</span> in <span class="ni">expand_environment_variable</span><span class="nt">(variable_name, offline)</span>
<span class="g g-Whitespace">    </span><span class="mi">419</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">offline</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">420</span>     <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">variable_directory</span><span class="p">):</span>
<span class="ne">--&gt; </span><span class="mi">421</span>         <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">((</span><span class="s2">"The directory contained in the </span><span class="si">{}</span><span class="s2"> "</span>
<span class="g g-Whitespace">    </span><span class="mi">422</span>                                  <span class="s2">"environment variable: </span><span class="si">{}</span><span class="s2"> does not exist or "</span>
<span class="g g-Whitespace">    </span><span class="mi">423</span>                                  <span class="s2">"is not accessible."</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">variable_name</span><span class="p">,</span> <span class="n">variable_directory</span><span class="p">)))</span>
<span class="g g-Whitespace">    </span><span class="mi">424</span> <span class="k">return</span> <span class="n">variable_directory</span>

<span class="ne">FileNotFoundError</span>: The directory contained in the MIRAGE_DATA environment variable: /path/to/mirage_data/ does not exist or is not accessible.
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
          <div class="section" id="update-the-contents-of-yaml-files-and-generate-raw-data">
           <h3>
            Update the contents of yaml files and generate raw data
            <a class="headerlink" href="#update-the-contents-of-yaml-files-and-generate-raw-data" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <p>
            Updating the yaml files is not always required. We are doing it here to generate data without bad pixels and to make a few other modifications.
           </p>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">yaml_files</span><span class="p">:</span>

    <span class="c1"># set astrometric reference file to None to use pysiaf</span>
    <span class="c1"># To create data without bad pixels use the following reference files.</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">infile</span><span class="p">:</span>
        <span class="n">yaml_content</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">infile</span><span class="p">)</span>
    <span class="n">yaml_content</span><span class="p">[</span><span class="s1">'Reffiles'</span><span class="p">][</span><span class="s1">'astrometric'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'None'</span>
    <span class="n">yaml_content</span><span class="p">[</span><span class="s1">'simSignals'</span><span class="p">][</span><span class="s1">'psf_wing_threshold_file'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'config'</span>
    <span class="n">yaml_content</span><span class="p">[</span><span class="s1">'Reffiles'</span><span class="p">][</span><span class="s1">'linearized_darkfile'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'None'</span>
    <span class="n">yaml_content</span><span class="p">[</span><span class="s1">'simSignals'</span><span class="p">][</span><span class="s1">'psfpath'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'./ref_files_non_default/niriss_gridded_psf_library_newmask'</span>
    <span class="n">yaml_content</span><span class="p">[</span><span class="s1">'Reffiles'</span><span class="p">][</span><span class="s1">'gain'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'./ref_files_non_default/jwst_niriss_gain_general.fits'</span>
    <span class="n">yaml_content</span><span class="p">[</span><span class="s1">'Reffiles'</span><span class="p">][</span><span class="s1">'pixelflat'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'./ref_files_non_default/jwst_niriss_flat_general.fits'</span>
    <span class="n">yaml_content</span><span class="p">[</span><span class="s1">'Reffiles'</span><span class="p">][</span><span class="s1">'superbias'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'./ref_files_non_default/jwst_niriss_superbias_sim.fits'</span>

    <span class="k">if</span> <span class="s2">"jw01093001"</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">yaml_content</span><span class="p">[</span><span class="s1">'Reffiles'</span><span class="p">][</span><span class="s1">'dark'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'./ref_files_non_default/simdarks/dark000001/dark000001_uncal.fits'</span>
    <span class="k">elif</span> <span class="s2">"jw01093002"</span> <span class="ow">in</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">yaml_content</span><span class="p">[</span><span class="s1">'Reffiles'</span><span class="p">][</span><span class="s1">'dark'</span><span class="p">]</span> <span class="o">=</span> <span class="s1">'./ref_files_non_default/simdarks/dark000005/dark000005_uncal.fits'</span>

    <span class="n">modified_file</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">'.yaml'</span><span class="p">,</span> <span class="s1">'_mod.yaml'</span><span class="p">)</span>
    <span class="k">with</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">modified_file</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">yaml_content</span><span class="p">,</span> <span class="n">outfile</span><span class="p">,</span> <span class="n">default_flow_style</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">"Updated yaml files. The jw*_mod.yaml files will be used to create data"</span><span class="p">)</span>

    <span class="c1"># create data</span>
    <span class="n">t1</span> <span class="o">=</span> <span class="n">imaging_simulator</span><span class="o">.</span><span class="n">ImgSim</span><span class="p">()</span>
    <span class="n">t1</span><span class="o">.</span><span class="n">paramfile</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">modified_file</span><span class="p">)</span>
    <span class="n">t1</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="useful-output-products-generated-by-mirage">
          <h2>
           Useful output products generated by Mirage
           <a class="headerlink" href="#useful-output-products-generated-by-mirage" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <div class="highlight-default notranslate">
           <div class="highlight">
            <pre><span></span><span class="o">-</span> <span class="n">jw01093001001_01101_00001_nis_uncal_pointsources</span><span class="o">.</span><span class="n">list</span> <span class="ow">and</span> 
  <span class="n">jw01093002001_01101_00001_nis_uncal_pointsources</span><span class="o">.</span><span class="n">list</span><span class="o">.</span> <span class="n">The</span> <span class="n">first</span> <span class="n">line</span> <span class="n">of</span> 
  <span class="n">jw01093001001_01101_00001_nis_uncal_pointsources</span><span class="o">.</span><span class="n">list</span> <span class="n">shows</span> <span class="n">coordinates</span> <span class="n">of</span> <span class="n">AB</span> <span class="n">Dor</span><span class="p">,</span> <span class="n">the</span>
  <span class="n">pixel</span> <span class="n">coordinates</span> <span class="n">at</span> <span class="n">which</span> <span class="n">the</span> <span class="n">data</span> <span class="ow">is</span> <span class="n">simulated</span><span class="p">,</span> <span class="n">magnitude</span> <span class="ow">and</span> <span class="n">total</span> <span class="n">count</span> <span class="n">rate</span><span class="o">.</span>
   
<span class="o">-</span> <span class="n">jw01093001001_01101_00001_nis_uncal_F480M_NRM_final_seed_image</span><span class="o">.</span><span class="n">fits</span> <span class="ow">and</span>  
  <span class="n">jw01093002001_01101_00001_nis_uncal_F480M_NRM_final_seed_image</span><span class="o">.</span><span class="n">fits</span>
  <span class="n">A</span> <span class="n">seed</span> <span class="n">image</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">noiseless</span> <span class="n">image</span> <span class="n">that</span> <span class="n">contains</span> <span class="n">signal</span> <span class="n">only</span> <span class="kn">from</span> <span class="nn">simulated</span> 
  <span class="n">astronomical</span> <span class="n">sources</span><span class="o">.</span> <span class="n">It</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span> <span class="k">for</span> <span class="n">quality</span> <span class="n">checks</span> <span class="n">on</span> <span class="n">the</span> <span class="n">final</span> <span class="n">output</span> <span class="n">data</span><span class="o">.</span>

<span class="o">-</span> <span class="n">jw01093001001_01101_00001_nis_uncal</span><span class="o">.</span><span class="n">fits</span> <span class="ow">and</span> <span class="n">jw01093002001_01101_00001_nis_uncal</span><span class="o">.</span><span class="n">fits</span>
  <span class="n">AB</span> <span class="n">Dor</span> <span class="ow">and</span> <span class="n">HD37093</span> <span class="n">raw</span> <span class="n">data</span>
</pre>
           </div>
          </div>
          <div class="section" id="examine-the-seed-images">
           <h3>
            Examine the seed images
            <a class="headerlink" href="#examine-the-seed-images" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">data_seed</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">data_seed</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">seed_images</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">'mirage_sim_data/jw*final_seed_image.fits'</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">seed_images</span><span class="p">):</span>
    <span class="n">seed_im</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">seed_im</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">seed_im</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">im</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">data_seed</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_seed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">data_seed</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1">#Temporarily adding the two lines below. </span>
<span class="c1">#Plots are rendered only when cell 1 is run twice.</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"AB-Dor seed image"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_seed</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">'lower'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"HD37093 seed image"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data_seed</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">'lower'</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="k">def</span> <span class="nf">find_location_of_peak</span><span class="p">(</span><span class="n">image</span><span class="p">):</span>
    <span class="sd">""" Find the location of PSF peak when bad pixels are not present"""</span>
    <span class="n">peak_location</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">image</span> <span class="o">==</span> <span class="n">image</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
    <span class="n">y_peak</span> <span class="o">=</span> <span class="n">peak_location</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">x_peak</span> <span class="o">=</span> <span class="n">peak_location</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"x_peak_python,y_peak_python"</span><span class="p">,</span> <span class="n">x_peak</span><span class="p">,</span> <span class="n">y_peak</span><span class="p">)</span>
    <span class="n">y_peak_ds9</span> <span class="o">=</span> <span class="n">y_peak</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">x_peak_ds9</span> <span class="o">=</span> <span class="n">x_peak</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">"x_peak_ds9,y_peak_ds9"</span><span class="p">,</span> <span class="n">x_peak_ds9</span><span class="p">,</span> <span class="n">y_peak_ds9</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">x_peak</span><span class="p">,</span> <span class="n">y_peak</span>

<span class="n">POS1</span> <span class="o">=</span> <span class="n">find_location_of_peak</span><span class="p">(</span><span class="n">data_seed</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">POS1</span><span class="p">)</span>

<span class="k">if</span> <span class="n">POS1</span> <span class="o">!=</span> <span class="p">(</span><span class="mi">45</span><span class="p">,</span> <span class="mi">40</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">'****************WARNING: PSF placement is not correct****************'</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="section" id="compare-peak-pixel-count-rate-for-ab-dor-seed-image-with-peak-count-rate-in-equivalent-jwst-etc-calculation">
            <h4>
             Compare peak pixel count rate for AB-Dor seed image with peak count rate in equivalent JWST ETC calculation
             <a class="headerlink" href="#compare-peak-pixel-count-rate-for-ab-dor-seed-image-with-peak-count-rate-in-equivalent-jwst-etc-calculation" title="Permalink to this headline">
              ¶
             </a>
            </h4>
            <div class="cell docutils container">
             <div class="cell_input docutils container">
              <div class="highlight-ipython3 notranslate">
               <div class="highlight">
                <pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">"Pixel count rate for AB-Dor simulated image"</span><span class="p">,</span> <span class="n">data_seed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="s2">"ADU/s"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">"Pixel count rate for AB-Dor simulated image"</span><span class="p">,</span> <span class="n">data_seed</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1.61</span><span class="p">,</span> <span class="s2">"electrons/s"</span><span class="p">)</span>
<span class="c1"># Upload screenshot from the ETC workbook.</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span>
<span class="n">Image</span><span class="p">(</span><span class="s2">"AB_Dor_ngroup5_nint65_F480M_jwetc_calc.png"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
</pre>
               </div>
              </div>
             </div>
            </div>
            <p>
             Comparison of the peak pixel count rate for AB-Dor simulated data with an equivalent JWST ETC calculation shows that the ETC peak pixel count rate of 71388.43 electrons/sec closely matches Mirage simulation.
            </p>
           </div>
          </div>
          <div class="section" id="examine-output-point-source-list-file-jw01093001001-01101-00001-nis-uncal-pointsources-list">
           <h3>
            Examine output point source list file ‘jw01093001001_01101_00001_nis_uncal_pointsources.list’
            <a class="headerlink" href="#examine-output-point-source-list-file-jw01093001001-01101-00001-nis-uncal-pointsources-list" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="c1"># Field center (degrees):   82.18741002   -65.44767991 y axis rotation angle (degrees): 108.118419  image size: 0080 0080</span>
<span class="c1">#</span>
<span class="c1">#    Index   RA_(hh:mm:ss)   DEC_(dd:mm:ss)   RA_degrees      DEC_degrees     pixel_x   pixel_y    magnitude   counts/sec    counts/frame    TSO_lightcurve_catalog</span>
<span class="mi">1</span> <span class="mi">05</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">44.9772</span> <span class="o">-</span><span class="mi">65</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mf">51.6315</span>    <span class="mf">82.18740518</span>   <span class="o">-</span><span class="mf">65.44767541</span>    <span class="mf">45.198</span>    <span class="mf">39.816</span>      <span class="mf">4.610</span>   <span class="mf">1.797615e+07</span>    <span class="mf">1.356121e+06</span>  <span class="kc">None</span>
<span class="mi">2</span> <span class="mi">05</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">44.9211</span> <span class="o">-</span><span class="mi">65</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mf">51.5351</span>    <span class="mf">82.18717120</span>   <span class="o">-</span><span class="mf">65.44764863</span>    <span class="mf">44.842</span>    <span class="mf">34.305</span>      <span class="mf">8.813</span>   <span class="mf">3.745042e+05</span>    <span class="mf">2.825260e+04</span>  <span class="kc">None</span>
<span class="mi">3</span> <span class="mi">05</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">44.4833</span> <span class="o">-</span><span class="mi">65</span><span class="p">:</span><span class="mi">26</span><span class="p">:</span><span class="mf">46.0343</span>    <span class="mf">82.18534722</span>   <span class="o">-</span><span class="mf">65.44612065</span>   <span class="mf">110.711</span>   <span class="o">-</span><span class="mf">31.926</span>      <span class="mf">7.500</span>   <span class="mf">1.255616e+06</span>    <span class="mf">9.472364e+04</span>  <span class="kc">None</span>
<span class="mi">5</span> <span class="mi">05</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mf">46.4246</span> <span class="o">-</span><span class="mi">65</span><span class="p">:</span><span class="mi">27</span><span class="p">:</span><span class="mf">10.7820</span>    <span class="mf">82.19343600</span>   <span class="o">-</span><span class="mf">65.45299500</span>  <span class="o">-</span><span class="mf">186.533</span>   <span class="mf">263.381</span>     <span class="mf">13.792</span>   <span class="mf">3.819238e+03</span>    <span class="mf">2.881233e+02</span>  <span class="kc">None</span>
</pre>
            </div>
           </div>
           <p>
            It would be worth noting the expected magnitude contrast in F480M is 4.2 magnitudes, and the pixel offset of the faint companion is -0.356, -5.511 pixels in x and y based on the output point source list.
           </p>
          </div>
          <div class="section" id="compare-total-count-rate-in-the-seed-image-with-total-count-rate-in-the-output-pointsource-list-file">
           <h3>
            Compare total count rate in the seed image with total count rate in the output pointsource list file.
            <a class="headerlink" href="#compare-total-count-rate-in-the-seed-image-with-total-count-rate-in-the-output-pointsource-list-file" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <div class="highlight-default notranslate">
            <div class="highlight">
             <pre><span></span><span class="n">counts</span><span class="o">/</span><span class="n">sec</span> <span class="ow">in</span> <span class="n">jw01093001001_01101_00001_nis_uncal_pointsources</span><span class="o">.</span><span class="n">list</span> 
<span class="ow">is</span> <span class="mf">1.797615e+07</span> <span class="n">ADU</span><span class="o">/</span><span class="n">sec</span>

<span class="n">Throughput</span> <span class="n">of</span> <span class="n">NRM</span> <span class="ow">is</span> <span class="o">~</span><span class="mf">0.155</span>
<span class="n">counts</span><span class="o">/</span><span class="n">sec</span> <span class="k">with</span> <span class="n">non</span> <span class="n">redundant</span> <span class="n">mask</span> <span class="p">(</span><span class="n">NRM</span><span class="p">)</span> <span class="o">=</span> <span class="mf">1.797615e+07</span> <span class="n">ADU</span><span class="o">/</span><span class="n">sec</span> <span class="o">*</span> <span class="mf">0.155</span> 
                                         <span class="o">=</span> <span class="mf">2786303.25</span> <span class="n">ADU</span><span class="o">/</span><span class="n">sec</span>
                                         
<span class="n">The</span> <span class="n">total</span> <span class="n">count</span> <span class="n">rate</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">seed</span> <span class="n">image</span> <span class="ow">is</span> <span class="mf">2662913.1485110847</span> <span class="n">ADU</span><span class="o">/</span><span class="n">sec</span><span class="o">.</span> <span class="n">The</span> <span class="n">seed</span> <span class="n">image</span> <span class="ow">is</span> <span class="mi">80</span><span class="n">x80</span> <span class="n">pixels</span> <span class="ow">and</span> 
<span class="n">therefore</span> <span class="n">SUB80</span> <span class="n">observations</span> <span class="n">are</span> <span class="n">subject</span> <span class="n">to</span> <span class="n">aperture</span> <span class="n">losses</span> <span class="n">that</span> <span class="n">cause</span> <span class="n">this</span> <span class="n">discrepancy</span><span class="o">.</span>
</pre>
            </div>
           </div>
          </div>
          <div class="section" id="examine-the-raw-data">
           <h3>
            Examine the raw data
            <a class="headerlink" href="#examine-the-raw-data" title="Permalink to this headline">
             ¶
            </a>
           </h3>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">datafiles</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">'mirage_sim_data/jw*uncal.fits'</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">datafiles</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
           <div class="cell docutils container">
            <div class="cell_input docutils container">
             <div class="highlight-ipython3 notranslate">
              <div class="highlight">
               <pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">df</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">datafiles</span><span class="p">):</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">fits</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">file</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
    <span class="n">im</span> <span class="o">=</span> <span class="n">file</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">data</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">im</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
    <span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">im</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"AB-Dor"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">4</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">'lower'</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"HD37093"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">11</span><span class="p">],</span> <span class="n">origin</span><span class="o">=</span><span class="s1">'lower'</span><span class="p">)</span>
</pre>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
         <div class="section" id="calibrate-raw-data-uncal-fits-files-with-the-jwst-pipiline">
          <h2>
           Calibrate raw data (_uncal.fits files) with the JWST pipiline
           <a class="headerlink" href="#calibrate-raw-data-uncal-fits-files-with-the-jwst-pipiline" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           Use 2_niriss_ami_binary.ipynb to calibrate the data with JWST pipeline.
          </p>
         </div>
         <div class="section" id="aditional-resources">
          <h2>
           Aditional Resources
           <a class="headerlink" href="#aditional-resources" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <ul class="simple">
           <li>
            <p>
             <a class="reference external" href="https://jwst-docs.stsci.edu/near-infrared-imager-and-slitless-spectrograph/niriss-observing-modes/niriss-aperture-masking-interferometry">
              NIRISS AMI JDox
             </a>
            </p>
           </li>
          </ul>
         </div>
         <div class="section" id="about-this-notebook">
          <h2>
           About this notebook
           <a class="headerlink" href="#about-this-notebook" title="Permalink to this headline">
            ¶
           </a>
          </h2>
          <p>
           <strong>
            Author:
           </strong>
           Deepashri Thatte, Kevin Volk
           <strong>
            Updated On:
           </strong>
           2020-12-18
          </p>
          <hr class="docutils"/>
          <p>
           <a class="reference external" href="#top">
            Top of Page
           </a>
           <img alt="Space Telescope Logo" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="float: right;" width="200px"/>
          </p>
         </div>
        </div>
        <script type="text/x-thebe-config">
         {
        requestKernel: true,
        binderOptions: {
            repo: "spacetelescope/jdat_notebooks",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/niriss_ami_binary"
        },
        predefinedOutput: true
    }
        </script>
        <script>
         kernelName = 'python3'
        </script>
       </div>
       <!-- Previous / next buttons -->
       <div class="prev-next-area">
        <a class="left-prev" href="../NIRISS_WFSS_postpipeline/03.%20Spatially%20resolved%20emission%20line%20map.html" id="prev-link" title="previous page">
         <i class="fas fa-angle-left">
         </i>
         <div class="prev-next-info">
          <p class="prev-next-subtitle">
           previous
          </p>
          <p class="prev-next-title">
           WFSS Spectra - Emission Line Map
          </p>
         </div>
        </a>
        <a class="right-next" href="2_niriss_ami_binary.html" id="next-link" title="next page">
         <div class="prev-next-info">
          <p class="prev-next-subtitle">
           next
          </p>
          <p class="prev-next-title">
           NIRISS AMI: Pipeline
          </p>
         </div>
         <i class="fas fa-angle-right">
         </i>
        </a>
       </div>
      </div>
     </div>
     <footer class="footer">
      <p>
       By STScI
       <br/>
       © Copyright 2022.
       <br/>
      </p>
     </footer>
    </main>
   </div>
  </div>
  <script src="../../_static/js/index.be7d3bbb2ef33a8344ce.js">
  </script>
 </body>
</html>